/*!
 * c2i - v7.5.0 (http://casual-insight.com)
 * Copyright 2016-2022 by Han Jong In (한종인)
 * Licensed under Commercial
 */

!function(){if("undefined"==typeof d3||"7"!==d3.version.charAt(0))throw new Error("C2I (Chart Intelligence & Insight) require D3 v7.");const c2i={version:d3.version,copyRighter:"Han Jong In (한종인)"};c2i.chart=c2i.chart||{},c2i.map=c2i.map||{},c2i.bi=c2i.bi||{},c2i.dumbo=c2i.dumbo||{},c2i.infoG=c2i.infoG||{},c2i.ui=c2i.ui||{},c2i.meta=c2i.meta||{},c2i.ai=c2i.ai||{},c2i.util=c2i.util||{},c2i.resizers=c2i.resizers||[],c2i.util.mergeByKey=((t,e,a)=>[...t.concat(e).reduce((t,e)=>t.set(e[a],Object.assign(t.get(e[a])||{},e)),new Map).values()]),c2i.util.initTooltip=(t=>t.select("table").html(function(){return'<thead><tr><th colspan="4" class="tipHeader"><div class="c2iCloseBtn" title="닫기">&#10062;</div><p><strong><span id="name">판매본부</span></strong></p><p id="measure" style="font-size: 14px; color: yellow">1,200</p><hr style="margin: 2px 0px; opacity: 0.5" /><p id="ratio"></p></th></tr></thead>'})),c2i.util.flatToStratify=((t,e)=>d3.stratify().id(t=>t[e.id]).parentId(t=>t[e.parentId])(t)),c2i.util.korean=(t=>new RegExp(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/).test(t)),c2i.util.genWords=((t,e)=>{const a={},o=t=>{a[t]?a[t]+=1:t&&(a[t]=1)};t=(t=t.replace(/[^\w\sㄱ-힣|[a-z]|[A-Z]]/g,"")).replace(/[\\\n]|[\\\t]|[_][{}[\]/?.,;:|)*~`!^\-_+<>@#$%&\\=('"]/gi,"").trim(),e?(e=e.replace(/\s/g,""),t.split(" ").forEach(t=>{let a=t.toLowerCase();-1===e.indexOf(a+",")&&o(a)})):t.split(" ").forEach(t=>{let e=t.toLowerCase();o(e)});const n=[];for(let t in a)n.push({word:t,frequency:a[t]});return n}),c2i.util.stanMoment=((t,e)=>{const a=d3.mean(t),o=d3.deviation(t),n=t.length;let r=0;for(var l=0;l<n;l++)r+=Math.pow((t[l]-a)/o,e);return r/t.length}),c2i.util.skewness=(t=>c2i.util.stanMoment(t,3)),c2i.util.kurtosis=(t=>c2i.util.stanMoment(t,4)-3),c2i.util.kdeFn=((t,e,a)=>e.map(e=>[e,d3.mean(a,a=>t(e-a))])),c2i.util.epanechnikovFn=(t=>e=>Math.abs(e/=t)<=1?.75*(1-e*e)/t:0),c2i.util.imgSrc=(t=>(t&&(c2i.util._imgSrc=t),c2i.util._imgSrc?c2i.util._imgSrc:"../assets/images/c2i/")),c2i.util.mapSrc=(t=>(t&&(c2i.util._mapSrc=t),c2i.util._mapSrc?c2i.util._mapSrc:"../assets/map/")),c2i.util.preset=(t=>{return`DDMV_${t.graphType?t.graphType:"Insight"}_v${c2i.version}`}),c2i.util.formatAll=((t,e,a)=>{let o;return o=t?d3.format(t):e}),c2i.util.renderLegend=(t=>{let{cfg:e,chart:a,_svg:o,dim:n,_extent:r,color:l,_lgScale:i}={...t};if(isNaN(r[0])||isNaN(r[1]))return;let{_xAxis:s,_dragLgHandle:c,_dragH:d,_lgWH:u,_lgData:m}={...t},{lgMouseEnter:p,lgMouseLeave:g,lgClick:f,_dimAll:h}={...t},{_gradeInfo:y,_xStart:_,scale:x,rotate:v}={...t};const b=e.title.subFonts,k=parseInt(b[1]),C=r,w="calView"===e.graphType?e.node.isVertical:e.area.isVertical;C[0]===C[1]&&(C[0]=C[0]*(C[0]>0?.9:1.1),C[1]=C[1]*(C[1]>0?1.1:.9));const N=l.range().map(t=>l.invertExtent(t)),A=C[1];N[N.length-1][1]=A+(A>=0?1e-6:-1e-6);const L="Quantile"===x?l.quantiles():l.thresholds();i.domain(C),s.scale(i).tickValues([...new Set(L)]).tickFormat(t=>n.format(t));let D,S,T,M,F=o.select(".c2iLgQuantile");if(F.empty()){T=0,M="start";const t=(F=o.append("g").attr("class","c2iLgQuantile").attr("transform","translate("+[_()]+")")).append("text").call(c).attrs({cursor:"move",class:"unit"}).attr("transform",`translate(${T}, ${k})`).style("text-anchor",M).style("font-family",b[0]).style("font-size",b[1]).style("fill",b[2]);t.append("tspan").attr("class","lgCaption").text(n.caption+" "+n.unitNm);const e=t.append("tspan").attr("class","lgValue").style("fill",b[3]);w?e.attr("x",0).attr("dy",k):e.attr("dx",5)}S=e.node?e.node.contentGab:e.area.contentGab,w?(D=u/2-12,S+=2.5*k):D=0;let I=F.selectAll(".lgContent").data([null]);(I=I.enter().append("g").attr("class","lgContent").call(d).merge(I)).attr("transform",`translate(${D}, ${S})`),m=function(t){const e=t.map(y);if(a.isAvg())return e;const o={...h.value()};return e.map(t=>(t.sumR=0!==o.yVal?t.ndSum/o.yVal:0,t))}(N);const B=I.selectAll("rect.lgRect").data(m);B.exit().remove(),B.enter().insert("rect",".lgRect").on("mouseenter",p).on("mouseleave",g).on("click",function(t,e){if(!f)return;let a=c2i.util.getIndex(I.selectAll(".lgRect"),t.currentTarget);f(t,e,a)}).merge(B).attr(w?"width":"height",12).attr("class",t=>"lgRect c_"+l(t.from).substr(1)).attr("x",t=>w?O():i(t.from)).attr("y",t=>w?i(t.to):R()).style("fill",t=>l(t.from)).attr(w?"height":"width",t=>Math.abs(i(t.from)-i(t.to))),w?(D=O(),S=0):(D=0,S=R());const E=w?"y":"x",G=w?".y.axis":".x.axis";let P=I.selectAll(G).data([null]);return(P=P.enter().append("g").merge(P).attr("class",E+" axis").call(s)).attr("transform","translate("+[D,S]+")"),P.select("path.domain").remove(),P.selectAll(G+" line").style("stroke","dimgray").style("pointer-events","none"),P.selectAll(".tick").each(function(t,e){let a,o;if(e%2)w?(a="start",o=20):(a="end",o=18);else{w?(a="end",o=-5):(a="start",o=-10);const t=c2i.util.transform(d3.select(this).attr("transform")),e=w?[-3,t.translate[1]]:[t.translate[0],-3];d3.select(this).attr("transform","translate("+[e]+")")}d3.select(this).select("text").attr("text-anchor",a).attr(w?"x":"y",o),v&&d3.select(this).select("text").attr("transform",()=>"rotate("+v+")")}),I.select(".indicator").empty()&&I.append("line").attr("class","indicator").style("pointer-events","none").style("stroke","red").style("stroke-width","3px").attr("stroke-opacity",0),w?I.select(".indicator").attrs({x1:O()-3,x2:O()+17}).attrs({y1:10,y2:10}):I.select(".indicator").attrs({y1:R()-3,y2:R()+17}).attrs({x1:10,x2:10}),a.isAvg()||function(t,e){const o=e.length,r=Math.max(9,50/o),i=r+1,s=w?u/2:u+30,c=w?u+4*k:3,m=a.isAvg()?t=>t.ndAvg:t=>t.ndSum,h=d3.scaleLinear().domain(d3.extent(e,m)).range([0,50]),y=h.domain()[0]<0?0:h.domain()[0];let _=e.filter(t=>0===m(t));_=_.length>1?a.isAvg()?e.map(t=>(t.ndAvg=0===t.ndAvg?1e-5*Math.random():t.ndAvg,t)):e.map(t=>(t.ndSum=0===t.ndSum?1e-5*Math.random():t.ndSum,t)):[...e];const x=d3.scaleOrdinal().domain(_.map(m)).range(l.range()),v=t.selectAll("g.lgStatInfo").data([null]);let b=v.enter().append("g").attrs({cursor:"move",class:"lgStatInfo"}).call(d).attr("transform","translate("+[s,c]+")");b.append("line").attr("stroke-width",.5).style("pointer-events","none").merge(v.select("line")).attr("y1",0).attr("y2",i*o-1).attr("stroke-dasharray",()=>y>0?0:3).attr("stroke",()=>y>0?n.fonts[2]:"red").attr("x1",h(y)).attr("x2",h(y)),b=b.merge(v),_=_.map(t=>t).sort((t,e)=>e.from-t.from);const C=b.selectAll("rect.c2iFore").data(_);C.exit().remove(),C.enter().insert("rect","line").merge(C).attr("class",t=>"c2iFore c_"+x(m(t)).substr(1)).attr("height",r).style("fill",t=>x(m(t))).attr("x",t=>h(Math.min(y,m(t)))).attr("y",(t,e)=>i*e).attr("width",t=>Math.abs(h(m(t))-h(y)));const N=b.selectAll("text").data(_);N.exit().remove(),N.enter().append("text").style("font-family",n.fonts[0]).style("font-size","10px").style("fill",n.fonts[2]).style("pointer-events","none").style("text-anchor","end").merge(N).attr("class",t=>"c_"+x(m(t)).substr(1)).attr("x",80).attr("y",(t,e)=>i*e+(r-1)).text(t=>d3.format(".1%")(t.sumR));const A=b.selectAll("rect.c2iGhost").data(_);A.exit().remove(),A.enter().append("rect").on("mouseenter",p).on("mouseleave",g).on("click",(t,e)=>f(t,e,-9)).style("fill","transparent").merge(A).attr("x",0).attr("class",t=>"c2iGhost c_"+x(m(t)).substr(1)).attr("width",80).attr("height",r).attr("y",(t,e)=>i*e)}(F,m),{_lgScale:i,_xAxis:s,_lgData:m};function O(){return Math.max(32,4.2*m.length)}function R(){return Math.max(32,k+4.2*m.length)}}),c2i.util.lgStatInfo=(t=>{if(!t.item)return;let{item:e,idx:a,chart:o,cfg:n,color:r}={...t},{_lgData:l,_dragHtml:i,_table:s,_cntFmt:c,tFmt:d,clsNm:u}={...t};const m=n.yDim,p=n.y2Dim,g=r.range()[a],f=d3.format(",.1%"),h=a===l.length-1?" ≤ ":" < ";let y,_=d3.select(n.id).select(".c2iLegendTip"),{ndSum:x,sumR:v,ndAvg:b,ndCnt:k,ndMax:C,ndMin:w}={...e},{nY2Val:N,y2ValAvg:A,from:L,to:D}={...e},S=m.caption+(m.unitNm?" "+m.unitNm:""),T=o.isAvg()?"450px":n.tooltip&&n.tooltip.width?n.tooltip.width+"px":"500px";if(S=d(L)+" ≤ "+S+h+d(D),_.empty()){_=d3.select(n.id).append("div").style("top","-100px").style("left","130px").attr("class","c2iLegendTip c2iTooltip").style("pointer-events","all").style("cursor","move").call(i);const t=(s=_.append("table").style("width",T)).append("thead");y=s.append("tbody");const e=t.append("tr").append("th").attr("colspan",o.isAvg()?5:"countryMap"===n.graphType?6:8);e.append("div").attr("class","c2iShrinkBtn").html("&#9940;").on("touchstart",()=>B(y)).on("click",()=>B(y)),e.append("p").attr("class","tipHeader").text(S),e.append("div").attr("class","c2iCloseBtn").on("touchstart",E).on("click",E).attr("title","닫기").html("&#10062;");const{cm:a,gen:r}={...c2i.lang};let l;l=o.isAvg()?[[a.min,a.max,a.avg,a.areas,a.count2],["cm.min","cm.max","cm.avg","cm.areas","cm.count2"],[d(w),d(C),d(b),c(k),c(N)]]:"countryMap"===n.graphType?[[a.sum,a.min,a.max,a.avg,a.areas,p.caption],["cm.sum","cm.min","cm.max","cm.avg","cm.areas","c2i.dummy"],[d(x),d(w),d(C),d(b),c(k),d(N)]]:[[a.min,a.max,a.sum,r.ratio,a.days,a.avgDay,a.count2,a.avgItem],["cm.min","cm.max","cm.sum","gen.ratio","cm.days","cm.avgDay","cm.count2","cm.avgItem"],[d(w),d(C),d(x),f(v),c(k),d(b),c(N),d(A)]],G(y,l[0],"tipRowHeaderR","th",l[1]),G(y,l[2],"number","td"),y.append("tr").attr("class",u)}else{let t;s=_.select("table"),y=s.select("tbody"),_.select(".tipHeader").text(S),o.isAvg()?t=[d(w),d(C),d(b),c(k),c(N)]:"countryMap"===n.graphType?(_.selectAll(".tipRowHeaderR").each(function(){"c2i.dummy"===d3.select(this).attr("data-c2i18n")&&d3.select(this).text(p.caption)}),t=[d(x),d(w),d(C),d(b),c(k),d(N)]):t=[d(w),d(C),d(x),f(v),c(k),d(b),c(N),d(A)],_.selectAll(".number").data(t).text(t=>t)}const{r:M,g:F,b:I}={...d3.rgb(g)};return _.selectAll("th, td").style("border","1px solid "+d3.rgb(M,F,I,.6)),{idx:a,_table:s};function B(t){s.empty()||t.classed("c2iHidden",!t.classed("c2iHidden"))}function E(){_&&_.classed("c2iHidden",!0)}function G(t,e,a,o,n){t.append("tr").selectAll(o).data(e).enter().append(o).attr("class",a).attr("data-c2i18n",(t,e)=>n?n[e]:null).text(t=>t)}}),c2i.util.symbols={circle:d3.symbolCircle,cross:d3.symbolCross,diamond:d3.symbolDiamond,square:d3.symbolSquare,star:d3.symbolStar,triangle:d3.symbolTriangle,wye:d3.symbolWye},c2i.util.curve={basis:d3.curveBasis,linear:d3.curveLinear,step:d3.curveStep,cardinal:d3.curveCardinal,monotone:d3.curveMonotoneX,curveMonotoneY:d3.curveMonotoneY,natural:d3.curveNatural,catmullRom:d3.curveCatmullRom},c2i.util.ease={elastic:d3.easeElastic,bounce:d3.easeBounce,linear:d3.easeLinear,sin:d3.easeSin,quad:d3.easeQuad,cubic:d3.easeCubic,poly:d3.easePoly,circle:d3.easeCircle,exp:d3.easeExp,back:d3.easeBack},c2i.util.ORDERS={none:d3.stackOrderNone,reverse:d3.stackOrderReverse,asc:d3.stackOrderAscending,desc:d3.stackOrderDescending,appearance:d3.stackOrderAppearance,inOut:d3.stackOrderInsideOut},c2i.util.OFFSETS={none:d3.stackOffsetNone,expand:d3.stackOffsetExpand,diverge:d3.stackOffsetDiverging,silhouette:d3.stackOffsetSilhouette,wiggle:d3.stackOffsetWiggle},c2i.util.alert=(t=>{console.log(t),alert(t)}),c2i.util.alert2=((t,e)=>{console.log(e),t&&alert(e)}),c2i.util.transform=(t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttributeNS(null,"transform",t);const a=e.transform.baseVal.consolidate().matrix;return{translate:[a.e,a.f]}}),c2i.util.getColorContrast=(t=>{let e=d3.rgb(t);return(e=.299*e.r+.587*e.g+.114*e.b)<125?"#eee":"#000"}),c2i.util.getScale=((t="linear")=>{switch(t.toLowerCase()){case"band":return d3.scaleBand();case"point":return d3.scalePoint();case"ordinal":return d3.scaleOrdinal();case"log":return d3.scaleLog().clamp(!0);case"sqrt":return d3.scaleSqrt().clamp(!0);case"time":return d3.scaleTime().clamp(!0);case"quantile":return d3.scaleQuantile();default:return d3.scaleLinear().clamp(!0)}}),c2i.util.setTheme=((t,e,a)=>{t.theme="none"===t.theme?null:t.theme;const o=d3.select(e).select("svg");o.empty()||(o.style("background",t.theme?t.theme:null),a&&parseInt(o.style("width"))>350&&o.style("opacity",.5).transition().duration(2*t.duration).style("opacity",1))}),c2i.util.resetTooltip=((t,e,a,o)=>{t.select("table").style("width",e),t.selectAll(["table hr","table #ratio"]).style("display",a),t.select("tbody").style("display",o||null)}),c2i.util.setTitle=(t=>{const e=t.title;e&&"object"==typeof e&&(e.caption=void 0===e.caption?"":e.caption,e.fonts=void 0===e.fonts?["helvetica","20px","#434343"]:e.fonts,e.gap=void 0===e.gap?5:e.gap,e.xPos=void 0===e.xPos?"middle":e.xPos,e.yPos=void 0===e.yPos?"top":e.yPos,e.opacity=void 0===e.opacity?1:e.opacity,"string"==typeof e.fonts&&(e.fonts=e.fonts.split("/")),e.fonts&&3===e.fonts.length||(t.fonts=["helvetica","16px","white"]),"string"==typeof e.subFonts&&(e.subFonts=e.subFonts.split("/")),e.subFonts&&4===e.subFonts.length||(t.subFonts=["helvetica","11px","white","#CFDD3F"]))}),c2i.util.rebind=function(t,e){let a,o=1;const n=arguments.length;for(;++o<n;)t[a=arguments[o]]=c2i.util.d3_rebind(t,e,e[a]);return t},c2i.util.d3_rebind=function(t,e,a){return function(){const o=a.apply(e,arguments);return o===e?t:o}},c2i.util.multiValuesFilter=(t=>e=>-1!==t.indexOf(e)),c2i.util.idenfityFn=(t=>t),c2i.util.colNmFn=(t=>e=>e[t]),c2i.util.rounded=(t=>{let e=()=>{};switch(t){case"floor":case"round":case"ceil":e=Math[t];break;case"hour":e=d3.timeHour;break;case"day":e=d3.timeDay;break;case"week":e=d3.timeWeek;break;case"month":e=d3.timeMonth;break;case"year":e=d3.timeYear;break;default:c2i.util.alert("rounded 유형(floor,round etc) 설정 오류.\n 정상 실행 불가..!!")}return e}),c2i.util.topDimFn=((t,e)=>Math.min(e,d[t])),c2i.util.minTopDimFn=((t,e,a)=>o=>Math.max(e,Math.min(a,o[t]))),c2i.util.minMaxHourDimFn=((t,e,a,o)=>n=>Math.max(e,Math.min(a,n[t].getHours()+n[t].getMinutes()/o))),c2i.util.hourDimFn=(t=>e=>e[t].getHours()),c2i.util.yearDimFn=(t=>e=>e[t].getFullYear()),c2i.util.year2DimFn=(t=>e=>+e[t].getFullYear().toString().substr(2,2)),c2i.util.season={0:"겨울",1:"겨울",2:"봄",3:"봄",4:"초여름",5:"여름",6:"여름",7:"여름",8:"초가을",9:"가을",10:"가을",11:"겨울"},c2i.util.seasonDimFn=(t=>e=>{const a=e[t].getMonth();return c2i.util.season[a]?c2i.util.season[a]:"계절누락"}),c2i.util.quarterDimFn=(t=>e=>{const a=e[t].getMonth();return a<=2?"Q1":a>2&&a<=5?"Q2":a>5&&a<=8?"Q3":"Q4"}),c2i.util.halfDimFn=(t=>e=>e[t].getMonth()<=5?"상반기":"하반기"),c2i.util.monthDimFn=(t=>e=>("0"+(e[t].getMonth()+1)).slice(-2)),c2i.util.ddDimFn=(t=>e=>e[t].getDate()),c2i.util.weekday=["일","월","화","수","목","금","토"],c2i.util.weekDimFn=(t=>e=>c2i.util.weekday[e[t].getDay()]),c2i.util.userObjDimFn=((t,e)=>a=>{const o=e[a[t]];return o||"설정누락"}),c2i.util.userArrDimFn=((t,e,a)=>{const o=e[t+a];return o||"설정누락"}),c2i.util.dimFn=((t,e)=>{const a=c2i.util;let o;return o="yearOnly"===t.roundType?a.yearDimFn(t.groupBy):"year2Only"===t.roundType?a.year2DimFn(t.groupBy):"seasonOnly"===t.roundType?a.seasonDimFn(t.groupBy):"halfOnly"===t.roundType?a.halfDimFn(t.groupBy):"monthOnly"===t.roundType?a.monthDimFn(t.groupBy):"ddOnly"===t.roundType?a.ddDimFn(t.groupBy):"hourOnly"===t.roundType?a.hourDimFn(t.groupBy):"weekOnly"===t.roundType?a.weekDimFn(t.groupBy):e.intervalMinutes?a.minMaxHourDimFn(t.groupBy,e.minMax[0],e.topValue,e.intervalMinutes):"c2iFact"===t.groupBy?a.minTopDimFn(t.fact,e.minMax[0],e.topValue):"string"==typeof t.groupBy?a.colNmFn(t.groupBy):a.userObjDimFn(t.groupBy.colNm,t.groupBy.values)}),c2i.util.groupFn=((t,e)=>{const a=c2i.util;let o;return o=t.roundType&&-1===t.roundType.indexOf("Only")?a.rounded(t.roundType):e.interval?a.intervalGrpFn(e.interval):a.idenfityFn}),c2i.util.intervalGrpFn=(t=>e=>Math.floor(e/t)*t),c2i.util.rdAdd=((t,e,a,o)=>(n,r,l)=>(o?n[a]+=r[o]:++n[a],n[e]+=r[t],n)),c2i.util.rdRemove=((t,e,a,o)=>(n,r,l)=>(o?n[a]-=r[o]:--n[a],n[e]-=r[t],n)),c2i.util.rdAddFn=((t,e,a,o)=>(n,r,l)=>(o?n[a]+=r[o]:++n[a],n[e]+=t(r),n)),c2i.util.rdRemoveFn=((t,e,a,o)=>(n,r,l)=>(o?n[a]-=r[o]:--n[a],n[e]-=t(r),n)),c2i.util.rdAddAvg=((t,e,a)=>(o,n,r)=>(++o[a],o[e+"_sum"]+=n[t],o[e]=0===o[a]?0:o[e+"_sum"]/o[a],o)),c2i.util.rdRemoveAvg=((t,e,a)=>(o,n,r)=>(--o[a],o[e+"_sum"]-=n[t],o[e]=0===o[a]?0:o[e+"_sum"]/o[a],o)),c2i.util.rdAddFnAvg=((t,e,a)=>(o,n,r)=>(++o[a],o[e+"_sum"]+=t(n),o[e]=0===o[a]?0:o[e+"_sum"]/o[a],o)),c2i.util.rdRemoveFnAvg=((t,e,a)=>(o,n,r)=>(--o[a],o[e+"_sum"]-=t(n),o[e]=0===o[a]?0:o[e+"_sum"]/o[a],o)),c2i.util.rdInit=(t=>()=>{const e={};return t.forEach(t=>e[t]=0),e}),c2i.util.nullChange=((t,e="없음")=>null===t||void 0===t||""===t.toString().trim()?e:t),c2i.util.parseDate=(t=>t instanceof Date?t:(t+="",new Date(t))),c2i.util.parseYm=(t=>t instanceof Date?t:(t+="",new Date(t.substring(0,4),t.substring(4,6)-1,1))),c2i.util.parseYmd=(t=>t instanceof Date?t:(t+="",new Date(t.substring(0,4),t.substring(4,6)-1,t.substring(6,8)))),c2i.util.parseYmdH=(t=>t instanceof Date?t:(t+="",new Date(t.substring(0,4),t.substring(4,6)-1,t.substring(6,8),t.substring(8,10),0))),c2i.util.parseYmdHm=(t=>t instanceof Date?t:(t+="",new Date(t.substring(0,4),t.substring(4,6)-1,t.substring(6,8),t.substring(8,10),t.substring(10,12)))),c2i.util.parseYmdHms=(t=>t instanceof Date?t:(t+="",new Date(t.substring(0,4),t.substring(4,6)-1,t.substring(6,8),t.substring(8,10),t.substring(10,12),t.substring(12,14)))),c2i.util.topKeyN=((t,e=3,a="key",o="yVal")=>t.map(t=>t).sort((t,e)=>e.value[o]-t.value[o]).filter((t,a)=>a<e).map(t=>t[a])),c2i.util.getFilterInfo=((t,e,a,o)=>{const n=o.xDim(),r=o.yDim(),l=o.y2Dim(),i=d3.format(",.2%"),s=o.groupAll();let c=t+" "+n.expX+" "+e;a.push(c);const d=o.aggInfos();if(n.brush.showDetail&&d.length){const t={...d[1].values};if(o.isAvg()){if(c=r.caption+": "+r.formatAvg(t.avg),c+=", "+l.caption+": "+l.tipFormat(t[l.colNm]),a.push(c),!s)return;const e={...s.value()},o=0===e[r.colNm]?0:t.avg/e[r.colNm],n=0===e[l.colNm]?0:t[l.colNm]/e[l.colNm];c="("+i(o)+", "+i(n)+")",a.push(c)}else{if(t[r.colNm]!==t[l.colNm]){if(c=r.tipFormat(t[r.colNm])+" &#247 "+l.tipFormat(t[l.colNm]),c+=" = "+r.formatAvg(t.avg),a.push(c),!s)return;const e={...s.value()};let o=0,n=0;const d=0===e[r.colNm]?0:t[r.colNm]/e[r.colNm];0!==e[l.colNm]&&(o=t[l.colNm]/e[l.colNm],n=e[r.colNm]/e[l.colNm]),c=i(d)+", "+i(o)+", ("+r.formatAvg(t.avg-n)+")"}else{if(c=r.tipFormat(t[r.colNm]),a.push(c),!s)return;const e={...s.value()};c=i(0===e[r.colNm]?0:t[r.colNm]/e[r.colNm])}a.push(c)}}}),c2i.util.aggSubtitle=((t,e,a)=>{const o=a.yDim(),n=a.y2Dim(),r=0===e[n.colNm]?0:e[o.colNm]/e[n.colNm];let l;a.isAvg()||a.tooltipMini&&!a.tooltipMini().isAvg?l=o.tipFormat(e[o.colNm])+o.unitNm+", "+n.tipFormat(e[n.colNm])+n.unitNm:e[o.colNm]!==e[n.colNm]?(l=o.tipFormat(e[o.colNm])+" &#247 "+n.tipFormat(e[n.colNm]),l+=" = "+o.formatAvg(r)):l=o.tipFormat(e[o.colNm]),t.select(".gTitle .subtitle").html(l)}),c2i.util.tooltipOn=function(t){const{e:e,d:a,cfg:o,_yVal:n,_y2Val:r,_aggInfoData:l,chart:i}={...t},s=o.xDim,c=o.yDim,d=o.y2Dim,u=d3.format(",.2%"),m=o.tooltip;if(!m||!m.isShow)return;let{yVal:p,y2Val:g}={...l[0].values};const f=0===p?0:n(a)/p,h=0===g?0:r(a)/g;let y=0===g?0:p/g,{yVal:_,y2Val:x}={...l[1].values};const v=0===_?0:n(a)/_,b=0===x?0:r(a)/x;let k=0===x?0:_/x;const C=0===r(a)?0:n(a)/r(a);y=0===y?0:C/y,k=0===k?0:C/k;let w="<br/>"+c.caption+": "+c.tipFormat(n(a));i.isAvg()?w+="<br/>"+d.caption+d.unitNm+": "+d.tipFormat(r(a)):(w+=" ("+u(v),w+=", "+u(f)+")",w+="<br/>"+d.caption+d.unitNm+": "+d.tipFormat(r(a)),w+=" ("+u(b),w+=", "+u(h)+")",i.tooltipMini&&i.tooltipMini().isAvg&&(w+="<br/>평균: "+d.formatAvg(C)+" (",w+=u(k)+", "+u(y)+")"));let N="band"===s.scale||"point"===s.scale?a.key:s.format?s.format(a.key):a.key;a.properties&&(N+="("+a.properties.cd+": "+a.properties.nm+")");const A=d3.select(".c2iMiniTip"),L=e.pageX-parseInt(A.style("width"))/2+"px";A.classed("c2iHidden",!1).html(N+w).style("left",L).style("top",e.pageY-75+"px")},c2i.util.tooltipOff=function(t){t&&t.isShow&&d3.select(".c2iMiniTip").classed("c2iHidden",!0)},c2i.util.renderAggBar=function(t){let{_aggBarG:e}={...t};const{_svg:a,_stat:o,cfg:n,chart:r,_xVal:l}={...t},{_xStart:i,_xEnd:s,_yEnd:c,_contentH:d,_negative:u}={...t},m=r.groupAll();if(!o.aggBar||!m||r.isAvg()||u)return a.select(".aggBars").remove(),void(e=void 0);e||(e=a.append("g").attr("class","aggBars"));let p,g={...m.value()},f=[];const h=n.yDim,y=n.y2Dim,_=r.aggInfos();_.length&&o.aggBar&&(p={..._[1].values},h.draw&&g[h.colNm]>0&&p[h.colNm]>=0&&f.push([{whichY:"y",key:"all",value:g[h.colNm]},{whichY:"y",key:"range",value:p[h.colNm]}]),y.draw&&g[y.colNm]>0&&p[y.colNm]>0&&f.push([{whichY:"y2",key:"all",value:g[y.colNm]},{whichY:"y2",key:"range",value:p[y.colNm]}]));const x=d3.scaleLinear().domain([0,g[h.colNm]]).range([0,d()]).clamp(!0),v=d3.scaleLinear().domain([0,g[y.colNm]]).range([0,d()]).clamp(!0),b=e.selectAll("g.bars").data(f);b.exit().transition().remove();const k=b.enter().append("g").attr("class","bars").attr("transform",(t,e)=>0===e?"translate("+[i()-2,c()]+")":"translate("+[s(),c()]+")").merge(b).selectAll("rect").data(t=>t,l);return k.enter().append("rect").attr("width",3).attr("fill",t=>"all"===t.key?h.colorBg:"y"===t.whichY?h.color:y.color).attr("height",0).attr("fill-opacity",.7).merge(k).transition().duration(500).attr("y",t=>"all"===t.key?0:d()-("y"===t.whichY?x(t.value):v(t.value))).attr("height",t=>"all"===t.key?d():"y"===t.whichY?x(t.value):v(t.value)),e},c2i.util.renderMenu=function(t){const{_svg:e,_width:a,_showToolbar:o,_dimension:n,cfg:r,chart:l,isLgScale:i}=t;let{menus:s}={...t};const c=c2i.util,d=r.optWin,u=c.setOptionBtn(r,l,e,a);e.on("contextmenu",t=>{l.toolbarToggle&&d.contextMenu&&(t.preventDefault(),t.stopPropagation(),l.toolbarToggle(t,!0))}).on("click",t=>{d.autoClose&&l.toolbarStatus()&&l.toolbarToggle(t)}).style("background",r.theme?r.theme:null),s=s.filter(t=>{if(!t.exclude)return t}),r.top&&"insight"===r.graphType&&s.push({id:"top",img:"rank.png",tip:"상위n",opacity:r.top.isShow?1:.4});const m=u.selectAll("image.imgTip").data(s,t=>t.id);if(m.exit().remove(),m.enter().append("g").attr("class","imgTip").on("mouseenter",(t,e)=>{"lgScale"===e.id&&y()}).on("click",function(t,e){switch(e.id){case"resetFilter":n.hasCurrentFilter()?l.resetFilter():l.zoomed&&l.zoomed()&&l.resetTransform();break;case"tooltip":l.tooltipToggle();break;case"expand":l.expandToggle();break;case"export":c.exportImage(r.id),l.exportData();break;case"aggBar":l.aggBarToggle();break;case"avgLine":l.avgLineToggle();break;case"top":l.topToggle();break;case"lgScale":y()}}).append("image").attr("class",t=>t.id).attr("xlink:xlink:href",t=>c.imgSrc()+t.img).attr("width",o?13:0).attr("height",13).style("opacity",t=>t.opacity).attr("transform",(t,e)=>`translate(${-14*e-14}, 0)`).append("title").html(t=>t.tip),!i)return;const p=r.title,g=c2i.lang.legend,f=["Quantize","Quantize Nice","Quantile"],h=[g.scale_Qtize,g.scale_QtizeNice,g.scale_Qtile];function y(){const t=_();let e=t.attr("x");e=parseInt(e)?0:150,t.transition().attr("x",e)}function _(){return u.selectAll(".scale")}u.append("g").attr("class","gScale").on("mouseleave",()=>_().transition().attr("x",150)).selectAll(".scale").data(h).enter().append("text").on("mouseenter",t=>d3.select(t.currentTarget).attr("x",0)).on("click",(t,e)=>{const a=_(),o=c2i.util.getIndex(a,t.currentTarget);a.transition().attr("x",150),l.lgScaleChange(f[o])}).attr("class","scale").attr("font-family",p.subFonts[0]).attr("font-size",p.subFonts[1]).attr("fill",p.subFonts[2]).attr("text-anchor","end").attr("x",150).attr("y",(t,e)=>25+13*e).text(t=>t)},c2i.util.getIndex=((t,e)=>{return t.nodes().indexOf(e)}),c2i.util.setOptionBtn=((t,e,a,o)=>{const n=t.optWin,r=n.optBtnHide?[]:[null];let l=a.select("g.gMenu");l.empty()&&(l=a.append("g").attr("class","gMenu").style("cursor","pointer")),l.attr("transform",`translate(${o-(n.optBtnHide?0:15)}, 3)`);const i=l.selectAll("g.optionBtn").data(r);i.exit().remove();const s=i.enter().append("g").attr("class","optionBtn").on("click",t=>{e.toolbarToggle&&(e.toolbarToggle(t),t.stopPropagation())});return s.append("image").attr("xlink:xlink:href",n&&n.src?n.src:c2i.util.imgSrc()+"gear_notice.png").attrs({width:13,height:13}),s.append("title").text(c2i.lang.cm.optionMenu),l}),c2i.util.changeOptionTitle=(t=>{if(!t.optWin)return;const e="c2iOption_"+t.id.substr(1);let a=d3.select(t.id).select("#"+e);if(a.empty())return;const o=t.title;let n=o.caption;o.captionTopN&&(n+=o.captionTopN),a.select(".c2iOptionTitle").text(n)}),c2i.util.optionConstructor=((t,e,a,o,n)=>{const r=n.gen,l={};"calView"!==t.graphType&&(l.resetFilter=(()=>{a.hasCurrentFilter()?e.resetFilter():e.zoomed&&e.zoomed()&&e.resetTransform()}),l.listRows=t.dataList.listRows),l.tooltip=t.tooltip&&t.tooltip.isShow,l.expand=o,l.export=r.exportType,l.graphType=r.graphType;const i=t.xDim,s=t.statistics;if("insight"===t.graphType){l.avgLine=s.avgLine,l.topShow=t.top.isShow,l.topType=t.top.type,l.topN=t.top.rank,e.isAvg()||(l.aggBar=s.aggBar);const a=i.scale;"point"!==a&&"band"!==a&&(l.lazyFilter=t.lazyFilter)}else"donut"===t.graphType&&(e.isAvg()||(l.aggBar=s.aggBar));l.duration=t.duration;const c=t.title;if(c){if(i&&c.captionFormat&&c.captionFormat.indexOf("{0")>-1){let e="";e=i.interval?i.tipFormat?i.tipFormat(i.interval):"임의분류":t.yDim.caption,c.caption=c2i.util.templateFormat(c.captionFormat,e)}l.titleColor="currentColor"===c.fonts[2]?"#444":c.fonts[2],l.subTitleColor="currentColor"===c.subFonts[2]?"#777":c.subFonts[2]}const d=t.theme;d&&-1===d.indexOf("gradient")&&-1===d.indexOf("none")?l.theme=d:l.theme=d&&"none"!==d?d:"#ffffff",l.brushShowDetail=i.brush.showDetail,l.brushColor="currentColor"===i.brush.fonts[2]?"#222":i.brush.fonts[2];const u=t.optWin;return l.optBtnHide=!u.optBtnHide,l.contextMenu=u.contextMenu,l.autoClose=u.autoClose,l.opacity=u.opacity,{...l}}),c2i.util.makeDefaultOption=((t,e,a,o,n,r)=>{const l=c2i.util,i=r.gen,s=t.optWin,c="c2iOption_"+t.id.substr(1),d=d3.select(t.id);let u=d.select("#"+c);if(u.empty()){const a=t.responsiveByCss&&t.c2iDashboard&&t.c2iDashboard.id?t.c2iDashboard.id:t.id,n=(u=d3.select(a).append("div").attr("id",c).on("mouseenter",()=>d.classed("c2iSelectTarget",!0)).on("mouseleave",()=>d.classed("c2iSelectTarget",!1)).style("opacity",s.opacity).attr("class","c2iOption"+(s.initPos?" "+s.initPos:"")).classed("c2iHidden",!o)).append("div").attr("id",c+"_H").attr("class","optionHandle").on("dblclick",()=>e.toolbarShrink()),r=t.top;let i="";r.isShow&&(i="("+(i="once"===r.type?"Top":"everyNew"===r.type?"N top":"top")+" "+r.rank+")",i=r.isShow?i:"");const m=t.title.caption+i;n.append("span").attr("class","c2iOptionTitle").text(m),n.append("div").attr("class","c2iShrinkBtn").on("click",t=>{if(t.shiftKey){e.container().shrinkAllOptions()}else e.toolbarShrink()}).attr("title","옵션창 확장/축소.(Shift+클릭시 모든 옵션창 축소)").html("&#9940;"),n.append("div").attr("class","c2iCloseBtn").on("click",t=>{if(t.shiftKey){e.container().closeAllOptions()}else e.toolbarToggle(t)}).attr("title","옵션창 닫기.(Shift+클릭시 모든 옵션창 닫힘)").html("&#10062;"),l.dragHtml(document.getElementById(c))}document.getElementById(c).appendChild(a.domElement);const m=u.select(".close-button").style("width");u.select(".optionHandle").style("width",m);const p=a.addFolder(i.default);if("calView"!==t.graphType){if(p.add(n,"resetFilter").name(i.resetFilter),t.changeGraphType){const e=["막대 차트","도넛 차트"];(t.map||t.isMap)&&e.push("한국 지도"),p.add(n,"graphType",[i.graphType,...e]).name(i.graphType).onChange(function(e){switch(e){case"막대 차트":t.changeGraphType("insight",t);break;case"도넛 차트":t.changeGraphType("donut",t);break;case"한국 지도":t.changeGraphType("countryMap",t)}})}p.add(n,"listRows",-1,1e3,1).name(i.listRows).onFinishChange(t=>e.listRows(t)).listen()}if(p.add(n,"tooltip").name(i.tipInfo).onChange(e.tooltipToggle).listen(),p.add(n,"expand").name(i.chartView).onChange(e.expandToggle).listen(),p.add(n,"export",[i.exportType,"이미지","데이터","이미지+데이터"]).name(i.export).onChange(function(a){switch(a){case"이미지":l.exportImage(t.id);break;case"데이터":e.exportData();break;case"이미지+데이터":l.exportImage(t.id),e.exportData()}}),"insight"===t.graphType){p.add(n,"avgLine").name("평균라인").onChange(e.avgLineToggle).listen();const a=t.top.rank;p.add(n,"topShow").name("상위 "+a+"위 토글").onChange(a=>{t.top.isShow=a,e.topRank()}).listen(),p.add(n,"topType",["once","everyNew","addNew"]).name("상위 "+a+"위 유형").onChange(a=>{t.top.type=a,e.topRank()}).listen(),p.add(n,"topN",0,t.data.length,1).name("상위 "+a+"위").onFinishChange(a=>{t.top.rank=a,t.top.isShow=!0,0===a?(n.topShow=!1,e.topToggle()):(n.topShow=!0,e.topRank())}).listen(),e.isAvg()||p.add(n,"aggBar").name("점유율 막대").onChange(e.aggBarToggle).listen()}else"donut"===t.graphType&&(e.isAvg()||p.add(n,"aggBar").name("점유율 막대").onChange(e.aggBarToggle).listen());if(p.add(n,"duration",0,3e3).step(10).name(i.transTime+"(ms)").onFinishChange(e=>t.duration=e).listen(),p.addColor(n,"theme").name(i.theme).onChange(function(e){t.theme="#ffffff"===e||"#000000"===e?"none":e,l.setTheme(t,t.id,!0)}).listen(),t.title){const a=t.title;p.addColor(n,"titleColor").name(i.titleColor).onChange(function(t){a.fonts[2]=t,e.title(a)}).listen(),p.addColor(n,"subTitleColor").name(i.subTitleColor).onChange(function(t){a.subFonts[2]=t,e.title(a)}).listen()}}),c2i.util.removeOptionDom=(t=>{const e="#c2iOption_"+t.id.substr(1);d3.select(e).remove()}),c2i.util.makeBrushOption=((t,e,a,o,n,r)=>{const l=t.graphType;if("calView"!==l){const n=a.addFolder("브러쉬 옵션");n.add(o,"brushShowDetail").name("브러시 상세 정보").onChange(a=>{t.xDim.brush.showDetail=a,e.brushInfoDisplay(t.xDim)}),n.addColor(o,"brushColor").name("브러시 정보").onChange(a=>{t.xDim.brush.fonts[2]=a,e.statInfoFill(t.xDim)});const r=t.xDim.scale;"point"!==r&&"band"!==r&&"insight"===l&&n.add(o,"lazyFilter").name("드래그 종료시 실행").onChange(t=>{e.lazyFilter(t),e.container().brushToggle()})}const i="c2iOption_"+t.id.substr(1),s=d3.select(t.id).select("#"+i),c=t.optWin,d=a.addFolder("설정 버튼");d.add(o,"optBtnHide").name("설정 버튼 토글").onChange(a=>{c.optBtnHide=!a,c.optBtnHide&&!c.contextMenu&&(o.contextMenu=c.contextMenu=!0),c2i.util.setOptionBtn(t,e,n,r())}).listen(),d.add(o,"contextMenu").name("우측버튼 메뉴 토글").onChange(a=>{c.contextMenu=a,c.optBtnHide&&!c.contextMenu&&(o.optBtnHide=!0,c.optBtnHide=!1,c2i.util.setOptionBtn(t,e,n,r()))}).listen(),d.add(o,"autoClose").name("배경클릭 자동닫기").onChange(t=>{c.autoClose=t}),d.add(o,"opacity",.6,1,.025).name("설정창 불투명").onChange(t=>{c.opacity=t,s.style("opacity",c.opacity)})}),c2i.util.curOptWin=((t,e)=>{const a="#c2iOption_"+t.id.substr(1),o=d3.select(a);o.empty()||o.classed("c2iHidden")||(d3.selectAll(".c2iOption").each(function(t){!d3.select(this).classed("c2iHidden")&&e&&d3.select(this).style("z-index",998)}),o.classed("c2iCurOptWin",e).style("z-index",999),o.select(a+"_H").classed("c2iCurOptWinH",e))}),c2i.util.toolbarToggle=((t,e,a,o,n)=>{o=void 0!==n?n:!o,a.selectAll(".gMenu .scale").transition().attr("x",150),a.selectAll(".gMenu .imgTip > image").transition().duration(700).delay((t,e)=>35*e).attr("width",o?13:0);const r=e.optWin,l=r&&r.opacity?r.opacity:0,i=d3.select("#c2iOption_"+e.id.substr(1));if(i.transition().style("opacity",l),i.classed("c2iHidden",!o),!o)return o;if(!e.nonComponent){const e=parseInt(i.style("width")),a=t.pageX-t.offsetX-("image"===t.srcElement.nodeName?e:0),o=t.pageY-t.offsetY;i.style("top",o+"px").style("left",a+"px")}return o}),c2i.util.saveOption=(t=>{localStorage.setItem(t.preset,JSON.stringify(t.getSaveObject()))}),c2i.util.loadOption=(t=>{const e=localStorage.getItem(t);return JSON.parse(e)}),c2i.util.removeOption=(t=>{localStorage.removeItem(t.preset);const e=t.getRoot();for(const a in e.__folders)t.removeFolder(e.__folders[a]);t.destroy()}),c2i.util.mergeMeta=function(){let t={};for(let e=0;e<arguments.length;e++)t=_.merge(t,arguments[e]);return t},c2i.util.optionSetting=function(t,e){const a=t.optWin;t.tooltip.isShow=e.tooltip,t.duration=e.duration,t.theme=e.theme;const o=t.title;o&&e.titleColor&&(o.fonts[2]=e.titleColor,o.subFonts[2]=e.subTitleColor),a.optBtnHide=!e.optBtnHide,a.contextMenu=e.contextMenu,a.autoClose=e.autoClose,a.opacity=e.opacity},c2i.util.tooltipToggle=function(t,e){if(!t.tooltip)return;const a=t.tooltip;a.isShow=!a.isShow,d3.select(".c2iMiniTip").classed("c2iHidden",!a.isShow),e(".tooltip",a.isShow?1:.4);const o=t.graphType;return o&&("calView"===o||o.indexOf("Map")>0)&&d3.select(t.id).select(".c2iLegendTip").classed("c2iHidden",!a.isShow),a.isShow},c2i.util.dragHtml=(t=>{let e,a,o,n;function r(t){(t=t||window.event).preventDefault(),o=t.clientX,n=t.clientY,document.onmouseup=i,document.onmousemove=l}function l(r){(r=r||window.event).preventDefault(),e=o-r.clientX,a=n-r.clientY,o=r.clientX,n=r.clientY,t.style.top=t.offsetTop-a+"px",t.style.left=t.offsetLeft-e+"px"}function i(){document.onmouseup=null,document.onmousemove=null}e=a=o=n=0,document.getElementById(t.id+"_H")?document.getElementById(t.id+"_H").onmousedown=r:t.onmousedown=r}),c2i.util.deepClone=(t=>{let e;if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array){e=[];for(let a=0,o=t.length;a<o;a++)e[a]=c2i.util.deepClone(t[a]);return e}if(t instanceof Object){e={};for(let a in t)"parent"!==a.toString()?t.hasOwnProperty(a)&&(e[a]=c2i.util.deepClone(t[a])):console.log("Except for "+a);return e}throw new Error(c2i.lang.cm.m3)}),c2i.util.devMode=(t=>{console.log("========================= 씨투아이(C2i) 개발모드 ================================"),console.log(t.data),console.log("----------------------------- Start : Meta Data -----------------------------"),c2i.util.makeJson(t),console.log("----------------------------- E n d : Meta Data -----------------------------"),console.log("=========================================================================")}),c2i.util.isIE=(()=>{const t=window.navigator.userAgent.toLowerCase(),e="undefined"!=typeof window&&t,a=e&&/msie|trident/.test(e),o=e&&e.indexOf("msie 9.0")>0;return a||o}),c2i.util.tooltipMag=((t,e)=>{const a=t.tooltip;return a&&!a.isShow&&"x"===e.value?"selected":a&&a.isUserTip&&"false"===e.value?"selected":a&&a.infoLevel.toString()===e.value?"selected":null}),c2i.util.getTextWidth=((t,e,a)=>{const o=document.createElement("canvas").getContext("2d"),n="string"==typeof e?" ":"px ";return o.font=e+n+a,Math.ceil(o.measureText(t).width)}),c2i.util.renderOptionWindow=((t,e,a,o,n)=>{const r=(t,e,o,n)=>{d3.select(a).style("width",t).style("left",o+"px").style("top",n+"px").style("height",0).style("opacity",1e-6).transition().style("height",e).style("opacity",l.opacity)},l=t.optWin;if(!l.optBtnHide){const t=(o=e.selectAll("g.optionBtn").data([1])).enter().append("g").attr("class","optionBtn").on("click",t=>{if(!d3.select(a).empty())return void d3.select(a).remove();n();const e=d3.select(a).style("width"),o=d3.select(a).style("height");let i=t.pageX+10;const s=t.pageY;"left"!==l.xPos&&(i=i-parseInt(e)-30),r(e,o,i,s)});t.append("image").style("cursor","pointer").attr("xlink:xlink:href",l.src?l.src:c2i.util.imgSrc()+"gear_notice.png").attr({width:"25px",height:"25px"}),t.append("title").text(c2i.lang.cm.op1)}return l.contextMenu&&e.on("contextmenu",t=>{n();const e=d3.select(a).style("width"),o=d3.select(a).style("height"),l=t.pageX-2,i=t.pageY-2;r(e,o,l,i),t.preventDefault(),t.stopPropagation()}).on("click",()=>{!0===l.autoClose&&(d3.select("#c2iColorPickerPop").remove(),d3.select(a).remove())}),o}),c2i.util.locale=(t=>{if(void 0===t.lang&&(t.lang="ko"),"object"!=typeof c2i.language[t.lang])throw new Error("C2I requires (c2i_"+t.lang+".js) language file.");c2i.lang=c2i.language[t.lang],c2i.util.translate(),d3.timeFormatDefaultLocale(c2i.lang.d3.time),d3.formatLocale(c2i.lang.d3.format)}),c2i.util.translate=(()=>{function t(t){return t.indexOf(".")>-1?(t=t.split("."),c2i.lang[t[0]][t[1]]):"i18n-Error"}d3.selectAll("[data-c2i18n]").style("opacity",.3).transition().duration(750).each(function(){let e=d3.select(this).attr("data-c2i18n");if(!e||"c2i.dummy"===e)return;let a=t((e=e.indexOf(",")>-1?e.split(","):[e])[0]);if(a&&(d3.select(this).text(a),e.length>1)){if(!(a=t(e[1])))return;d3.select(this).attr("title",a)}}).style("opacity",1)}),c2i.util.checkLicenseLocale=(t=>{if(!t)return alert(c2i.lang&&c2i.lang.cm?c2i.lang.cm.m2:"The option setting does not exist and can not be executed normally"),!1;if(["localhost","b2i-lab.com","data-wow.co.kr","survey-wow.com","survey-wow.herokuapp.com","casual-insight.com","kdx.kr","127.0.0"].find(t=>location.host.indexOf(t)>-1)+1)return c2i.util.locale(t),t.isDev||(t.lang&&"ko"!==t.lang?(console.log("/////////////  Notice about the use of C2i  ///////////////"),console.log(">> This product is protected by copyright law."),console.log(">> Prohibits the use of sources for cracking (reverse engineering, etc.) and for analysis purposes."),console.log(">>  If the product is not genuine, the reproduction, publication, and web publishing of the program is subject to approval by the manufacturer or the supplier."),console.log("///////// C2i Copyrighter - 한종인(Han Jong In) //////////")):(console.log("/////////////  씨투아이(C2i) 사용에 대한 공지사항  ///////////////"),console.log(">> 동 제품은 저작권법의 보호를 받고 있습니다."),console.log(">> 소스의 크래킹(역공학 등) 및 분석 목적의 소스 사용을 금지합니다."),console.log(">> 정품의 승인된 사용 범위가 아닌경우 동 프로그램의 복제, 공표, 웹 퍼블리싱 등은 제조사 또는 구매처의 승인이 필요합니다."),console.log("///////// 씨투아이(C2i) 저작권자 - 한종인(Han Jong In) //////////"))),!0;const e=Math.random;return!!((0,Math.round)(30*e()%e()*10)%5)}),c2i.util.checkConfig=((t,e)=>{if(!t||0!==t.indexOf("#"))return c2i.lang&&c2i.lang.cm?alert(c2i.lang.cm.m1):alert("*.Error: Container ID is required mandatory setting."),!1;for(let t in e.method)if(e.method.hasOwnProperty(t)&&"function"!=typeof e.method[t])return alert("*.Error: "+e.method[t]+" assigned to "+t+" + must be a function."),!1;return e.c2iCon=t,!0}),c2i.util.init=((t,e)=>{if(void 0!==e)for(let a in e)e.hasOwnProperty(a)&&void 0!==e[a]&&(t[a]=e[a])}),c2i.util.computeDim=((t,e)=>{let a=t.node().clientWidth;if("string"==typeof e.width&&e.width.indexOf("%")>-1)a=parseInt(a*(parseInt(e.width)/100),10);else if(e.width&&parseInt(e.height))return e.aspect=e.width/e.height,e.width;if(e.height||e.aspectRatio||(e.aspectRatio="1:1"),e.isResponsive&&e.aspectRatio&&e.aspectRatio.indexOf(":")>-1){let o=e.aspectRatio.replace(/[\s|\/]/g,"");"4:3"!==o&&"1:1"!==o&&"16:9"!==o&&console.log("*.가로:세로 비율은 통상 4:3, 16:9, 1:1 적당하나, 현재 설정 값은 => "+e.aspectRatio);try{o=o.split(":"),e.height=parseInt(a/(+o[0]/+o[1])),isNaN(e.height)&&(console.info("*.가로:세로 비율 설정 오류.\n 현재 설정 값은 => "+e.aspectRatio+", 기본값(16:9)으로 자동 적용 및 실행."),e.aspectRatio="16:9",c2i.util.computeDim(t,e))}catch(a){console.info("*.가로:세로 비율 설정 오류.\n 현재 설정 값은 => "+e.aspectRatio+", 기본값(16:9)으로 자동 적용 및 실행."),e.aspectRatio="16:9",c2i.util.computeDim(t,e)}}else e.height||e.aspectRatio&&e.aspectRatio.indexOf("%")>-1&&("100%"===e.aspectRatio?e.height=t.node().clientHeight:e.height=parseInt(a*parseFloat(e.aspectRatio)/100)),e.height||!e.isResponsive||e.nonComponent?e.height=e.height?parseInt(e.height):300:e.height=parseInt(t.style("height"),10);return e.aspect=a/e.height,a}),c2i.util.setDefs=((t,e,a,o)=>{const n=a.yDim,r=c2i.util,l=a.id.substr(1),i="M 2.5,2.5l5,5M2.5,7.5l5,-5",s=n.colorSave?n.colorSave:n.color;let c=e.select("defs"),d=[];if(o){if(!c.empty())return;return c=e.append("defs"),d.push({id:l+"c2iTip",color:r.colorHover(s),path:i,size:10,sWidth:1}),void m()}if(!t||!c.empty())return void p();c=e.append("defs");const u="M 0,10 l 10,-10 M -2.5,2.5 l 5,-5 M 7.5,12.5 l 5,-5";function m(){c.selectAll("pattern").data(d).enter().append("pattern").attr("id",t=>t.id).attr("patternUnits","userSpaceOnUse").attr("width",t=>t.size).attr("height",t=>t.size).append("path").attr("d",t=>t.path).attr("stroke",t=>t.color).attr("stroke-width",t=>t.sWidth).attr("shape-linecap","square").attr("shape-rendering","auto")}function p(){if(0===n.solid||"없음"===n.colorScale)return;const t=a.id+"_yColor_"+n.colorScale;n.colorSave=d3.rgb(n.colorSave).formatHex();const e=r.shadeColor(n.colorSave,n.solid),o=c.selectAll(t).data([t]),l=o.enter().append(n.colorScale+"Gradient").attr("id",t.substr(1));function i(t,e,a){l.append("stop").attr("class",t).attr("offset",e).merge(o.select("."+t)).attr("stop-color",a)}"linear"===n.colorScale?(l.attr("x1","60%").attr("y1","50%").attr("x2","0%").attr("y2","50%").attr("spreadMethod","reflect"),i("stop1","0%",n.colorSave),i("stop2","50%",e),i("stop3","100%",n.colorSave)):(l.attr("gradientUnits","objectBoundingBox").attr("fx","30%").attr("fy","30%"),i("stop1","0%","#FFFFFF"),i("stop2","40%",n.colorSave),i("stop3","100%",e)),n.color="url("+t+")"}d=[{id:l+"c2iTx",color:s,path:u,size:10,sWidth:2},{id:l+"c2iTxNeg",color:n.colorNeg,path:u,size:10,sWidth:2},{id:l+"c2iTxD",color:r.colorHover(s),path:"M 2, 0 l 0, 4",size:4,sWidth:1},{id:l+"c2iTxNegD",color:n.colorNeg,path:"M 2, 0 l 0, 4",size:10,sWidth:1},{id:l+"c2iTip",color:r.colorHover(s),path:i,size:10,sWidth:1}],m(),p()}),c2i.util.setTitleDesc=(t=>{if(!t.title)return;const e=t.yDim,a=t.y2Dim;let o="",n="";const r=t.isSort;r&&r.type&&(o="-."+(n="y"===r.whichY?e.caption:a.caption)+"별 ",o+=("desc"===r.type?"내림차순":"오름차순")+" 정렬.");const l=t.top;if("insight"===t.graphType&&l){const e="once"===l.type?"Top":"everyNew"===l.type?"N top":"top";e&&(t.title.captionTopN="("+e+" "+l.rank+")"),"once"===l.type?(n="Top "+l.rank+"은 최초 전체 데이터 기반의 top에 대한",n+=" 모니터링 효과 제공.\n",n+=" 매번 사용자 조건 적용(다른 차트 x축 브러싱)에 관계없음."):"everyNew"===l.type?(n="N top "+l.rank+"은 항상 새로운 Top 데이터 표시.\n",n+=" 매번 사용자 조건 적용(다른 차트 x축 브러싱)에 따라 변경."):(n="top "+l.rank+"은 최초는 전체 데이터 기반의 top 표시 후,\n",n+=" 매번 사용자 조건 적용(다른 차트 x축 브러싱)에 따른\n",n+=" 신규 top 값 발생시 추가 표시 가능함."),o+=(o?"\n-.":"-.")+n}o&&(t.title.desc=o)}),c2i.util.renderTitle=((t,e,a,o,n,r,l)=>{if(!e)return;t.bgImg&&t.bgImg.src&&function(){const o=d3.transition().duration(t.duration).ease(c2i.util.ease[t.easing]),{src:n,width:r,height:l,opacity:i}=t.bgImg,s=(a-r)/2,c=(t.height-l)/2,d=e.selectAll(".logoImg").data([null]);d.enter().append("image").attr("class","logoImg").attr("transform","translate("+[s,0]+")").attr("xlink:xlink:href",n).attr("width",r).attr("height",l).style("pointer-events","none").merge(d).transition(o).attr("transform","translate("+[s,c]+")").style("opacity",a<200?1e-6:i||.3)}();const i=t.title;if(!i||!i.caption||0===i.caption.length)return;const s="middle"===i.xPos?a/2:"start"===i.xPos?o()+i.gap:n()-i.gap,c="middle"===i.yPos?t.height/2:"top"===i.yPos?i.gap:r()-i.gap;let d=i.caption;const u=t.isSort;if(u&&Array.isArray(u.rankRanges)){let t="";const e=d3.format(",d");u.rankRanges[0]>0?(t=e(u.rankRanges[0]+1)+" ~ ",u.rankRanges[1]>0&&(t+=e(u.rankRanges[1]))):u.rankRanges[1]>0&&(t="1 ~ "+e(u.rankRanges[1])),d+=" "+("desc"===u.type?" 내림차순 ":" 오름차순 ")+t+" 기준"}i.captionTopN&&t.top&&t.top.isShow&&(d+=i.captionTopN);const m=e.selectAll(".gTitle").data([d]),p=m.enter().append("g").attr("class","gTitle"),g=p.append("text").style("text-anchor",i.xPos);l&&(p.call(l),g.attr("cursor","move")),g.append("tspan").attr("class","mainTitle").attr("dy",i.fonts[1]).style("font-family",i.fonts[0]).style("font-size",i.fonts[1]).style("text-decoration",i.textDeco).merge(m.select(".mainTitle")).style("fill",i.fonts[2]).text(t=>t).each(c2i.util.wrap),i.subCaption&&g.append("tspan").attr("class","subtitle").attr("x",0).attr("dy",c2i.util.titleDy(i.fonts[1])).style("font-family",i.subFonts[0]).style("font-size",i.subFonts[1]).merge(m.select(".subtitle")).text(i.subCaption).style("fill",i.subFonts[2]),g.append("title").html(i.desc),p.merge(m).attr("transform","translate("+[s,c]+")").attr("fill-opacity",i.opacity)}),c2i.util.dPx=(t=>{const e=parseInt(t);return"number"==typeof e?e:"5px"}),c2i.util.titleDy=(t=>{let e=parseInt(t);return(e+=e>16?-4:1)+"px"}),c2i.util.getClassName=((t,e)=>{let a="";if(e instanceof Date){for(let o=0,n=t.length;o<n;o++)if(t[o].xName.getTime()===e.getTime()){a="C"+t[o].id;break}}else a="c_"+("number"==typeof e?e:c2i.util.getClassPure(e));return a.slice(0,20)}),c2i.util.getClassPure=(t=>t.replace(/[\s|`|.|\t|\n|\r|'|"|~|@|+|/|(|)|[|\]|&|\#|,|-|+|<|>|$|%|;|:|?|!|^|*|\\]/g,"")),c2i.util.colorHover=((t,e=!1)=>e?d3.rgb(t).darker():d3.rgb(t).brighter()),c2i.util.pascalize=function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():t.toLowerCase()}).replace(/\s+/g,"")},c2i.util.hexToRGB=function(t,e){if("object"==typeof t){const{r:a,g:o,b:n}=t;return`rgba(${a},${o},${n},${e})`}const a=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16);return e?`rgba(${a},${o},${n},${e})`:`rgba(${a},${o},${n})`},c2i.util.invertColor=(t=>{if(6!==(t=d3.rgb(t).formatHex().slice(1,7)).length)throw new Error("Invalid HEX color.");const e=(255-parseInt(t.slice(0,2),16)).toString(16),a=(255-parseInt(t.slice(2,4),16)).toString(16),o=(255-parseInt(t.slice(4,6),16)).toString(16);return"#"+n(e)+n(a)+n(o);function n(t,e){return e=e||2,(new Array(e).join("0")+t).slice(-e)}}),c2i.util.createAccessor=((t,e)=>{const a=function(t,e,a){return function(o){return arguments.length?(e[a]=o,t):e[a]}};for(let o in e)if(!t[o]&&e.hasOwnProperty(o)){if(!e.hasOwnProperty(o))continue;t[o]=a(t,e,o)}return t}),c2i.util.wrap=function(){var t=parseInt(this.parentNode.parentNode.parentNode.attributes.width.value),e=d3.select(this),a=e.text(),o=e.node().getComputedTextLength();o>t-40&&a.length>0&&(t=(t-40)/o,a=a.slice(0,parseInt(a.length*t)),e.text(a+"..."),o=e.node().getComputedTextLength())},c2i.util.pathShow=(t=>{const{sel:e,dr:a,isReverse:o,ease:n="linear"}={...t};let{dashLen:r}={...t};const l=c2i.util.isIE()?0:e.node().getTotalLength();r||(r=l),e.attr("stroke-dasharray",r).attr("stroke-dashoffset",o?0:l).transition().duration(a).ease(c2i.util.ease[n]).attr("stroke-dashoffset",o?l:0)}),c2i.util.resizeChart=((t,e,a,o)=>{if(t.responsiveByCss){const t=document.getElementById(e.substr(1)),o=new ResizeSensor(t,a);let n=!0;c2i.resizers.some(t=>{if(t.con===e)return t.reObj.detach(t.resize),n=!1,!1}),n&&c2i.resizers.push({con:e,reObj:o,resize:a})}else d3.select(window).on("resize."+e,()=>{clearTimeout(o),o=setTimeout(a,150)})}),c2i.util.optionBtnView=((t,e,a)=>{let o,n;const r=t.optWin;r.xPos&&"left"!==r.xPos?o=e-30:(o=10,r.xPos="left"),r.yPos&&"bottom"!==r.yPos?n=10:(n=t.height-30,r.yPos="bottom"),a.attr("transform","translate("+[o,n]+")")}),c2i.util.optionHide=(()=>{d3.select(window).on("keydown",t=>{"h"!==t.key&&"KeyH"!==t.code||d3.select("#c2iOption").empty()||d3.select("#c2iOption").classed("c2iHidden",!d3.select("#c2iOption").classed("c2iHidden"))})}),c2i.util.makeJson=(t=>{const e=JSON.stringify(t,(t,e)=>{if("function"==typeof e)return e.toString();if(t.indexOf("data")>-1){if("data2"===t)return;return"임의로 제거 하였음..!!"}return t.indexOf("__")>-1?void 0:e},4);console.log(e)}),c2i.util.setCustomColors=function(t){if(t&&(c2i.util.customColors=t),c2i.util.customColors){const t=c2i.util;c2i.meta.std.data.some(e=>{if("colors"===e.id){const a=[];return e.options.forEach(t=>{t.isC2i&&a.push(t)}),e.options=a,e.options.unshift({value:"",separator:!0,length:10,idx:0}),t.customColors.reverse(),t.customColors.forEach(t=>{e.options.unshift({value:t.name+"/solid",label:""})}),e.options.unshift({value:"",separator:!0,length:10,idx:0}),t.customColors.forEach(t=>{e.options.unshift({value:t.name,label:""})}),t.customColors.forEach(e=>{t.customColors[e.name]=e.value}),!0}})}},c2i.util.drawGradeInfo=function(t,e,a,o,n,r,l,i,s,c,d,u,m,p){const g=d3.select(e).select("svg");if(0===a.length)return void g.select("g.gGrades").data([]).exit().transition().duration(t.duration).style("opacity",0).remove();let f,h,y,_;switch(a.forEach((t,e)=>{0===e?t.cntX0=t.valueX0=0:(t.valueX0=f.value+f.valueX0,t.cntX0=f.cnt+f.cntX0),f=t}),l.xPos){case"start":h=0;break;case"middle":h=(c-l.width)/2;break;default:h=m()-l.width}switch(l.yPos){case"top":y=0;break;case"middle":y=(t.height-l.height)/2;break;default:y=p()}(_=(_=g.selectAll("g.gGrades").data([null])).enter().append("g").attr("class","gGrades").attr("transform","translate("+[h+l.dx,y+l.dy]+")").call(s).merge(_)).transition().duration(t.duration).attr("transform","translate("+[h+l.dx,y+l.dy]+")");const x=_.selectAll("g.gGrade").data(["value","cnt"]);function v(e,n,s){const c=d3.extent(a,t=>t[n]+t[s]);let m,p;c[0]=c[0]>0?0:1.1*c[0];const f=d3.scaleLinear().domain(c).range([0,l.width]),h=d3.format(",.2%"),y=e.selectAll(".lgRect").data(a,t=>t.color);y.exit().remove();const _=y.enter().append("rect").attr("class",(t,e)=>"lgRect g"+e).on("mouseenter",function(){if(".cell"!==u)return;const t=d3.rgb(d3.select(this).style("fill")).formatHex().toUpperCase();g.selectAll("rect.lgRect").each(function(e){d3.select(this).style("fill-opacity",t===e.color.toUpperCase()?1:0)}),g.select(".gCell").selectAll(u).each(function(){const e=d3.rgb(d3.select(this).style("fill")).formatHex().toUpperCase();d3.select(this).style("fill-opacity",t===e?1:0)})}).on("mouseleave",()=>{".cell"===u&&(g.selectAll("rect.lgRect").style("fill-opacity",1),g.select(".gCell").selectAll(u).style("fill-opacity",1))}).style("stroke",l.stroke).attr("height",l.height).attr("width",0).style("fill",t=>t.color);_.merge(y).transition().duration(t.duration).attr("x",t=>f(t[s])).attr("width",t=>f(t[n])),_.append("title").merge(y.select("title")).text(t=>("value"===n?(m=d+": "+i(t[n]),p=h(t[n]/o.tot)):(m=c2i.lang.gen.tipNodes+": "+i(t[n]),p=h(t[n]/o.cnt)),m+" ("+p+")"));const x=e.selectAll(".lgLabel").data(a,t=>t.color);x.exit().remove(),x.enter().append("text").attr("class",(t,e)=>"lgLabel g"+e).attr("y",l.height+l.label.dy).style("fill",t=>c2i.util.invertColor(t.color)).style("font-size","11px").style("text-anchor","middle").style("pointer-events","none").style("fill-opacity",0).merge(x).transition().duration(t.duration).attr("x",t=>f(t[s])+f(t[n])/2).text(function(t){return m="value"===l.label.content?"value"===n?i(t[n]):d3.format(",.0f")(t[n]):d3.format(",.0%")(t[n]/("value"===n?o.tot:o.cnt)),p=f(t[n])>c2i.util.getTextWidth(m,11,r[0])?1:0,d3.select(this).style("fill-opacity",p),m})}x.enter().append("g").attr("class","gGrade").attr("transform",(t,e)=>"translate(0,"+(e>0?l.dy2nd:0)+")").merge(x).each(function(t){const e=d3.select(this);"value"===t?v(e,"value","valueX0"):v(e,"cnt","cntX0")}),_.append("text").attr("class","nodeCnt").attr("data-c2i18n","gen.tipNodes").style("font-family",n[0]).style("font-size","11px").style("fill",n[2]).attr("y",l.dy2nd+l.height+14).text(c2i.lang.gen.tipNodes)},c2i.util.defaultColor={dark:{axixPath:"#999"},white:{axixPath:"#444"}},c2i.util.likertColors={3:["#d7191c","#ffffbf","#2b83ba"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},c2i.util.colorSchemes=["C2iGreen2Red5","C2iRed2Green5","C2iGreen2Red3","C2iRed2Green3","C2iGreen2Red2","C2iRed2Green2","Tab10","Cat10","Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"],c2i.util.getColorScheme=(t=>{if("function"==typeof t)return t();if(Array.isArray(t))return t;switch(t){case"C2iGreen2Red5":return["#1a9641","#a6d96a","#ffffbf","#fdae61","#d7191c"];case"C2iRed2Green5":return["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"];case"C2iGreen2Red3":return["#1a9641","#ffffbf","#d7191c"];case"C2iRed2Green3":return["#d7191c","#ffffbf","#1a9641"];case"C2iGreen2Red2":return["#1a9641","#d7191c"];case"C2iRed2Green2":return["#d7191c","#1a9641"];case"Tab10":return d3.schemeTableau10;case"Cat10":return d3.schemeCategory10;case"Accent":return d3.schemeAccent;case"Dark2":return d3.schemeDark2;case"Paired":return d3.schemePaired;case"Pastel1":return d3.schemePastel1;case"Pastel2":return d3.schemePastel2;case"Set1":return d3.schemeSet1;case"Set2":return d3.schemeSet2;case"Set3":return d3.schemeSet3;default:const e=c2i.util.customColors;return e&&t in e?d3.scaleOrdinal().range(e[t]).range():d3.schemeTableau10}}),c2i.util.shadeColor=((t,e)=>{let a=parseInt(t.substring(1,3),16),o=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);return a=parseInt(a*(100+e)/100),o=parseInt(o*(100+e)/100),n=parseInt(n*(100+e)/100),a=a<255?a:255,o=o<255?o:255,n=n<255?n:255,"#"+(1===a.toString(16).length?"0"+a.toString(16):a.toString(16))+(1===o.toString(16).length?"0"+o.toString(16):o.toString(16))+(1===n.toString(16).length?"0"+n.toString(16):n.toString(16))}),c2i.util.shapeTypes=function(t){if(void 0===t&&(t="ko"),"object"!=typeof c2i.language[t])throw new Error("C2I requires (c2i_"+t+".js) language file.(for SHAPE_TYPES)");return c2i.util.SHAPE_TYPES.forEach(function(e){e.name=c2i.language[t].gen[e.type]}),c2i.util.SHAPE_TYPES},c2i.util.trendLine=function(t,e,a){return t.indexOf("linear")>-1?((t,e)=>{const a={},o=e.length;let n=0,r=0,l=0,i=0,s=0;for(let a=0;a<e.length;a++)n+=t[a],r+=e[a],l+=t[a]*e[a],i+=t[a]*t[a],s+=e[a]*e[a];return a.slope=(o*l-n*r)/(o*i-n*n),a.intercept=(r-a.slope*n)/o,a.rSquare=Math.pow((o*l-n*r)/Math.sqrt((o*i-n*n)*(o*s-r*r)),2),a})(e,a):t.indexOf("least")>-1?((t,e)=>{const a={},o=(t,e)=>t+e,n=d3.mean(t),r=d3.mean(e),l=t.map(t=>Math.pow(t-n,2)).reduce(o),i=e.map(t=>Math.pow(t-r,2)).reduce(o),s=t.map((t,a)=>(t-n)*(e[a]-r)).reduce(o);return a.slope=s/l,a.intercept=r-n*a.slope,a.rSquare=Math.pow(s,2)/(l*i),a})(e,a):function(t){const e=t.length,a=d3.range(1,e+1),o=m(a),n=t.map(t=>Math.log(t)),r=m(a.map(t=>u(t))),l=m(n),i=m(a.map((t,e)=>t*n[e])),s=(l*r-o*i)/(e*r-u(o)),c=(e*i-o*l)/(e*r-u(o)),d=[];return a.forEach(t=>d.push(Math.exp(s)*Math.exp(c*t))),d;function u(t){return Math.pow(t,2)}function m(t){let e=0;return t.forEach(t=>e+=t),e}}(a)},c2i.util.trendLinear=((t,e,a=!1)=>{let o,n,r,l,i,s,c,d=0,u=0,m=0,p=0,g=t.length;t.forEach(t=>{m+=t.x*t.y,d+=t.x,u+=t.y,p+=Math.pow(t.x,2)}),o=m*g,n=d*u,r=g*p,l=Math.pow(d,2),c=(u-(i=(s=(o-n)/(r-l))*d))/g;const f={data:[x(t[0].x,s,c),x(t[g-1].x,s,c)]},h=[],y=[];a&&(t=t.filter(t=>0!==t.y)),t.forEach(t=>{h.push(t.x),y.push(parseFloat(t.y))});const _=c2i.util.trendLine(e,h,y);return f.value={..._,yFmt:",.4f"},f;function x(t,e,a){return{x:t,y:e*t+a}}}),c2i.util.trendLogarithmic=(t=>{let e=0,a=0,o=0,n=0,r=0;(t=t.filter(t=>t.x>0).sort((t,e)=>t.x-e.x)).forEach(t=>{e+=Math.log(t.x),a+=t.y,o+=Math.log(t.x)*Math.log(t.x),r+=t.y*t.y,n+=Math.log(t.x)*t.y});const l=t.length,i=(l*n-e*a)/(l*o-e*e),s=(a-i*e)/l,c=[];return t.forEach(t=>{const e=t.x,a=parseFloat(i*Math.log(t.x)+s);c.push({x:e,y:a})}),{data:c,value:{slope:i,intercept:s,yFmt:",.4f"}}}),c2i.util.line13={linesThicker:()=>textures.lines().thicker(),linesHeavier10:()=>textures.lines().heavier(10).thinner(1.5),linesSize4:()=>textures.lines().size(4).strokeWidth(1),linesSize8:()=>textures.lines().size(8).strokeWidth(2),linesOri38:t=>textures.lines().orientation("3/8").stroke(t||"darkorange"),linesOri3878:t=>textures.lines().orientation("3/8","7/8").stroke(t||"darkorange"),linesOriVerHor:t=>textures.lines().orientation("vertical","horizontal").size(4).strokeWidth(1).shapeRendering("crispEdges").stroke(t||"darkorange"),linesOriDia:t=>textures.lines().orientation("diagonal").size(40).strokeWidth(26).stroke(t||"darkorange"),lines:()=>textures.lines(),linesLighter:()=>textures.lines().lighter(),linesHeavier:()=>textures.lines().heavier(),linesThinner:()=>textures.lines().thinner(),linesOriVer:()=>textures.lines().orientation("vertical").strokeWidth(1).shapeRendering("crispEdges")},c2i.util.circle11={circles:()=>textures.circles(),circlesHeavier:()=>textures.circles().heavier(),circlesThicker:()=>textures.circles().thicker(),circlesComplement:()=>textures.circles().complement(),circlesSize5:()=>textures.circles().size(5),circlesRadius4:()=>textures.circles().radius(4),circlesRadius4Fill2:()=>textures.circles().radius(4).fill("transparent").strokeWidth(2),circlesRadius4Comp:t=>textures.circles().radius(4).fill(t||"darkorange").strokeWidth(2).stroke("firebrick").complement(),circlesRadius4Back:()=>textures.circles().size(2).radius(2).fill("firebrick"),circlesLighter:()=>textures.circles().lighter(),circlesThinner:()=>textures.circles().thinner()},c2i.util.path7={pathHexagons:t=>textures.paths().d("hexagons").size(8).strokeWidth(2).stroke(t||"darkorange"),pathCrosses:()=>textures.paths().d("crosses").lighter().thicker(),pathCaps:t=>textures.paths().d("caps").lighter().thicker().stroke(t||"darkorange"),pathWoven:()=>textures.paths().d("woven").lighter().thicker(),pathWaves:()=>textures.paths().d("waves").thicker().stroke("firebrick"),pathNylon:()=>textures.paths().d("nylon").lighter().shapeRendering("crispEdges"),pathSquares:t=>textures.paths().d("squares").stroke(t||"darkorange")},c2i.util.blankChange=(t=>""===t.trim()?"없음":t),c2i.util.textures={linesThicker:()=>textures.lines().thicker(),linesHeavier10:()=>textures.lines().heavier(10).thinner(1.5),linesSize4:()=>textures.lines().size(4).strokeWidth(1),linesSize8:()=>textures.lines().size(8).strokeWidth(2),linesOri38:t=>textures.lines().orientation("3/8").stroke(t||"darkorange"),linesOri3878:t=>textures.lines().orientation("3/8","7/8").stroke(t||"darkorange"),linesOriVerHor:t=>textures.lines().orientation("vertical","horizontal").size(4).strokeWidth(1).shapeRendering("crispEdges").stroke(t||"darkorange"),linesOriDia:t=>textures.lines().orientation("diagonal").size(40).strokeWidth(26).stroke(t||"darkorange"),lines:()=>textures.lines(),linesLighter:()=>textures.lines().lighter(),linesHeavier:()=>textures.lines().heavier(),linesThinner:()=>textures.lines().thinner(),linesOriVer:()=>textures.lines().orientation("vertical").strokeWidth(1).shapeRendering("crispEdges"),circles:()=>textures.circles(),circlesHeavier:()=>textures.circles().heavier(),circlesThicker:()=>textures.circles().thicker(),circlesComplement:()=>textures.circles().complement(),circlesSize5:()=>textures.circles().size(5),circlesRadius4:()=>textures.circles().radius(4),circlesRadius4Fill2:()=>textures.circles().radius(4).fill("transparent").strokeWidth(2),circlesRadius4Comp:t=>textures.circles().radius(4).fill(t||"darkorange").strokeWidth(2).stroke("firebrick").complement(),circlesRadius4Back:()=>textures.circles().size(2).radius(2).fill("firebrick"),circlesLighter:()=>textures.circles().lighter(),circlesThinner:()=>textures.circles().thinner(),pathHexagons:t=>textures.paths().d("hexagons").size(8).strokeWidth(2).stroke(t||"darkorange"),pathCrosses:()=>textures.paths().d("crosses").lighter().thicker(),pathCaps:t=>textures.paths().d("caps").lighter().thicker().stroke(t||"darkorange"),pathWoven:()=>textures.paths().d("woven").lighter().thicker(),pathWaves:()=>textures.paths().d("waves").thicker().stroke("firebrick"),pathNylon:()=>textures.paths().d("nylon").lighter().shapeRendering("crispEdges"),pathSquares:t=>textures.paths().d("squares").stroke(t||"darkorange")},c2i.util.SHAPE_EASE={back:TWEEN.Easing.Back.InOut,bounce:TWEEN.Easing.Bounce.InOut,circular:TWEEN.Easing.Circular.InOut,cubic:TWEEN.Easing.Cubic.InOut,elastic:TWEEN.Easing.Elastic.InOut,exponential:TWEEN.Easing.Exponential.InOut,linear:TWEEN.Easing.Linear.None,quadratic:TWEEN.Easing.Quadratic.InOut,quartic:TWEEN.Easing.Quartic.InOut,quintic:TWEEN.Easing.Quintic.InOut,sinusoidal:TWEEN.Easing.Sinusoidal.InOut},c2i.util.SHAPE_TYPES=[{type:"curve",name:"커브"},{type:"pattern",name:"패턴"},{type:"table",name:"테이블"},{type:"sphere",name:"구형"},{type:"helix",name:"나선"},{type:"grid",name:"그리드"}],c2i.util.templateFormat=((t,...e)=>t.replace(/{(\d+)}/g,(t,a)=>void 0!==e[a]?e[a]:t)),c2i.util.exportImage=function(t,e){function a(t,e){const a=d3.select(t).select("svg");if(a.empty())return void console.info('*.Info: "'+t+'" 없거나, 벡터(svg) 기반이 아닙니다. 확인 바랍니다.');c2i.resizers.some(e=>{if(e.con===t)return e.reObj.detach(e.resize),!1});let o=a.attr("version",1.2).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").node().parentNode.innerHTML;const r=(o=o.substr(0,o.indexOf("</svg>")+6)).indexOf("<svg ");r>-1&&(o=o.substr(r,o.indexOf("</svg>")+6));const l="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(o))),i=document.createElement("canvas"),s=i.getContext("2d");if(i.width=a.attr("width"),i.height=a.attr("height"),0===i.width||0===i.height)return void console.info("*.Info: 한 번도 보지 않은 차트는 추출하지 않습니다.");const c=n(e),d=new Image;function u(){const t=window.open("","_blank");t.document.write("<img src='"+l+"' alt='from C2I' title='오른쪽 마우스 클릭 후\n다른 이름으로 사진 저장을 선택해 주세요.'/>"),t.document.title=c}function m(){c2i.resizers.some(e=>{if(e.con===t){const a=document.getElementById(t.substr(1));return new ResizeSensor(a,e.resize),!1}})}d.addEventListener("load",function(){try{s.drawImage(d,0,0);const t=document.createElement("a");t.download=c,t.href=i.toDataURL("image/png"),document.body.appendChild(t),t.click(),document.body.removeChild(t),m()}catch(t){u(),m(),console.error("*.Info: "+t.message)}finally{console.log("*.C2i 이미지 다운로드 왼료...!!")}},!1),d.src=l,c2i.util.isIE()&&(u(),m())}function o(t,e){if(0===t.getWidth()||0===t.getHeight())return void console.info("*.Info: 한 번도 보지 않은 차트는 추출하지 않습니다.");const a=n(e),o=new Image;function r(){const t=window.open("","_blank");t.document.write("<img src='"+o.src+"' alt='from C2I' title='오른쪽 마우스 클릭 후\n다른 이름으로 사진 저장을 선택해 주세요.'/>"),t.document.title=a}o.addEventListener("load",function(){try{const t=document.createElement("a");t.download=a,t.href=o.src,document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(t){r(o.src),console.error("*.Info: "+t.message)}finally{console.log("*.C2i 이미지 다운로드 왼료...!!")}},!1),o.src=t.getDataURL({pixelRatio:1,backgroundColor:t.getOption().backgroundColor}),c2i.util.isIE()&&r()}function n(t){let e=c2i.licenseKey&&49===c2i.licenseKey.length?"c2i_":"c2i_Demo_";return e+=void 0!==t?t+"_":"",e+=d3.timeFormat("%Y%m%d_%H%M%S")(new Date)+".png"}t&&(Array.isArray(t)?t.forEach((t,n)=>{e?o(t,n):a(t,n)}):e?o(t):a(t))},c2i.util.fix4Bootstrap=(()=>{d3.selectAll(".dg select").style("color","black"),d3.selectAll(".dg input").style("line-height","normal"),d3.selectAll(".dg .close-button").attr("title",c2i.lang.gen.keyH)}),c2i.util.formatMask=((t,e)=>(e=e||",.0f",d3.format(e)(t))),c2i.util.isEmpty=(t=>{for(const e in t)if(t.hasOwnProperty(e))return!1;return JSON.stringify(t)===JSON.stringify({})}),c2i.util.exportFilters=function(t,e,a,o,n,r){const l=t.xDim,i=t.yDim,s=t.y2Dim,c=t.title&&t.title.caption?t.title.caption:"",d=[l.colNm+",",i.colNm+",",s.colNm+","],u=[];let m=l.caption?l.caption:l.colNm;[m,i.caption,s.caption].forEach(t=>{t.search(/["|,|\n]/g)>=0?u.push('"'+t+'",'):u.push(t+",")});let p=r||t.data;if(p=p.filter(o).map(t=>((m={})[l.colNm]=n?n(t.key):t.key,{...m,...t.value})),e&&e.length||!a||(e=a()),e.length){let a,o,n="";(e=e.filter(e=>e.c2iCon!==t.id)).forEach(t=>{a=t.title.search(/("|,|\n)/g)>=0?'"'+t.title+'"':t.title,o=t.filters.search(/("|,|\n)/g)>=0?'"'+t.filters+'"':t.filters,n+=(a+=","+o)+"\r\n"}),n&&(e=n+"\r\n")}return{caption:c,colNms:d,colCaptions:u,data:p,filters2:e}},c2i.util.exportData=function(t,e,a,o,n,r,l){let i="",s=[],c=t?t.replace(/"/g,'""'):"";c.search(/("|,|\n)/g)>=0&&(c='"'+c+'"');let d,u,m,p=c?c+"\r\n\n":"";for(d in r&&(p+=r),o[0])o[0].hasOwnProperty(d)&&(e.length?(u=e.indexOf(d+","))>-1&&(s.push(a[u]),i+=d+","):i+=d+",");if(s.length&&(s[s.length-1]=s[s.length-1].slice(0,-1),p+=s.join("")+"\r\n"),i=i.slice(0,-1),p+=i+"\r\n",o.forEach(t=>{for(d in i="",t)t.hasOwnProperty(d)&&(m=t[d],l&&l.colNm===d&&("function"==typeof l.tipFormat&&(m=l.tipFormat(m)),"time"===l.scale&&(m="‌"+m)),e.length?e.indexOf(d+",")>-1&&(i+='"'+m+'",'):i+='"'+m+'",');i=i.slice(0,i.length-1),p+=i+"\n"}),""===p)return void alert("*.Error: Invalid data");c=c.replace(/"/g,"");let g=c2i.licenseKey&&49===c2i.licenseKey.length?"c2i_":"c2i_Demo_";c&&c.length>0?g+=c.replace(/( |,|\n)/g,"_"):g+=d3.timeFormat("%Y%m%d_%H%M%S")(new Date);const f=n&&"xls"===n?"vnd.ms-excel":"text";p="\ufeff"+p;const h="data:application/"+f+";charset=utf-8,"+encodeURIComponent(p);if(g+="text"===f?".csv":".xls",c2i.util.isIE()){const t=function(){let t,e="N/A",a=navigator.userAgent.toLowerCase();if("Microsoft Internet Explorer"===navigator.appName)t="msie ";else if(a.search("trident")>-1)t="trident/.*rv:";else{if(!(a.search("edge/")>-1))return e;t="edge/"}null!==new RegExp(t+"([0-9]{1,})(\\.{0,}[0-9]{0,1})").exec(a)&&(e=RegExp.$1+RegExp.$2);return e}(),e=parseInt(t,10);if("N/A"===t)return void console.info("IE가 아닌 다른 브라우저 사용 중.");if(e<10){const t=window.open();return t.document.write(p),t.document.close(),t.document.execCommand("SaveAs",!0,g),void t.close()}if(navigator.msSaveBlob){const t=new Blob([p],{type:"data:application/"+f+";charset=utf-8;"});navigator.msSaveBlob(t,g)}else alert("ie10 미만은 서버 익스포트만 지원합니다."),console.info("Not support under ie10 msSaveBlob");return}const y=document.createElement("a");y.href=h,y.style="visibility:hidden",y.download=g,document.body.appendChild(y),y.click(),document.body.removeChild(y),console.log("*.C2i 데이터 화일 다운로드 왼료...!!")},c2i.util.L0=[{cd:-1,nm:"전국"},{cd:11,nm:"서울특별시"},{cd:21,nm:"부산광역시"},{cd:22,nm:"대구광역시"},{cd:23,nm:"인천광역시"},{cd:24,nm:"광주광역시"},{cd:25,nm:"대전광역시"},{cd:26,nm:"울산광역시"},{cd:29,nm:"세종"},{cd:31,nm:"경기도"},{cd:32,nm:"강원도"},{cd:33,nm:"충청북도"},{cd:34,nm:"충청남도"},{cd:35,nm:"전라북도"},{cd:36,nm:"전라남도"},{cd:37,nm:"경상북도"},{cd:38,nm:"경상남도"},{cd:39,nm:"제주특별자치도"}],c2i.util.toggleFullScreen=(()=>{const t=window.document,e=t.documentElement,a=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,o=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement?o.call(t):a.call(e)}),c2i.util.genData=((t,e=100,a=0,o)=>{const n={},r={};let l;const i=d3.range(e).map((e,i)=>{const s={id:i};return t.forEach(t=>{r[t]=.9*((r[t]||0)+(Math.random()-.5)),l=Math.max(a,(n[t]||10*Math.random())+r[t]),(o||0===o&&a<0)&&(l=Math.max(o,l)),n[t]=s[t]=l}),s});return i.keys=t,i}),c2i.utilEx={aggClass:(t,e,a)=>{let o;switch(t){case"class":o=e>=a?"c2iAggPositive":"c2iAggNegative";break;case"color":o=e>=a?"green":"red";break;default:o=e>a?"arrow_drop_up":e===a?"":"arrow_drop_down"}return o},metaMapping2:(t,e,a,o)=>{t.sMeta=_.merge({},e,a);const n=t.sMeta.measures.map(t=>t.colNm).map(t=>o.common.measures[t]);t.sMeta.measures=_.merge([],n,t.sMeta.measures),a.xDim&&!a.xDim.brush&&(t.sMeta.xDim.brush=void 0)},metaMapping:(t,e,a)=>{t.sMeta=_.merge({},e,a);const o=t.sMeta.measures.map(t=>t.colNm).map(t=>c2iMeta.common.measures[t]);t.sMeta.measures=_.merge([],o,t.sMeta.measures),a.xDim&&!a.xDim.brush&&(t.sMeta.xDim.brush=void 0)},changePointer:t=>d3.select(t).selectAll(".c2iStd .x.axis text").style("cursor","pointer"),resetTooltip:(t,e,a,o)=>{t.select("table").style("width",e),t.selectAll(["table hr","table #ratio"]).style("display",a),t.select("tbody").style("display",o||null)},sortFields:t=>(e,a)=>{const o=/^\d+$/;for(let n=0;n<t.length;n++){let r=1,l=t[n];if(0==t[n].indexOf("-")&&(l=t[n].substr(1,t[n].length),r=-r),o.test(e[l])&&(e[l]=parseFloat(e[l]),a[l]=parseFloat(a[l])),e[l]>a[l])return r;if(e[l]<a[l])return-r}},resultColumnsFix:(t,e,a="wow_QA_")=>{const o=/[\s|.|:|'|@|+|/|(|)|[|\]|&|?|,]/g;let n=!1;if(e.some(t=>{if(o.test(t))return n=!0,!0}),n){const o=(e.length+"").length;return e=e.map((t,e)=>a+(e+++"").padStart(o,"0")),t=t.map(t=>{let a=0,o={};for(let n in t)o[e[a++]]=t[n];return o}),{columns:e,result:t}}return null}},c2i.meta={msg:"*.[{0}]\nThe trial period has passed.\n Please contact your C2I dealer.",msgLicense:">> The License was violated.\n Please contact your C2I dealer.",separator:["&#x2500;","&#x2550;"],std:{title:"title",data:[{caption:"std.dC1",type:"div",dev:!1,cls:"tdContentLeft",method:["change","_whichYChange_",".whichY"],labels:[{label:"std.dLL11",title:"std.dLT1",input:{id:"whichY",type:"radio",name:"whichY",cls:"whichY",value:"y"}},{label:"std.dLL12",title:"std.dLT2",input:{id:"whichY2",type:"radio",name:"whichY",cls:"whichY m10px",value:"y2"}}]},{caption:"std.dC2",type:"select",dev:!1,id:"clusterType",cls:"tdContent",title:"std.dT2",method:["change","_clusterTypeChange_"],options:[{value:"stackbar",label:"std.dO2Label1",group:"group"},{value:"stackbar100",label:"std.dO2Label2",group:"group"},{value:"groupbar",label:"std.dO2Label3",group:"group"},{value:"stackarea",label:"std.dO2Label4",group:"group"},{value:"stackarea100",label:"std.dO2Label5",group:"group"},{value:"stackstream",label:"std.dO2Label6",group:"group"},{value:"",separator:!0,length:10,idx:0,group:"group"},{value:"boxplot",label:"std.dO2Label7",group:"boxplot"},{value:"",separator:!0,length:10,idx:0,group:"boxplot"},{value:"bar",label:"std.dO2Label10",group:"group"},{value:"line",label:"std.dO2Label11",group:"group"},{value:"area",label:"std.dO2Label12",group:"group"},{value:"linearea",label:"std.dO2Label13",group:"group"},{value:"",separator:!0,length:10,idx:0,group:"group"},{value:"each",label:"std.dO2Label99"}]},{caption:"std.dC21",type:"select",dev:!1,id:"curveType",cls:"tdContent",title:"std.dT21",method:["change","_curveTypeChange_"],options:[{value:"monotone",label:"std.dO21Label1",group:"group"},{value:"step",label:"std.dO21Label2",group:"group"},{value:"cardinal",label:"std.dO21Label3",group:"group"},{value:"basis",label:"std.dO21Label4",group:"group"},{value:"linear",label:"std.dO21Label5",group:"group"}]},{caption:"std.dC20",type:"div",dev:!1,cls:"tdContentLeft2",title:"std.dT20",method:["change","_ySplitChange_",".ySplitChange"],range:{input:{id:"ySplit",type:"range",cls:"ySplitChange",min:0,max:100,value:100},div:{id:"__ySplitText",cls:"ySplitText"}}},{caption:"std.dC3",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT3",method:["change","_yScaleChange_",".yScale"],labels:[{label:"std.dLL31",input:{id:"yLinear",type:"radio",name:"yScale",cls:"yScale",value:"linear"}},{label:"std.dLL32",input:{id:"ySqrt",type:"radio",name:"yScale",cls:"yScale m10px",value:"sqrt"}}]},{caption:"std.dC4",type:"select",dev:!1,id:"colors",cls:"tdContent",method:["change","_colorsChange_"],options:[{value:"Tab10",label:"std.dO4Label1",isC2i:!0},{value:"Cat10",label:"std.dO4Label2",isC2i:!0},{value:"Accent",label:"std.dO4Label3",isC2i:!0},{value:"Dark2",label:"std.dO4Label4",isC2i:!0},{value:"Paired",label:"std.dO4Label5",isC2i:!0},{value:"Pastel1",label:"std.dO4Label6",isC2i:!0},{value:"Pastel2",label:"std.dO4Label7",isC2i:!0},{value:"Set1",label:"std.dO4Label8",isC2i:!0},{value:"Set2",label:"std.dO4Label9",isC2i:!0},{value:"Set3",label:"std.dO4Label10",isC2i:!0},{value:"",separator:!0,length:10,idx:0,isC2i:!0},{value:"Tab10/solid",label:"std.dO4Label21",isC2i:!0},{value:"Cat10/solid",label:"std.dO4Label22",isC2i:!0},{value:"Accent/solid",label:"std.dO4Label23",isC2i:!0},{value:"Dark2/solid",label:"std.dO4Label24",isC2i:!0},{value:"Paired/solid",label:"std.dO4Label25",isC2i:!0},{value:"Pastel1/solid",label:"std.dO4Label26",isC2i:!0},{value:"Pastel2/solid",label:"std.dO4Label27",isC2i:!0},{value:"Set1/solid",label:"std.dO4Label28",isC2i:!0},{value:"Set2/solid",label:"std.dO4Label29",isC2i:!0},{value:"Set3/solid",label:"std.dO4Label30",isC2i:!0},{value:"",separator:!0,length:10,idx:1,isC2i:!0},{value:"each",label:"gen.userDefine",isC2i:!0}]},{caption:"std.dC5",type:"select",dev:!1,id:"texture",cls:"tdContent",title:"std.dT5",method:["change","_textureChange_"],options:[{value:"line13",label:"std.dC5Label1"},{value:"circle11",label:"std.dC5Label2"},{value:"path7",label:"std.dC5Label3"},{value:"all",label:"std.dC5Label4"},{value:"",separator:!0,length:10,idx:1},{value:"",label:"std.dC5Label5"}]},{caption:"std.dC6",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT6",method:["change","___stackValue100",".stackValue100"],labels:[{label:"std.dLL61",input:{id:"both",type:"radio",name:"stackValue100",cls:"stackValue100",value:"both"}},{label:"std.dLL62",input:{id:"value",type:"radio",name:"stackValue100",cls:"stackValue100 m10px",value:"value"}}]},{caption:"std.dC7",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT7",method:["click","___plotLines",".plotLines"],labels:[{label:"std.dLL71",input:{id:"plotLines",type:"checkbox",cls:"plotLines"}},{label:"std.dLL72",title:"std.dLT72",input:{id:"paretoLines",type:"checkbox",cls:"plotLines m10px"}},{label:"std.dLL73",input:{id:"markers",type:"checkbox",cls:"plotLines m10px"}}]},{caption:"std.dC24",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT24",method:["click","___trendLines",".trendLines"],labels:[{label:"std.dLL241",title:"std.dLT241",input:{id:"trendLines",type:"checkbox",cls:"trendLines"}},{label:"std.dLL242",title:"std.dLT242",input:{id:"exceptZero",type:"checkbox",cls:"trendLines m10px"}}]},{caption:"std.dC22",type:"select",dev:!1,id:"trendType",cls:"tdContent",title:"std.dT22",method:["change","___trendTypeChange"],options:[{value:"linearexpression",label:"std.dC22Label1"},{value:"leastsquare",label:"std.dC22Label2"},{value:"exponentialregression",label:"std.dC22Label3"}]},{caption:"std.dC8",type:"select",dev:!1,id:"summaryType",cls:"tdContent",title:"std.dT8",method:["change","___summaryTypeChange"],options:[{value:"_sum",label:"std.dC8Label1"},{value:"_avg",label:"std.dC8Label2"},{value:"_min",label:"std.dC8Label3"},{value:"_max",label:"std.dC8Label4"},{value:"",separator:!0,length:10,idx:0},{value:"false",label:"std.dC8Label5"}]},{caption:"std.dC9",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT9",method:["click","___scaleAuto","#scaleAuto"],labels:[{label:"std.dLL91",title:"std.dLT91",input:{id:"scaleAuto",type:"checkbox"}}]},{caption:"std.dC11",type:"select",dev:!1,id:"c2iSelectedChart",cls:"tdContent",title:"std.dT11",options:[],dynamic:{caption:"gen.create",type:"button",id:"createNewChart",cls:"tdContent",method:["click","___createNewChart"]}},{caption:"std.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"std.dO14Label1"},{value:"1",label:"std.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"std.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"std.dC25",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT25",method:["click","___hideValLable","#hideValLable"],labels:[{label:"std.dLL251",title:"std.dT25",input:{id:"hideValLable",type:"checkbox"}}]},{caption:"std.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"std.dO15Label1"},{value:"#444363",label:"std.dO15Label2"},{value:"#333333",label:"std.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"std.dC16",type:"button",dev:!0,id:"makeJson",cls:"tdContent",title:"std.dT116",label:"std.dataLabel16",method:["click","___makeJson"]},{caption:"std.dC18",type:"button",dev:!0,id:"animation",cls:"tdContent",label:"std.dataLabel18",method:["click","animatedAction"]},{caption:"std.dC19",type:"button",dev:!0,id:"changeData",cls:"tdContent",label:"std.dataLabel19",method:["click","changeData"]}]},country:{title:"title",data:[{caption:"country.dC1",type:"div",dev:!1,cls:"tdContentLeft",title:"country.dT1",method:["change","_areaShowLabelToggle_",".areaShowLabel"],labels:[{label:"country.dLL11",input:{id:"dataExist",type:"checkbox",cls:"areaShowLabel"}},{label:"country.dLL12",input:{id:"dataNonExist",type:"checkbox",cls:"areaShowLabel m4px"}}]},{caption:"country.dC2",type:"select",dev:!1,id:"changeGhostLevel",cls:"tdContent",title:"country.dT2",method:["change","___changeGhostLevel"],mapLevel:!0,options:[{value:"0",label:"country.dO2Label1"},{value:"1",label:"country.dO2Label2"},{value:"2",label:"country.dO2Label3"},{value:"-1",label:"country.dO2Label4"}]},{caption:"country.dC3",type:"div",dev:!1,cls:"tdContentLeft",title:"country.dT3",method:["click","___showGhostLabelToggle","#gShowLabel"],labels:[{label:"country.dLL31",input:{id:"gShowLabel",type:"checkbox"}}]},{caption:"country.dC4",type:"div",dev:!1,cls:"tdContentLeft",title:"country.dT4",method:["click","___courseToggle","#showCourses"],labels:[{label:"country.dLL41",input:{id:"showCourses",type:"checkbox"}}]},{caption:"std.dC5",type:"select",dev:!1,id:"texture",cls:"tdContent",title:"std.dT5",method:["change","_textureChange_"],options:[{value:"line13",label:"std.dC5Label1"},{value:"circle11",label:"std.dC5Label2"},{value:"path7",label:"std.dC5Label3"},{value:"all",label:"std.dC5Label4"},{value:"",separator:!0,length:10,idx:1},{value:"",label:"std.dC5Label5"}]},{caption:"country.dC6",type:"select",dev:!1,id:"changeResolution",cls:"tdContent",title:"country.dT6",method:["change","___changeResolution"],options:[{value:"H",label:"country.dLL61"},{value:"M",label:"country.dLL62"},{value:"L",label:"country.dLL63"}]},{caption:"std.dC11",type:"select",dev:!1,id:"c2iSelectedChart",cls:"tdContent",title:"std.dT11",options:[],dynamic:{caption:"gen.create",type:"button",id:"createNewChart",cls:"tdContent",method:["click","___createNewChart"]}},{caption:"std.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"std.dO14Label1"},{value:"1",label:"std.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"std.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"std.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"std.dO15Label1"},{value:"#444363",label:"std.dO15Label2"},{value:"#333333",label:"std.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"country.dC16",type:"button",dev:!0,id:"makeJson",cls:"tdContent",title:"std.dT116",label:"std.dataLabel16",method:["click","___makeJson"]}]},world:{title:"title",data:[{caption:"country.dC1",type:"div",dev:!1,cls:"tdContentLeft",title:"country.dT1",method:["change","_areaShowLabelToggle_",".areaShowLabel"],labels:[{label:"country.dLL11",input:{id:"dataExist",type:"checkbox",cls:"areaShowLabel"}},{label:"country.dLL12",input:{id:"dataNonExist",type:"checkbox",cls:"areaShowLabel m4px"}}]},{caption:"country.dC3",type:"div",dev:!1,cls:"tdContentLeft",title:"country.dT3",method:["click","___showGhostLabelToggle","#gShowLabel"],labels:[{label:"country.dLL31",input:{id:"gShowLabel",type:"checkbox"}}]},{caption:"country.dC4",type:"div",dev:!1,cls:"tdContentLeft",title:"country.dT4",method:["click","___courseToggle","#showCourses"],labels:[{label:"country.dLL41",input:{id:"showCourses",type:"checkbox"}}]},{caption:"std.dC5",type:"select",dev:!1,id:"texture",cls:"tdContent",title:"std.dT5",method:["change","_textureChange_"],options:[{value:"line13",label:"std.dC5Label1"},{value:"circle11",label:"std.dC5Label2"},{value:"path7",label:"std.dC5Label3"},{value:"all",label:"std.dC5Label4"},{value:"",separator:!0,length:10,idx:1},{value:"",label:"std.dC5Label5"}]},{caption:"country.dC6",type:"select",dev:!1,id:"changeResolution",cls:"tdContent",title:"country.dT6",method:["change","___changeResolution"],options:[{value:"H",label:"country.dLL61"},{value:"M",label:"country.dLL62"},{value:"L",label:"country.dLL63"}]},{caption:"std.dC11",type:"select",dev:!1,id:"c2iSelectedChart",cls:"tdContent",title:"std.dT11",options:[],dynamic:{caption:"gen.create",type:"button",id:"createNewChart",cls:"tdContent",method:["click","___createNewChart"]}},{caption:"std.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"std.dO14Label1"},{value:"1",label:"std.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"std.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"std.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"std.dO15Label1"},{value:"#444363",label:"std.dO15Label2"},{value:"#333333",label:"std.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"std.dC16",type:"button",dev:!0,id:"makeJson",cls:"tdContent",title:"std.dT116",label:"std.dataLabel16",method:["click","___makeJson"]}]},motion:{title:"title",data:[{caption:"motion.dC1",type:"select",dev:!1,id:"colorColNms",cls:"tdContent",title:"motion.dT1",method:["change","___colorColNmChange"],options:[]},{caption:"motion.dC2",type:"div",dev:!1,cls:"tdContentLeft2",title:"motion.dT2",colorPicker:{id:"c2iColorPicker",options:{width:146,height:370,easing:"linear",duration:750,method:{click:"__colorChangeResult"}}}},{caption:"motion.dC3",type:"select",dev:!1,id:"radiusColNms",cls:"tdContent",title:"motion.dT3",method:["change","___radiusColNmChange"],options:[]},{caption:"motion.dC4",type:"div",dev:!1,cls:"tdContentLeft2",title:"motion.dT4",method:["change","___radiusChange",".radiusChange"],range:{input:{id:"nRadius",type:"range",cls:"radiusChange",min:1,max:80,value:40},div:{id:"__nRadiusText",cls:"nRadiusText"}}},{caption:"motion.dC5",type:"div",dev:!1,cls:"tdContentLeft2",title:"motion.dT5",method:["input","___xRotateChange",".xRotateChange"],range:{input:{id:"xRotate",type:"range",cls:"xRotateChange",min:-90,max:90,value:0},div:{id:"__xRotateText",cls:"xRotateText"}}},{caption:"motion.dC6",type:"div",dev:!1,cls:"tdContentLeft2",title:"motion.dT6",method:["input","___xAxisGBottomMarginChange",".xAxisGBottomMargin"],range:{input:{id:"xAxisGBottomMargin",type:"range",cls:"xAxisGBottomMargin",min:20,max:100,value:40},div:{id:"__xAxisGBottomMarginText",cls:"xAxisGBottomMarginText"}}},{caption:"motion.dC7",type:"div",dev:!1,cls:"tdContentLeft",title:"motion.dT7",method:["change","___xyGridLineChange",".xyGridLines"],labels:[{label:"motion.dLL71",input:{id:"xGrid",type:"checkbox",cls:"xyGridLines"}},{label:"motion.dLL72",input:{id:"yGrid",type:"checkbox",cls:"xyGridLines m4px"}}]},{caption:"motion.dC8",type:"button",dev:!1,id:"xyExchange",cls:"tdContent",label:"motion.dataLabel8",title:"motion.dT8",method:["click","___xyExchange"]},{caption:"std.dC11",type:"select",dev:!1,id:"c2iSelectedChart",cls:"tdContent",title:"std.dT11",options:[],dynamic:{caption:"gen.create",type:"button",id:"createNewChart",cls:"tdContent",method:["click","___createNewChart"]}},{caption:"std.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"std.dO14Label1"},{value:"1",label:"std.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"std.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"std.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"std.dO15Label1"},{value:"#444363",label:"std.dO15Label2"},{value:"#333333",label:"std.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"std.dC16",type:"button",dev:!0,id:"makeJson",cls:"tdContent",title:"std.dT116",label:"std.dataLabel16",method:["click","___makeJson"]},{caption:"std.dC19",type:"button",dev:!0,id:"changeData",cls:"tdContent",label:"std.dataLabel19",method:["click","changeData"]}]},pCoord:{title:"title",data:[{caption:"std.dC8",type:"select",dev:!1,id:"summaryType",cls:"tdContent",title:"std.dT8",method:["change","___summaryTypeChange"],options:[{value:"sum",label:"std.dC8Label1"},{value:"avg",label:"std.dC8Label2"},{value:"min",label:"std.dC8Label3"},{value:"max",label:"std.dC8Label4"},{value:"",separator:!0,length:10,idx:0},{value:"false",label:"std.dC8Label5"}]},{caption:"std.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"std.dO15Label1"},{value:"#444363",label:"std.dO15Label2"},{value:"#333333",label:"std.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"std.dC16",type:"button",dev:!0,id:"makeJson",cls:"tdContent",title:"std.dT116",label:"std.dataLabel16",method:["click","___makeJson"]}]},pyramid:{title:"title",data:[{caption:"pyramid.dC1",type:"div",dev:!1,cls:"tdContentLeft",title:"pyramid.dT1",method:["click","___plotLines","#plotLines"],labels:[{label:"pyramid.dLL11",input:{id:"plotLines",type:"checkbox"}}]},{caption:"std.dC11",type:"select",dev:!0,id:"c2iSelectedChart",cls:"tdContent",title:"std.dT11",options:[],dynamic:{caption:"gen.create",type:"button",id:"createNewChart",cls:"tdContent",method:["click","___createNewChart"]}},{caption:"std.dC3",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT3",method:["change","_yScaleChange_",".yScale"],labels:[{label:"std.dLL31",input:{id:"yLinear",type:"radio",name:"yScale",cls:"yScale",value:"linear"}},{label:"std.dLL32",input:{id:"ySqrt",type:"radio",name:"yScale",cls:"yScale m4px",value:"sqrt"}}]},{caption:"std.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"std.dO14Label1"},{value:"1",label:"std.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"std.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"std.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"std.dO15Label1"},{value:"#444363",label:"std.dO15Label2"},{value:"#333333",label:"std.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"std.dC16",type:"button",dev:!0,id:"makeJson",cls:"tdContent",title:"std.dT116",label:"std.dataLabel16",method:["click","___makeJson"]},{caption:"std.dC19",type:"button",dev:!0,id:"changeData",cls:"tdContent",label:"std.dataLabel19",method:["click","changeData"]}]},hi:{title:"title",data:[{caption:"hi.dC1",type:"select",dev:!1,id:"__firstColNms",cls:"tdContent",title:"hi.dT1",method:["change","___firstColNmChange"],options:[]},{caption:"hi.dC2",type:"select",dev:!1,id:"__secondColNms",cls:"tdContent",title:"hi.dT2",method:["change","___secondColNmChange"],options:[]},{caption:"hi.dC3",type:"select",dev:!1,id:"__thirdColNms",cls:"tdContent",title:"hi.dT3",method:["change","___thirdColNmChange"],options:[]},{caption:"hi.dC4",type:"select",dev:!1,id:"__sortColNms",cls:"tdContent",title:"hi.dT4",method:["change","___sortColNmChange"],options:[]},{caption:"hi.dC5",type:"div",dev:!1,cls:"tdContentLeft",title:"hi.dT5",method:["change","___acsDesc",".acsDesc"],labels:[{label:"hi.dLL51",title:"hi.dLT51",input:{id:"ascSort",type:"radio",name:"acsDesc",cls:"acsDesc",value:"asc"}},{label:"hi.dLL52",title:"hi.dLT52",input:{id:"descSort",type:"radio",name:"acsDesc",cls:"acsDesc m5px",value:"desc"}}]},{caption:"hi.dC6",type:"button",dev:!1,id:"expandCollapse",cls:"tdContent",label:"hi.dCLabel6",method:["click","___expandCollapse"]},{caption:"hi.dC7",type:"div",dev:!1,cls:"tdContentLeft",method:["change","___whichDirection",".direction"],labels:[{label:"hi.dLL71",title:"hi.dLT71",input:{id:"__topDown",type:"radio",name:"direction",cls:"direction",value:"topDown"}},{label:"hi.dLL72",title:"hi.dLT72",input:{id:"__leftRight",type:"radio",name:"direction",cls:"direction m5px",value:"leftRight"}}]},{caption:"hi.dC8",type:"div",dev:!1,cls:"tdContentLeft",method:["change","___linkInfo",".linkInfo"],labels:[{label:"hi.dLL81",title:"hi.dLT81",input:{id:"linkDiagonal",type:"radio",name:"linkInfo",cls:"linkInfo",value:"diagonal"}},{label:"hi.dLL82",title:"hi.dLT82",input:{id:"linkElbow",type:"radio",name:"linkInfo",cls:"linkInfo m5px",value:"elbow"}}]},{caption:"hi.dC9",type:"div",dev:!1,cls:"tdContentLeft",method:["change","___currentNodePos",".currentNodePos"],labels:[{label:"hi.dLL91",title:"hi.dLT91",input:{id:"nodeAs",type:"radio",name:"currentNodePos",cls:"currentNodePos",value:""}},{label:"hi.dLL92",title:"hi.dLT92",input:{id:"nodeCenter",type:"radio",name:"currentNodePos",cls:"currentNodePos m3px",value:"center"}},{label:"hi.dLL93",title:"hi.dLT93",input:{id:"nodeAnchor",type:"radio",name:"currentNodePos",cls:"currentNodePos m3px",value:"anchorCenter"}}]},{caption:"hi.dC10",type:"div",dev:!1,cls:"tdContentLeft2",title:"hi.dT10",method:["input","___levelGapChange",".levelGap"],range:{input:{id:"nLevelGap",type:"range",cls:"levelGap",min:5,max:50,value:10},div:{id:"__nLevelGapText",cls:"nLevelGapText"}}},{caption:"hi.dC11",type:"div",dev:!1,cls:"tdContentLeft2",title:"hi.dT11",method:["input","___neighborGapChange",".neighborGap"],range:{input:{id:"nNeighborGap",type:"range",cls:"neighborGap",min:80,max:150,value:0},div:{id:"__nNeighborGapText",cls:"neighborGapText"}}},{caption:"hi.dC13",type:"div",dev:!1,cls:"tdContentLeft2",title:"hi.dT13",method:["input","___nodeRadiusChange",".nodeRadius"],range:{input:{id:"nodeRadius",type:"range",cls:"nodeRadius",min:0,max:50,value:0},div:{id:"__nodeRadiusText",cls:"nodeRadiusText"}}},{caption:"hi.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"hi.dO14Label1"},{value:"1",label:"hi.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"hi.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"hi.dC15",type:"select",dev:!0,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"hi.dO15Label1"},{value:"#444363",label:"hi.dO15Label2"},{value:"#333333",label:"hi.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"hi.dC16",type:"button",dev:!0,cls:"tdContent",title:"hi.dT116",label:"hi.dataLabel16",method:["click","___makeJson"]}]},corR:{title:"title",data:[{caption:"corR.dC1",type:"select",dev:!1,id:"measureColNm",cls:"tdContent",title:"corR.dT1",method:["change","___measureColNmChange"],options:[]},{caption:"corR.dC6",type:"div",dev:!1,cls:"tdContentLeft",method:["change","___cellValueChange",".cellValue"],labels:[{label:"corR.dLL61",title:"corR.dLT61",input:{id:"cellValue1",type:"radio",name:"cellValue",cls:"cellValue",value:0}},{label:"corR.dLL62",title:"corR.dLT62",input:{id:"cellValue2",type:"radio",name:"cellValue",cls:"cellValue m4px",value:1}},{label:"corR.dLL63",title:"corR.dLT63",input:{id:"cellValue3",type:"radio",name:"cellValue",cls:"cellValue m4px",value:9}}]},{caption:"corR.dC7",type:"div",dev:!1,cls:"tdContentLeft",method:["change","___lgValueChange",".lgValue"],labels:[{label:"corR.dLL71",title:"corR.dLT71",input:{id:"lgValue1",type:"radio",name:"lgValue",cls:"lgValue",value:"value"}},{label:"corR.dLL72",title:"corR.dLT72",input:{id:"lgValue2",type:"radio",name:"lgValue",cls:"lgValue m4px",value:"ratio"}}]},{caption:"corR.dC2",type:"select",dev:!1,id:"___rowGroup",cls:"tdContent",title:"corR.dT2",method:["change","___rowGroupChange"],options:[]},{caption:"corR.dC3",type:"select",dev:!1,id:"___colGroup",cls:"tdContent",title:"corR.dT3",method:["change","___colGroupChange"],options:[]},{caption:"corR.dC4",type:"select",dev:!1,id:"___orderBy",cls:"tdContent",method:["change","___changeOrderBy"],options:[{value:"rowcol",label:"corR.dO4Label1"},{value:"row",label:"corR.dO4Label2"},{value:"col",label:"corR.dO4Label3"},{value:"",separator:!0,length:10,idx:1},{value:"user",label:"gen.userDefine"}]},{caption:"corR.dC5",type:"button",dev:!1,id:"__rowColExchange",cls:"tdContent",label:"corR.dC5",method:["click","__rowColExchange"]},{caption:"hi.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"hi.dO14Label1"},{value:"1",label:"hi.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"hi.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"corR.dC8",type:"select",dev:!1,id:"chartMeasureColNm",cls:"tdContent",title:"corR.dT8",method:["change","___chartMeasureColNmChange"],options:[]},{caption:"corR.dC9",type:"div",dev:!1,cls:"tdContentLeft",title:"corR.dT9",method:["click","___sparseApply","#sparseApply"],labels:[{label:"corR.dLL9",title:"corR.dT9",input:{id:"sparseApply",type:"checkbox"}}]},{caption:"hi.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"hi.dO15Label1"},{value:"#444363",label:"hi.dO15Label2"},{value:"#333333",label:"hi.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"hi.dC16",type:"button",dev:!0,cls:"tdContent",title:"hi.dT116",label:"hi.dataLabel16",method:["click","___makeJson"]}]},quad:{title:"title",data:[{caption:"motion.dC3",type:"select",dev:!1,id:"radiusColNms",cls:"tdContent",title:"motion.dT3",method:["change","___radiusColNmChange"],options:[]},{caption:"corR.dC7",type:"div",dev:!1,cls:"tdContentLeft",method:["change","___lgValueChange",".lgValue"],labels:[{label:"corR.dLL71",title:"corR.dLT71",input:{id:"lgValue1",type:"radio",name:"lgValue",cls:"lgValue",value:"value"}},{label:"corR.dLL72",title:"corR.dLT72",input:{id:"lgValue2",type:"radio",name:"lgValue",cls:"lgValue m4px",value:"ratio"}}]},{caption:"motion.dC4",type:"div",dev:!1,cls:"tdContentLeft2",title:"motion.dT4",method:["change","___radiusChange",".radiusChange"],range:{input:{id:"nRadius",type:"range",cls:"radiusChange",min:1,max:80,value:40},div:{id:"__nRadiusText",cls:"nRadiusText"}}},{caption:"motion.dC5",type:"div",dev:!1,cls:"tdContentLeft2",title:"motion.dT5",method:["input","___xRotateChange",".xRotateChange"],range:{input:{id:"xRotate",type:"range",cls:"xRotateChange",min:-90,max:90,value:0},div:{id:"__xRotateText",cls:"xRotateText"}}},{caption:"motion.dC6",type:"div",dev:!1,cls:"tdContentLeft2",title:"motion.dT6",method:["input","___xAxisGBottomMarginChange",".xAxisGBottomMargin"],range:{input:{id:"xAxisGBottomMargin",type:"range",cls:"xAxisGBottomMargin",min:20,max:100,value:40},div:{id:"__xAxisGBottomMarginText",cls:"xAxisGBottomMarginText"}}},{caption:"motion.dC7",type:"div",dev:!1,cls:"tdContentLeft",title:"motion.dT7",method:["change","___xyGridLineChange",".xyGridLines"],labels:[{label:"motion.dLL71",input:{id:"xGrid",type:"checkbox",cls:"xyGridLines"}},{label:"motion.dLL72",input:{id:"yGrid",type:"checkbox",cls:"xyGridLines m4px"}}]},{caption:"motion.dC8",type:"button",dev:!1,id:"xyExchange",cls:"tdContent",label:"motion.dataLabel8",title:"motion.dT8",method:["click","___xyExchange"]},{caption:"std.dC11",type:"select",dev:!1,id:"c2iSelectedChart",cls:"tdContent",title:"std.dT11",options:[],dynamic:{caption:"gen.create",type:"button",id:"createNewChart",cls:"tdContent",method:["click","___createNewChart"]}},{caption:"std.dC14",type:"select",dev:!1,id:"tooltipMag",cls:"tdContent",method:["change","___tooltipMagChange"],options:[{value:"0",label:"std.dO14Label1"},{value:"1",label:"std.dO14Label2"},{value:"false",label:"gen.userDefine"},{value:"",separator:!0,length:10,idx:1},{value:"x",label:"std.dO14Label4"}]},{caption:"std.dC23",type:"div",dev:!1,cls:"tdContentLeft",title:"std.dT23",method:["click","___tipFixed","#tipFixed"],labels:[{label:"std.dLL231",title:"std.dT23",input:{id:"tipFixed",type:"checkbox"}}]},{caption:"std.dC15",type:"select",dev:!1,id:"changeTheme",cls:"tdContent",method:["change","___changeTheme"],options:[{value:"base",label:"std.dO15Label1"},{value:"#444363",label:"std.dO15Label2"},{value:"#333333",label:"std.dO15Label3"},{value:"",separator:!0,length:10,idx:1},{value:"none",label:"cm.themeRemove"}]},{caption:"std.dC17",type:"button",dev:!1,id:"exportImage",cls:"tdContent",label:"std.dataLabel17",method:["click","___exportImage"]},{caption:"std.dC16",type:"button",dev:!0,id:"makeJson",cls:"tdContent",title:"std.dT116",label:"std.dataLabel16",method:["click","___makeJson"]},{caption:"std.dC19",type:"button",dev:!0,id:"changeData",cls:"tdContent",label:"std.dataLabel19",method:["click","changeData"]}]},data:{sexes:["남성","여성"],edus:["모름","대학원 이상","대졸","고졸","고졸 미만"],marriged:["모름","기혼","미혼","이혼후 독신"],overdues:["연체무","리볼빙","1개월","2개월","3개월","4개월","5개월","6개월","7개월","8월이상"],isOverdue:["정상","연체"]}},c2i.stat=c2i.stat||{},c2i.stat.sumsqerr=function(t){const e=d3.mean(t);let a,o=0,n=t.length;for(;--n>=0;)o+=(a=t[n]-e)*a;return o},c2i.stat.variance=function(t,e){return c2i.stat.sumsqerr(t)/(t.length-(e?1:0))},c2i.stat.covariance=function(t,e){const a=d3.mean(t),o=d3.mean(e),n=t.length,r=new Array(n);for(let l=0;l<n;l++)r[l]=(t[l]-a)*(e[l]-o);return d3.sum(r)/(n-1)},c2i.stat.stdev=function(t,e){return Math.sqrt(c2i.stat.variance(t,e))},c2i.stat.corrcoeff=function(t,e){return c2i.stat.covariance(t,e)/c2i.stat.stdev(t,1)/c2i.stat.stdev(e,1)},c2i.stat.spearmancoeff=function(t,e){return t=d3.rank(t),e=d3.rank(e),c2i.stat.corrcoeff(t,e)},c2i.stat.stanMoment=function(t,e){const a=d3.mean(t),o=d3.stdev(t),n=t.length;let r=0;for(let l=0;l<n;l++)r+=Math.pow((t[l]-a)/o,e);return r/t.length},c2i.stat.skewness=function(t){return c2i.stat.stanMoment(t,3)},c2i.stat.CorpusKo="문재인,대통령",c2i.stat.StopWordsKo="가,가까스로,가령,가서,가지,각,각각,각자,각종,갖고말하자면,같,같다,같은,같이,개,개의치않고,거니와,거바,거의,것,것으로,것과,게다가,게우다,\n겨우,견지에서,결과에,결국,결론을,겸사겸사,경우,고려하면,고로,곧,공동으로,과,과연,관계가,관계없이,관련이,관하여,관한,관해서는,구,구체적으로,구토하다,\n그,그것,그녀,그들,그때,그래,그래도,그래서,그러,그러나,그러니,그러니까,그러면,그러므로,그러한즉,그런,그런데,그런즉,그럼,그럼에도,그렇,그렇게,그렇지,그렇지만,\n그렇지않으면,그리고,그리하여,그만이다,그에,그위에,그저,그중에서,그치지,근거로,근거하여,기대여,기점으로,기준으로,기타,김에,까닭에,까닭으로,까악,까지,까지도,\n꽈당,끙끙,끼익,나,나머지는,나오,남들,남짓,낫다,내,낼,너,너희,너희들,네,넷,년,년도,논하지,놀라다,놓,누가,누구,는,다른,다만,다섯,다소,다수,다시,다시말하면,\n다음,다음에,다음으로,단지,달려,답다,당신,당장,대로,대하,대하면,대하여,대해,대해서,댕그,더,더군다나,더라도,더불어,더욱더,더욱이는,데,도달하다,도착하다,동시에,\n동안,되,되는이만큼,되다,되어,된,된바에야,된이상,두,두번째로,둘,둥둥,뒤따라,뒤이어,든간에,들,들면,들자면,듯하다,등,등등,등이,등을,딩동,따라,따라서,따르,따르는,따름이다,따위,\n따지지,딱,때,때가,때문,때문에,또,또한,뚝뚝,라,령,로,로부터,로써,륙,를,마음대로,마저,마저도,마치,막론하고,만,만들,만약,만약에,만은,만이,만일,만큼,많,많은,말,\n말하,말하면,말하자면,말할것도,매,매번,메쓰겁다,명,몇,모,모두,모르,몰라도,몰랏다,못하,못하다,무렵,무릎쓰고,무슨,무엇,무엇때문에,문제,물론,미치다,및,바꾸어말하면,\n바꾸어말하자면,바꾸어서,바꿔,바로,바와같이,밖에,반대로,반드시,받,방면으로,버금,번,보,보는데서,보다더,보드득,보면,보아,보이,본대로,봐,봐라,부류의,부터,불구하고,\n불문하고,붕붕,비걱거리다,비교적,비길수,비로소,비록,비슷하다,비추어,비하면,뿐만,뿐만아니라,뿐이다,삐걱,삐걱거리다,사,사람,사람들,사실,사회,살,삼,상대적으로,생각,\n생각이다,생각하,생각한대로,서술한바와같이,설령,설마,설사,셋,소생,소인,속,솨,수,쉿,습니까,습니다,시각,시간,시작하여,시초에,시키,시키다,실로,심지어,싶,쓰여,씨,아,\n아니,아니나다를가,아니다,아니라,아니라면,아니면,아니었다면,아래윗,아무거나,아무도,아야,아울러,아이,아이고,아이구,아이야,아이쿠,아하,아홉,안,안다,안된다,않,않고,\n않기,않는다면,않다,않다면,않도록,않으면,알,알겠는가,알았어,앗,앞,앞에서,앞의것,야,약간,양자,어,어기여차,어느,어느것,어느곳,어느때,어느쪽,어느해,어디,어때,어떠한,\n어떤,어떤것,어떤것들,어떻,어떻게,어떻해,어이,어째서,어쨋든,어쩔수,어찌,어찌됏든,어찌됏어,어찌하든지,어찌하여,언제,언젠가,얼마,얼마간,얼마나,얼마든지,얼마만큼,얼마큼,\n없,없고,없다,엉엉,에,에게,에서,여,여기,여덟,여러분,여보시오,여부,여섯,여자,여전히,여차,연관되다,연이서,영,영차,옆사람,예,예를,예컨대,예하면,오,오로지,오르다,오자마자,\n오직,오호,오히려,와,와르르,와아,왜,왜냐하면,외에,외에도,요만큼,요만한걸,요만한얼마,요컨대,우르르,우리,우리들,우선,우에,운운,원,월,위에서,위하,위하여,위한,위해서,윙윙,육,으로,\n으로서,으로써,은,을,응,응당,의,의거하여,의지하여,의해,의해되다,의해서,이,이것,이곳,이때,이라면,이래,이러이러하다,이러한,이런,이럴정도로,이렇,이렇게,이렇게되면,이렇게말하자면,\n이렇구나,이로,이르기까지,이르다,이리하여,이번,이봐,이상,이어서,이었다,이와,이와같다면,이외에도,이용하여,이유는,이유만으로,이젠,이지만,이쪽,이천구,이천육,이천칠,이천팔,인,인젠,\n인하여,일,일것이다,일곱,일단,일때,일반적으로,일지라도,임에,입각하여,입장에서,잇따라,있,있다,자,자기,자기집,자마자,자신,잘,잠깐,잠시,저,저것,저것만큼,저기,저쪽,저희,적,전,전부,\n전자,전후,점,점을,점에서,정도,정도에,정도의,제,제각기,제외하고,조금,조차,조차도,졸졸,좀,종합한것과같이,좋,좋아,좍좍,주,주룩주룩,주저하지,줄,줄은,줄은모른다,중,중에서,중의하나,\n즈음하여,즉,즉시,지,지경이다,지금,지든지,지만,지말고,진짜로,집,쪽으로,차라리,참,참나,첫번째로,쳇,총적으로,칠,콸콸,쾅쾅,쿵,크,타다,타인것들,탕탕,토하다,통하,통하여,툭,퉤,\n틀림없다,틈타,팍,팔,퍽,펄렁,편이,하,하게될것이다,하게하다,하겠는가,하고,하고있었다,하곤하였다,하구나,하기,하기는한데,하기만,하기보다는,하기에,하나,하느니,하는,하는것도,하는것만,\n하는것이,하는바,하다,하더라도,하도다,하도록시키다,하도록하다,하든지,하들,하려고하다,하마터면,하면,하면된다,하면서,하물며,하여금,하여야,하자마자,하지,하지마,하지마라,하지만,\n하하,한,한다면,한데,한마디,한적이있다,한켠으로는,한하다,한항목,할,할때,할만하다,할망정,할뿐,할수록,할수있다,할수있어,할줄알다,할지라도,할지언정,함께,함으로써,해도,해도된다더구나,\n해도좋다,해봐요,해서는,해야한다,해요,했어요,향하다,향하여,향해서,허,허걱,허허,헉,헉헉,헐떡헐떡,형식으로,혹시,혹은,혼자,후,훨씬,휘익,휴,흐흐,흥,힘이,힘입어,\nㄱ,ㄴ,ㄷ,ㄹ,ㅁ,ㅂ,ㅅ,ㅇ,ㅈ,ㅊ,ㅋ,ㅌ,ㅍ,ㅎ,ㄲ,ㄸ,ㅃ,ㅆ,ㅉ,ㅏ,ㅑ,ㅓ,ㅕ,ㅗ,ㅛ,ㅜ,ㅠ,ㅡ,ㅣ,ㅐ,ㅒ,ㅔ,ㅖ,ㅘ,ㅙ,ㅚ,ㅝ,ㅞ,ㅟ,ㅢ",c2i.stat.CorpusEn="",c2i.stat.StopWordsEn="a,about,above,after,again,against,ain,all,am,an,and,any,are,aren,aren't,as,at,b,be,because,\nbeen,before,being,below,between,both,but,by,c,can,could,couldn,couldn't,d,did,didn,didn't,do,does,doesn,doesn't,\ndoing,don,don't,down,during,e,each,f,few,for,from,further,g,h,had,hadn,hadn't,has,hasn,hasn't,have,haven,haven't,\nhaving,he,her,here,hers,herself,him,himself,his,how,i,if,in,into,is,isn,isn't,it,it's,its,itself,j,just,k,l,ll,\nm,ma,me,mightn,mightn't,more,most,mustn,mustn't,my,myself,n,needn,needn't,no,nor,not,now,o,of,off,on,once,only,\nor,other,our,ours,ourselves,out,over,own,p,q,r,re,s,same,shan,shan't,she,she's,should,should've,shouldn,shouldn't,\nso,some,such,t,than,that,that'll,the,their,theirs,them,themselves,then,there,these,they,this,those,through,to,\ntoo,u,under,until,up,upon,v,ve,very,w,was,wasn,wasn't,we,were,weren,weren't,what,when,where,which,while,who,whom,\nwhy,will,with,within,without,won,won't,would,wouldn,wouldn't,x,y,you,you'd,you'll,you're,you've,your,yours,yourself,yourse",c2i.ui.animateNumber=function(t,e){"use strict";var a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;var o,n,r,l,i={},s={tagName:"h1",easing:"easeCubic",duration:750,data:void 0,className:void 0,fonts:["helvetica","36px","dimgray"],format:",.0f",caption:"",prefix:"",unit:"",opacity:1,hoverAnimate:!1,beginValue:0};e.method=e.method||{},a.init(s,e),s.themeInit=s.themeInit?s.themeInit:s.theme;var c=d3.select(t),d=d3.format(s.format),u=d3.drag().on("start",function(t){const e=t.sourceEvent;e.stopPropagation(),r=parseFloat(d3.select(this).style("left"))-e.pageX,l=parseFloat(d3.select(this).style("top"))-e.pageY}).on("drag",function(t){const e=t.sourceEvent;d3.select(this).style("left",function(){return e.pageX+r+"px"}).style("top",function(){return e.pageY+l+"px"})});return i.render=function(){if(s.data&&0!==s.data.length){c.style("background",s.theme&&"none"!==s.theme?s.theme:null);var e=c.call(u).selectAll(s.tagName).data(s.data),r=e.enter().append(s.tagName).on("click",function(e,a){s.method.click&&s.method.click(e,{container:t,selector:"label"},a)}).on("mouseenter",function(e,a){s.template&&s.template.baseOn?d3.select(this).selectAll("."+s.template.baseOn[0]).classed(s.template.baseOn[1],!0):s.hoverAnimate&&d3.select(this).transition().tween("text",p(o)).transition().tween("text",p(a)),s.method.mouseenter&&s.method.mouseenter(e,{container:t,selector:"label"},a)}).on("mouseleave",function(e,a){s.template&&s.template.baseOn&&d3.select(this).selectAll("."+s.template.baseOn[0]).classed(s.template.baseOn[1],!1),s.method.mouseleave&&s.method.mouseleave(e,{container:t,selector:"label"},a)});if(s.template){var l,m=s.template;if(m.html.indexOf("{caption}")>-1)n=m.html.replace("{caption}",s.caption),m.prefix.forEach(function(t,e){l=e+1,n=(n=(n=n.replace("{prefix"+l+"}",t)).replace("{value"+l+"}","{"+e+"}")).replace("{unit"+l+"}",m.unit[e])});else n=m.html.replace("{value1}","{0}")}else r.merge(e).attr("class",function(t,e){return"c2i_text "+(s.className?s.className:"c2i_"+e)}).style("font-family",s.fonts[0]).style("font-size",s.fonts[1]).style("color",s.fonts[2]);return r.merge(e).html(function(t){if(!s.template)return o=parseFloat(s.beginValue),"string"==typeof s.beginValue&&s.beginValue.indexOf("%")>-1&&(o=parseFloat(t*o/100)),o}).transition().duration(s.duration).ease(a.ease[s.easing]).tween("text",function(t){var e,o=d3.select(this);e=s.template?d3.interpolate(o.html(),t.value?t.value:t.value1):d3.interpolate(o.html(),t);var r=(t+"").split("."),l=r.length>1?Math.pow(10,r[1].length):1,i=d3.interpolate(0,s.opacity);return function(r){var c;if(s.template){var u=s.template.format,m=d3.format;switch(u.length){case 2:c=a.templateFormat(n,m(u[0])(t.value1),m(u[1])(t.value2));break;case 3:c=a.templateFormat(n,m(u[0])(t.value1),m(u[1])(t.value2),m(u[2])(t.value3));break;default:c=a.templateFormat(n,m(u[0])(t.value1))}}else o.html(d(Math.round(e(r)*l)/l)).style("opacity",i(r)),c=s.prefix+o.html()+s.unit,s.caption.length>0&&(c=s.caption+" "+c);o.html(c)}}),i}function p(t){if(!s.template)return function(){var e=d3.select(this),a=e.text();s.caption&&(a=a.replace(s.caption,"")),s.prefix&&(a=a.replace(s.prefix,"")),s.unit&&(a=a.replace(s.unit,"")),a=a.replaceAll(",","");var o=d3.interpolate(parseFloat(a),t),n=(a+"").split("."),r=n.length>1?Math.pow(10,n[1].length):1,l=d3.interpolate(0,s.opacity);return function(t){e.html(d(Math.round(o(t)*r)/r)).style("opacity",l(t));var a=s.prefix+e.html()+s.unit;s.caption.length>0&&(a=s.caption+" "+a),e.html(a)}}}a.alert("*.애니메이트 차트에 사용할 데이터 없습니다.")},i.theme=function(t){return arguments.length?(s.theme="base"===t?s.themeInit:t,c.style("background",t),i):s.theme},i.caption=function(t){return arguments.length?(s.caption=t,i):s.caption},i.prefix=function(t){return arguments.length?(s.prefix=t,i):s.prefix},i.unit=function(t){return arguments.length?(s.unit=t,i):s.unit},i.fonts=function(t){return arguments.length?(s.fonts=t,i):s.fonts},i.data=function(t){return arguments.length?(Array.isArray(t)?s.data=t:s.data=[t],i):s.data},i.clear=function(){return c.select(s.tagName).remove(),i},i.leave=function(){var t=s.template;t&&t.baseOn&&c.select(s.tagName).selectAll("."+t.baseOn[0]).classed(t.baseOn[1],!1)},a.createAccessor(i,s)},c2i.bi.corR=function(c2iCon,options){"use strict";const _u=c2i.util;if(!_u.checkLicenseLocale(options))return!1;if(!_u.checkConfig(c2iCon,options))return!1;let chart={},cfg={isResponsive:!1,width:"100%",margin:{top:30,left:30,right:30,bottom:30},aspectRatio:"4:3",easing:"linear",duration:350,delay:20,data:void 0,preBuildData:!1,title:void 0,matrix:void 0,row:void 0,col:void 0,measures:void 0,tooltip:void 0,legendId:void 0,isDev:void 0};options.method=options.method||{},_u.init(cfg,options),cfg.themeInit=cfg.themeInit?cfg.themeInit:cfg.theme;const _c2iCon=d3.select(c2iCon),_oID="#c2iOption";let _width=_u.computeDim(_c2iCon,cfg),_svg,_bodyG,_rawData,_meta,_cM,_lgIndex,_groupRowColNm,_groupColColNm,_chart,_chartMeasure,_changedSelection,_isSparse,_tip,_tipFirst,_option,_extent1st,_colors1st,_xDragPos,_yDragPos,_userSet=[],_gradeInfo=[],_orderBy="rowcol",_rowSortInfo="",_colSortInfo="";const _dragHandle=d3.drag().on("start",__dragStart).on("drag",__dragMove).on("end",__dragEnd);function __dragStart(t){const e=t.sourceEvent;"range"!==e.target.type&&(e.stopPropagation(),_xDragPos=parseFloat(d3.select(this).style("left"))-e.pageX,_yDragPos=parseFloat(d3.select(this).style("top"))-e.pageY,"c2iOption"!==this.id||d3.selectAll("#c2iColorPickerPop").empty()||d3.selectAll("#c2iColorPickerPop").remove())}function __dragMove(t){const e=t.sourceEvent;"range"!==e.target.type&&d3.select(this).style("opacity",.5).style("left",function(){return e.pageX+_xDragPos+"px"}).style("top",function(){return e.pageY+_yDragPos+"px"})}function __dragEnd(t){"range"!==t.sourceEvent.target.type&&d3.select(this).style("opacity","c2iOption"===this.id?cfg.optWin.opacity:cfg.tooltip.opacity)}const _dragHandleLg=d3.drag().on("start",__dragStartLg).on("drag",__dragMoveLg).on("end",__dragEndLg);function __dragStartLg(t){t.sourceEvent.stopPropagation();const e=_u.transform(d3.select(this).attr("transform"));_xDragPos=e.translate}function __dragMoveLg(t){const e=t.sourceEvent;_xDragPos[0]=e.offsetX,_xDragPos[1]=e.offsetY,d3.select(this).style("opacity",.5).attr("transform","translate("+_xDragPos+")")}function __dragEndLg(){d3.select(this).style("opacity",1)}function _makeOptionView(){function __selectTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.options&&Array.isArray(t.options)&&t.options.forEach(t=>{t.label&&(t.c2i18n=[t.label],t.label=___translate2(t.label,0))})}function __buttonTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.label&&(t.c2iNoBtn=[t.label],t.label=___translate2(t.label,0))}function __divTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.labels&&Array.isArray(t.labels)&&t.labels.forEach(t=>{t.label&&(t.c2i18n=[t.label],t.label=___translate2(t.label,0)),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0))})}_meta||(_meta=_u.deepClone(c2i.meta.corR),cfg.row.group||(_meta.data=_meta.data.filter(t=>"___rowGroup"!==t.id&&"___orderBy"!==t.id)),cfg.col.group||(_meta.data=_meta.data.filter(t=>"___colGroup"!==t.id&&"___orderBy"!==t.id)),_meta.title=___translate2(_meta.title,0),_meta.data.forEach(t=>{switch(t.type){case"select":__selectTrans(t);break;case"button":__buttonTrans(t);break;default:__divTrans(t)}})),d3.select(_oID).remove(),d3.select("body").append("div").attr("id",_oID.substr(1)).attr("class","c2iOption");const table=d3.select(_oID).call(_dragHandle).append("table").style("width",cfg.optWin.width?cfg.optWin.width:"300px"),theadTr=table.append("thead").style("cursor","move").append("tr").append("th").attr("colspan",3).attr("class","tipHeader"),tbody=table.append("tbody");let bodyTrs,trTds,td,options,method,func,tmp;theadTr.append("div").attr("class","c2iCloseBtn").attr("data-c2i18n","gen.closeX,gen.close").attr("title",function(){return ___translate(this,1)}).text(function(){return ___translate(this,0)}).on("click",()=>d3.select(_oID).classed("c2iHidden",!0)),theadTr.append("div").append("p").append("strong").append("span").attr("id","optionName").attr("data-c2i18n","corR.title").html(_meta.title);let nodes=[],realNodes=[],data;function ___translate2(t,e){if(t.indexOf(",")>-1)t=t.split(",");else{if(e>0)return null;t=[t]}return t[e].indexOf(".")>-1?(t=t[e].split("."),c2i.lang[t[0]][t[1]]):c2i.lang.corR[t[e]]}function ___translate(t,e){const a=d3.select(t).attr("data-c2i18n");return a?___translate2(a,e):null}function ___bodyTrs_trTds(t){bodyTrs=tbody.selectAll("tr."+t.node+t.seq).data(data.filter(e=>e.type===t.node&&e.seq===t.seq)),(trTds=bodyTrs.enter().append("tr").attr("class",e=>e.dev?t.node+t.seq+" isDev":t.node+t.seq)).append("td").attr("class","caption").attr("data-c2i18n",t=>t.c2i18n).attr("title",function(){return ___translate(this,1)}).text(function(){return ___translate(this,0)})}function __renderSelect(d0){___bodyTrs_trTds(d0);const select=trTds.append("td").append(d0.node).attr("id",t=>t.id).attr("class",t=>t.cls);switch(d0.method&&2===d0.method.length&&(method=d0.method[0],func=eval(d0.method[1]),select.on(method,func)),d0.id){case"measureColNm":case"chartMeasureColNm":d0.options=cfg.measures.map(t=>({value:t.colNm,label:t.caption}));break;case"___rowGroup":d0.options=cfg.row.groups.map(t=>({value:t.colNm,label:t.caption}));break;case"___colGroup":d0.options=cfg.col.groups.map(t=>({value:t.colNm,label:t.caption}));break;case"c2iSelectedChart":d0.options=____dynamicChart()}function ____dynamicChart(){let t,e;return nodes=[],d3.selectAll(".c2iPlace").filter(function(){return this.id!==c2iCon.substr(1)}).attr("data-c2iTitle",function(a,o){if(this.id||(this.id=_oID.substr(1)+"_"+o),e=this.attributes["data-c2iTitle"],t=e?e.value:this.title.length>0?this.title:c2i.lang.gen.isTitle+" "+this.id,tmp={value:"#"+this.id,label:t},nodes.push(tmp),e)return e.value}),nodes}if(options=select.selectAll("option").data(d0.options),options.enter().append("option").property("disabled",t=>t.separator?"disabled":null).attr("data-c2i18n",t=>t.c2i18n).attr("data-group",t=>t.group).attr("value",t=>t.value).property("selected",t=>{switch(d0.id){case"measureColNm":return t.value===_cM.colNm?"selected":null;case"chartMeasureColNm":return t.value===_chartMeasure?"selected":null;case"___rowGroup":return e(_groupRowColNm);case"___colGroup":return e(_groupColColNm);case"___orderBy":return t.value===_orderBy?"selected":null;case"tooltipMag":return _u.tooltipMag(cfg,t);case"changeTheme":return cfg.theme===t.value?"selected":null}function e(e){return t.value===e?"selected":null}}).html(function(t){if(!t.separator)return t.c2i18n&&d3.select(this).attr("data-c2i18n",t.c2i18n),t.label;let e="";for(let a=0;a<t.length;a++)e+=c2i.meta.separator[t.idx];return e}),"object"==typeof d0.dynamic&&d0.options.length>0){const btn=trTds.append("td").append(d0.dynamic.type).attr("id",d0.dynamic.id).attr("class",d0.dynamic.cls).text(d0.dynamic.caption);method=d0.dynamic.method[0],func=eval(d0.dynamic.method[1]),btn.on(method,func)}}function __renderButton(d0){___bodyTrs_trTds(d0);const btn=trTds.append("td").append(d0.node).attr("id",t=>t.id).attr("class",t=>t.cls).attr("data-c2i18n",t=>t.c2iNoBtn).property("disabled",t=>{if("expandCollapse"===t.id)return!(!cfg.node.singleAncestor&&!cfg.node.singleFamily)||null}).text(function(){return ___translate(this,0)});method=d0.method[0],func=eval(d0.method[1]),btn.on(method,func)}function __renderDiv(d0){___bodyTrs_trTds(d0);const div=trTds.append("td").append(d0.node).attr("class",function(t){return t.cls});function _labels(){d0.labels.forEach(t=>{div.append("input").attr("id",t.input.id).attr("class",t.input.cls?t.input.cls:null).attr("type",t.input.type).attr("name",t.input.name).attr("value",t.input.value).property("disabled",()=>{switch(t.input.id){case"tipFixed":return!cfg.tooltip;case"sparseApply":return!cfg.chart}}).property("checked",()=>{switch(t.input.name){case"cellValue":return t.input.value===cfg.matrix.label.compColor?"checked":null;case"lgValue":return t.input.value===cfg.matrix.legend.label.content?"checked":null}switch(t.input.id){case"tipFixed":return cfg.tooltip&&cfg.tooltip.fixedPos?"checked":null;case"sparseApply":return cfg.chart&&cfg.chart.sparseApply?"checked":null}}),div.append("label").attr("for",t.input.id).attr("class",t.cls?t.cls:null).attr("data-c2i18n",t.c2i18n).attr("title",t.title).text(t.label)})}d0.labels&&_labels(),d0.method&&(method=d0.method[0],func=eval(d0.method[1]),d3.selectAll(d0.method[2]).on(method,func))}function ___cellValueChange(){cfg.matrix.label.compColor=+this.value,_drawValue()}function ___lgValueChange(){cfg.matrix.legend.label.content=this.value,__drawGradeInfo()}function ___rowGroupChange(t){_groupRowColNm=this.value,chart.groupBy(_groupRowColNm,!1)}function ___colGroupChange(t){_groupColColNm=this.value,chart.groupBy(_groupColColNm,!0)}function ___changeOrderBy(){chart.orderBy(this.value)}function __rowColExchange(){chart.rowColExchange()}function ___createNewChart(t){const e=d3.select("#c2iSelectedChart").property("value"),a=cfg.data;cfg.data=void 0;const o=_u.deepClone(cfg);cfg.data=a,t.options.some(t=>{if(t.value===e)return o.legendId=t.legendId,!0}),o.legendId?(d3.select(e).select("svg").remove(),d3.select(o.legendId).select("svg").remove(),c2i.bi.corR(e,o).data(_rawData).render()):alert(c2i.lang.cm.lg_0)}function ___tooltipMagChange(){const t=cfg.tooltip;void 0!==t?("0"===this.value||"1"===this.value?(t.isShow=!0,t.infoLevel=+this.value,t.isUserTip=!1):"false"===this.value?(t.isShow=!0,t.isUserTip=!0):(t.isShow=!1,_tip.classed("c2iHidden",!0)),chart.tooltip(t)):alert(c2i.lang.cm.tipNo)}function ___tipFixed(){chart.tipFixed(this.checked)}function ___sparseApply(){chart.sparse(this.checked)}function ___changeTheme(){chart.theme(this.value)}function ___exportImage(){_u.exportImage(c2iCon)}function ___makeJson(){_u.makeJson(cfg)}cfg.isDev&&!0===cfg.isDev?(data=_meta.data,_u.makeJson(data)):data=_meta.data.filter(t=>void 0===t.dev||!0!==t.dev),data.forEach((t,e)=>{if(t.seq=e,-1===nodes.indexOf(t.type+"_"+e)){nodes.push(t.type+"_"+e);const a=t;a.node=t.type,a.seq=e,realNodes.push(a)}}),realNodes.forEach(t=>{switch(t.node){case"select":__renderSelect(t);break;case"button":__renderButton(t);break;default:__renderDiv(t)}t.dynamic||(t.range&&t.range.div?trTds.append("td").append("div").attr("id",t.range.div.id).attr("class",t.range.div.class).style("text-align","center").text(()=>{switch(t.range.div.id){case"__nLevelGapText":return cfg.node.levelGap+"px";case"__nNeighborGapText":return d3.format(".2f")(cfg.node.neighborGap);case"__nodeRadiusText":return cfg.node.size.radius+"px"}}):trTds.append("td"))})}function renderBody(){_bodyG||(_bodyG=_svg.append("g").attr("class","body").attr("transform","translate("+_xStart()+","+_yEnd()+")")),makeDraw()}function makeDraw(){const t=cfg.matrix.node,e=cfg.margin;cfg.isResponsive&&(t.width=parseInt((_width-e.left-e.right)/cfg.data.col.length),t.height=parseInt((cfg.height-e.top-e.bottom)/cfg.data.row.length)),function(){_bodyG.select("g.gRow").empty()&&_bodyG.append("g").attr("class","gRow");const e=cfg.row,a=(t.height+parseFloat(e.fonts[1]))/2;let o=_bodyG.select("g.gRow").selectAll(".rowLabel").data(cfg.data.row,t=>t[e.idColNm]);o.exit().transition().duration(cfg.duration).remove();const n=o.enter().append("text").attr("class",(t,e)=>"rowLabel r"+e).on("mouseover",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".rowLabel"),e);d3.select(e).classed("text-hover",!0),_bodyG.selectAll(".r"+a).classed("text-hover",!0),_bodyG.selectAll(".cr"+a).classed("cell-pos",!0),_chart&&(_chart.selectAll(".r"+a).classed("text-hover",!0),_chart.selectAll(".rr"+a).classed("rect-hover",!0))}).on("mouseout",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".rowLabel"),e);d3.select(e).classed("text-hover",!1),_bodyG.selectAll(".r"+a).classed("text-hover",!1),_bodyG.selectAll(".cr"+a).classed("cell-pos",!1),_chart&&(_chart.selectAll(".r"+a).classed("text-hover",!1),_chart.selectAll(".rr"+a).classed("rect-hover",!1))}).on("dblclick",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".rowLabel"),e);sortbyLabel(t,"r",a,e)}).style("cursor","pointer").style("font-family",e.fonts[0]).style("font-size",e.fonts[1]).style("fill",e.fonts[2]).style("text-anchor","end").text(t=>t[e.nameColNm]).attr("x",-20).attr("y",(e,o)=>o*t.height+a);o=n.merge(o),n.append("title").text(t=>{const a=d3.format(_cM.format);return t[e.nameColNm]+" :"+a(t.__summary.tot)});let r=0;e.group&&Array.isArray(e.groups)&&(r=e.group.size+4);o.transition().duration(cfg.duration).attr("x",t=>e.dx-r),r&&(function(){_bodyG.select("g.gRowGroup").empty()&&_bodyG.append("g").attr("class","gRowGroup");const e=cfg.row,a=_bodyG.select("g.gRowGroup").selectAll(".rowGroup").data(cfg.data.row,t=>t[e.idColNm]),o=_u.getColorScheme(e.group.color),n=d3.scaleOrdinal().domain(cfg.data.row.map(t=>t[_groupRowColNm])).range(o),r=a.enter().append("rect").attr("class",(t,e)=>"rowGroup r"+e).attr("y",(e,a)=>a*t.height+1).style("cursor","pointer").attr("x",t=>e.dx-cfg.data.__rowScale(t.__summary.tot)).attr("width",t=>e.group.size-(e.group.size-cfg.data.__rowScale(t.__summary.tot))).style("fill",t=>n(t[_groupRowColNm])).attr("height",t.height-2).on("mouseover",function(t,e){const a=t.currentTarget,o=__getIndex(_bodyG.selectAll(".rowGroup"),a);d3.select(a).classed("cell-pos",!0),_bodyG.selectAll(".r"+o).classed("text-hover",!0),_bodyG.selectAll(".cr"+o).classed("cell-pos",!0),_chart&&(_chart.selectAll(".r"+o).classed("text-hover",!0),_chart.selectAll(".rr"+o).classed("rect-hover",!0))}).on("mouseout",function(t,e){const a=t.currentTarget,o=__getIndex(_bodyG.selectAll(".rowGroup"),a);d3.select(a).classed("cell-pos",!1),_bodyG.selectAll(".r"+o).classed("text-hover",!1),_bodyG.selectAll(".cr"+o).classed("cell-pos",!1),_chart&&(_chart.selectAll(".r"+o).classed("text-hover",!1),_chart.selectAll(".rr"+o).classed("rect-hover",!1))}).on("dblclick",function(t,e){const a=t.currentTarget,o=__getIndex(_bodyG.selectAll(".rowGroup"),a);sortbyLabel(t,"r",o,a)});r.merge(a).attr("width",0).transition().duration(cfg.duration).attr("x",t=>e.dx-cfg.data.__rowScale(t.__summary.tot)).attr("width",t=>e.group.size-(e.group.size-cfg.data.__rowScale(t.__summary.tot))),r.append("title").text(t=>{const e=d3.format(_cM.format);return`${t[_groupRowColNm]}(${t[cfg.row.nameColNm]}) :${e(t.__summary.tot)} (평균:${e(t.__summary.avg)}))`}),a.exit().transition().duration(cfg.duration).remove()}(),function(){_bodyG.select("g.gRowGroupAvg").empty()&&_bodyG.append("g").attr("class","gRowGroupAvg");const e=cfg.row,a=_bodyG.select("g.gRowGroupAvg").selectAll(".rowGroupAvg").data(cfg.data.row,t=>t[cfg.row.idColNm]),o=e.group.colorAvg?e.group.colorAvg:"dimgray",n=a.enter().append("rect").attr("class",(t,e)=>"rowGroupAvg r"+e).on("mouseover",function(t,e){const a=t.currentTarget,o=__getIndex(_bodyG.selectAll(".rowGroupAvg"),a);d3.select(a).classed("cell-pos",!0),_bodyG.selectAll(".r"+o).classed("text-hover",!0),_bodyG.selectAll(".cr"+o).classed("cell-pos",!0),_chart&&(_chart.selectAll(".r"+o).classed("text-hover",!0),_chart.selectAll(".rr"+o).classed("rect-hover",!0))}).on("mouseout",function(t,e){const a=t.currentTarget,o=__getIndex(_bodyG.selectAll(".rowGroupAvg"),a);d3.select(a).classed("cell-pos",!1),_bodyG.selectAll(".r"+o).classed("text-hover",!1),_bodyG.selectAll(".cr"+o).classed("cell-pos",!1),_chart&&(_chart.selectAll(".r"+o).classed("text-hover",!1),_chart.selectAll(".rr"+o).classed("rect-hover",!1))}).on("dblclick",function(t,e){const a=t.currentTarget,o=__getIndex(_bodyG.selectAll(".rowGroupAvg"),a);sortbyLabel(t,"r",o,a,!0)}).style("cursor","pointer").style("fill",o).attr("x",t=>e.dx-cfg.data.__rowAvgScale(t.__summary.avg)).attr("y",(e,a)=>a*t.height+t.height/2-2).attr("width",t=>e.group.size-(e.group.size-cfg.data.__rowAvgScale(t.__summary.avg))).attr("height",4);n.merge(a).attr("width",0).transition().duration(cfg.duration).attr("x",t=>e.dx-cfg.data.__rowAvgScale(t.__summary.avg)).attr("width",t=>e.group.size-(e.group.size-cfg.data.__rowAvgScale(t.__summary.avg))),n.append("title").text(t=>{const e=d3.format(_cM.format);return`${t[_groupRowColNm]} (${t[cfg.row.nameColNm]}) :${e(t.__summary.avg)} (소계: ${e(t.__summary.tot)})`}),a.exit().transition().duration(cfg.duration).remove()}())}(),function(){_bodyG.select("g.gCol").empty()&&_bodyG.append("g").attr("class","gCol");const e=cfg.col,a=t.width/2;let o=_bodyG.select("g.gCol").selectAll(".colLabel").data(cfg.data.col,t=>t[cfg.col.idColNm]);o.exit().transition().duration(cfg.duration).remove();const n=o.enter().append("text").text(t=>{const a=t[e.nameColNm];return a&&a.length>e.cutLength?a.substr(0,e.cutLength):a}).attr("class",(t,e)=>"colLabel c"+e).on("mouseover",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colLabel"),e);d3.select(e).classed("text-hover",!0),_bodyG.selectAll(".cc"+a).classed("cell-pos",!0)}).on("mouseout",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colLabel"),e);d3.select(e).classed("text-hover",!1),_bodyG.selectAll(".cc"+a).classed("cell-pos",!1)}).on("dblclick",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colLabel"),e);sortbyLabel(t,"c",a,e)}).style("cursor","pointer").style("font-family",e.fonts[0]).style("font-size",e.fonts[1]).style("fill",e.fonts[2]).style("text-anchor",e.xLabel.isVertical?"end":0!==e.xLabel.rotate?"start":"middle").style("writing-mode",e.xLabel.isVertical?"tb":null);o=n.merge(o),n.append("title").text(t=>{const e=d3.format(_cM.format);return t[cfg.col.nameColNm]+" :"+e(t.__summary.tot)});let r=0;e.group&&Array.isArray(e.groups)&&(r=e.group.size+2);o.transition().duration(cfg.duration).attr("transform",(o,n)=>`translate(${n*t.width+a}, ${e.dy-r}) rotate(${e.xLabel.rotate})`),r&&(function(){_bodyG.select("g.gColGroup").empty()&&_bodyG.append("g").attr("class","gColGroup");const e=cfg.col;let a=_bodyG.select("g.gColGroup").selectAll(".colGroup").data(cfg.data.col,t=>t[e.idColNm]);a.exit().transition().duration(cfg.duration).remove();const o=_u.getColorScheme(e.group.color),n=d3.scaleOrdinal().domain(cfg.data.col.map(t=>t[_groupRowColNm])).range(o),r=a.enter().append("rect").attr("class",(t,e)=>"colGroup c"+e).attr("x",(e,a)=>a*t.width+1).style("cursor","pointer").attr("y",t=>e.dy-cfg.data.__colScale(t.__summary.tot)).attr("width",t.width-2).style("fill",t=>n(t[_groupColColNm])).on("mouseover",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colGroup"),e);d3.select(e).classed("cell-pos",!0),_bodyG.selectAll(".c"+a).classed("text-hover",!0),_bodyG.selectAll(".cc"+a).classed("cell-pos",!0)}).on("mouseout",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colGroup"),e);d3.select(e).classed("cell-pos",!1),_bodyG.selectAll(".c"+a).classed("text-hover",!1),_bodyG.selectAll(".cc"+a).classed("cell-pos",!1)}).on("dblclick",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colGroup"),e);sortbyLabel(t,"c",a,e)});a=r.merge(a),r.append("title").text(t=>{const e=d3.format(_cM.format);return`${t[_groupColColNm]} (${t[cfg.col.nameColNm]}): ${e(t.__summary.tot)} (평균:${e(t.__summary.avg)}))`}),a.attr("height",0).transition().duration(cfg.duration).attr("y",t=>e.dy-cfg.data.__colScale(t.__summary.tot)).attr("height",t=>e.group.size-(e.group.size-cfg.data.__colScale(t.__summary.tot)))}(),function(){_bodyG.select("g.gColGroupAvg").empty()&&_bodyG.append("g").attr("class","gColGroupAvg");const e=cfg.col;let a=_bodyG.select("g.gColGroupAvg").selectAll(".colGroupAvg").data(cfg.data.col,t=>t[cfg.col.idColNm]);a.exit().transition().duration(cfg.duration).remove();const o=e.group.colorAvg?e.group.colorAvg:"dimgray",n=a.enter().append("rect").attr("class",(t,e)=>"colGroupAvg c"+e).on("mouseover",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colGroupAvg"),e);d3.select(e).classed("cell-pos",!0),_bodyG.selectAll(".c"+a).classed("text-hover",!0),_bodyG.selectAll(".cc"+a).classed("cell-pos",!0)}).on("mouseout",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colGroupAvg"),e);d3.select(e).classed("cell-pos",!1),_bodyG.selectAll(".c"+a).classed("text-hover",!1),_bodyG.selectAll(".cc"+a).classed("cell-pos",!1)}).on("dblclick",t=>{const e=t.currentTarget,a=__getIndex(_bodyG.selectAll(".colGroupAvg"),e);sortbyLabel(t,"c",a,e,!0)}).style("cursor","pointer").style("fill",o).attr("x",(e,a)=>a*t.width+t.width/2-3).attr("y",t=>e.dy-cfg.data.__colAvgScale(t.__summary.avg)).attr("width",6);a=n.merge(a),n.append("title").text(t=>{const e=d3.format(_cM.format);return`${t[_groupColColNm]}(${t[cfg.col.nameColNm]}): ${e(t.__summary.avg)} (소계:${e(t.__summary.tot)})`}),a.attr("height",0).transition().duration(cfg.duration).attr("y",t=>e.dy-cfg.data.__colAvgScale(t.__summary.avg)).attr("height",t=>e.group.size-(e.group.size-cfg.data.__colAvgScale(t.__summary.avg)))}())}(),function(){_bodyG.select("g.gCell").empty()&&_bodyG.append("g").attr("class","gCell");const a=cfg.matrix.sparseInfo,n=_bodyG.select("g.gCell").selectAll(".cell").data(cfg.data.matrix,t=>t.id);n.exit().transition().duration(cfg.duration).remove();const r=cfg.matrix.node.stroke?cfg.matrix.node.stroke:"white";_gradeInit(),n.enter().append("rect").attr("x",e=>e.x*t.width).attr("y",e=>e.y*t.height).attr("class",t=>"cell cellB cr"+t.y+" cc"+t.x).style("stroke",r).on("click",(t,e)=>{if(cfg.method.click){const a=o(e);cfg.method.click(t,{container:c2iCon,selector:"corR",measure:_cM.colNm},a)}}).on("mouseenter",function(t,a){if(a.isSparse)return;d3.select(this).classed("cell-hover",!0),_bodyG.selectAll(".rowLabel").classed("text-highlight",(t,e)=>e===a.y),_bodyG.selectAll(".colLabel").classed("text-highlight",(t,e)=>e===a.x),_bodyG.selectAll([".cr"+a.y,".cc"+a.x]).classed("cell-pos",!0),_bodyG.selectAll(".rr"+a.y).classed("rect-hover",!0),_bodyG.selectAll([".rowGroup.r"+a.y,".colGroup.c"+a.x]).classed("cell-pos",!0),_chart&&(_chart.selectAll(".r"+a.y).classed("text-hover",!0),_chart.selectAll(".rr"+a.y).classed("rect-hover",!0));let n=d3.select(this).style("fill");if(n=d3.rgb(n).formatHex().toUpperCase(),_svg.selectAll("rect.lgRect").each(function(t){d3.select(this).style("fill-opacity",n===t.color.toUpperCase()?1:.3)}),_tip&&cfg.tooltip.isShow){const t='<thead> <tr> <th colspan="4" class="tipHeader"> <div class="c2iCloseBtn" title="닫기">&#10062;</div> <p> <strong><span id="name">판매본부</span></strong> </p> <p id="measure" style="font-size: 14px; color: yellow">1,200</p> </th> </tr> </thead>';_tip.select("table").style("width","500px").html(t),_tip.classed("c2iHidden",!1).style("opacity",cfg.tooltip.opacity),cfg.tooltip.isUserTip?_tip.select("tbody").classed("c2iHidden",!0):function(){const t=cfg.data.row[a.y],o=cfg.data.col[a.x];let n=cfg.row.idColNm===cfg.row.nameColNm?t[cfg.row.idColNm]:t[cfg.row.idColNm]+"."+t[cfg.row.nameColNm];n+=" - ",n+=cfg.col.idColNm===cfg.col.nameColNm?o[cfg.col.idColNm]:o[cfg.col.idColNm]+"."+o[cfg.col.nameColNm],_tip.select("#name").text(n),n=_cM.caption+": "+d3.format(_cM.format)(a[_cM.colNm]/_cM.unit),n+=_cM.unitNm?" ("+_cM.unitNm+")":"",_tip.select("#measure").html(n),cfg.tooltip.infoLevel>0?function(t){const a=c2i.lang.gen,o=d3.format(".1%"),n=d3.format(",d"),r=d3.format(_cM.format),l=_cM.unit,i=cfg.data.__summary,s=t[_cM.colNm],c=[],d=[a.byRow,a.byCol,a.byAll],u=[cfg.data.row[t.y].__summary,cfg.data.col[t.x].__summary,i];d.forEach(function(t,e){const a=function(t,e){const a={};return a.vsAllTot=0===i.tot?0:e.tot/i.tot,a.vsAllCnt=0===i.cnt?0:e.cnt/i.cnt,a.vsCurrentTot=0===e.tot?0:s/e.tot,a.vsCurrentAvgDiff=s-e.avg,[t,r(e.tot/l),o(a.vsAllTot),o(a.vsCurrentTot),n(e.cnt),r(e.avg),r(a.vsCurrentAvgDiff)]}(t,u[e]);c.push(a)}),_tip.select("tbody").classed("c2iHidden",!1);const m=[{name:"tipContent",cls:"tipName"},{name:"total",cls:"tipAll"},{name:"tipVsAllNode",cls:"tipAll"},{name:"tipVsCurrNode",cls:"tipAll"},{name:"tipNodes",cls:"tipAll"},{name:"avg",cls:"tipAll"},{name:"avgDiff",cls:"tipAll"}],p=["tipHeader","number","number","number","number","number","number"];let g,f,h=_tip.select("table").select("tbody");if(_tip.select("table").select("thead").select("th.tipHeader").attr("colspan",e.img?7:8),h.empty()){const t=(h=_tip.select("table").append("tbody")).append("tr").selectAll("th").data(m);t.enter().append("th").attr("class",t=>t.cls).attr("data-c2i18n",t=>"gen."+t.name).text(t=>a[t.name]),g=(g=h.selectAll(".level1").data(c)).enter().append("tr").attr("class","level1").merge(g),(f=g.selectAll("td").data(t=>t)).enter().append("td").attr("class",(t,e)=>p[e]).classed("negative",(t,e)=>6===e&&parseFloat(t)<0).text(t=>t)}else g=h.selectAll(".level1").data(c),(f=g.selectAll("td").data(t=>t)).text(t=>t);cfg.tooltip.infoLevel;cfg.tooltip.infoLevel}(a):_tip.select("tbody").classed("c2iHidden",!0)}();const o=cfg.tooltip.fixedPos;o&&void 0===_tipFirst&&function(){const t=cfg.tooltip.fixedPos,e=parseInt(_tip.select("table").style("width")),a=parseInt(_tip.select("table").style("height"));let o,n;o="middle"===t.xPos?(_xEnd()-e)/2:"start"===t.xPos?_xStart():_xEnd()-e,n="middle"===t.yPos?(_yStart()-a)/2:"top"===t.yPos?_yEnd():_yStart()-a,_tip.select(".c2iCloseBtn").classed("c2iHidden",!1).on("click",function(){_tip.classed("c2iHidden",!0)}),o<5&&(o=5);n<5&&(n=5);_tip.style("left",o+"px").style("top",n+"px"),_tipFirst=!1}()}if(cfg.method.mouseenter){const e=o(a);cfg.method.mouseenter(t,{container:c2iCon,selector:"corR"},e)}}).on("mousemove",(t,e)=>{if(!_tip||!cfg.tooltip.isShow||e.isSparse)return;if(cfg.tooltip.isUserTip&&cfg.method.mousemove){const t=o(e);cfg.method.mousemove({container:c2iCon,selector:"corR"},t)}let a=cfg.tooltip.fixedPos;if(a)return;const n=parseInt(_tip.select("table").style("width")),r=parseInt(_tip.select("table").style("height"));let l,i;a?(l="middle"===a.xPos?(_xEnd()-n)/2:"start"===a.xPos?_xStart():_xEnd()-n,i="middle"===a.yPos?(_yStart()-r)/2:"top"===a.yPos?_yEnd():_yStart()-r):(l=t.pageX+5,i=t.pageY+5,l>_width-n&&(l-=n+5),i>cfg.height-r&&(i-=1.2*r)),l<0&&(l=0),i<0&&(i=0),_tip.style("left",l+"px").style("top",i+"px")}).on("mouseleave",function(t,e){if(!e.isSparse&&(d3.select(this).classed("cell-hover",!1),_bodyG.selectAll(".rowLabel").classed("text-highlight",!1),_bodyG.selectAll(".colLabel").classed("text-highlight",!1),_bodyG.selectAll(".cr"+e.y).classed("cell-pos",!1),_bodyG.selectAll(".cc"+e.x).classed("cell-pos",!1),_bodyG.selectAll(".rr"+e.y).classed("rect-hover",!1),_bodyG.selectAll(".rowGroup.r"+e.y).classed("cell-pos",!1),_bodyG.selectAll(".colGroup.c"+e.x).classed("cell-pos",!1),_chart&&(_chart.selectAll(".r"+e.y).classed("text-hover",!1),_chart.selectAll(".rr"+e.y).classed("rect-hover",!1)),_tip&&cfg.tooltip.isShow&&!cfg.tooltip.fixedPos&&_tip.classed("c2iHidden",!0),cfg.method.mouseleave)){const a=o(e);cfg.method.mouseleave(t,{container:c2iCon,selector:"corR"},a)}}).merge(n).style("fill",function(t){const e=_colors1st?_colors1st(t[_cM.colNm]):_cM.fonts[2];return t.isSparse?(d3.select(this).style("stroke",a.stroke),a.fill):(_colors1st&&_gradeCompute(t,e),e)}).attr("height",t.height).attr("width",t.width/5).transition().duration(cfg.duration).attr("width",t.width).style("opacity",t=>t.isSparse?a.opacity:1)}(),_drawValue(),__drawGradeInfo();const a=_bodyG.select(".gCell").on("mousedown",function(t){if(_changedSelection=!1,t.shiftKey||(_bodyG.selectAll(".cell-selected").classed("cell-selected",!1).style("stroke","#bbb").style("stroke-dasharray",null).style("stroke-width","1px"),_bodyG.selectAll(".rowLabel").classed("text-selected",!1),_bodyG.selectAll(".colLabel").classed("text-selected",!1)),!t.altKey)return;const e=d3.pointer(t);a.append("rect").attr("class","selection").attr("rx",0).attr("ry",0).attr("x",e[0]).attr("y",e[1]).attr("width",1).attr("height",1)}).on("mousemove",function(e){const o=a.select("rect.selection");if(o.empty())return;const n=d3.pointer(e),r={x:parseInt(o.attr("x"),10),y:parseInt(o.attr("y"),10),width:parseInt(o.attr("width"),10),height:parseInt(o.attr("height"),10)},l={x:n[0]-r.x,y:n[1]-r.y};l.x<0||2*l.x<r.width?(r.x=n[0],r.width-=l.x):r.width=l.x,l.y<1||2*l.y<r.height?(r.y=n[1],r.height-=l.y):r.height=l.y,o.attr("x",r.x).attr("y",r.y).attr("width",r.width).attr("height",r.height),_changedSelection=!0,_bodyG.selectAll(".cell-selection.cell-selected").classed("cell-selected",!1).style("stroke","#bbb").style("stroke-dasharray",null).style("stroke-width","1px"),_bodyG.selectAll(".text-selection.text-selected").classed("text-selected",!1),_bodyG.selectAll(".cell").filter(function(e){let a=this.x.baseVal.value,o=this.y.baseVal.value;!d3.select(this).classed("cell-selected")&&a+t.width>=r.x&&a<=r.x+r.width&&o+t.height>=r.y&&o<=r.y+r.height&&(d3.select(this).classed("cell-selection",!0).classed("cell-selected",!0).style("stroke","#333").style("stroke-dasharray","2px").style("stroke-width","2px"),_bodyG.select(".r"+e.y).classed("text-selection",!0).classed("text-selected",!0),_bodyG.select(".c"+e.x).classed("text-selection",!0).classed("text-selected",!0))})}).on("mouseup",()=>{_bodyG.selectAll(".cell-selected")._groups[0].length>0&&_userSet.length>0&&(_userSet=[]),_bodyG.selectAll(".cell-selected").filter(getChartData),_userSet.length>0&&_changedSelection&&(_chartMeasure||(_chartMeasure=_cM.colNm),_lgIndex=-1,drawChart(_chartMeasure)),a.selectAll("rect.selection").remove(),_bodyG.selectAll(".cell-selection").classed("cell-selection",!1),_bodyG.selectAll(".text-selection").classed("text-selection",!1)}).on("mouseout",t=>{null!==t.relatedTarget&&"html"===t.relatedTarget.tagName&&(a.selectAll("rect.selection").remove(),_bodyG.selectAll(".cell-selection").classed("cell-selection",!1),_bodyG.selectAll(".rowLabel").classed("text-selected",!1),_bodyG.selectAll(".colLabel").classed("text-selected",!1))});function o(t){const e={},a=cfg.row.nameColNm,o=cfg.col.nameColNm,n=cfg.row.colNm,r=cfg.col.colNm;let l=t.id.substr(0,t.id.indexOf("-"));l=cfg.data.row.findIndex(t=>t[n]==l);let i=t.id.substr(t.id.indexOf("-")+1);i=cfg.data.col.findIndex(t=>t[r]==i);let s="없음",c=0;return l>-1&&i>-1&&(s="("+cfg.data.row[l][a]+","+cfg.data.col[i][o]+")",c=t[_cM.colNm]),_cM&&(e.first={code:t.id,name:s,value:c}),e}}function __getIndex(t,e){return _u.getIndex(t,e)}function __drawGradeInfo(){const t=cfg.data.__summary,e=cfg.row.captionFonts,a=cfg.matrix.label.fonts,o=cfg.matrix.legend,n=d3.format(_cM.format);_u.drawGradeInfo(cfg,c2iCon,_gradeInfo,t,e,a,o,n,_dragHandleLg,_width,_cM.caption,".cell",_xEnd,_yStart)}function _gradeInit(){_gradeInfo=[],_colors1st&&_colors1st.range().forEach(t=>{const e={color:t,value:0,cnt:0};_gradeInfo.push(e)})}function _gradeCompute(t,e){_gradeInfo.some(a=>{if(a.color===e&&!t.isSparse)return a.value+=t[_cM.colNm],a.cnt++,!0})}function _drawValue(){if(9===cfg.matrix.label.compColor)return void _bodyG.select("g.gValue").data([]).exit().transition().duration(cfg.duration).style("fill-opacity",0).remove();_bodyG.select("g.gValue").empty()&&_bodyG.append("g").attr("class","gValue");const t=d3.format(_cM.format),e=cfg.matrix.node,a=cfg.matrix.label,o=cfg.matrix.sparseInfo,n=a.dx?a.dx:null,r=a.dy?a.dy:null,l=_bodyG.select("g.gValue").selectAll(".cValue").data(cfg.data.matrix,t=>t.id);l.exit().transition().duration(cfg.duration).remove(),l.enter().append("text").attr("class",t=>"cValue cr"+t.y+" cc"+t.x).attr("x",t=>t.x*e.width+e.width).attr("y",t=>t.y*e.height+e.height/2).attr("dx",n).attr("dy",r).style("font-family",a.fonts[0]).style("font-size",a.fonts[1]).style("text-anchor","end").style("opacity",0).merge(l).text(e=>e[_cM.colNm]===cfg.matrix.sparseInfo.value?"":t(e[_cM.colNm])).transition().duration(cfg.duration).style("fill",t=>a.compColor&&_colors1st?_u.invertColor(_colors1st(t[_cM.colNm])):a.fonts[2]).style("opacity",t=>t.isSparse?o.opacity:1)}function getChartData(t){const e={name:cfg.data.row[t.y][cfg.row.nameColNm],rClass:t.y};cfg.measures.forEach(function(a){e[a.colNm]=t[a.colNm]});let a=!0;for(let o=0;o<_userSet.length;o++)if(_userSet[o].name===e.name){cfg.measures.forEach(function(e){_userSet[o][e.colNm]+=t[e.colNm]}),a=!1;break}a&&(_userSet[_userSet.length]=e)}function sortbyLabel(t,e,a,o,n){let r=d3.select(o).attr("sort");r=null===r||"false"===r,d3.select(o).attr("sort",r);const l=cfg.row,i=cfg.matrix.node,s=(i.height+parseFloat(l.fonts[1]))/2,c=_bodyG.transition().duration(cfg.duration),d=[];let u,m,p="";if(t.altKey){let t="tot",a="c"===e?"rect.rowGroup":"rect.colGroup";p=" 소계",n&&(a+="Avg",t="avg",p=" 평균"),_bodyG.selectAll(a).filter(e=>d.push(e.__summary[t]))}else _bodyG.selectAll("rect.c"+e+a).filter(t=>d.push(t[_cM.colNm]));const g=void 0===r?"":r?"(내림차순)":"(오름차순)";if(_orderBy="user","r"===e){u=t.altKey?cfg.row.caption+p:cfg.data.row[a][l.nameColNm],_rowSortInfo=g?u+g:g,m=f(cfg.data.col.length);const e=i.width;let o=0;cfg.col.group&&Array.isArray(cfg.col.groups)&&(o=cfg.col.group.size+2),c.selectAll(".gCol .colLabel").attr("transform",(t,a)=>`translate(${m.indexOf(a)*e+e/2}, ${cfg.col.dy-o}) rotate(${cfg.col.xLabel.rotate})`),c.selectAll(".gColGroup .colGroup").attr("x",(t,a)=>m.indexOf(a)*e),c.selectAll(".gColGroupAvg .colGroupAvg").attr("x",(t,a)=>m.indexOf(a)*e+e/2-3),c.selectAll(".gCell .cell").attr("x",t=>m.indexOf(t.x)*e),c.selectAll(".gValue .cValue").attr("x",t=>m.indexOf(t.x)*e+e)}else{u=t.altKey?cfg.col.caption+p:cfg.data.col[a][cfg.col.nameColNm],_colSortInfo=g?u+g:g,m=f(cfg.data.row.length);const e=i.height;c.selectAll(".gRow .rowLabel").attr("y",(t,a)=>m.indexOf(a)*e+s),c.selectAll(".gRowGroup .rowGroup").attr("y",(t,a)=>m.indexOf(a)*e),c.selectAll(".gRowGroupAvg .rowGroupAvg").attr("y",(t,a)=>m.indexOf(a)*e+e/2-3),c.selectAll(".gCell .cell").attr("y",t=>m.indexOf(t.y)*e),c.selectAll(".gValue .cValue").attr("y",t=>m.indexOf(t.y)*e+e/2)}function f(t){return d3.range(t).sort((t,e)=>r?d[e]-d[t]:d[t]-d[e])}subTitleChange()}function subTitleChange(){if(cfg.title&&cfg.title.subCaption){let t=cfg.title.subCaption,e=cfg.title.subFonts[2];(_rowSortInfo||_colSortInfo)&&(_rowSortInfo?(t=_rowSortInfo,_colSortInfo&&(t+=","+_colSortInfo)):_colSortInfo&&(t=_colSortInfo),e=cfg.title.subFonts[3]),_svg.select(".subtitle").style("fill",e).text(t)}}function orderBy(){const t=cfg.matrix.node,e=t.width,a=t.height,o=cfg.row,n=(a+parseFloat(o.fonts[1]))/2,r=e/2,l=a/2,i=_bodyG.transition().duration(cfg.duration);switch(_orderBy){case"row":i.selectAll(".gRow .rowLabel").attr("y",(t,e)=>e*a+n),i.selectAll(".gRowGroup .rowGroup").attr("y",(t,e)=>e*a),i.selectAll(".gRowGroupAvg .rowGroupAvg").attr("y",(t,e)=>e*a+l-3),i.selectAll(".gCell .cell").attr("y",t=>t.y*a),i.selectAll(".gValue .cValue").attr("y",t=>t.y*a+l),_colSortInfo="";break;case"col":i.selectAll(".gCol .colLabel").each(function(t,e){s(this,e)}),i.selectAll(".gColGroup .colGroup").attr("x",(t,a)=>a*e),i.selectAll(".gColGroupAvg .colGroupAvg").attr("x",(t,a)=>a*e+r-3),i.selectAll(".gCell .cell").attr("x",t=>t.x*e),i.selectAll(".gValue .cValue").attr("x",t=>t.x*e+e),_rowSortInfo="";break;default:i.selectAll(".gRow .rowLabel").attr("y",(t,e)=>e*a+n),i.selectAll(".gRowGroup .rowGroup").attr("y",(t,e)=>e*a),i.selectAll(".gRowGroupAvg .rowGroupAvg").attr("y",(t,e)=>e*a+l-3),i.selectAll(".gCol .colLabel").each(function(t,e){s(this,e)}),i.selectAll(".gColGroup .colGroup").attr("x",(t,a)=>a*e),i.selectAll(".gColGroupAvg .colGroupAvg").attr("x",(t,a)=>a*e+r-3),i.selectAll(".gCell .cell").attr("x",t=>t.x*e).attr("y",t=>t.y*a),i.selectAll(".gValue .cValue").attr("x",t=>t.x*e+e).attr("y",t=>t.y*a+l),_rowSortInfo=_colSortInfo=""}function s(t,a){const o=_u.transform(d3.select(t).attr("transform")).translate[1];d3.select(t).attr("transform",`translate(${a*e+r}, ${o}) rotate(${cfg.col.xLabel.rotate})`)}subTitleChange()}function ___measureColNmChange(t){const e="string"==typeof t?t:this.value;cfg.measures.forEach(t=>{t.colNm===e?(t.draw=!0,_cM=t):t.draw=!1}),____make_draw_option("corR",e)}function ___chartMeasureColNmChange(t){const e="string"==typeof t?t:this.value;chart.byChartMeasure(e),cfg.method.click&&cfg.method.click(null,{container:c2iCon,selector:"corR",which:"chartMeasure"},null,e)}function ____make_draw_option(t,e){makeMatrix(),cfg.method.click&&cfg.method.click(null,{container:c2iCon,selector:t,which:"measure"},cfg.data,e),makeDraw()}function _setMatrix(){const t=cfg.matrix;if(t.node||(console.info(c2i.lang.corR.msg_1),t.node={width:20,height:20,radius:0,stroke:"#fff",isInvert:!1}),t.node.radius)if(t.node.radius>0){const e=d3.min([t.node.width,t.node.height]);t.node.radius>e&&(t.node.radius=e)}else t.node.radius=0;return t.label||(t.label={dx:-4,dy:-4,fonts:["helvetica","11px","#555"],compColor:9}),!0}function _setXDim(){const t=cfg.col,e=c2i.lang.corR;return t.caption=t.caption?t.caption:"",t.colNm?t.idColNm?t.nameColNm?(t.axisPos=t.axisPos?t.axisPos.toLowerCase():"top",t.xPos=t.xPos?t.xPos:"middle",t.dy=void 0!==t.dy?t.dy:35,void 0===t.xLabel?t.xLabel={rotate:0}:void 0===t.xLabel.rotate&&(t.xLabel.rotate=0),t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","14px","dimgray"]),!0):(alert(e.msg_4),!1):(alert(e.msg_3),!1):(alert(e.msg_2),!1)}function _setYDim(){const t=cfg.row,e=c2i.lang.corR;return t.caption=t.caption?t.caption:"",t.colNm?t.idColNm?t.nameColNm?(t.axisPos=t.axisPos?t.axisPos.toLowerCase():"left",t.dx=void 0!==t.dx?t.dx:35,void 0===t.xLabel?t.xLabel={rotate:0}:void 0===t.xLabel.rotate&&(t.xLabel.rotate=0),t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","14px","dimgray"]),!0):(alert(e.msg_7),!1):(alert(e.msg_6),!1):(alert(e.msg_5),!1)}function _setMeasures(){const t=cfg.measures;return t&&t.length?(_cM=void 0,t.forEach(t=>{void 0===t.chartAgg&&(t.chartAgg="sum"),!0!==t.draw||_cM||(_cM=t),t.unit||(t.unit=1),t.fonts||(t.fonts=["helvetica","11px","gray"]),t.sFormat||(t.sFormat=".2s")}),void 0===_cM&&(_cM=t[0]),!0):(alert(c2i.lang.corR.hi_12),!1)}function _setCommon(){cfg.duration=cfg.duration&&cfg.duration>=750&&cfg.duration<=1500?cfg.duration:750}function resize(){_svg&&_c2iCon.node().parentNode.clientWidth&&(cfg.nonComponent?_width=_c2iCon.node().parentNode.clientWidth:(_width=parseInt(_c2iCon.style("width"),10),cfg.height=parseInt(_width/cfg.aspect)),_bodyG.remove(),_bodyG=void 0,_svg.attr("width",_width).attr("height",cfg.height),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),chart.render(),drawChart())}function _setTooltip(){const t=cfg.tooltip;(_tip=cfg.method.mouseenter&&t&&void 0!==t.id?d3.select(t.id):void 0)&&!_tip.empty()&&(c2i.util.resetTooltip(_tip,t.width?t.width:"460px","none"),"object"!=typeof t.fixedPos?t.fixedPos=void 0:_tip.style("pointer-events","all").style("cursor","move").call(_dragHandle),t.infoLevel=t.infoLevel?t.infoLevel<0||t.infoLevel>3?0:t.infoLevel:0,t.opacity=t.opacity?t.opacity:.7,t.isShow=void 0!==t.isShow&&t.isShow)}function _layoutData(){c2i.lang&&_setMatrix()&&_setXDim()&&_setYDim()&&_setMeasures()&&(_setCommon(),_setTooltip(),_u.setTheme(cfg,c2iCon,!1),_u.setTitle(cfg),cfg.data={},cfg.preBuildData?(cfg.data=_rawData,_rawData=_rawData.fact):makeDimFact(),_setDimFactInit(),_selectGroup(!0),_selectGroup(!1),_groupRowColNm&&sortByGroup(_groupRowColNm,!1),_groupColColNm&&sortByGroup(_groupColColNm,!0),makeMatrix(),cfg.isDev&&_u.devMode(cfg))}function _setDimFactInit(){const t={},e=cfg.data;e.row.sort((t,e)=>d3.ascending(t[cfg.row.colNm],e[cfg.row.colNm])),e.col.sort((t,e)=>d3.ascending(t[cfg.col.colNm],e[cfg.col.colNm])),e.fact.forEach(e=>{cfg.measures.forEach(t=>{e[t.colNm]=+e[t.colNm]}),e.id=e[cfg.row.colNm]+"-"+e[cfg.col.colNm],t[e.id]=e}),e.fact=t}function _selectGroup(t){let e;const a=t?cfg.row.groups:cfg.col.groups;a&&(a.some(t=>{if(t.isSelected)return e=t,!0}),!e&&Array.isArray(a)&&(a[0].isSelected=!0,e=a[0])),t?_groupRowColNm=e?e.colNm:e:_groupColColNm=e?e.colNm:e}function makeDimFact(){function t(t){const e=[];let a;return _rawData.sort((e,a)=>d3.ascending(e[t.colNm],a[t.colNm])),(a=d3.map(_rawData,e=>e[t.colNm]).values()).forEach(a=>{const o={};o[t.idColNm]=a[t.colNm],o[t.nameColNm]=a[t.nameColNm],t.group&&Array.isArray(t.groups)&&t.groups.forEach(function(t){o[t.colNm]=a[t.colNm]}),e.push(o)}),e}cfg.data.row=t(cfg.row),cfg.data.col=t(cfg.col),cfg.data.fact=_rawData}function sortByGroup(t,e){let a;const o=cfg.data;function n(e,o){return e[t]===o[t]?d3.ascending(e[a],o[a]):d3.ascending(e[t],o[t])}e?(a=cfg.col.idColNm,o.col=o.col.sort(n),o.col.forEach((t,e)=>{t.__seq=e})):(a=cfg.row.idColNm,o.row=o.row.sort(n),o.row.forEach((t,e)=>{t.__seq=e}))}function makeMatrix(){const t=cfg.row,e=cfg.col,a=[],o=cfg.data,n=cfg.matrix.sparseInfo;let r,l,i,s;const c={tot:0,cnt:0,avg:0},d={tot:0,cnt:0,avg:0};for(r in _chartMeasure=_chartMeasure||_cM.colNm,o.row)if(o.row.hasOwnProperty(r)){for(l in s={tot:0,cnt:0,avg:0},o.col)o.col.hasOwnProperty(l)&&(i={id:o.row[r][t.idColNm]+"-"+o.col[l][e.idColNm],x:+l,y:+r},o.fact[i.id]?(cfg.measures.forEach(t=>{n&&!i.isSparse&&t.colNm===_cM.colNm&&o.fact[i.id][t.colNm]===n.value&&(i.isSparse=!0),i[t.colNm]=o.fact[i.id][t.colNm]}),i.isSparse||(s.tot+=i[_cM.colNm],s.cnt++,c.tot+=i[_cM.colNm],c.cnt++,d.tot+=i[_chartMeasure],d.cnt++)):(n&&cfg.measures.forEach(t=>{i[t.colNm]=n.value}),i.isSparse=!0),a.push(i));s.cnt>0&&(s.avg=s.tot/s.cnt),o.row[r].__summary=s}for(l in o.col)if(o.col.hasOwnProperty(l)){for(r in s={tot:0,cnt:0,avg:0},o.row)o.row.hasOwnProperty(r)&&(i={id:o.row[r][t.idColNm]+"-"+o.col[l][e.idColNm],x:+l,y:+r},o.fact[i.id]&&(cfg.measures.forEach(t=>{n&&!i.isSparse&&t.colNm===_cM.colNm&&o.fact[i.id][t.colNm]===n.value&&(i.isSparse=!0),i[t.colNm]=o.fact[i.id][t.colNm]}),i.isSparse||(s.tot+=i[_cM.colNm],s.cnt++)));s.cnt>0&&(s.avg=s.tot/s.cnt),o.col[l].__summary=s}if(o.matrix=a,c.cnt>0&&(c.avg=c.tot/c.cnt),d.cnt>0&&(d.avg=d.tot/d.cnt),o.__summary=c,o.__summaryChart=d,e.group){let t=d3.extent(cfg.data.col.map(t=>t.__summary.tot));t=[t[0]-.05*Math.abs(t[0]),t[1]],o.__colScale=d3.scaleLinear().domain(t).range([0,e.group.size]),t=[(t=d3.extent(cfg.data.col.map(t=>t.__summary.avg)))[0]-.05*Math.abs(t[0]),t[1]],o.__colAvgScale=d3.scaleLinear().domain(t).range([0,e.group.size])}if(t.group){let e=d3.extent(cfg.data.row.map(t=>t.__summary.tot));e=[e[0]-.05*Math.abs(e[0]),e[1]],o.__rowScale=d3.scaleLinear().domain(e).range([0,t.group.size]),e=[(e=d3.extent(cfg.data.row.map(t=>t.__summary.avg)))[0]-.05*Math.abs(e[0]),e[1]],o.__rowAvgScale=d3.scaleLinear().domain(e).range([0,t.group.size])}_extent1st=d3.extent(o.matrix,t=>t[_cM.colNm])}function _chartSummary(){const t=cfg.row,e=cfg.col,a=[],o=cfg.data,n=cfg.matrix.sparseInfo;let r,l,i;const s={tot:0,cnt:0,avg:0};for(r in _chartMeasure=_chartMeasure||_cM.colNm,o.row)if(o.row.hasOwnProperty(r))for(l in o.col)o.col.hasOwnProperty(l)&&(i={id:o.row[r][t.idColNm]+"-"+o.col[l][e.idColNm],x:+l,y:+r},o.fact[i.id]&&(cfg.measures.some(t=>{if(n&&!i.isSparse&&t.colNm===_chartMeasure&&o.fact[i.id][t.colNm]===n.value&&(i.isSparse=!0),t.colNm===_chartMeasure)return i[t.colNm]=o.fact[i.id][t.colNm],!0}),i.isSparse||(s.tot+=i[_chartMeasure],s.cnt++)),a.push(i));s.cnt>0&&(s.avg=s.tot/s.cnt),o.__summaryChart=s}function drawChart(t){const e=cfg.chart;if(t?_chartMeasure=t:t=_chartMeasure,!e||!e.id||!t)return;let a;"#"!==e.id[0]&&(e.id="#"+e.id),d3.select(e.id).select("svg").remove(),cfg.measures.some(function(e){if(e.colNm===t)return a=e,!0});let o=0;const n=[],r=d3.format(a.format),l=cfg.matrix.sparseInfo;if(_userSet.forEach(e=>{_isSparse&&l&&void 0!==l.value?l.value!==e[t]&&(e.value=e[t],o+=e[t],n.push(e)):(e.value=e[t],o+=e[t],n.push(e))}),n.length<1)return;const i=e.margin,s=cfg.height,c=parseInt(d3.select(e.id).style("width"),10),d=d3.scaleLinear().rangeRound([0,c-2*i.right-i.left]).clamp(!0),u=d3.scaleBand().rangeRound([0,s-(i.top+i.bottom)]).padding(.05),m=d3.axisTop().scale(d).tickSize(-(s-(i.top+i.bottom))).ticks(4).tickFormat(d3.format(a.sFormat)),p=d3.axisLeft().scale(u).tickSize(0).tickPadding(6),g=t=>{const e=`${r(t.value)} (${d3.format(",.2%")(t.value/o)}, ${d3.format(",.2%")(t.value/cfg.data.__summaryChart.tot)})`;return _u.getTextWidth(e,a.fonts[1],a.fonts[0])+10},f=(_chart=d3.select(e.id).append("svg").attr("width",c-i.right).attr("height",cfg.height).style("background",cfg.theme)).append("g").attr("transform","translate("+[i.left,i.top]+")");n.sort((t,e)=>e.value-t.value);const h=d3.min(n,t=>t.value);h<0?d.domain([h+Math.floor(.1*h),d3.max(n,t=>t.value)]).nice():d.domain([0,d3.max(n,t=>t.value)]).nice(),u.domain(n.map(t=>t.name));const y=u.bandwidth(),_=f.selectAll("g.bar").data(n).enter().append("g").attr("class","bar").attr("transform",t=>"translate(0,"+u(t.name)+")"),x=-1===_lgIndex?"steelblue":_svg.selectAll(".lgRect.g"+_lgIndex).style("fill");_.append("rect").attr("class",t=>{return(t.value<0?"negative":"positive")+" bar rr"+t.rClass}).attr("width",0).attr("height",y).style("fill",t=>t.value<0?"brown":x).on("mouseover",function(t,e){d3.select(this).classed("rect-hover",!0),_bodyG.selectAll(".r"+e.rClass).classed("text-highlight",!0),_bodyG.selectAll(".cr"+e.rClass).classed("cell-pos",!0)}).on("mouseout",function(t,e){d3.select(this).classed("rect-hover",!1),_bodyG.selectAll(".r"+e.rClass).classed("text-highlight",!1),_bodyG.selectAll(".cr"+e.rClass).classed("cell-pos",!1)}).transition().duration(cfg.duration).attr("width",t=>d(t.value)),_.append("text").attr("class","value").attr("x",0).attr("y",y/2).attr("dx",t=>{const e=g(t);return d(t.value)>e?-3:3}).attr("dy",".35em").attr("text-anchor",t=>{const e=g(t);return d(t.value)>e?"end":"start"}).style("font-family",e.xFonts[0]).style("font-size",e.xFonts[1]).attr("fill",t=>{const a=g(t);return-1===_lgIndex?d(t.value)>a?"white":e.outColor:d(t.value)>a?e.fontColors[_lgIndex]:e.outColor}).text(t=>`${format(t.value)} (${d3.format(",.2%")(t.value/o)}, \n        ${d3.format(",.2%")(t.value/cfg.data.__summaryChart.tot)})`).transition().duration(1.1*cfg.duration).delay((t,e)=>e*cfg.delay).ease(_u.ease[cfg.easing]).attr("x",t=>d(t.value)),f.append("g").attr("class","x axis").call(m).selectAll("text").style("font-family",e.xFonts[0]).style("font-size",e.xFonts[1]).style("fill",e.xFonts[2]),f.append("g").attr("class","y axis").call(p).selectAll("text").style("font-family",e.yFonts[0]).style("font-size",e.yFonts[1]).style("fill",e.yFonts[2]).attr("class",t=>{return"r"+A(t).rClass}).on("mouseover",function(t,e){d3.select(this).classed("text-hover",!0);const a=A(e);_bodyG.selectAll(".r"+a.rClass).classed("text-highlight",!0),_bodyG.selectAll(".cr"+a.rClass).classed("cell-pos",!0),_chart.selectAll(".rr"+a.rClass).classed("rect-hover",!0)}).on("mouseout",function(t,e){d3.select(this).classed("text-hover",!1);const a=A(e);_bodyG.selectAll(".r"+a.rClass).classed("text-highlight",!1),_bodyG.selectAll(".cr"+a.rClass).classed("cell-pos",!1),_chart.selectAll(".rr"+a.rClass).classed("rect-hover",!1)}),f.selectAll(".axis .domain").style("fill","none"),f.selectAll(".axis line").style("stroke","#ccc").style("stroke-opacity",.3).style("shape-rendering","crispEdges");const v=cfg.data.__summaryChart,b=c2i.lang.gen;let k=b.tipCurrTot+": "+format(o);k+=" ("+d3.format(",.2%")(o/v.tot)+"),",k+=" "+b.row+" "+b.avg+": "+format(o/n.length),k+=" "+b.rowCnt+": "+d3.format(",d")(n.length);let C=b.total+": "+format(v.tot);C+=" "+b.node+b.avg+": "+format(v.avg),C+=" "+b.tipNodes+": "+d3.format(",.0f")(v.cnt),_chart.append("text").style("font-family",e.summaryFonts[0]).style("font-size",e.summaryFonts[1]).style("fill",e.summaryFonts[2]).attr("class","summary").attr("transform","translate("+[i.left/2,s-i.top/2]+")").text(k).append("title").text(C);const w=[{name:"행평균",value:o/n.length},{name:"전체 노드 평균",value:v.avg}],N=f.selectAll(".avgLine").data(w).enter().append("g").attr("class","avgLine").append("line").attr("x1",t=>d(t.value)).attr("x2",t=>d(t.value)).attr("y1",0).attr("y2",0).attr("stroke",t=>"행평균"===t.name?e.avgLines[0]:e.avgLines[1]).attr("stroke-width",e.avgStroke[0]).attr("stroke-dasharray",e.avgStroke[1]).style("stroke-opacity",e.avgStroke[2]);function A(t){let e="";return _userSet.some(a=>{if(a.name===t)return e=a,!0}),e}N.append("title").text(t=>t.name+": "+d3.format(",.2f")(t.value)),N.transition().duration(1.1*cfg.duration).ease(_u.ease[cfg.easing]).attr("y2",s-(i.top+i.bottom))}function _xStart(){return cfg.margin.left}function _xEnd(){return _width-cfg.margin.right}function _yStart(){return cfg.height-cfg.margin.bottom}function _yEnd(){return cfg.margin.top}chart.render=function(){const t=cfg.optWin;if(!_svg){if(_svg=d3.select(c2iCon).append("svg").attr("width",_width).attr("height",cfg.height).style("background",cfg.theme?cfg.theme:null),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),!c2i.lang)return;t&&(_option=_u.renderOptionWindow(cfg,_svg,_oID,_option,_makeOptionView))}return t&&!t.optBtnHide&&_u.optionBtnView(cfg,_width,_option),renderBody(),chart},chart.matrix=function(t){return arguments.length?(cfg.matrix=t,_setMatrix(),chart):cfg.matrix},chart.row=function(t){return arguments.length?(cfg.row=t,_setYDim(),chart):cfg.row},chart.col=function(t){return arguments.length?(cfg.col=t,_setXDim(),chart):cfg.col},chart.measures=function(t){return arguments.length?(cfg.measures=t,_setMeasures(),chart):cfg.measures},chart.tooltip=function(t){return arguments.length?(cfg.tooltip=t,_setTooltip(),chart):cfg.tooltip},chart.tipFixed=function(t){const e=cfg.tooltip;t?(e.fixedPos=e.fixedPos?e.fixedPos:{xPos:"start",yPos:"top"},_setTooltip()):e.fixedPos=void 0},chart.theme=function(t){return arguments.length?(cfg.theme="base"===t?cfg.themeInit:t,_u.setTheme(cfg,c2iCon,!0),chart):cfg.theme},chart.clear=function(){return _svg&&(d3.select(cfg.tooltip.id).select("tbody").remove(),_svg.remove(),_svg=_bodyG=_tip=void 0),chart},chart.data=function(t){return arguments.length?(_rawData=t,_layoutData(),chart):cfg.data},chart.getExtent=(()=>_extent1st),chart.setColors=function(t,e){_colors1st=e,_gradeInit(),_bodyG.selectAll(".gCell .cell").style("fill",t=>{const e=_colors1st?_colors1st(t[_cM.colNm]):_cM.fonts[2];return _colors1st&&_gradeCompute(t,e),t.isSparse?cfg.matrix.sparseInfo.fill:e}),_bodyG.selectAll(".gValue .cValue").style("fill",t=>cfg.matrix.label.compColor?_u.invertColor(_colors1st(t[_cM.colNm])):cfg.matrix.label.fonts[2]),__drawGradeInfo()},chart.selectNodes=function(t,e,a){if(t){let o,n=e[0],r=e[1];if(t.selector.indexOf("first_")>-1){t.selector==="first_"+_colors1st.range().length&&(r+=1e-6),o=_bodyG.selectAll(".cell").filter(t=>n<=t[_cM.colNm]&&t[_cM.colNm]<r&&!t.isSparse),_bodyG.selectAll(".rowLabel").classed("text-selected",!1),_bodyG.selectAll(".colLabel").classed("text-selected",!1),_bodyG.selectAll(".cell").style("fill-opacity",0).classed("cell-selected",!1).style("stroke","#bbb").style("stroke-dasharray",null).style("stroke-width","1px"),_svg.selectAll(".lgRect").style("fill-opacity",0);const e=t.selector.substr(t.selector.indexOf("_")+1)-1;_svg.selectAll(".lgRect.g"+e).style("fill-opacity",1),o.style("fill-opacity",1),"click"===a&&(_userSet=[],o.data().forEach(getChartData),_userSet.length>0&&(_chartMeasure||(_chartMeasure=_cM.colNm),_lgIndex=e,drawChart(_chartMeasure)),o.classed("cell-selected",!0).style("stroke","#333").style("stroke-dasharray","2px").style("stroke-width","2px"))}}else _bodyG.selectAll(".cell").style("fill-opacity",1),_svg.selectAll(".lgRect").style("fill-opacity",1)},chart.getInfo=(()=>({container:c2iCon,type:"corR",cm:_cM})),chart.lang=function(t){return arguments.length?(cfg.lang=t.toLowerCase(),_u.locale(cfg),_meta=void 0,chart):cfg.lang},chart.orderBy=function(t){_orderBy=t.toLowerCase(),orderBy()},chart.groupBy=function(t,e){e?_groupColColNm=t:_groupRowColNm=t,sortByGroup(t,e),makeMatrix(),_bodyG.selectAll("g").remove(),makeDraw()},chart.rowColExchange=function(){let t=_u.deepClone(cfg.data.row);cfg.data.row=_u.deepClone(cfg.data.col),cfg.data.col=_u.deepClone(t);const e=cfg.row,a=cfg.col,o={axisPos:e.axisPos,dx:e.dx},n={axisPos:a.axisPos,xPos:a.xPos,dy:a.dy,xLabel:{rotate:a.xLabel.rotate,isVertical:a.xLabel.isVertical}};t=_u.deepClone(e),cfg.row=_u.deepClone(a),cfg.col=_u.deepClone(t);for(let t in o)cfg.row[t]=o[t];for(let t in n)cfg.col[t]=n[t];cfg.data.fact=_rawData,_setDimFactInit(),_selectGroup(!0),_selectGroup(!1),_groupRowColNm&&sortByGroup(_groupRowColNm,!1),_groupColColNm&&sortByGroup(_groupColColNm,!0),makeMatrix(),_bodyG.selectAll("g").remove(),makeDraw()},chart.byMeasure=function(t){___measureColNmChange(t)},chart.sparse=function(t){_isSparse=t,_chartSummary(),drawChart(_chartMeasure)},chart.byChartMeasure=function(t){_chartMeasure=t,_chartSummary(),drawChart(_chartMeasure)},chart.getMeasureColNm=function(){return _cM.colNm},chart.exportData=function(t,e){const a=cfg.title&&cfg.title.caption?cfg.title.caption:"",o=[],n=[];if(!e){const t=cfg.row,e=cfg.col;o.push(t.colNm+","),o.push(t.nameColNm+","),o.push(e.colNm+","),o.push(e.nameColNm+","),n.push(t.colNm+","),n.push(-1===t.caption.search(/["|,|\n]/g)?'"'+t.caption+'",':t.nameColNm+","),n.push(e.colNm+","),n.push(-1===e.caption.search(/["|,|\n]/g)?'"'+e.caption+'",':e.nameColNm+","),cfg.measures.forEach(function(t){t.caption.search(/["|,|\n]/g)>-1?n.push('"'+t.caption+'",'):n.push(t.caption+","),o.push(t.colNm+",")})}_u.exportData(a,o,n,_rawData,t)};let _timer=null;return cfg.isResponsive&&_u.resizeChart(cfg,c2iCon,resize,_timer),cfg.optWin&&_u.optionHide(),_u.createAccessor(chart,cfg)},c2i.bi.dbManager=(t=>{"use strict";const e=c2i.util;if(!e.checkLicenseLocale(t))return!1;const a={};let o={db:{dbName:"c2iMetaDb",version:1,autoIncrement:!1},meta:[],isDev:void 0};e.init(o,t);const n=window;if(n.indexedDB||(n.indexedDB=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB),n.IDBTransaction||(n.IDBTransaction=n.IDBTransaction||n.webkitIDBTransaction||n.msIDBTransaction),n.IDBKeyRange||(n.IDBKeyRange=n.IDBKeyRange||n.webkitIDBKeyRange||n.msIDBKeyRange),!n.indexedDB)return d="*.이 브라우저는 IndexedDB를 지원하지 않습니다.(경우에 따라 성능 저하 가능합니다.)",e.alert2(!0,d),!1;const{dbName:r,version:l}={...o.db},i=[...o.meta];let s,c,d;function u(t,e){return s.transaction(t,e).objectStore(t)}return a.openDB=function(t){s&&(d="*.이미 DB(V."+l+")가 오픈 되어 있습니다.",e.alert2(o.isDev,d),t&&t({isOk:!0,dbMgr:a,msg:d})),console.log("*.DB 오픈 시작...");const n=indexedDB.open(r,l);return n.onsuccess=(n=>{d="*.DB 오픈 및 초기화 완료..!!!",e.alert2(o.isDev,d),(s=n.currentTarget.result).onversionchange=(t=>{s.close(),d="*.DB V"+l+"가 준비 되었으니, 브라우져 새로고침 하여 작업하세요.!",e.alert2(!0,d)}),t&&t({isOk:!0,dbMgr:a,msg:d})}),n.onerror=(a=>{d="*.IndexedDB의 사용을 허락해야 정상 작동 및 성능이 좋아 집니다."+a.target.error.message,e.alert2(!0,d,a),t&&t({isOk:!1,dbMgr:null,msg:d})}),n.onblocked=(a=>{d="*.이 사이트를 오픈하면, 동일 사이트의 다른 탭을 닫아 주세요.(for DB)",e.alert2(!0,d,a),t&&t({isOk:!1,dbMgr:null,msg:d})}),n.onupgradeneeded=(n=>{(s=n.target.result).onerror=(a=>{d="*.DB 업그레이드 오류: "+a.target.error.message,e.alert2(!0,d,a),t&&t({isOk:!1,dbMgr:null,msg:d})}),i.forEach(t=>{t.version>=l&&a.createStore(t),t.isMigrate&&console.log(`*.${t.storeNm} Data Migration은 추후 추가...!!`),t.isDrop&&s.objectStoreNames.contains(t.storeNm)&&s.deleteObjectStore(t.storeNm)}),d="*.DB가 새로운 버젼(V."+l+")으로 정상 업그레이드 되었습니다.",e.alert2(o.isDev,d)}),a},a.closeDB=(t=>s?(s=s.close(),d="*.DB가 정상적으로 닫혔습니다..!!",e.alert2(o.isDev,d),t&&t({isOk:!0,msg:d}),a):(d="*.DB가 닫혀있으니, 우선 DB를 오픈하세요...!!",t&&t({isOk:!1,msg:d}),a)),a.createStore=((t,o)=>{if(s.objectStoreNames.contains(t.storeNm))return d="*.이미 "+t.storeNm+" 은 존재하여, 생성 불가합니다.!! (isMigrate: true) 사용하세요",e.alert2(!0,d),o&&o({isOk:!1,msg:d}),a;const n=s.createObjectStore(t.storeNm,{keyPath:t.pk,autoIncrement:!!t.autoIncrement});return t.cols.forEach(t=>{t.isIndex&&n.createIndex(t.name,t.name,{unique:t.unique})}),t.indexes&&t.indexes.forEach(t=>{n.createIndex(t.name,t.cols,{unique:t.unique})}),o&&o({isOk:!0}),a}),a.idbHandle=(t=>t?(s=t,a):s),a.getIsDev=(()=>o.isDev),a.deleteDB=(t=>{if(!s)return d="*.DB를 오픈하세요...!!",void(t&&t({isOk:!1,msg:d}));const a=indexedDB.deleteDatabase(r);a.onsuccess=(a=>{d="*."+r+" DB 삭제 완료.!!",e.alert2(o.isDev,d),s=null,t&&t({isOk:!0,msg:d})}),a.onerror=(a=>{d="*."+r+" DB 삭제 실패.!!",e.alert2(!0,d,a),t&&t({isOk:!1,msg:d})}),a.onblocked=(a=>{d="*.블로킹 때문에 "+r+" DB 삭제 불가능합니다.!!",e.alert2(!0,d,a),t&&t({isOk:!1,msg:d})})}),a.clearStore=((t,a)=>{const n=u(t,"readwrite").clear();n.onsuccess=(n=>{d="*."+t+" 삭제 완료.!!",e.alert2(o.isDev,d),a&&a({isOk:!0,msg:d})}),n.onerror=(o=>{d="*."+t+" 삭제 오류:"+o.target.error.message,e.alert2(!0,d),a&&a({isOk:!1,msg:d})})}),a.addData=((t,a,n)=>{const r=u(t,"readwrite");let l;try{a.createdAt=new Date,l=r.add(a)}catch(t){throw d="DataCloneError"==t.name?"*.이 브라우져는 Blob를 지원하지 않습니다. Chrome, Firefox를 사용하세요.":"*.DB 저장 오류: "+t.name+"("+t.code+")",n&&n({isOk:!1,msg:d}),e.alert2(!0,d),t}l.onsuccess=(t=>{d="*.데이터 DB 저장 완료",n&&n({isOk:!0,values:[a],msg:d}),e.alert2(o.isDev,d)}),l.onerror=(t=>{d="*.데이터 DB 저장 오류: "+t.target.error.message,n&&n({isOk:!1,msg:d}),e.alert2(!0,d)})}),a.updateData=((t,a,n)=>{const r=u(t,"readwrite"),l=r.get(a.id);l.onsuccess=(t=>{let l=t.target.result;if(!l)return d="*.기존 데이터("+a.id+")가 DB에 없습니다. 다시 입력 하세요.",n&&n({isOk:!0,msg:d}),void e.alert2(!0,d);(l={...l,...a}).modifiedAt=new Date;const i=r.put(l);i.onsuccess=(()=>{d="*.데이터 DB 수정 완료",n&&n({isOk:!0,values:[l]}),e.alert2(o.isDev,d)}),i.onerror=(t=>{d="*.데이터 DB 수정 오류: "+t.target.error.message,n&&n({isOk:!1,msg:d}),e.alert2(!0,d)})}),l.onerror=(t=>{d="*.삭제할 데이터 DB 조회 오류: "+t.target.error.message,n&&n({isOk:!1,msg:d}),e.alert2(!0,d)})}),a.deleteData=((t,a,n)=>{const r=u(t,"readwrite"),l=r.get(a);l.onsuccess=(t=>{if(!t.target.result)return d="*.해당하는 데이터("+a+")가 DB에 없습니다.",n&&n({isOk:!0,msg:d}),void e.alert2(o.isDev,d);const l=r.delete(a);l.onsuccess=(t=>{d="*.데이터("+a+") DB 삭제 성공.",n&&n({isOk:!0,_msg:d}),e.alert2(o.isDev,d)}),l.onerror=(t=>{d="*.데이터("+a+") DB 삭제 오류: "+t.target.error.message,n&&n({isOk:!1,msg:d}),e.alert2(!0,d)})}),l.onerror=(t=>{d="*.해당하는 데이터("+a+") DB 불러오기 오류: "+t.target.error.message,n&&n({isOk:!1,msg:d}),e.alert2(!0,d)})}),a.getData=((t,a,n)=>{const r=u(t).get(a);r.onsuccess=(t=>{let r=t.target.result;r||(d="*.해당하는 데이터("+a+")가 DB에 없습니다.",e.alert2(o.isDev,d),r=null),n&&n({isOk:!0,values:r})}),r.onerror=(t=>{d="*.getData Error."+t.target.error.message,n&&n({isOk:!1,msg:d}),e.alert2(!0,d)})}),a.existData=((t,a,n)=>{const r=u(t).get(a);r.onsuccess=(t=>{let e=t.target.result;n&&n({isOk:!!e})}),r.onerror=(t=>{d="*.getData Error."+t.target.error.message,n&&n({isOk:!1,msg:d}),e.alert2(o.isDev,d)})}),a.getRangeData=((t,a,n,r)=>{const l=u(t).index(a).openCursor(IDBKeyRange.only(n));let i=[];l.onsuccess=(t=>{let a=t.target.result;a?(i.push(a.value),a.continue()):(i.length||(d="*.["+(d=Array.isArray(n)?n.join(","):n)+"]에 해당하는 데이터가 DB에 없습니다.",e.alert2(o.isDev,d)),r&&r({isOk:!0,values:i}))}),l.onerror=(t=>{d="*.getRangeData Error."+t.target.error.message,r&&r({isOk:!1,msg:d}),e.alert2(!0,d)})}),a.getAll=((t,a)=>{const n=u(t).getAll();n.onsuccess=(t=>{let n=t.target.result;n||(d="*.데이터가 없습니다.",e.alert2(o.isDev,d),n=[]),a&&a({isOk:!0,values:n})}),n.onerror=(t=>{d="*.getAll Error."+t.target.error.message,a&&a({isOk:!1,msg:d}),e.alert2(!0,d)})}),a.lang=(t=>t?(o.lang=t.toLowerCase(),e.locale(o),c=c2i.lang,a):o.lang),e.createAccessor(a,o)}),c2i.infoG.budget=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;let o={};const n={isResponsive:!0,width:"100%",margin:{top:5,left:5,right:5,bottom:5},padding:5,aspectRatio:"1:1",easing:"linear",duration:750,delay:100,data:void 0,title:void 0,fullSize:!1,exceptValue:0,stroke:"#c4be09",strokeWidth:0,group:{colNm:"",caption:"",format:"",fonts:["Roboto","12px","#c4be09"]},account:{colNm:"",caption:"",fonts:["Roboto","12px","#f4ee09"],labelInMainPie:!0},unitNm:"",mainPie:{bPlan:!0,bSameSize:!1,inRadius:.55,color:"20b",halfCircle:!1,radiusIncrease:!1,padding:3,showLabels:["name","value","ratio"],dyLabel:15,drawSequence:!1,sub:{width:25,color:["#166097","#d53636"],dyLabel:5,fonts:["Roboto","11px"],drawSequence:!0,draw:!0}},planetPie:{exceptColor:"red",inheritedColor:!1,format:[",f",".1%"],sameRadius:!1,scale:"linear",fonts:["Roboto","12px"],stroke:"#c4be09",strokeWidth:0,dyLabel:5,dimNms:["예산","실적"],color:["#a5a5a5","#985455"],faultDimNms:["예산 없음","실적 없음","초과"],inRadius:.5,halfCircle:!1,draw:!0},measures:void 0,legendId:void 0,tooltip:void 0,isDev:!0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;let r,l,i,s,c,d,u,m,p,g,f,h,y,_=a.computeDim(_c2iCon,n),x=c2i.lang,v=Math.min(_,n.height)/(n.fullSize?2:4)-n.mainPie.padding,b=0;const k=d3.scaleOrdinal().range(a.getColorScheme(n.mainPie.color)),C=d3.scaleOrdinal().domain(n.planetPie.dimNms).range(n.planetPie.color),w=d3.arc(),N=d3.arc(),A=d3.arc(),L=d3.arc(),D=a.getScale(n.planetPie.scale),S=d3.pie().sort(null).value(t=>n.mainPie.bSameSize?n.mainPie.bPlan?t.__plan_ratio:t.__result_ratio:n.mainPie.bPlan?t.__plan:t.__result),T=d3.pie().sort(null).value(t=>t[H()]),M=d3.pie().sort(null).value(t=>t.__measure);let F,I,B=0,E=0,G="",P="",O="";const R=n.planetPie.faultDimNms,V=t=>t.data[n.account.colNm],W=(t,e)=>d3.descending(t[P],e[P]),Y=(t,e)=>d3.ascending(t[P],e[P]),z=(t,e)=>d3.ascending(t.__id,e.__id),H=t=>t?"__"+t:!n.mainPie||n.mainPie.bSameSize?"__pos":n.mainPie.bPlan?"__plan":"__result",$=()=>n.planetPie&&n.planetPie.sameRadius,X=()=>n.planetPie&&n.planetPie.draw;n.mainPie.sub&&n.mainPie.sub.draw&&(y="string"==typeof n.mainPie.sub.color?a.getColorScheme(n.mainPie.sub.color):n.mainPie.sub.color,b=n.mainPie.sub.width?n.mainPie.sub.width:0,v-=n.planetPie.draw?-b/2:b),y=d3.scaleOrdinal().domain(n.measures.map(t=>t.caption)).range(y);const q=d3.drag().on("start",function(t){const e=t.sourceEvent;e.stopPropagation(),d=parseFloat(d3.select(this).style("left"))-e.pageX,u=parseFloat(d3.select(this).style("top"))-e.pageY,"c2iOption"!==this.id||d3.selectAll("#c2iColorPickerPop").empty()||d3.selectAll("#c2iColorPickerPop").remove()}).on("drag",function(t){const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",()=>e.pageX+d+"px").style("top",()=>e.pageY+u+"px")}).on("end",function(){d3.select(this).style("opacity",1)});function U(){let e,o,i;l||(l=r.append("g").attr("class","body").attr("transform","translate("+_/2+","+m+")").attr("class","c2iBudget"),g=l.append("g").attr("class","main")),j(),n.mainPie.sub&&n.mainPie.sub.draw&&function(){let t=Z();t=t.filter(t=>n.mainPie.bPlan?void 0!==t.__plan&&0!==t.__plan:void 0!==t.__result&&0!==t.__result),f||(f=l.append("g").attr("class","mainEx"));(o=f.selectAll("path").data(S(t),V)).exit().remove();const r=o.enter().append("path").on("click",function(t,e){}).on("touchstart",function(t){b(t,this,"mainEx","")}).on("dblclick",t=>F(t,"mainEx","")).on("mouseenter",function(){d3.select(this).style("stroke-width","3px").style("stroke-dashed","3px")}).on("mouseleave",function(){d3.select(this).style("stroke-width",n.strokeWidth?n.strokeWidth:1)}).attr("stroke",n.stroke).attr("stroke-width",n.strokeWidth?n.strokeWidth:1).style("fill",t=>y(t.data.caption)).attr("transform","scale("+(n.mainPie.radiusIncrease?0:1)+")");(o=r.merge(o)).transition().duration(n.duration).ease(a.ease[n.easing]).attrTween("d",function(t){return n.mainPie.sub.drawSequence?J(t):tt(t,this)}).attr("transform",n.mainPie.radiusIncrease?"scale(1)":null),(e=f.selectAll("text").data(S(t),V)).exit().remove(),e.enter().append("text").attr("pointer-events","none").attr("font-family",n.mainPie.sub.fonts[0]).attr("font-size",n.mainPie.sub.fonts[1]).attr("text-anchor","middle").attr("dy",n.mainPie.sub.dyLabel).style("fill",t=>a.getColorContrast(y(t.data.caption))).text(t=>t.data.caption).merge(e).transition().duration(n.duration).ease(a.ease[n.easing]).attr("transform",t=>"translate("+A.centroid(t)+")")}();let c=g.selectAll("path").data(T(s),V);c.exit().remove();const d=c.enter().append("path").on("click",function(t,e){}).on("touchstart",function(t){b(t,this,"main","")}).on("dblclick",t=>F(t,"main","")).on("mouseenter",function(e,a){if(d3.select(this).style("stroke-width","3px").style("stroke-dashed","3px"),n.legendId){const t="."+n.legendId.substr(1)+"C"+a.data.__id;d3.select(n.legendId).selectAll(t).style("fill",d3.rgb(_colors(a.data.__id)).brighter()).classed("rectHover",!0).style("opacity",.9)}n.method.mouseenter&&n.method.mouseenter(e,{container:t,selector:"arcB"},a.data)}).on("mouseleave",function(e,a){if(d3.select(this).style("stroke-width",n.strokeWidth),n.legendId){const t="."+n.legendId.substr(1)+"C"+a.data.__id;d3.select(n.legendId).selectAll(t).classed("rectHover",!0).style("opacity",0)}n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"arcarcB"},a.data)}).attr("stroke",n.stroke).attr("stroke-width",n.strokeWidth).style("fill",(t,e)=>k(e));if(c=d.merge(c),d.append("title").text(function(t){return x.gen.working+"..."}),!X())return h&&h.selectAll("g").transition().duration(n.duration).ease(a.ease[n.easing]).attr("transform","scale(0)").remove(),p(),void c.attr("transform","scale("+(n.mainPie.radiusIncrease?0:1)+")").transition().duration(n.duration).ease(a.ease[n.easing]).attrTween("d",function(t){return n.mainPie.drawSequence?Q(t):K(t,this)}).attr("transform",n.mainPie.radiusIncrease?"scale(1)":null);h?h.selectAll("g").transition().duration(n.duration).ease(a.ease[n.easing]).attr("transform","scale(0)").remove():h=l.append("g",".main").attr("class","planet");const u=d3.extent(n.data,t=>t.__plan);function p(){const t=n.account,e=n.mainPie,o=e.showLabels,r=3===o.length?10:2===o.length?5:-5;g.selectAll("text").empty()||g.selectAll("text").remove();const l=(i=g.selectAll("text").data(T(s),V)).enter().append("text").on("touchstart",function(t){b(t,this,"main","name")}).on("dblclick",t=>F(t,"main","name")).attr("font-family",t.fonts[0]).attr("font-size",t.fonts[1]).attr("fill",(e,o)=>t.fonts[2]?t.fonts[2]:a.getColorContrast(k(o))).attr("text-anchor","middle");l.append("tspan").attr("class","accName").attr("x",0).text(t=>t.data.accNm);const c=n.planetPie.format;o.indexOf("value")>-1&&l.append("tspan").attr("class","value").attr("x",0).attr("dy",e.dyLabel).attr("fill",(t,e)=>a.getColorContrast(k(e))).text(t=>e.bPlan?d3.format(c[0])(t.data.__plan):d3.format(c[0])(t.data.__result)),o.indexOf("ratio")>-1&&l.append("tspan").attr("class","ratio").attr("x",0).attr("dy",e.dyLabel).attr("fill",(t,e)=>a.getColorContrast(k(e))).text(t=>e.bPlan?"("+d3.format(c[1])(t.data.__plan/n.data.__plan_sum)+")":"("+d3.format(c[1])(t.data.__result/n.data.__result_sum)+")"),l.merge(i).transition().duration(n.duration).ease(a.ease[n.easing]).attr("transform",e=>{const a=t.labelInMainPie?N.centroid(e):v(e);return a[1]-=r,"translate("+a+")"})}function v(t){const e=w.centroid(t);return e[0]=2*e[0],e[1]=2*e[1],e}function b(t,e,a,o){if(t.preventDefault(),t.stopPropagation(),e.__start){e.__end=new Date;const t=e.__end-e.__start;if(e.__start=void 0,!t||t>500)return;F(a,o)}else e.__start=new Date}function F(t,l,d){if(O!==l&&(O=l,G=""),t){let e=!1;if(t.shiftKey&&t.altKey?(n.fullSize=!n.fullSize,n.planetPie.draw=!n.fullSize,ot(),e=!0):(t.shiftKey&&(n.mainPie.bPlan=!n.mainPie.bPlan,e=!0),t.altKey&&(n.mainPie.bSameSize=!n.mainPie.bSameSize,e=!0)),e)return void U()}switch(P="name"===d?n.account.colNm:H(d),G){case"desc":n.data.sort(Y),G="asc";break;case"asc":n.data.sort(z),G="normal";break;default:n.data.sort(W),G="desc"}!function(){if(n.title&&n.title.subCaption){let t,e;e=P.indexOf("plan")>-1?n.planetPie.dimNms[0]:P.indexOf("result")>-1?n.planetPie.dimNms[1]:P.indexOf("pos")>-1?x.gen.sameSize:n.account.caption;let a=n.title.subCaption;"desc"===G?(a+=": "+e+" "+x.gen.by+" "+x.gen.desc,t=n.title.subFonts[3]):"asc"===G?(a+=": "+e+" "+x.gen.by+" "+x.gen.asc,t=n.title.subFonts[3]):t=n.title.subFonts[2],r.select(".subtitle").style("fill",t).text(a)}}();const u=n.mainPie.showLabels,m=3===u.length?10:2===u.length?5:-5;if(j(),c=g.selectAll("path").data(T(s),V),(i=g.selectAll("text").data(T(s),V)).transition().duration(n.duration).ease(a.ease[n.easing]).attr("transform",t=>{const e=n.account.labelInMainPie?N.centroid(t):v(t);return e[1]-=m,"translate("+e+")"}),c.transition().duration(n.duration).ease(a.ease[n.easing]).attrTween("d",function(t){return n.mainPie.drawSequence?Q(t):K(t,this)}).each(t=>{if(n.planetPie.draw){const e=w.centroid(t);e[0]=2*e[0],e[1]=2*e[1],h.select(".C"+t.data.__id).transition().duration(n.duration).ease(a.ease[n.easing]).attr("transform","translate("+e+")")}}),n.mainPie.sub&&n.mainPie.sub.draw){let t=Z();t=t.filter(t=>n.mainPie.bPlan?void 0!==t.__plan&&0!==t.__plan:void 0!==t.__result&&0!==t.__result),o=f.selectAll("path").data(S(t),V),e=f.selectAll("text").data(S(t),V),o.transition().duration(n.duration).ease(a.ease[n.easing]).attrTween("d",function(t){return n.mainPie.sub.drawSequence?J(t):tt(t,this)}),e.transition().duration(n.duration).ease(a.ease[n.easing]).attr("transform",t=>"translate("+A.centroid(t)+")")}}D.domain([0,u[1]]),c.attr("transform","scale("+(n.mainPie.radiusIncrease?0:1)+")").transition().duration(n.duration).ease(a.ease[n.easing]).attrTween("d",function(t){return n.mainPie.drawSequence?Q(t):K(t,this)}).attr("transform",n.mainPie.radiusIncrease?"scale(1)":null).each((t,e)=>(function(t,e){let o,r;$()?0===e&&(o=D.range()[1],r=n.planetPie.inRadius?o*n.planetPie.inRadius:0,L.outerRadius(o).innerRadius(r)):(o=D(t.data.__plan),r=n.planetPie.inRadius?o*n.planetPie.inRadius:0,L.outerRadius(o).innerRadius(r));const l=h.append("g").attr("class","C"+t.data.__id);l.selectAll("path").data(M(t.data.children)).enter().append("path").attr("class",(t,e)=>e?"plan":"result").on("touchstart",function(t){b(t,this,"planet",d3.select(this).attr("class"))}).on("dblclick",function(t){F(t,"planet",d3.select(this).attr("class"))}).on("click",function(t,e){}).on("mouseenter",function(){d3.select(this).style("stroke-width","3px")}).on("mouseleave",function(){d3.select(this).style("stroke-width",n.strokeWidth)}).attr("d",t=>n.planetPie.exceptColor&&t.data.value<=0?null:L(t)).attr("stroke",n.planetPie.stroke).attr("stroke-width",n.planetPie.strokeWidth).style("fill",t=>t.data.__measure<=n.exceptValue?n.planetPie.exceptColor:n.planetPie.inheritedColor&&t.data.accNm===n.planetPie.dimNms[1]?k(e):C(t.data.accNm)),l.selectAll("text").data(M(t.data.children)).enter().append("text").attr("dy",n.planetPie.dyLabel).attr("font-family",n.planetPie.fonts[0]).attr("font-size",n.planetPie.fonts[1]).attr("text-anchor","middle").attr("pointer-events","none").style("fill",(t,e)=>{if(t.data.__measure<=n.exceptValue)return t.data.status===R[1]?a.getColorContrast(C(n.planetPie.dimNms[0])):a.getColorContrast(n.planetPie.exceptColor);let o;return o=n.planetPie.inheritedColor&&t.data.accNm===n.planetPie.dimNms[1]?k(e):C(t.data.accNm),a.getColorContrast(o)}).text(t=>t.data.status?t.data.status:t.data.accNm+": "+d3.format(n.planetPie.format[1])(t.data.__measure)).attr("transform",t=>"translate("+L.centroid(t)+")"),a.isIE()?l.attr("transform",()=>"scale(1) translate("+v(t)+")"):l.attr("opacity",0).attr("transform","scale(0)").transition().duration(1.5*n.duration).delay((t,e)=>e*n.delay).ease(a.ease.exp).attr("opacity",1).attr("transform",()=>"scale(1) translate("+v(t)+")")})(t,e)).on("end",()=>p())}function j(){s=n.data.filter(t=>n.mainPie.bPlan?t.__plan>1e-7:t.__result>1e-7)}function Z(){const t=[];return s.forEach(e=>{n.measures.forEach(a=>{const o={};o[n.account.colNm]=e[n.account.colNm]+","+a.groupByDim+","+a.caption,o.groupBy=a.groupByDim+","+a.caption,o.caption=a.caption,n.planetPie.dimNms[0]===a.groupByDim?(o.__plan=e[a.colNm],o.__plan_ratio=0===e.__plan?0:e[a.colNm]/e.__plan):(o.__result=e[a.colNm],o.__result_ratio=0===e.__result?0:e[a.colNm]/e.__result),t.push(o)})}),t}function Q(t){t.innerRadius=0;const e=d3.interpolate({startAngle:0,endAngle:0},t);return t=>N(e(t))}function K(t,e){e._current=e._current||t;const a=d3.interpolate(e._current,t);return e._current=a(0),t=>N(a(t))}function J(t){t.innerRadius=0;const e=d3.interpolate({startAngle:0,endAngle:0},t);return t=>A(e(t))}function tt(t,e){e._current=e._current||t;const a=d3.interpolate(e._current,t);return e._current=a(0),t=>A(a(t))}function et(){n.mainPie.halfCircle?(S.startAngle(Math.PI/180*-90).endAngle(Math.PI/180*90),T.startAngle(Math.PI/180*-90).endAngle(Math.PI/180*90)):(S.startAngle(0).endAngle(Math.PI/180*360),T.startAngle(0).endAngle(Math.PI/180*360))}function at(){n.planetPie.halfCircle?M.startAngle(Math.PI/180*-90).endAngle(Math.PI/180*90):M.startAngle(0).endAngle(Math.PI/180*360)}function ot(){p=n.height,v=Math.min(_,p)/(n.fullSize?2:4),v-=(n.margin.top+n.margin.bottom+n.mainPie.padding)/(n.fullSize?1:2),n.mainPie.sub&&n.mainPie.sub.draw&&(v-=n.planetPie.draw?-b/2:b),w.outerRadius(v).innerRadius(v/2),I=v*n.mainPie.inRadius,N.outerRadius(v).innerRadius(I),A.outerRadius(v+b).innerRadius(v+1),F=.5*v-b-n.mainPie.padding,D.range([10,F]),a.renderTitle(n,r,_,rt,lt,it)}function nt(){const t=n.tooltip;(c=n.method.mousemove&&t&&void 0!==t.id?d3.select(t.id):void 0)&&!c.empty()&&("object"!=typeof t.fixedPos?t.fixedPos=void 0:c.style("pointer-events","all").style("cursor","move").call(q),t.infoLevel=t.infoLevel?t.infoLevel<0||t.infoLevel>3?0:t.infoLevel:0,t.opacity=t.opacity?t.opacity:.7,t.isShow=void 0!==t.isShow&&t.isShow)}function rt(){return n.margin.left}function lt(){return _-n.margin.right}function it(){return n.height-n.margin.bottom}et(),at(),o.render=function(){if(r||(_=parseInt(d3.select(t).style("width"),10),n.height=parseInt(_/n.aspect),m=n.height/2+n.margin.top,r=d3.select(t).call(q).append("svg").attr("width",_).attr("height",n.height).style("background",n.theme?n.theme:null),ot(),c2i.lang))return U(),o},o.title=function(t){return arguments.length?(n.title=t,a.setTitle(n),o):n.title},o.tooltip=function(t){return arguments.length?(n.tooltip=t,nt(),o):n.tooltip},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(e){return arguments.length?(i=e,n.data=a.deepClone(i),n.data.forEach((t,e)=>{t.__id=e,t.__pos=1,t.__plan=0,t.__result=0;const a=n.planetPie;a.dimNms.forEach((e,a)=>{n.measures.forEach(o=>{t[o.colNm]=+t[o.colNm],e===o.groupByDim&&(0===a?(t.__plan+=t[o.colNm],B+=t[o.colNm]):(t.__result+=t[o.colNm],E+=t[o.colNm]))})}),0===t.__plan?(t.__plan=d3.min([t.__result/1e3,1e-7]),t.status0=R[0],t.status1="-"):t.__result>t.__plan?t.status0=R[2]+": "+d3.format(a.format[0])(t.__result-t.__plan):0===t.__result&&(t.status1=R[1]),t.children=[{accNm:a.dimNms[1],__measure:t.__result/t.__plan,value:t.__result,status:t.status1},{accNm:a.dimNms[0],__measure:(t.__plan-t.__result)/t.__plan,value:t.__plan,status:t.status0}]}),n.data.__plan_sum=B,n.data.__result_sum=E,a.setTheme(n,t,!1),a.setTitle(n),nt(),n.isDev&&a.devMode(n),o):n.data},o.getConfig=(()=>(n.c2iCon=t,n)),o.toggleFullSize=(()=>(n.fullSize=!n.fullSize,n.planetPie.draw=!n.fullSize,ot(),U(),o)),o.togglePlanResult=(()=>(n.mainPie.bPlan=!n.mainPie.bPlan,ot(),U(),o)),o.toggleSameSize=(()=>(n.mainPie.bSameSize=!n.mainPie.bSameSize,ot(),U(),o)),o.toggleSameRadius=(()=>(n.planetPie.sameRadius=!n.planetPie.sameRadius,U(),o)),o.toggleMainPieHalfCircle=(()=>(n.mainPie.halfCircle=!n.mainPie.halfCircle,et(),U(),o)),o.togglePlanetPieHalfCircle=(()=>(n.planetPie.halfCircle=!n.planetPie.halfCircle,at(),U(),o)),o.exportData=((t,e)=>{const o=n.title&&n.title.caption?n.title.caption:"",r=[],l=[];e||(r.push(n.keyCol+","),l.push(n.keyCol+","),n.measures.forEach(t=>{t.caption.search(/["|,|\n]/g)>=0?l.push('"'+t.caption+'",'):l.push(t.caption+","),r.push(t.colNm+",")})),a.exportData(o,r,l,i,t)}),o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),x=c2i.lang,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,function(){r&&parseInt(d3.select(t).style("width"),10)&&(_=parseInt(d3.select(t).style("width"),10),n.height=parseInt(_/n.aspect),m=n.height/2+n.margin.top,r&&(r.attr("width",_).attr("height",n.height),l.attr("transform","translate("+_/2+","+m+")")),ot(),U())},null),a.createAccessor(o,n)},c2i.infoG.calView=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;let o={};const n={isResponsive:!1,width:"100%",margin:{top:30,left:30,right:30,bottom:30},aspectRatio:"1:1",easing:"linear",duration:250,delay:20,data:void 0,title:void 0,formats:["%Y-%m-%d","%Y-%m","%Y"],byYear:{caption:"",formatNm:"",dy:20,fonts:["Roboto","14px","#faff35"],sort:"",sortBy:"",height:50,draw:!0},byMon:{caption:"",formatNm:"",dy:10,siblingGap:0,fonts:["Roboto","12px","#eeeeee"],lineChart:{height:40,stroke:"#e7e5e5",strokeWidth:3,opacity:.9,draw:!0},dotCircle:{radius:6,stroke:"#474747",strokeWidth:4,fill:"orange",fillText:["red","grey","11px"],opacity:1,draw:!0}},node:{caption:"",cellSize:12,radius:0,color:"20c",stroke:"#ccc",fillEmpty:"#4a4a4a",opacity:.75},measures:void 0,legend:void 0,tooltip:void 0,isDev:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t),l=t=>t.key,i=d3.timeFormat("%w"),s=(d3.timeFormat("%e"),d3.timeFormat("%j"),d3.timeFormat("%U")),c=d3.timeFormat("%m"),d=d3.scaleLinear(),u=(t,e)=>d3.timeDays(new Date(t,0,1),new Date(e+1,0,1));let m,p,g,f,h,y,_,x=a.computeDim(r,n),v=c2i.lang,b=[],k=[],C=(d3.format(",.0f"),d3.scaleQuantize());const w=d3.timeFormat(n.formats[0]),N=d3.timeFormat(n.formats[1]),A=d3.timeFormat(n.formats[2]);let L,D,S,T,M,F,I,B,E,G,P,O=750,R=0,V=0;const W=t=>d3.line().defined(t=>void 0===h.sparseVal||t[h.colNm]!==h.sparseVal).curve(a.curve[n.easing]).x((t,e)=>{const a=n.byMon.siblingGap*t.__seq;return e*D+a+D/2}).y(t=>d(t[h.colNm]))(t);let Y=d3.select("#tooltipCal");function z(t,e){let a="",o=0;n.data.some(e=>{if(A(t)===e.key)return a=e[h.colNm],e.values.forEach(t=>{t.values.forEach(t=>{void 0!==t[h.colNm]&&o++})}),!0});const r=d3.format(h.format);let l=A(t)+n.byYear.formatNm+": "+r(a);if(l+=" (일수: "+o,l+=", 일 평균: "+r(a/o)+")",!M)return l;let i=e?e+n.byYear.formatNm+" ":"";i+="monthAgg"===F?n.byMon.formatNm+" "+h.caption:n.byMon.caption;const s=v.gen;return l+": "+i+" "+s.by+" "+("desc"===M?s.desc:s.asc)}function H(){return"translate("+[0,7*L]+")"}function $(t,e,o,r){t&&t.stopPropagation();const i=(t,e)=>e/12*n.duration;if(o?(S=""===S?"desc":"desc"===S?"asc":"",X(e),s()):(e&&(M=""===M?"desc":"desc"===M?"asc":"",function(t){"month"===(F=t)?n.data=n.data.map(t=>(t.values.sort("desc"===M?(t,e)=>new Date(e.key)===new Date(t.key)?d3.descending(t.__id,e.__id):new Date(e.key)-new Date(t.key):"asc"===M?(t,e)=>new Date(e.key)===new Date(t.key)?d3.ascending(t.__id,e.__id):new Date(t.key)-new Date(e.key):(t,e)=>d3.ascending(t.__id,e.__id)).forEach((t,e)=>{t.__seq=e}),t)):"monthAgg"===F&&function(){const t=h.colNm;n.data=n.data.map(e=>(e.values.sort("desc"===M?(e,a)=>a[t]===e[t]?d3.descending(e.__id,a.__id):a[t]-e[t]:"asc"===M?(e,a)=>a[t]===e[t]?d3.ascending(e.__id,a.__id):e[t]-a[t]:(t,e)=>d3.ascending(t.__id,e.__id)).forEach((t,e)=>{t.__seq=e}),e))}()}(e)),s(),function(){B.text(t=>("",z(new Date(t.key),""))),E.selectAll(".monthLine").attr("transform",H).attr("d",t=>W(t.values)).each(function(){a.pathShow({sel:d3.select(this),dr:n.duration,dashLen:0})}),E.selectAll(".circles").attr("transform",H),E.selectAll(".monthDot").data(t=>t.values,l).transition().duration(n.duration).delay(i).attr("cx",(t,e)=>{const a=n.byMon.siblingGap*t.__seq;return e*D+a+D/2}).attr("cy",t=>d(t[h.colNm]));const t=n.byMon.lineChart;if(t&&t.draw){let t=d.range();t=(t[0]-t[1])/2,E.selectAll(".monthValue").data(t=>t.values,l).transition().duration(n.duration).delay(i).attr("x",(t,e)=>{const a=n.byMon.siblingGap*t.__seq;return e*D+a+D/2}).attr("y",e=>{const a=d(e[h.colNm]);return a>t?a-10:a+20})}}()),n.title&&n.title.subCaption){const t=v.gen,e="yearAgg"===T?n.byYear.formatNm+" "+h.caption:n.byYear.caption;let a,o=n.title.subCaption;"desc"===S?(o+=": "+e+" "+t.by+" "+t.desc,a=n.title.subFonts[3]):"asc"===S?(o+=": "+e+" "+t.by+" "+t.asc,a=n.title.subFonts[3]):a=n.title.subFonts[2],m.select(".subtitle").style("fill",a).text(o)}function s(){I=m.selectAll(".gGroupBy").data(n.data,l).transition().duration(n.duration).delay(i).attr("transform",(t,e)=>"translate("+[Q(),e*O]+")"),(G=E.selectAll("g").data(t=>t.values,l)).transition().duration(n.duration).delay(i).attr("transform",(t,e)=>{const a=n.byMon.siblingGap*t.__seq;return"translate("+[e*D+a,0]+")"})}}function X(t){"year"===(T=t)?n.data=n.data.sort("desc"===S?(t,e)=>new Date(e.key)===new Date(t.key)?d3.descending(t.__id,e.__id):new Date(e.key)-new Date(t.key):"asc"===S?(t,e)=>new Date(e.key)===new Date(t.key)?d3.ascending(t.__id,e.__id):new Date(t.key)-new Date(e.key):(t,e)=>d3.ascending(t.__id,e.__id)):"yearAgg"===T&&function(){const t=h.colNm;n.data=n.data.sort("desc"===S?(e,a)=>a[t]===e[t]?d3.descending(e.__id,a.__id):a[t]-e[t]:"asc"===S?(e,a)=>a[t]===e[t]?d3.ascending(e.__id,a.__id):e[t]-a[t]:(t,e)=>d3.ascending(t.__id,e.__id))}()}function q(t,e){const a=(x-n.margin.left-n.margin.right-11*t.siblingGap)/12/7;D=7*(L=a),O=R+7*L+V+n.margin.bottom,n.height=O*n.data.length+(n.title?n.margin.top:0)}function U(){const t=n.byYear;R=isNaN(t.height)||!t.draw?30:t.height}function j(){const t=n.byMon.lineChart;V=isNaN(t.height)||!t.draw?20:t.height,d.range([V,0])}function Z(){C.range(a.getColorScheme(n.node.color))}function Q(){return n.margin.left}function K(){return x-n.margin.right}function J(){return n.height-n.margin.bottom}Y.empty()&&(Y=d3.select("body").append("div").attr("id","tooltipCal").attr("class","c2iTooltip c2iHidden")),U(),j(),o.render=function(){return q(n.byMon,n.node),m||(n.aspect=x/O,m=d3.select(t).append("svg").attr("width",x).attr("height",n.height+5).attr("class","c2iCalView").style("background",n.theme?n.theme:null),a.renderTitle(n,m,x,Q,K,J)),S="",T="",M="",F="",function(){p||(p=m.append("g").attr("class","body").attr("transform","translate("+Q()+","+n.margin.top+")"));const e=n.byMon,o=n.node;(I=p.selectAll(".gGroupBy").data(n.data,l)).exit().transition().style("opacity",0).remove();const r=I.enter().append("g").attr("class","gGroupBy").attr("transform",(t,e)=>"translate("+[Q(),e*O]+")");function u(t,e,a,o,n){if(t.preventDefault(),t.stopPropagation(),e.__start){e.__end=new Date;const o=e.__end-e.__start;if(e.__start=void 0,!o||o>500)return!0;$(t,a,null,n)}else e.__start=new Date}function g(t,e){let a,o,r,l=!1;if(n.data.some(t=>{if(t.key==A(new Date(e[n.groupBy]))||t.key==A(new Date(e.key)))return void 0!==e[h.colNm]&&(a=t),!0}),void 0!==e[n.groupBy]?(o=e[n.groupBy],r=new Date(o).getMonth(),l=!0):(o=y(new Date(e.key)),r=new Date(e.key).getMonth()),a){if(!a.values[r]&&(r=a.values.findIndex(t=>t.key.indexOf(r+1)>-1),!a.values[r]))return;let t=a.values[r][h.colNm],n=a[h.colNm];const i=d3.format(h.format),s=void 0!==e[h.colNm]?e[h.colNm]:0;if(n=0===n?0:d3.format(",.1%")(s/n),o+=": "+h.caption+" "+i(s),l)t=0===t?0:d3.format(",.1%")(s/t),o+="<br/> (월: "+t+", 년: "+n+")";else{let a=0;e.values.forEach(function(t){t[h.colNm]&&a++}),n+=", 일수: "+a,n+=", 일 평균: "+i(t/a),o+="<br/> (년: "+n+")"}}Y.html(o).style("color","yellow").style("left",t.pageX+10+"px").style("top",t.pageY+10+"px")}function f(){Y.classed("c2iHidden",!0)}function y(t){return c(t)+n.byMon.formatNm}(function(){if(!n.byYear||!n.byYear.draw)return;const a=n.byYear.fonts;B=r.append("text").on("touchstart",function(t){u(t,this,t?"yearAgg":"year",!0)}).on("dblclick",t=>{$(t,t?"yearAgg":"year",!0)}).on("click",(e,a)=>{n.method.click&&n.method.click(e,{container:t,selector:"yearly"},a)}).on("mouseenter",(e,a)=>{n.method.mouseenter&&n.method.mouseenter(e,{container:t,selector:"yearly"},a)}).on("mouseleave",(e,a)=>{n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"yearly"},a)}).attr("class","gYear").text(t=>z(new Date(t.key))).attr("x",6*D+11*e.siblingGap/2).attr("y",n.byYear.dy).style("font-family",a[0]).style("font-size",a[1]).style("fill",a[2]).style("text-decoration","underline").style("text-anchor","middle")})(),E=r.append("g").attr("class","gMonth").attr("transform","translate(0,"+n.byYear.height+")"),function(){const e=n.byMon.lineChart;e&&e.draw&&E.append("path").attr("class","monthLine").style("pointer-events","none").style("stroke",e.stroke).style("stroke-width",e.strokeWidth+"px").style("stroke-opacity",e.opacity).attr("transform",H).attr("d",t=>W(t.values)).attr("fill","none").each(function(){a.pathShow({sel:d3.select(this),dr:n.duration,dashLen:0})});const o=n.byMon.dotCircle;if(o&&o.draw){const t=E.append("g").on("touchstart",function(t,e){u(t,this,"monthAgg",null,e.key)}).on("dblclick",(t,e)=>$(t,"monthAgg",null,e.key)).attr("class","circles").attr("transform",H).selectAll(".monthDot").data(t=>t.values,l);t.enter().append("circle").attr("class","monthDot").attr("r",t=>void 0!==h.sparseVal?t[h.colNm]!==h.sparseVal?o.radius:0:o.radius).style("fill-opacity",o.opacity).style("fill",o.fill).style("stroke",o.stroke).style("stroke-width",o.strokeWidth+"px").style("stroke-opacity",o.opacity).attr("cx",(t,e)=>{const a=n.byMon.siblingGap*t.__seq;return e*D+a+D/2}).attr("cy",t=>d(t[h.colNm]))}if(e&&e.draw){const e=n.byMon.fonts,a=E.append("g").on("touchstart",function(t,e){u(t,this,"monthAgg",null,e.key)}).on("dblclick",(t,e)=>$(t,"monthAgg",null,e.key)).attr("class","monthValues").attr("transform",H).selectAll(".monthValue").data(t=>t.values,l);let o=d.range();o=(o[0]-o[1])/2;const r=n.byMon.dotCircle.fillText;a.enter().append("text").on("click",(e,a)=>{n.method.click&&n.method.click(e,{container:t,selector:"monthly"},a)}).on("mouseenter",(e,a)=>{Y.classed("c2iHidden",!1).style("opacity",.8),n.method.mouseenter&&n.method.mouseenter(e,{container:t,selector:"monthly"},a)}).on("mouseleave",(e,a)=>{f(),n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"monthly"},a)}).on("mouseover",g).text(t=>{const e=new Date(t.key).getFullYear(),a=t[h.colNm];let o="";return n.data.some(t=>{if(t.key==e)return o=0===(o=t[h.colNm])?0:d3.format(",.1%")(a/o),!0}),d3.format(h.format)(t[h.colNm])+" ("+o+")"}).attr("class","monthValue").attr("x",(t,e)=>{const a=n.byMon.siblingGap*t.__seq;return e*D+a+D/2}).attr("y",t=>{const e=d(t[h.colNm]);return e>o?e-10:e+20}).style("font-family",e[0]).style("font-size",r[2]).style("fill",t=>{const e=d(t[h.colNm]);return r[o>e?1:0]}).style("display",t=>t[h.colNm]?null:"none").style("text-anchor","middle")}}(),E=E.merge(I.select("g.gMonth")),G=E.selectAll("g").data(t=>t.values,l),function(){const a=G.enter().append("g").on("touchstart",function(t,e){u(t,this,"monthAgg",null,e.key)}).on("dblclick",(t,e)=>{const a=A(new Date(e.key));$(t,"monthAgg",null,a)}).attr("class",t=>"m"+(new Date(t.key).getMonth()+1)).attr("transform",(t,a)=>{const o=e.siblingGap*t.__seq;return"translate("+[a*D+o,0]+")"});G=a.merge(G),function(){const e=n.byMon.fonts;G.append("text").on("touchstart",function(t){u(t,this,"month")}).on("dblclick",(t,e)=>$(t,"month")).on("click",(e,a)=>{n.method.click&&n.method.click(e,{container:t,selector:"monthly"},a)}).on("mouseenter",(e,a)=>{let o=new Date(a.key).getMonth()+1;o="m"+o,d3.selectAll(".gGroupBy ."+o).classed("sameMonth",!0),n.method.mouseenter&&n.method.mouseenter(e,{container:t,selector:"monthly"},a),a.isValid&&Y.classed("c2iHidden",!1).style("opacity",.8)}).on("mouseleave",(e,a)=>{let o=new Date(a.key).getMonth()+1;o="m"+o,d3.selectAll(".gGroupBy ."+o).classed("sameMonth",!1),f(),n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"monthly"},a)}).on("mouseover",g).text(t=>{let e=y(new Date(t.key));if(t.isValid){let a=0;t.values.forEach(t=>{t[h.colNm]&&a++}),e+="("+a+"일)"}return e}).attr("class","monthNm").style("font-family",e[0]).style("font-size",e[1]).style("fill",e[2]).style("text-anchor","middle").attr("transform","translate("+[(D+n.byMon.siblingGap)/2,-n.byMon.dy]+")");const a=n.byMon.lineChart;a&&!a.draw&&G.append("text").on("click",(e,a)=>{n.method.click&&n.method.click(e,{container:t,selector:"monthly"},a)}).on("mouseenter",(e,a)=>{Y.classed("c2iHidden",!1).style("opacity",.8),n.method.mouseenter&&n.method.mouseenter(e,{container:t,selector:"monthly"},a)}).on("mouseleave",(e,a)=>{f(),n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"monthly"},a)}).on("mouseover",g).text(t=>d3.format(h.format)(t[h.colNm])).attr("class","monthValue").style("font-family",e[0]).style("font-size",e[1]).style("fill",h.color).style("display",t=>t[h.colNm]?null:"none").style("text-anchor","middle").attr("transform",()=>"translate("+[(D+n.byMon.siblingGap)/2,D+n.byMon.dy]+")")}(),function(){const e=isNaN(o.radius)?null:o.radius;(P=(P=G.selectAll("rect").data(t=>t.values)).enter().append("rect").on("click",(e,a)=>{n.method.click&&a[h.colNm]&&n.method.click({container:t,selector:"daily"},a)}).on("mouseenter",function(e,a){Y.classed("c2iHidden",!1).style("opacity",.8),d3.select(this).style("stroke","yellow").style("stroke-width",3);const o={name:a[n.groupBy],value:a[h.colNm]};n.method.mouseenter&&n.method.mouseenter(e,{container:t,selector:"daily"},o)}).on("mouseleave",function(e,a){d3.select(this).style("stroke",null).style("stroke-width",1),f(),n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"daily"},a)}).on("mouseover",g).attr("class",t=>"cell c_"+t[n.groupBy]).attr("stroke",o.stroke).attr("width",L).attr("height",L).attr("rx",e).attr("ry",e).style("fill",n.theme).style("shape-rendering","crispEdges").style("fill-opacity",.7).attr("y",0).attr("x",t=>{const e=new Date(t[n.groupBy]);return i(e)*L}).merge(P).style("fill",t=>void 0!==t[h.colNm]?C(t[h.colNm]):o.fillEmpty)).transition().duration(n.duration).delay((t,e)=>e*n.delay).attr("y",t=>{const e=new Date(t[n.groupBy]),a=s(e)-s(new Date(A(e),c(e)-1,1));return a*L})}()}()}(),o},o.byYear=function(t){return arguments.length?(n.byYear=t,U(),o):n.byYear},o.byMon=function(t){return arguments.length?(n.byMon=t,j(),o):n.byMon},o.node=function(t){return arguments.length?(n.node=t,Z(),o):n.node},o.measures=function(t){return arguments.length?(n.measures=t,o):n.measures},o.data=function(t){return arguments.length?(g=t,function(){U(),j(),Z(),h=void 0,b=[],k=[],n.measures.forEach(t=>{"function"==typeof t.fn?k.push({colNm:t.colNm,fn:t.fn}):b.push(t.colNm),t.isSelected&&(h=t)}),h||(h=n.measures[0]),g.forEach(t=>{k.forEach(e=>{t[e.colNm]=e.fn(t)})});let t=function(){_=d3.extent(g,t=>(t[n.groupBy]=t[n.groupBy].replace(/\./g,"-"),t[h.colNm])),C.domain(_),y=d3.extent(g,t=>t[n.groupBy]);const t=new Date(y[0]).getFullYear(),e=new Date(y[1]).getFullYear();return u(t,e)}();t=t.map(t=>{let e={};return e[n.groupBy]=w(t),g.some(t=>{if(t[n.groupBy]===e[n.groupBy])return e=t,!0}),e}),n.data=d3.nest().key(t=>N(new Date(t[n.groupBy]))).entries(t),n.data=d3.nest().key(function(t){return n.measures.forEach(e=>t[e.colNm]=0),t.values.forEach(e=>{b.forEach(a=>{void 0!==e[a]&&(t[a]+=e[a],t.isValid=!0)})}),k.forEach(e=>{const a=e.fn(t);t[e.colNm]=isNaN(a)?0:a}),A(new Date(t.key))}).entries(n.data),y=[],n.data=n.data.map((t,e)=>{n.measures.forEach(e=>t[e.colNm]=0),t.values.forEach((e,a)=>{b.forEach(a=>{void 0!==e[a]&&(t[a]+=e[a])}),e.__seq=a,e.__id=a}),k.forEach(e=>{const a=e.fn(t);t[e.colNm]=isNaN(a)?0:a}),t.__id=e;const a=d3.extent(t.values.filter(t=>t.isValid),t=>t[h.colNm]);return y.push(a[0]),y.push(a[1]),t}),y=d3.extent(y),d.domain(y),S=n.byYear.sort,X(n.byYear.sortBy)}(),o):g},o.clear=function(){return m&&(m.remove(),m=p=void 0),o},o.setColors=function(t,e){const a=h;a&&(C=e.copy(),e&&P.style("fill",t=>void 0!==t[a.colNm]&&e?e(t[a.colNm]):n.node.fillEmpty))},o.getExtent=function(t){let e;return e=_},o.selectNodes=function(t,e){if(t){let a;const o=h.colNm;t.selector.indexOf("first_")>-1&&(a=P.filter(function(t){return e[0]<=t[o]&&t[o]<=e[1]})),a&&(P.style("opacity",.2),a.style("opacity",1))}else P.style("opacity",null)},o.getInfo=(()=>({container:t,type:"calView",cm:{colNm:h.colNm,caption:h.caption,format:h.format,unitNm:h.unitNm}})),o.exportData=((t,e)=>{const o=n.title&&n.title.caption?n.title.caption:"",r=[],l=[];let i;e||(r.push(n.groupBy+","),(i=n.byYear.caption?n.byYear.caption:n.groupBy).search(/["|,|\n]/g)>=0?l.push('"'+i+'",'):l.push(i+","),n.measures.forEach(t=>{t.caption.search(/["|,|\n]/g)>=0?l.push('"'+t.caption+'",'):l.push(t.caption+","),r.push(t.colNm+",")})),a.exportData(o,r,l,g,t)}),o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),v=c2i.lang,f=void 0,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,function(){if(d3.select(t).empty())return;n.nonComponent?x=d3.select(t).node().parentNode.clientWidth:(x=parseInt(d3.select(t).style("width"),10),n.height=parseInt(x/n.aspect));const e=n.byMon;n.node,q(e);let o=x/O/n.aspect;o>1&&(o=1),d.range([V*o,0]),m&&(m.attr("width",x).attr("height",n.height+5),a.renderTitle(n,m,x,Q,K,J),$()),B.attr("x",6*D+11*e.siblingGap/2),G.attr("transform",function(t,a){const o=e.siblingGap*t.__seq;return"translate("+[a*D+o,0]+")"}),G.selectAll(".monthNm").attr("transform","translate("+[(D+n.byMon.siblingGap)/2,-n.byMon.dy]+")");const r=e.lineChart;r&&(r.draw?E.selectAll(".monthValues").attr("transform",H):G.selectAll(".monthValue").attr("transform","translate("+[(D+e.siblingGap)/2,D+e.dy]+")")),P.attr("width",L).attr("height",L).attr("x",t=>{const e=new Date(t[n.groupBy]);return i(e)*L}).attr("y",t=>{const e=new Date(t[n.groupBy]);return(s(e)-s(new Date(A(e),c(e)-1,1)))*L})},null),a.createAccessor(o,n)},c2i.infoG.std3D=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return;const o={},n={isResponsive:!0,width:0,height:0,theme:"#474747",margin:{top:20,left:0,right:30,bottom:25},easing:"linear",duration:1200,delay:100,data:void 0,preBuildData:!0,rawStructure:void 0,positionData:void 0,title:void 0,xDim:void 0,yDim:void 0,fonts:["Roboto","24px","#333333"],measures:void 0,camera:{fov:40,near:1,far:2e3,positionZ:3e3},geometry:{type:"sphere",autoChange:!1,easing:"back",changeInterval:5e3,curve:{cols:15,y:200},table:{cols:10,widthGap:10,heightGap:15,y:800},sphere:{radius:850},helix:{radius:1e3,rows:11,y:400},grid:{width:800,heightGap:20,rows:5,cols:5,zGap:250,y:400}},rotate:{direction:"stop",speed:.005},controllers:{rotateSpeed:1.5,minDistance:250,maxDistance:3e4,noRotate:!1,noZoom:!1,noPan:!1},node:{width:240,height:160,borderRadius:5,bColor:"#0c0c0c",opacity:.75},main:{group:{colNm:"name",fonts:["Roboto","12px","#7FFFFF"],opacity:.8},agg:{type:"sum",format:",0f",color:"20",fonts:["Roboto","30px","#faff35"],opacity:.9},info:{fn:void 0,fonts:["Roboto","8px","#fffdfd"],opacity:.8}},legend:void 0,tooltip:void 0,isDev:!0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=["stackbar","stackbar100","groupbar"],l=["stackarea","stackarea100","stackstream"],i=["stackOffsetNone","stackOffsetExpand","stackOffsetSilhouette"],s=d3.format(n.main.agg?n.main.agg.format:",.0f"),c=t=>t.key,d=(t,e)=>e.id-t.id,u=d3.stack();let m,p,g,f,h,y,_,x,v,b,k,C,w,N,A,L,D,S,T,M,F,I,B,E,G,P,O,R,V,W,Y,z,H,$,X,q,U,j=c2i.lang,Z=[],Q={curve:[],table:[],pattern:[],sphere:[],helix:[],grid:[]},K="init",J=!1;const tt=d3.drag().on("start",function(t){const e=t.sourceEvent;if(e.stopPropagation(),J=!1,e.srcElement.className.indexOf("slider")>-1)return void(J=!0);H=parseFloat(d3.select(this).style("left"))-e.pageX,$=parseFloat(d3.select(this).style("top"))-e.pageY}).on("drag",function(t){if(J)return;"c2iOption"===this.id&&d3.selectAll("#c2iOption").attr("class","c2iOption");const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",()=>e.pageX+H+"px").style("top",()=>e.pageY+$+"px")}).on("end",function(){if(J)return;d3.select(this).style("opacity","c2iOption"===this.id?n.optWin.opacity:n.tooltip.opacity)}),et=(t,e)=>e/k.length*n.delay,at=(t,e)=>d3.area().x(t=>v(t.data[n.xDim.colNm])+v.bandwidth()/2).y0(t=>b(t[0])).y1(t=>b(e?t[1]:t[0])).curve(a.curve[n.yDim.curve])(t);function ot(t,e){d3.selectAll(".series").style("opacity",.15),d3.selectAll(".series."+e.key).style("stroke","#ccc").style("opacity",1)}function nt(){d3.selectAll(".series").style("opacity",1).style("stroke","none")}function rt(){if((h=new THREE.PerspectiveCamera(n.camera.fov,window.innerWidth/window.innerHeight,n.camera.near,n.camera.far)).position.z=n.camera.positionZ,y=new THREE.Scene,n.node.isHtml){d();const t=n.main,e=t.group,a=e.scaleBy;N.style("background",function(e){return _t(this,e[t.body.scaleBy],t.body.scaleBy)}),N.append("div").attr("class","c2iKey").style("font-family",e.fonts[0]).style("font-size",e.fonts[1]).style("color",e.fonts[2]).style("opacity",e.opacity).style("background",function(t){return a?yt(this,t[a],a):null}).html(t=>t[e.colNm]);const o=n.measures.filter(t=>"Count"!==t.aggSQL&&"image"!==t.dataType).length-1,r=d3.format(",d");let l=0;n.measures.forEach(function(t){t.draw&&("image"===t.dataType?N.append("img").attr("class","c2iImages "+t.classNm).attr("src",e=>n.imgFolder?n.imgFolder+e[t.colNm]:e[t.colNm]):(N.append("div").attr("class",o===l?t.classNm+" c2iLastItem":t.classNm).style("top","c2iKeyCount"!==t.classNm?60+31*l+"px":null).style("font-size","c2iKeyCount"!==t.classNm?n.fonts[1]:null).style("font-family",n.fonts[0]).style("color",n.fonts[2]).html(e=>"uri"==t.dataType?"<a href="+e[t.colNm]+" target='_blank'>"+t.caption+"</a>":"c2iKeyCount"==t.classNm?"# "+r(e[t.colNm]):e[t.colNm]),l++))})}else!function(){d();const t=n.node,e=n.yDim,o=n.margin,s=t.height;g=[t.width-o.left-o.right,s-o.top-o.bottom],v=d3.scaleBand().domain(O).rangeRound([0,g[0]]).padding(n.xDim.xPad[0],n.xDim.xPad[1]),b=d3.scaleLinear().domain([0,1.1*("groupbar"===e.cluster?W:R[1])]).rangeRound([g[1],0]),e.cluster.indexOf("100")>0&&b.domain([0,1]);const m=d3.axisBottom().scale(v).tickSize(0);D=d3.axisLeft().ticks("stackstream"===e.cluster?0:e.ticks).tickSize(0).scale(b),M=d3.scaleOrdinal().domain(k).range(a.getColorScheme(e.color)),N.append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("class","gContent").attr("transform","translate("+o.left+","+o.top+")"),function(){F="stackOffsetNone",I="stackOrderNone",b.domain([0,1.1*R[1]]);let t,a=l.indexOf(e.cluster);a>-1?(F=i[a],"stackstream"===e.cluster&&(I="stackOrderInsideOut",b.domain([-1*R[1],R[1]]))):"groupbar"!==e.cluster&&(a=r.indexOf(e.cluster))>-1&&(F=i[a]),"groupbar"===e.cluster?t=N.select(".gContent").append("g").selectAll(".series").data(t=>dt(t.children),c):(u.keys(k).value((t,e)=>t[e]).offset(d3[F]).order(d3[I]),t=N.select(".gContent").append("g").selectAll(".series").data(t=>u(t.children),c)),e.cluster.indexOf("stackarea")>-1||e.cluster.indexOf("stream")>0?vt(t):e.cluster.indexOf("stack")>-1?bt(t):kt(t)}(),n.legend&&n.legend.draw&&function(){const t=n.legend;N.select(".gContent").append("g").attr("class","legend").attr("transform","translate("+[t.margin.left,t.margin.top]+")").selectAll(".lgItem").data((e=n.measures.map(t=>({caption:t.caption,colNm:t.colNm})),e.map(function(e,a){return{caption:e.caption,colNm:e.colNm,x:a%t.columns*t.colWidth,y:8*Math.floor(a/t.columns)}}))).enter().append("g").attr("class","lgItem").each(function(e,a){d3.select(this).append("rect").on("mouseenter",function(e,a){d3.select(this).attr("stroke",t=>M(t.colNm)).attr("stroke-width",t.size);const o=d3.select(this.parentNode.parentNode.parentNode);o.selectAll(".series").style("opacity",.1),o.selectAll("."+a.colNm).style("opacity",null).style("font-size","12px")}).on("mouseleave",function(t,e){d3.select(this).attr("stroke",null).attr("stroke-width",null);const a=d3.select(this.parentNode.parentNode.parentNode);a.selectAll(".series").style("opacity",null),a.selectAll("."+e.colNm).style("font-size",null)}).attr("class",t=>t.colNm).attr("rx",t.radius).attr("ry",t.radius).attr("x",t=>t.x).attr("y",t=>t.y).attr("width",t.size).attr("height",t.size).style("fill",t=>M(t.colNm)),d3.select(this).append("text").on("mouseenter",function(e,a){d3.select(this.parentNode).select("rect").attr("stroke",t=>M(t.colNm)).attr("stroke-width",t.size);const o=d3.select(this.parentNode.parentNode.parentNode);o.selectAll(".series").style("opacity",.1),o.selectAll("."+a.colNm).style("opacity",null),d3.select(this).style("font-size","12px")}).on("mouseleave",function(){d3.select(this.parentNode).select("rect").attr("stroke",null).attr("stroke-width",null),d3.select(this.parentNode.parentNode.parentNode).selectAll(".series").style("opacity",null),d3.select(this).style("font-size",null)}).attr("class","lgText").attr("x",e=>e.x+t.size+2).attr("y",e=>e.y+t.size).text(t=>t.caption)});var e}();N.select(".gContent").append("g").attr("class","x axis").attr("transform","translate(0,"+g[1]+")").call(m),N.select(".gContent").append("g").attr("class","y axis").call(D).append("text").attr("x",6).style("writing-mode",e.captionV?"tb":"").style("text-anchor","start").text(e.caption+e.unitNm),ft()}();N.each(st),_=new THREE.CSS3DRenderer,it(),_.domElement.style.position="absolute",n.theme&&(_.domElement.style.background=n.theme);const e=document.getElementById(t.substr(t.indexOf("#")+1));function d(){const e=n.node,o=n.main,r=o.group;function l(t,e){let a;return a=t.children?{name:t[r.colNm],value:t[o.agg.type],children:t.children}:{name:t[r.colNm],value:t,self:e}}N=d3.selectAll(".c2iNode").data(n.data,t=>t[r.colNm]).join("div").attr("class",t=>"c2iNode c"+t.__id).style("width",e.width+"px").style("height",e.height+"px").style("border-radius",e.borderRadius+"px").style("background",e.bColor).style("opacity",e.opacity).on("click",(t,e)=>{lt(e.__id)}).on("mouseenter",function(t,e){d3.select(this).classed("c2iNodeHover",!0),function(t,e){const o=n.tooltip;if(!Y||!o.isShow)return;Y.classed("c2iHidden",!1).style("opacity",o.opacity),o.isUserTip||function(){let l,i;if(a.initTooltip(Y),Y.select("#name").text(t[r.colNm]),i=t,!n.yDim)return;l=[n.yDim.caption,":",s(i[n.main.agg.type]),n.yDim.unitNm].join(" "),Y.select("#measure").html(l);const c=j.gen,d="<span data-c2i18n='gen.sum'>"+c.sum+"</span>: "+s(E.sum)+" ("+d3.format(",.1%")(i[n.main.agg.type]/E.sum)+"), "+c.count+": "+d3.format(",d")(E.count-1);Y.select("table").select("#ratio").empty()?Y.insert("p","hr").attr("id","ratio").classed("tipRatio",!0).html(d):Y.select("table").select("#ratio").classed("tipRatio",!0).html(d);o.infoLevel>0?function(t){Y.select("tbody").classed("c2iHidden",!1);const a=t,r=j.gen,l=[{name:"tipContent",cls:"tipName"},{name:"value",cls:"tipAll"},{name:"ratio",cls:"tipSeries"}],i=["tipHeader","number","number"],s=[],c=d3.format(".2%");k.forEach(function(t,o){const r={caption:C[o]};r[t]=0;for(let a=0;a<e.length;a++)r[t]+=e[a][t];r[t+"_ratio"]=c(r[t]/a[n.main.agg.type]),s.push(r)});let d,u,m=Y.select("table").select("tbody");if(m.empty()){const t=(m=Y.select("table").append("tbody")).append("tr"),e=t.selectAll("th").data(l);e.enter().append("th").attr("class",t=>t.cls).attr("data-c2i18n",t=>"gen."+t.name).text(function(t,e){return 1===e?n.yDim.caption:r[t.name]}),(d=m.selectAll(".measures").data(s)).enter().append("tr").attr("class","measures"),(u=d.selectAll("td").data(function(t){return Object.values(t,function(t){return t})})).enter().append("td").attr("class",function(t,e){return i[e]})}else d=m.selectAll(".measures").data(s),u=d.selectAll("td").data(function(t){return Object.values(t,function(t){return t})});u.html(t=>t),o.infoLevel;o.infoLevel}(t):Y.select("tbody").classed("c2iHidden",!0)}();const l=o.fixedPos;l&&void 0===z&&function(){const t=parseInt(Y.select("table").style("width")),e=parseInt(Y.select("table").style("height"));let a,o;a="middle"===l.xPos?(m-t)/2:"start"===l.xPos?n.margin.left:m-n.margin.right-t,o="middle"===l.yPos?(n.height-e)/2:"top"===l.yPos?n.margin.top:p-e,Y.select(".c2iCloseBtn").classed("c2iHidden",!1).on("touchstart",function(){Y.classed("c2iHidden",!0)}).on("click",function(){Y.classed("c2iHidden",!0)}),a<5&&(a=5);o<5&&(o=5);Y.style("left",a+"px").style("top",o+"px"),z=!1}()}(e,e.children),n.method.mouseenter&&n.method.mouseenter(t,{container:"c2iCon",selector:"3dStdInfo"},l(e,this))}).on("mousemove",function(e,a){n.method.mouseenter&&function(e,a,o){const r=n.tooltip;if(!Y||!r.isShow)return;r.isUserTip&&n.method.mousemove&&n.method.mousemove(e,{container:t,selector:o},a);if(r.fixedPos)return;const l=parseInt(Y.select("table").style("width")),i=parseInt(Y.select("table").style("height"));let s,c;s=parseInt(e.pageX-l/2),c=e.pageY+15,s>m-l&&(s-=l/2);c>p-i&&(c-=i+35);s<0&&(s=0);c<0&&(c=0);Y.style("left",s+"px").style("top",c+"px")}(e,l(a,this),"3dStdInfo")}).on("mouseleave",function(e,a){d3.select(this).classed("c2iNodeHover",!1),Y&&n.tooltip.isShow&&!n.tooltip.fixedPos&&Y.classed("c2iHidden",!0),n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"3dStdInfo"},l(a,this))}),e.isHtml||(N.append("div").attr("class","gTitle").style("font-family",r.fonts[0]).style("font-size",r.fonts[1]).style("color",r.fonts[2]).style("opacity",r.opacity).html(function(t){return t[r.colNm]}),o.agg&&o.agg.type&&N.append("div").attr("class","mainMeasure").style("font-family",o.agg.fonts[0]).style("font-size",o.agg.fonts[1]).style("color",o.agg.fonts[2]).style("opacity",o.agg.opacity).html(function(t){return`${s(t[o.agg.type])}<span class="rank">(${d3.format(",d")(t.rank)} ${j.gen.rank})</span>`}),o.info&&o.info.fn&&"function"==typeof o.info.fn&&N.append("div").attr("class","mainDesc").style("font-family",o.info.fonts[0]).style("font-size",o.info.fonts[1]).style("color",o.info.fonts[2]).style("opacity",o.info.opacity).html(o.info.fn))}e.addEventListener("dblclick",mt),e.appendChild(_.domElement),(x=new THREE.TrackballControls(h,_.domElement)).rotateSpeed=n.controllers.rotateSpeed,x.minDistance=n.controllers.minDistance,x.maxDistance=n.controllers.maxDistance,x.noRotate=n.controllers.noRotate,x.noZoom=n.controllers.noZoom,x.noPan=n.controllers.noPan,x.addEventListener("change",ct),o.shapeChange(),n.isResponsive&&window.addEventListener("resize",function(){it(),ct()},!1),function t(){P=requestAnimationFrame(t);TWEEN.update();x.update();n.rotate.direction&&"stop"!==n.rotate.direction&&function(){const t=n.rotate,e=t.speed,a=h.position.x,o=(h.position.y,h.position.z);"left"===t.direction?(h.position.x=a*Math.cos(e)+o*Math.sin(e),h.position.z=o*Math.cos(e)-a*Math.sin(e)):(h.position.x=a*Math.cos(e)-o*Math.sin(e),h.position.z=o*Math.cos(e)+a*Math.sin(e));h.lookAt(y.position)}()}(),function(){if(!n.optWin)return;const t=n.optWin,e=n.rotate,r=n.geometry,l=n.controllers,i=n.node,s=n.tooltip,c=n.yDim;n.main;w=new function(){this.cluster=c?c.cluster:null,this.dataSort=K,this.tooltip=null,s&&(s.isShow?s.isUserTip?this.tooltip="user-defined":0===s.infoLevel?this.tooltip="default":s.infoLevel>0&&(this.tooltip="detail"):this.tooltip="hide",s.fixedPos&&(L=s.fixedPos,this.fixedPos=!0)),this.shapeType=r.type,this.patternText=!1,this.autoChange=r.autoChange,this.changeInterval=r.changeInterval?r.changeInterval:5e3,this.shapeEasing=r.easing,this.duration=n.duration,this.rotateDirection=e.direction,this.rotateSpeed=e.speed,this.nodeCircle=!!i.nodeCircle,this.noRotate=!l.noRotate,this.noZoom=!l.noZoom,this.noPan=!l.noPan,-1===n.theme.indexOf("gradient")?this.theme=n.theme:this.theme="#000000",this.bColor=i.bColor};const d=new dat.GUI({closeOnTop:!0,autoPlace:!0});let u=d3.select("#c2iOption");u.empty()||u.remove();u=d3.select("body").append("div").attr("id","c2iOption").attr("class","c2iOption"+(t.initPos?" "+t.initPos:"")).style("cursor","move").call(tt),document.getElementById("c2iOption").appendChild(d.domElement);const m=d.addFolder(j.gen.default);c&&m.add(w,"cluster",["stackbar","stackbar100","groupbar","stackarea","stackarea100","stackstream"]).name(j.gen.graphType).onChange(function(t){c.cluster=t,N.selectAll(".series").data([]).exit().remove(),o.render()});m.add(w,"dataSort",["init","desc","asc"]).name(j.gen.dataSort).onChange(function(t){K=t,mt(t)}).listen(),m.add(w,"patternText").name(j.gen.patternText).onChange(function(t){d3.select(".c2iPositionGrid").classed("c2iHidden",t)}).listen();const p=[];a.SHAPE_TYPES.forEach(function(t){p.push(t.type)}),m.add(w,"shapeType",p).name(j.gen.shapeType).onChange(function(t){r.type=t,o.shapeChange(null,!0)}).listen(),m.add(w,"autoChange").name(j.gen.autoChange).onChange(function(t){r.autoChange=t,o.autoChange()}).listen();const g=[];for(const t in a.SHAPE_EASE)a.SHAPE_EASE.hasOwnProperty(t)&&g.push(t);m.add(w,"shapeEasing",g).name(j.gen.changeEase).onChange(function(t){r.easing=t}),m.add(w,"rotateDirection",["stop","left","right"]).name(j.gen.rotateLeftRight).onChange(function(t){n.rotate.direction=t}).listen(),m.add(w,"nodeCircle").name(j.gen.nodeCircle).onChange(function(t){i.nodeCircle=t,o.nodeCircle()}).listen();const f=d.addFolder(j.gen.etcOptions);f.add(w,"noRotate").name(j.gen.leftBtnRotate).onChange(function(t){l.noRotate=x.noRotate=!t}),f.add(w,"noZoom").name(j.gen.wheelBtn).onChange(function(t){l.noZoom=x.noZoom=!t}),f.add(w,"noPan").name(j.gen.rightBtnMove).onChange(function(t){l.noPan=x.noPan=!t}),f.add(w,"fixedPos").name(j.gen.fixedTip).onChange(function(t){s.fixedPos=t?L:void 0})}(),function(){const t=n.tooltip;if(!(Y=n.method.mousemove&&t&&void 0!==t.id?d3.select(t.id):void 0)||Y.empty())return;a.initTooltip(Y),"object"!=typeof t.fixedPos?t.fixedPos=void 0:Y.style("pointer-events","all").style("cursor","move").call(tt);B=t.displayTips?t.displayTips:2,t.infoLevel=t.infoLevel?t.infoLevel<0||t.infoLevel>3?0:t.infoLevel:0,t.opacity=t.opacity?t.opacity:.7,t.isShow=void 0!==t.isShow&&t.isShow}(),a.fix4Bootstrap()}function lt(t){const e=n.duration,r=n.geometry,l=Z.find(e=>e.element.__data__.__id===t);0!==l.position.x||80!==l.position.y||2500!==l.position.z?(o.shapeChange(e/2),new TWEEN.Tween(l.position).to({x:0,y:80,z:2500},Math.random()*e+e).easing(a.SHAPE_EASE[r.easing]).start(),new TWEEN.Tween(l.rotation).to({x:0,y:0,z:0},Math.random()*e+e).easing(a.SHAPE_EASE[r.easing]).start(),new TWEEN.Tween(this).to({},2*e).onUpdate(ct).start()):o.shapeChange(e)}function it(){!isNaN(n.width)&&n.width&&!isNaN(n.height)&&n.height?(m=n.width,p=n.height):d3.select(".c2i4Size").empty()?(m=window.innerWidth,p=window.innerHeight):(m=parseInt(d3.select(t).style("width"),10),p=n.height?n.height:window.innerHeight-parseInt(d3.select(".c2i4Size").style("height"))),_.setSize(m,p),n.aspect=m/p,h.aspect=n.aspect,h.updateProjectionMatrix()}function st(t,e){const a=n.geometry,o=n.node,r=a.curve,l=a.grid,i=a.table,s=a.pattern,c=a.helix;r&&function(){const t=r.cols,a=r.separation,o=r.y,n=(t-1.7)*a/2,l=new THREE.Object3D;l.position.x=e%t*a-n,l.position.z=Math.floor(e/t)*a,l.position.y=300*(Math.sin(.5*l.position.x)+Math.sin(.5*l.position.z))+o,Q.curve.push(l)}(),i&&function(){const t=i.heightGap,a=o.height+t,n=i.cols,r=i.widthGap,l=o.width+r,s=l*(n/2)-l/2,c=i.y,d=new THREE.Object3D;d.position.x=e%n*l-s,d.position.y=-Math.floor(e/n)%n*a+c,Q.table.push(d)}(),s&&function(){if(n.positionData){const e=s.heightGap,a=o.height+e,n=s.cols,r=s.widthGap,l=o.width+r,i=l*(n/2)-l/2,c=s.y,d=new THREE.Object3D,u=c+a;d.position.x=t.x*l-i-l,d.position.y=-t.y*a+u,Q.pattern.push(d)}}(),a.sphere&&function(){const t=new THREE.Vector3,o=Math.acos(2*e/A-1),n=Math.sqrt(A*Math.PI)*o,r=new THREE.Object3D,l=new THREE.Spherical(a.sphere.radius,o,n);r.position.setFromSpherical(l),t.copy(r.position).multiplyScalar(2),r.lookAt(t),Q.sphere.push(r)}(),c&&function(){const t=new THREE.Vector3,o=.25*(e+12)+Math.PI,n=-e*c.rows+a.helix.y,r=new THREE.Object3D,l=new THREE.Cylindrical(c.radius,o,n);r.position.setFromCylindrical(l),t.x=2*r.position.x,t.y=r.position.y,t.z=2*r.position.z,r.lookAt(t),Q.helix.push(r)}(),l&&function(){const t=l.width,a=l.matrix,n=o.height+l.heightGap,r=a*a,i=l.zGap,s=new THREE.Object3D;s.position.x=t-e%a*(t/2)+l.x,s.position.y=Math.floor(e/a)%a*n-l.y,s.position.z=Math.floor(e/r)*i,Q.grid.push(s)}(),t.object=new THREE.CSS3DObject(this),y.add(t.object),Z.push(t.object)}function ct(){_.render(y,h)}function dt(t){return k.map(function(e){return{key:e,values:t.map(function(t){return{key:e,x:v(t[n.xDim.colNm]),y:+t[e]}})}})}function ut(t){const e=n.main.agg?n.main.agg.type:n.main.group.colNm;n.data.sort("desc"===t?(t,a)=>d3.descending(t[e],a[e]):"asc"===t?(t,a)=>d3.ascending(t[e],a[e]):(t,e)=>d3.ascending(t.__id,e.__id))}function mt(t){t&&(t.stopPropagation&&(t.stopPropagation(),K="init"===K?"desc":"desc"===K?"asc":"init",w&&(w.dataSort=K)),ut(K),gt()),N&&(N=N.data(n.data,function(t){return t[n.main.group.colNm]})),y=new THREE.Scene,Z=[],Q={curve:[],pattern:[],table:[],sphere:[],helix:[],grid:[]},A=n.data.length,N&&N.each(st),Q.sphere.sort(d),Q.grid.sort(d),Q.curve.sort(d),o.shapeChange()}function pt(t,e){return n.node.borderWidth+"px solid "+t(e[n.main.agg.type])}function gt(){if(!n.positionData)return;const t=[];if(n.positionData.forEach(function(e,a){e.forEach(function(e,o){e&&t.push({x:o+1,y:a+1})})}),n.data.length>t.length){let e,a=t.length,o=d3.max(n.positionData,function(t){return t.length}),r=0,l=d3.max(t,function(t){return t.y});for(;n.data.length>a;a++)0===(e=r++%o)&&++l,t.push({x:e+1,y:l})}n.data.forEach(function(e,a){const o=t[a];e.x=o.x,e.y=o.y})}function ft(){const t=n.xDim.fonts;N.selectAll(".gContent .x.axis text").style("font-family",t[0]).style("font-size",t[1]).attr("fill",t[2]);const e=n.yDim.fonts;N.selectAll(".gContent .y.axis text").style("font-family",e[0]).style("font-size",e[1]).attr("fill",e[2])}function ht(t){return"string"!=typeof t?t:(colors=a.getColorScheme(t),colors?colors.range():void 0)}function yt(t,e,a){const o=q(e),r=d3.rgb(o).darker(2),l=q.range().indexOf(o);if(d3.select(t.parentNode).attr("c2i"+a,l),!n.main.group.backColorRemove)return"linear-gradient(to right, "+o+","+r+","+o+")"}function _t(t,e,a){const o=X(e),n=d3.rgb(o).brighter(2),r=X.range().indexOf(o);return d3.select(t).attr("c2i"+a,r),"linear-gradient(to right, "+o+","+n+","+o+")"}function xt(){k=[],C=[],n.measures.forEach(function(t){"image"===t.dataType?t.classNm="c2iWowImg":t.classNm="Count"===t.aggSQL?"c2iKeyCount":"c2iValues",k.push(t.colNm),C.push(t.caption)}),E={sum:0,min:0,max:0,count:0,avg:0},n.data=f,n.preBuildData?n.data.forEach(function(t,e){t.__id=e}):function(){const t=d3.groups(n.data,t=>t[n.main.group.colNm]);n.data=t.map((t,e)=>{const a={__id:e};return a[n.main.group.colNm]=t[0],a.sum=0,a.children=t[1].map(function(t){const e={};return e[n.xDim.colNm]=t[n.xDim.colNm],k.forEach(function(o){e[o]=+t[o],a.sum+=e[o]}),e}),a})}(),W=Number.MIN_VALUE,R=[Number.MAX_VALUE,Number.MIN_VALUE],V=[Number.MAX_VALUE,Number.MIN_VALUE],O=[];const t=n.main;if(n.node.isHtml){const e=ht(t.group.color[1]);q=d3.scaleOrdinal().domain(t.group.color[0]).range(e);const a=ht(t.body.color[1]);X=d3.scaleOrdinal().domain(t.body.color[0]).range(a)}else if(t.agg){n.data.forEach(function(t){t.sum=0,t.children.forEach(function(e){e._sum=0,k.forEach(function(t){e._sum+=e[t],W<e[t]&&(W=e[t]),e[t]<V[0]?V[0]=e[t]:e[t]>V[1]&&(V[1]=e[t])}),-1===O.indexOf(e[n.xDim.colNm])&&O.push(e[n.xDim.colNm]),t.sum+=e._sum});const e=d3.extent(t.children,function(t){return t._sum});e[0]<R[0]&&(R[0]=e[0]),e[1]>R[1]&&(R[1]=e[1]),E.sum+=t.sum});const t=d3.extent(n.data,function(t){return t.sum});E.min=t[0],E.max=t[1]}if(A=n.data.length,E.count=A,E.avg=+(E.sum/A).toFixed(1),gt(),n.main.agg){ut("desc");const t=n.main.agg.type;let e=Number.MIN_VALUE,a=0;n.data.forEach(function(o,n){o[t]===e?o.rank=a:(e=o[t],a=n+1,o.rank=a)}),ut(K)}}function vt(t){t.enter().append("path").attr("class",t=>"series "+t.key).attr("fill",t=>M(t.key)).attr("fill-opacity",n.node.opacity).attr("d",t=>at(t)).on("mouseenter",ot).on("mouseleave",nt).transition().duration(n.duration).ease(a.ease[n.easing]).delay(et).attr("d",t=>at(t,!0))}function bt(t){t.enter().append("g").attr("class",t=>"series "+t.key).attr("fill",t=>M(t.key)).attr("fill-opacity",n.node.opacity).on("mouseenter",ot).on("mouseleave",nt).selectAll("rect").data(t=>t,c).join("rect").attr("class",t=>t.key).attr("x",t=>v.range()[1]).attr("y",t=>b(t[1])).attr("height",t=>b(t[0])-b(t[1])).transition().duration(n.duration).ease(a.ease[n.easing]).delay(et).attr("width",v.bandwidth()).attr("x",t=>v(t.data[n.xDim.colNm]))}function kt(t){const e=d3.scaleBand().domain(k).range([0,v.bandwidth()]).padding([n.xDim.xPad[2]]);b.domain([V[0]*(V[0]>0?.9:1.1),V[1]*(V[1]>0?1.1:.9)]),t.enter().append("g").attr("class",t=>"series "+t.key).attr("transform",t=>"translate("+e(t.key)+",0)").selectAll("rect").data(t=>t.values,c).join("rect").on("mouseenter",ot).on("mouseleave",nt).style("fill-opacity",n.node.opacity).style("fill",t=>M(t.key)).attr("x",t=>0).attr("y",t=>b(t.y)).attr("width",e.bandwidth()).transition().duration(n.duration).ease(a.ease[n.easing]).delay(et).attr("x",t=>t.x).attr("height",t=>g[1]-b(t.y))}return o.render=function(t){if(!N)return rt(),n.geometry.autoChange&&o.autoChange(),o;const e=n.yDim;e&&(e.cluster.indexOf("100")>0?(b.domain([0,1]),D.scale(b),F="stackOffsetExpand",D.ticks(e.ticks,"%")):e.cluster.indexOf("group")>-1?(b.domain([0,1.1*W]),D.scale(b),F="stackOffsetNone",D.ticks(e.ticks,s)):(e.cluster.indexOf("stream")>0?(F="stackOffsetSilhouette",b.domain([-1*R[1],R[1]]),D.ticks(0)):(e.cluster.indexOf("group")>0?b.domain([V[0]*(V[0]>0?.9:1.1),V[1]*(V[1]>0?1.1:.9)]):b.domain([0,1.1*R[1]]),F="stackOffsetNone",D.ticks(e.ticks,s)),D.scale(b)),N.select(".gContent .y.axis").call(D),ft());const a=n.main;let r;return(N=N.data(n.data,t=>t[a.group.colNm])).exit().transition().style("opacity",0).remove(),N.style("border",t=>S?pt(T,t):""),a&&(a.agg&&a.agg.type&&N.selectAll(".mainMeasure").html(t=>`${s(t[a.agg.type])}<span class="rank">(${d3.format(",d")(t.rank)}&nbsp;${j.gen.rank})</span>`),a.info&&a.info.fn&&"function"==typeof a.info.fn&&N.selectAll(".mainDesc").html(a.info.fn),n.node.isHtml&&(N.selectAll(".c2iKey").style("opacity",0).style("background",function(t){return a.group.scaleBy?yt(this,t[a.group.scaleBy],a.group.scaleBy):null}),n.measures.forEach(function(t){t.draw&&N.select("."+t.classNm).style("opacity",0).html(e=>e[t.colNm])}),N.style("opacity",.1).style("height","0px").style("background",function(t){return _t(this,t[a.body.scaleBy],a.body.scaleBy)}).transition().duration(n.duration).delay(function(t,e){return e/n.data.length*n.duration}).style("height",n.node.height+"px").style("opacity",1),N.selectAll([".c2iKey",".c2iValues",".c2iImages"]).transition().duration(2*n.duration).delay(function(t,e){return e/n.data.length*n.duration}).style("opacity",1))),e&&(I="stackstream"===e.cluster?"stackOrderInsideOut":"stackOrderNone",u.offset(d3[F]).order(d3[I]),"groupbar"===e.cluster?r=N.select(".gContent > g").selectAll(".series").data(t=>dt(t.children),c):(u.keys(k),r=N.select(".gContent > g").selectAll(".series").data(t=>u(t.children),c)),e.cluster.indexOf("stackarea")>-1||e.cluster.indexOf("stream")>0?vt(r):e.cluster.indexOf("stack")>-1?bt(r):kt(r)),t&&mt(),o},o.data=function(t){return arguments.length?(f=t,xt(),o):n.data},o.clear=function(){if(N){N.remove(),N=void 0;const t=d3.select("#c2iOption");t.empty()||(t.remove(),d3.select("#c2iOption").remove()),d3.select(".dg.ac").remove(),G&&(clearInterval(G),G=null),P&&(window.cancelAnimationFrame(P),P=void 0)}return o},o.rotateDirection=function(){const t=n.rotate;return t.direction="stop"===t.direction?"left":"left"===t.direction?"right":"stop",w.rotateDirection=t.direction,o},o.patternChange=function(t){return n.positionData=t,mt(!0),o},o.shapeChange=function(t,e){e&&n.showMe&&(n.showMe=!1,clearTimeout(U));const r=n.geometry;if("pattern"===r.type&&!n.positionData)return void alert(j.std3D.std3D_1);const l=Q[r.type],i=t||n.duration;if(l.length<1)return o;TWEEN.removeAll();for(let t=0;t<Z.length;t++){const e=Z[t],o=l[t];new TWEEN.Tween(e.position).to({x:o.position.x,y:o.position.y,z:o.position.z},Math.random()*i+i).easing(a.SHAPE_EASE[r.easing]).start(),new TWEEN.Tween(e.rotation).to({x:o.rotation.x,y:o.rotation.y,z:o.rotation.z},Math.random()*i+i).easing(a.SHAPE_EASE[r.easing]).start()}return new TWEEN.Tween(this).to({},2*i).onUpdate(ct).start(),w&&(w.shapeType=r.type),o},o.showMe=(()=>{n.showMe=!n.showMe;let t,e=Math.max(3*n.duration,5e3);n.showMe&&Z.length?(t=n.node.isHtml?Z.map((t,e)=>({idx:e})):Z.map((t,e)=>({idx:e,agg:t.element.__data__.sum})).sort((t,e)=>e.agg-t.agg),lt(Z[t[0].idx].element.__data__.__id),function a(o){U=setTimeout(()=>{lt(Z[t[o].idx].element.__data__.__id),o>=t.length-1&&(o=-1),a(++o)},e)}(1)):clearTimeout(U)}),o.autoChange=function(){const t=n.geometry;return t.autoChange?(G&&clearInterval(G),G=setInterval(function(){let e=0;a.SHAPE_TYPES.some(function(a,o){if(a.type===t.type)return e=o,!0}),e=e===a.SHAPE_TYPES.length-1?0:e+1,t.type=a.SHAPE_TYPES[e].type,o.shapeChange(),t.menuId?(d3.selectAll(t.menuId+" button").classed("actived",!1),d3.select(t.menuId+" .c2i_"+t.type).classed("actived",!0)):console.log(j.std3D.std3D_2)},t.changeInterval)):(clearInterval(G),G=null),w&&(w.autoChange=t.autoChange),o},o.nodeCircle=function(){d3.select(t).selectAll([".c2iNode",".c2iWowImg"]).transition().duration(n.duration).delay((t,e)=>e*n.delay).style("border-radius",()=>n.node.nodeCircle?n.node.width/2+"px":null)},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),j=c2i.lang,o):n.lang},o.setColors=function(t,e){const a=n.main;a&&a.agg&&a.agg.type&&(T=e,S=e.range(),e&&(N.select(".mainMeasure").html(function(t){return s(t[a.agg.type])+' <span class="rank">('+t.rank+j.gen.rank+")</span>"}).style("color",function(t){return e?e(t[a.agg.type]):a.agg.fonts[2]}).style("opacity",a.agg.opacity),N.style("border",function(t){return e?pt(e,t):""})))},o.getExtent=function(t){let e;return e=[E.min,E.max]},o.selectNodes=function(t,e){if(t){if(Array.isArray(e)){let a;a=(t.selector.indexOf("first"),N.filter(function(t){return e[0]<=t[n.main.agg.type]&&t[n.main.agg.type]<=e[1]})),N.style("opacity",.2),a.transition().style("opacity",1)}}else N.style("opacity",n.node.opacity)},o.getConfig=function(e){return n.measure=void 0,n.measures.some(function(t,a){if(t.colNm===e)return n.measure=t,!0;t.__id=a}),n.measure||(n.measure=n.measures[0]),n.pieceColors=M?M.range():void 0,n.keyCol="colNm",n.lgData=!0,n.c2iCon=t,n},o.getInfo=function(){return{container:t,type:"std3D",cm:{colNm:n.main.agg.type,caption:n.yDim.caption}}},o.exportData=function(t,e){const o=n.title&&n.title.caption?n.title.caption:"";let r,l=[],i=[];e||(n.xDim&&(l.push(n.xDim.colNm+","),(r=n.xDim.caption?n.xDim.caption:n.xDim.colNm).search(/["|,|\n]/g)>=0?i.push('"'+r+'",'):i.push(r+",")),n.measures.forEach(function(t){t.caption.search(/["|,|\n]/g)>=0?i.push('"'+t.caption+'",'):i.push(t.caption+","),l.push(t.colNm+",")})),a.exportData(o,l,i,f,t)},n.optWin&&a.optionHide(),a.createAccessor(o,n)},c2i.bi.iList=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;const o={};let n={};e.method=e.method||{},a.init(n,e);const r=n.cols[0];if(!r.listGroupBy)return void a.alert(">> cols 의 첫번째는 반드시 listGroupBy: true 이어야 합니다.(오류)");const l=d3.select(t);let i,s=c2i.lang,c=[],d=0,u=[];const m=(t,e)=>"time"===t||0===t.indexOf("date")?d3.timeFormat(e):d3.format(e),p=r.groupByFormat?m(r.type,r.groupByFormat):a.idenfityFn,g=r.groupByListFormat?m(r.type,r.groupByListFormat):a.idenfityFn,f=r.listFormat?m(r.type,r.listFormat):a.idenfityFn,h=d3.format(",d"),y=d3.format(".2%"),_=[],x={};return n.cols.filter(t=>!t.hideList).forEach(t=>{_.push({listGroupBy:t.listGroupBy,caption:t.caption,textAlign:t.textAlign?t.textAlign:null,isMeasure:t.isMeasure}),d++,t.listFormatFn=t.listFormat?m(t.type,t.listFormat):a.idenfityFn,t.isMeasure&&(x[t.colNm]=d3.scaleSequential(d3.interpolatePiYG))}),_.splice(1,0,{caption:"No",textAlign:"right"}),_.push({caption:"X",textAlign:"center"}),d+=1,o.render=function(){!function(){if(!l.selectAll(".c2iColHeader").empty())return;const t=l.append("thead").attr("class","c2iColHeader").append("tr");t.selectAll("th.c2iColCaption").data(_).enter().append("th").attr("class",(t,e)=>0===e?"c2iBroupby":"X"===t.caption?"exitBtn":1===e?"c2iExport c2iColCaption":t.isMeasure?"c2iColMeasure":"c2iColCaption").style("cursor",t=>"No"===t.caption?"pointer":null).attr("title",t=>"X"===t.caption?s.gen.close:t.caption.length>15?t.caption:null).on("click",(t,e)=>"No"===e.caption?function(){const t=n.title&&n.title.caption?n.title.caption:"",e=[],l=[];n.cols.forEach(t=>{t.caption.search(/["|,|\n]/g)>=0?l.push('"'+t.caption+'",'):l.push(t.caption+","),e.push(t.colNm+",")});const i=(u.length?u:o.container().listData()).map(t=>{const e={...t};return e[r.colNm]=f(e[r.colNm]),e});a.exportData(t,e,l,i)}():"X"===e.caption?o.container().listToggle():null).text(t=>"No"===t.caption?null:t.caption),t.selectAll("th.c2iExport").append("div").append("img").attr("src",a.imgSrc()+"export.png").attr("title",s.std.dC17+": 리스트에 보이는 샘플 건수 보다, 대부분 더 많은 실제 데이터를 추출합니다.")}();const t={};if(n.cols.filter(t=>x[t.colNm]).forEach(e=>{x[e.colNm].domain(d3.extent(c,t=>t[e.colNm])),n.byGroupType&&e.groupType&&(t[e.groupType]?t[e.groupType].push(...x[e.colNm].domain()):t[e.groupType]=x[e.colNm].domain())}),n.byGroupType){for(const e in t)t[e]=d3.extent(t[e]);n.cols.filter(t=>t.groupType&&x[t.colNm]).forEach(e=>{x[e.colNm].domain(t[e.groupType])})}const e=c.length,i=(t=>d3.group(t,t=>p(t[n.dataList.listGroupBy])))(c);l.selectAll("tbody.groupBy").remove();let m=l.selectAll("tbody.groupBy").data(i,t=>t[0]);(m=m.enter().append("tbody").attr("class","groupBy").merge(m)).append("tr").append("td").attr("class","groupByTd").attr("colspan",d).text(t=>{const a=d3.format(",d")(t[1].length),o=t[1][0][r.colNm];return(p?p(o):o)+" ("+a+"건, 전체: "+h(e)+"건 중 "+y(t[1].length/e)+")"});const v=m.order().selectAll(".dataRow").data(t=>t[1],t=>t.idx),b=(t,e)=>e.listFn?e.listFn(t):e.listFormatFn(t[e.colNm]),k=v.enter().append("tr").attr("class","dataRow");return k.append("td").attr("class","c2iGroupByDateTime").style("color",r.groupByListColor).text(t=>g?g(t[r.colNm]):t[r.colNm]),k.append("td").attr("class","c2iSeqNo").style("text-align","right").style("color",r.groupByListColor).text((t,e)=>h(e+1)),n.cols.forEach(t=>{t.listGroupBy||t.hideList||k.append("td").style("text-align",t.textAlign?t.textAlign:t.isMeasure?"right":null).classed("negative",e=>t.negativeClass?e[t.colNm]<=0:null).style("color",r.groupByListColor).attr("title",e=>!t.isMeasure&&b(e,t).length>15?b(e,t):null).text(e=>b(e,t))}),v.order(),o},o.altData=function(t){return arguments.length?(u=t,o):u},o.clear=(()=>(l&&l.selectAll(".groupBy").remove(),o)),o.data=function(t){return arguments.length?(c=t,o):c},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),s=c2i.lang,o):n.lang},o.container=function(t){return arguments.length?(i=t,o):i},o},c2i.bi.iCalView=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;let o={},n={width:"100%",margin:{top:50,left:10,right:25,bottom:20},data:void 0,title:void 0,formats:["%Y-%m-%d","%Y-%m","%Y"],byYear:{caption:"년도명",unitNm:"년",dy:15,fonts:["Roboto","12px","#333"],sort:"",sortBy:"",height:50,draw:!0},byMon:{caption:"월명",unitNm:"월",dy:10,siblingGap:0,fonts:["Roboto","12px","#333"],lineChart:{height:60,stroke:"steelblue",strokeWidth:3,opacity:.7,draw:!0},dotCircle:{radius:4,stroke:"#474747",strokeWidth:3,fill:"orange",fillText:["red","dimgrey","11px"],draw:!0}},node:{radius:0,color:d3.schemeRdYlGn[5].sort((t,e)=>e-t?1:-1),stroke:"#ddd",fillEmpty:"lightgrey",opacity:.75},cols:void 0,tooltip:void 0,isDev:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t),l=t=>t.key,i=d3.timeFormat("%w"),s=(d3.timeFormat("%e"),d3.timeFormat("%j"),d3.timeFormat("%U")),c=d3.timeFormat("%m"),d=d3.scaleLinear(),u=d3.format(",d"),m=(t,e=0,a,o=0)=>d3.timeDays(new Date(t,e,1),new Date(a,o,1));let p,g,f,h,y,_,x,v,b,k,C,w,N=d3.axisBottom().tickPadding(5).tickSize(15),A=a.computeDim(r,n),L=c2i.lang,D=[],S=[],T=d3.scaleLinear(),M=!0;const F=n.method;let I,B,E,G,P,O=n.xDim,R=n.yDim,V=n.y2Dim,W=n.statistics,Y=[],z=!(!W||!W.showToolbar)&&W.showToolbar,H=!0,$=()=>{};const X=d3.brushX(),q=t=>t[O.colNm],U=t=>t.value[R.colNm],j=t=>t.value[V.colNm],Z=t=>d3.extent(h,t),Q=t=>t.values.filter(t=>t.y2Val).length;let K,J,tt,et,at,ot,nt,rt,lt,it,st,ct,dt,ut=d3.timeFormat(n.formats[0]),mt=d3.timeFormat(n.formats[1]),pt=d3.timeFormat(n.formats[2]),gt=750,ft=0,ht=0,yt=n.duration?n.duration:100,_t=8,xt=56;const vt=d3.drag().on("start",function(t){const e=t.sourceEvent;e.stopPropagation(),ct=parseFloat(d3.select(this).style("left"))-e.pageX,dt=parseFloat(d3.select(this).style("top"))-e.pageY}).on("drag",function(t){const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",()=>e.pageX+ct+"px").style("top",()=>e.pageY+dt+"px")}).on("end",function(){d3.select(this).style("opacity",1)}),bt=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this.parentNode).style("opacity",.5)}).on("drag",function(t){const e=t.sourceEvent,a=e.offsetX?e.offsetX:t.x,o=e.offsetY?e.offsetY:t.y;a>0&&a<Me()&&o>0&&o<n.height-20&&d3.select(this.parentNode).attr("transform","translate("+[a,o]+")")}).on("end",function(){d3.select(this.parentNode).style("opacity",1)}),kt=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this).style("opacity",.5)}).on("drag",function(t){d3.select(this).attr("transform","translate("+[t.x,t.y-22]+")")}).on("end",function(){d3.select(this).style("opacity",1)}),Ct=d3.scaleLinear(),wt=25,Nt=(t,e)=>e/12*yt;let At,Lt,Dt,St=250,Tt=d3.scaleLinear().range([0,St]),Mt=-1,Ft=n.byMon.siblingGap;const It=L.legend,Bt=["Quantize","Quantize Nice","Quantile"],Et=[It.scale_Qtize,It.scale_QtizeNice,It.scale_Qtile],Gt=["calView","scatter","bar","barLine","barDot"],Pt=[It.calView,It.scatter,It.bar,It.barLine,It.barDot],Ot=()=>{const t=d3.mean(n.data,t=>(t.avg=d3.mean(t.values,t=>{if(t.y2Val)return t.avg=d3.mean(t.values,t=>{if(t.y2Val)return t.yVal}),t.yVal}),t.avg));return d(t)};let Rt=xt+Ft;const Vt=(t,e)=>"translate("+[e*xt+Ft*t.__seq,0]+")",Wt=(t,e)=>e*xt+Ft*t.__seq+xt/2,Yt=t=>d3.line().defined(t=>t.yVal!==k.sparseVal).x(Wt).y(t=>d(t.yVal))(t),zt=t=>d3.line().defined(t=>t.yVal_2!==k.sparseVal).x(Wt).y(t=>T(t.yVal_2))(t);function Ht(){let t={cfg:n,chart:o,_svg:g,dim:n.byMon,_extent:w,color:At,_lgScale:Tt};t={...t={...t={...t,_xAxis:N,_dragLgHandle:bt,_dragH:kt,_lgWH:St,_lgData:S,_lgScale:Tt,lgMouseEnter:jt,lgMouseLeave:Zt},lgClick:Qt,_dimAll:E,_gradeInfo:o.isAvg()?Xt:$t},_xStart:De,scale:n.node.scale,rotate:n.node.rotate},(t=a.renderLegend(t))&&(Tt=t._lgScale,N=t._xAxis,S=t._lgData)}function $t(t){let e,a,o,n,r,l,i,s;return n=Number.MIN_VALUE,r=Number.MAX_VALUE,e=a=o=l=i=0,rt.selectAll(".day").filter(a=>{a.y2Val&&(s=a.yVal,t[0]<=s&&s<t[1]&&(l+=a.y2Val,e+=s,o++,s>n&&(n=s),s<r&&(r=s)))}),a=0===o?0:e/o,i=0===l?0:e/l,n!==Number.MIN_VALUE&&0!==o||(n=0),r!==Number.MAX_VALUE&&0!==o||(r=0),{...{from:t[0],to:t[1],ndSum:e,ndAvg:a,ndMin:r,ndMax:n},ndCnt:o,nY2Val:l,y2ValAvg:i}}function Xt(t){let e,a,o,n,r,l,i,s;return n=Number.MIN_VALUE,r=Number.MAX_VALUE,e=a=o=l=i=0,rt.selectAll(".day").filter(a=>{a.y2Val&&(s=a.yVal,t[0]<=s&&s<t[1]&&(l+=a.y2Val,e+=s,o++,s>n&&(n=s),s<r&&(r=s)))}),a=0===o?0:e/o,n!==Number.MIN_VALUE&&0!==o||(n=0),r!==Number.MAX_VALUE&&0!==o||(r=0),{...{from:t[0],to:t[1],ndSum:e,ndAvg:a,ndMin:r,ndMax:n},ndCnt:o,nY2Val:l}}function qt(t){const e=g.select(".c2iLgQuantile"),r=a.weekday[new Date(t.name).getDay()];let l=t.name+" ("+r+") "+R.caption,i="";if(t.y2Val){const r=n.byMon.tipFormat,l=r(t.value),s=u(t.y2Val),c=t.value/t.y2Val,d=Tt(t.value),m=n.node.isVertical?{y1:d,y2:d}:{x1:d,x2:d};e.select(".indicator").transition().duration(350).attr("stroke-opacity",.8).attrs(m),i=l+" ("+s+"건)";const p=At.range().findIndex(e=>e===At(t.value)),g=S[p];if(Dt!==p){let t={item:g,idx:p,chart:o,cfg:n,_dragHtml:vt};t={...t={...t,_table:Lt,_cntFmt:u,_lgData:S,tFmt:r},color:At,clsNm:"dayInfo"},(t=a.lgStatInfo(t))&&(Dt=t.idx,Lt=t._table)}if(n.tooltip.isShow){const e=d3.format(",.1%"),{ndSum:a,nY2Val:o}={...g},n="number"+(a/o<c?" positive":" negative"),i=[{key:1,value:t.name,colspan:2,cls:"tipHeader"},{key:2,value:l,cls:"number"},{key:3,value:0===a?0:e(t.value/a),cls:"number"},{key:4,value:"-",cls:"number"},{key:5,value:l,cls:"number"},{key:6,value:s,cls:"number"},{key:7,value:r(c),cls:n}],d=Lt.select(".dayInfo").style("display",null).selectAll("td").data(i,t=>t.key);d.exit().remove(),d.enter().append("td").attr("colspan",t=>t.colspan?t.colspan:null).merge(d).attr("class",t=>t.cls).text(t=>t.value)}}else e.select(".indicator").attr("stroke-opacity",0),l+=": 없음",n.tooltip.isShow&&Lt&&Lt.select(".dayInfo").style("display","none");e.select(".lgCaption").text(l),e.select(".lgValue").text(i)}function Ut(t){let e,a;return Array.isArray(t)?(e=t[0],a=t[1]):(e=t.from,a=t.to),{from:e,to:a}}function jt(t,e){te(e);const r=At(e.from),l=".c_"+r.substr(1),i=".lgRect"+l+",.c2iGhost"+l;let s,c;g.select(".c2iLgQuantile").selectAll(i).style("stroke-width",1).style("stroke-dasharray",1.5).style("stroke",a.colorHover(r,!0));let{from:d,to:m}=Ut(e);S.some((t,e)=>{if(t.from===d&&t.to===m)return s=t,c=e,!0});const p=n.byMon.tipFormat;let f={item:s,idx:c,chart:o,cfg:n,_dragHtml:vt,_table:Lt,_cntFmt:u,_lgData:S};f={...f,tFmt:p,color:At,clsNm:"dayInfo"},(f=a.lgStatInfo(f))&&(Dt=f.idx,(Lt=f._table).select(".dayInfo").style("display","none"))}function Zt(t,e){te();const a=".c_"+At(e.from).substr(1),o=".lgRect"+a+",.c2iGhost"+a;g.select(".c2iLgQuantile").selectAll(o).style("stroke-width",null).style("stroke",null)}function Qt(t,e,a){if(!e)return;let o=a;if(-9===o&&(o=S.findIndex(t=>t.from===e.from)),Mt===o)return void he();Mt=o;const r=n.byMon;if(Kt(e)){const t=At(e.from);r.lineChart.fillColor=t,Jt(),r.graphType.indexOf("bar")>-1&&r.isDayAvgLine&&ie()}}function Kt(t){let{from:e,to:a}=Ut(t);const o=it.filter(t=>t.y2Val&&e<=t.yVal&&t.yVal<a);if(o.empty())return!1;const r=n.byMon.lineChart;if(!r||!r.draw)return!1;let l=d3.nest().key(t=>mt(new Date(t.key))).rollup(function(t){return{yVal:d3.sum(t,t=>t.yVal),y2Val:d3.sum(t,t=>t.y2Val),days:t.length}}).entries(o.data()),i=!1,s=[];return n.data.forEach(t=>{t.values.forEach(t=>{i=!1,l.some(e=>{if(t.key===e.key)return t.yVal_2=e.value.yVal,t.y2Val_2=e.value.y2Val,t.days_2=e.value.days,s.push(t.yVal_2),i=!0,!0}),i||(t.yVal_2="x",t.y2Val_2="x")})}),(T=d.copy()).domain(d3.extent(s)),!0}function Jt(t){const e=n.byMon,o=e.lineChart;if(!o.fillColor)return;t||ge(),f.selectAll(".gGroupBy2").remove();const r=(ot=f.selectAll(".gGroupBy2").data(n.data,l)).enter().append("g").attr("class","gGroupBy2").attr("transform",(t,e)=>"translate("+[De(),e*gt]+")");r.append("path").attr("class","monthLine2").style("pointer-events","none").style("stroke",o.fillColor).style("stroke-width","2px").style("stroke-opacity",o.opacity).style("stroke-dasharray",4).attr("fill","none").attr("transform",ce(10)).attr("d",t=>zt(t.values)).each(function(){a.pathShow({sel:d3.select(this),dr:yt,dashLen:0})});const i=e.dotCircle;if(i&&i.draw){r.append("g").attr("class","circles2").style("opacity",.7).attr("transform",ce(10)).selectAll(".monthDot2").data(t=>t.values,l).enter().append("circle").attr("class","monthDot2").style("fill",o.fillColor).style("stroke",i.stroke).style("stroke-width","2px").attr("r",t=>t.yVal_2===k.sparseVal?0:i.radius).attr("cx",Wt).attr("cy",t=>T(t.yVal_2))}let s,c,d;r.append("g").attr("class","lgGhost").attr("transform",ce(5)).selectAll("rect").data(t=>t.values,l).enter().append("rect").attr("class","rectGhost").style("fill","none").style("stroke",n.node.stroke).attr("height",5).attr("x",(t,e)=>e*Rt).attr("y",(t,e)=>-wt).attr("width",xt),r.append("g").attr("class","lgMonth").merge(ot.select(".lgMonth")).attr("transform",ce(5)).selectAll("rect").data(t=>t.values,l).enter().append("rect").attr("class","rectMonth").style("fill",o.fillColor).style("stroke","none").attr("height",5).attr("x",(t,e)=>(s=t.yVal_2/t.yVal,!isNaN(t.yVal_2)&&t.yVal_2>0&&t.yVal>0&&s<=1?(c=Ct(s),e*Rt+xt-c):0)).attr("y",(t,e)=>-wt).attr("width",0).transition().attr("width",t=>(s=t.yVal_2/t.yVal,!isNaN(t.yVal_2)&&t.yVal_2>0&&t.yVal>0&&s<=1?c=Ct(s):0));const u=r.append("g").attr("class","lgValue").attr("transform",ce(5)).selectAll("text").data(t=>t.values,l).enter().append("g").attr("class","lgMonValue").attr("transform",(t,e)=>`translate(${e*Rt+xt}, ${-wt-1})`),m=e.fonts,p=e.dotCircle.fillText,g=u.append("text").style("font-family",m[0]).style("font-size",p[2]).style("fill",p[1]).style("display",t=>t.yVal_2?null:"none").style("text-anchor","end");g.append("tspan").attr("class","value").attr("x",0).text(t=>isNaN(t.yVal_2)?"":e.tipFormat(t.yVal_2)),g.append("tspan").attr("class","ratio").attr("x",0).attr("dy","16px").text(t=>!isNaN(t.yVal_2)&&t.yVal_2>0&&t.yVal>0?(s=t.yVal_2/t.yVal,d=0===t.yVal?0:s,d3.format(",.1%")(d)+", "+d3.format("d")(t.days_2)+"일"):"-")}function te(t){if(t){let{from:e,to:a}=Ut(t);const o=it.filter(t=>t.y2Val&&e<=t.yVal&&t.yVal<a);o&&(it.style("fill-opacity",.1),o.style("fill-opacity",1),lt.selectAll(".dayCnt").style("fill-opacity",.3))}else it.style("fill-opacity",null),lt.selectAll(".dayCnt").style("fill-opacity",1)}function ee(){f||(f=g.append("g").attr("class","body").attr("transform","translate(0,"+n.margin.top+")"));const e=n.byYear,o=n.byMon;(at=f.selectAll(".gGroupBy").data(n.data,l)).exit().remove();const r=at.enter().append("g").attr("class","gGroupBy").attr("transform",(t,e)=>"translate("+[De(),e*gt]+")");function i(t,e,a,o,n){if(t.preventDefault(),t.stopPropagation(),e.__start){e.__end=new Date;const o=e.__end-e.__start;if(e.__start=void 0,!o||o>500)return!0;de(t,a,null,n)}else e.__start=new Date}!function(){if(!e||!e.draw)return;const a=e.fonts;nt=r.append("text").on("touchstart",function(t){i(t,this,t.shiftKey?"yearAgg":"year",!0)}).on("dblclick",t=>de(t,t.shiftKey?"yearAgg":"year",!0)).on("click",(e,a)=>{ye(e,2,a),F.click&&F.click(e,{container:t,selector:"yearly"},a)}).on("mouseenter",(e,a)=>{F.mouseenter&&F.mouseenter(e,{container:t,selector:"yearly"},a)}).on("mouseleave",(e,a)=>{F.mouseleave&&F.mouseleave(e,{container:t,selector:"yearly"},a)}).attr("class","gYear").attr("x",6*xt+11*Ft/2).attr("y",e.dy).style("font-family",a[0]).style("font-size",a[1]).style("fill",a[2]).style("text-decoration","underline").style("text-anchor","middle").merge(at.select(".gYear")).text(t=>se(new Date(t.key)))}(),function(){let e=Ot();const s=o.fonts,c=o.lineChart,u=o.dotCircle;if(c&&c.draw&&(r.append("path").attr("class","monthLine").style("pointer-events","none").style("stroke",c.stroke).style("stroke-width",c.strokeWidth+"px").style("stroke-opacity",c.opacity).attr("fill","none").merge(at.select(".monthLine")).attr("transform",ce(10)).attr("d",t=>Yt(t.values)).each(function(){a.pathShow({sel:d3.select(this),dr:yt,dashLen:0})}),n.isAvgLine)){void 0===e&&(e=0);const t=d3.rgb(c.stroke).brighter(),a=u.fillText[2],l=n.node.xyStroke;r.append("rect").attr("class","monthRectAll").attr("height",ht).attr("stroke-dasharray",9).attr("fill","none").attr("stroke-opacity",.7*c.opacity).attr("stroke",l).style("pointer-events","none").merge(at.select(".monthRectAll")).attr("transform",ce(10)).attr("width",Se()-1);const i=d.domain();r.append("text").attr("class","maxMonth").style("font-family",s[0]).style("font-size",a).style("fill",s[2]).attr("y",-2).merge(at.select(".maxMonth")).attr("transform",ce(10)).attr("x",Se()-3).text(o.tipFormat(i[1])),r.append("text").attr("class","minMonth").style("font-family",s[0]).style("font-size",a).style("fill",s[2]).merge(at.select(".minMonth")).attr("transform",ce(10)).attr("x",Se()-3).attr("y",ht+parseInt(a)).text(o.tipFormat(i[0])),r.append("line").attr("class","avgLine").attr("x1",0).attr("x2",0).attr("stroke",t).style("stroke-dasharray",3).style("pointer-events","none").merge(at.select(".avgLine")).attr("opacity",c.opacity).attr("transform",ce(10)).attr("x2",Se()-1).attr("y1",e).attr("y2",e);const m=d.invert(e);let p;r.append("text").attr("class","avgText").style("font-family",s[0]).style("font-size",a).attr("y",-1).style("text-anchor","middle").merge(at.select(".avgText")).style("fill",e=>void 0!==e.avg&&e.avg-m>0?t:u.fillText[0]).attr("transform",ce(10)).attr("x",Se()/2).text(t=>(p=void 0!==t.avg?o.tipFormat(t.avg-m):"데이터 없음.!!","전체 월평균: "+o.tipFormat(m)+" (당해 월평균과 차이: "+p+")"))}if(u&&u.draw){let t=r.append("g").on("touchstart",function(t,e){i(t,this,"monthAgg",null,e.key)}).on("dblclick",(t,e)=>de(t,"monthAgg",null,e.key)).attr("class","circles").merge(at.select(".circles")).attr("transform",ce(10)).selectAll(".monthDot").data(t=>t.values,l);t.enter().append("circle").attr("class","monthDot").style("fill",u.fill).style("stroke",u.stroke).style("stroke-width",u.strokeWidth+"px").merge(at.selectAll(".monthDot")).attr("r",t=>t.yVal===k.sparseVal?0:u.radius).attr("cx",Wt).attr("cy",t=>d(t.yVal))}const m=r.append("g").on("touchstart",function(t,e){i(t,this,"monthAgg",null,e.key)}).on("dblclick",(t,e)=>de(t,"monthAgg",null,e.key)).attr("class","monthValues").attr("transform",ce(10)).merge(at.select(".monthValues")).selectAll(".monValue").data(t=>t.values,l).enter().append("g").on("click",(e,a)=>{ye(e,1,a),F.click&&F.click(e,{container:t,selector:"monthly"},a)}).on("mouseenter",(e,a)=>{F.mouseenter&&F.mouseenter(e,{container:t,selector:"monthly"},a)}).on("mouseleave",(e,a)=>{ne(),F.mouseleave&&F.mouseleave(e,{container:t,selector:"monthly"},a)}).on("mouseover",oe).attr("class","monValue");let p,g,f,h,y;const _=m.merge(at.selectAll(".monValue")).attr("transform",(t,a)=>(p=Wt(t,a),g=d(t.yVal),`translate(${[p,g=g>e?g-20:g+20]})`)),x=u.fillText,v=m.append("text").style("font-family",s[0]).style("font-size",x[2]).style("fill",t=>(g=d(t.yVal),x[e>g?1:0])).style("display",t=>t.yVal?null:"none").style("text-anchor","middle");v.merge(_.selectAll("text")),v.append("tspan").attr("class","value").attr("x",0).merge(_.select(".value")).text(t=>o.tipFormat(t.yVal)),v.append("tspan").attr("class","ratio").attr("x",0).attr("dy","12px").merge(_.select(".ratio")).text(t=>(f=new Date(t.key).getFullYear(),h=t.yVal,y="",n.data.some(t=>{if(+t.key===f)return y=0===(y=t.yVal)?0:d3.format(",.1%")(h/y),!0})," ("+y+")"))}(),rt=r.append("g").attr("class","gMonth").attr("transform","translate(0,"+e.height+")").merge(at.select("g.gMonth")),lt=rt.selectAll("g.month").data(t=>t.values,l),le()}function ae(t){return c(t)+n.byMon.unitNm}function oe(t,e){const a=n.tooltip;if(!a||!a.isShow)return;const o=d3.select(".c2iMiniTip");let r,l;o.classed("c2iHidden",!1);let i=!1,s=(e.key,e.key);const c=n.byMon;if(e.y2Val&&(n.data.some(t=>{if(t.key==pt(new Date(s)))return r=t,!0}),s.length>7?(l=new Date(s).getMonth(),i=!0):(s=ae(new Date(s)),l=new Date(e.key).getMonth()),r)){if(!r.values[l]&&(l=r.values.findIndex(t=>t.key.indexOf(l+1)>-1),!r.values[l]))return;let t=r.values[l].yVal,a=r.y2Val?r.yVal:0;const o=c.tipFormat,n=c.formatAvg,d=e.y2Val?e.yVal:0;if(a=0===a?0:d3.format(",.1%")(d/a),s+=": "+R.caption+" "+o(d),i)s+=" ("+u(e.y2Val)+"건)",t=0===t?0:d3.format(",.1%")(d/t),s+=(t="<br/> 월: "+t+", 년: "+a)+", 건당: ",s+=e.y2Val?n(d/e.y2Val):"없음";else{let o=0,r=0;e.values.forEach(t=>{t.y2Val&&(o++,r+=t.y2Val)}),a+=", 일수: "+o+"<br/> 일 평균: ",a+=o?n(t/o):"없음",s+=" ("+u(r)+"건)<br/> 년: "+a,s+=", 건당: "+(r?n(t/r):"없음")}}const d=t.pageX-parseInt(o.style("width"))/2+"px";o.html(s).style("left",d).style("top",t.pageY+10+"px")}function ne(){const t=n.tooltip;t&&t.isShow&&d3.select(".c2iMiniTip").classed("c2iHidden",!0)}function re(t,e,a){d3.select(t).style("stroke",e).style("stroke-width",a)}function le(){const e=n.byMon;let o;const r=lt.enter().append("g").on("touchstart",function(t,e){_touchDbClick(t,this,"monthAgg",null,e.key)}).on("dblclick",(t,e)=>{de(t,"monthAgg",null,o=pt(new Date(e.key)))}).attr("class",t=>"month m"+(new Date(t.key).getMonth()+1)).attr("transform",Vt);!function(){const a=e.fonts;let o,n;r.append("text").on("click",(e,a)=>{ye(e,1,a),F.click&&F.click(e,{container:t,selector:"monthly"},a)}).on("mouseenter",(e,a)=>{o="m"+(o=new Date(a.key).getMonth()+1),d3.selectAll(".gGroupBy ."+o).classed("sameMonth",!0),F.mouseenter&&F.mouseenter({container:t,selector:"monthly"},a)}).on("mouseleave",(e,a)=>{o="m"+(o=new Date(a.key).getMonth()+1),d3.selectAll(".gGroupBy ."+o).classed("sameMonth",!1),ne(),F.mouseleave&&F.mouseleave({container:t,selector:"monthly"},a)}).on("mouseover",oe).attr("class","monthNm").style("font-family",a[0]).style("font-size",a[1]).style("fill",a[2]).style("text-anchor","middle").merge(lt.select(".monthNm")).attr("transform","translate("+[Rt/2,-e.dy]+")").text(t=>(n=ae(new Date(t.key)),t.isValid&&(n+="("+t.workDays+"일)"),n))}(),lt=r.merge(lt),"scatter"===e.graphType?function(){const e=n.byMon,o=a.getScale(e.xScale),r=a.getScale(e.yScale),i=5*_t,s=n.node,c=Z(U),d=Z(j);r.domain(c).range([i,0]),o.domain(d).range([0,xt]),function(t,a){const o=n.byYear,r=[{x:-12,y:o.height,text:R.unitNm?R.caption+" "+R.unitNm:R.caption,mode:"tb"},{x:0,y:o.height-1,text:e.tipFormat(t[1])},{x:0,y:o.height+6*_t,text:V.unitNm?V.caption+" "+V.unitNm:V.caption},{x:xt,y:o.height+6*_t-1,text:o.tipFormat(a[1]),anchor:"end"}],l=R.fonts,i=[];n.data.forEach(()=>i.push(r));const s=f.selectAll(".gAxis").data(i),c=s.enter().append("g").attr("class","gAxis").merge(s).attr("transform",(t,e)=>"translate("+[De(),e*gt]+")").selectAll("text").data(t=>t);c.enter().append("text").style("font-family",l[0]).style("font-size",l[1]).style("fill",l[2]).style("writing-mode",t=>t.mode?t.mode:null).style("text-anchor",t=>t.anchor?t.anchor:null).merge(c).attr("x",t=>t.x).attr("y",t=>t.y).text(t=>t.text)}(c,d),(it=(it=lt.selectAll(".day").data(t=>t.values.filter(t=>void 0!==t.y2Val),l)).enter().append("circle").on("click",(e,a)=>{ye(e,0,a),F.click&&F.click(e,{container:t,selector:"daily"},{d:a,details:details})}).on("mouseenter",function(e,a){re(this,"yellow",3);const o={name:a.key,value:a.yVal,y2Val:a.y2Val};qt(o),F.mouseenter&&F.mouseenter(e,{container:t,selector:"daily"},o)}).on("mouseleave",function(e,a){re(this,null,1),ne(),F.mouseleave&&F.mouseleave(e,{container:t,selector:"daily"},a)}).on("mouseover",oe).attr("class",t=>"day c_"+t.key).attr("stroke",null).attr("fill-opacity",s.opacity).style("shape-rendering","crispEdges").merge(it)).style("fill",t=>t.y2Val?At(t.yVal):"none").transition().delay((t,e)=>e*n.delay).attr("r",t=>t.y2Val?3.5:0).attr("cx",t=>o(t.y2Val)).attr("cy",t=>r(t.yVal));const u=R.fonts;if(lt.select(".monthRect").empty()){const t=.7*s.strokeWidth;lt.append("rect").attr("class","monthRect").attr("fill","none").attr("stroke",s.stroke).style("stroke-width",s.strokeWidth).merge(lt.select(".monthRect")),lt.append("line").attr("class","dayAvgLineX").style("stroke-width",t).style("stroke-dasharray",3).merge(lt.select(".dayAvgLineX")),lt.append("text").attr("class","dayAvgTextX").style("font-family",u[0]).style("font-size",u[1]).style("fill",u[2]).style("text-anchor","start").merge(lt.select(".dayAvgTextX")),lt.append("line").attr("class","dayAvgLineY").style("stroke-width",t).style("stroke-dasharray",3).merge(lt.select(".dayAvgLineY")),lt.append("text").attr("class","dayAvgTextY").style("font-family",u[0]).style("font-size",u[1]).style("fill",u[2]).style("text-anchor","end").merge(lt.select(".dayAvgTextY"))}function m(t){const e=Q(t);return e?o(t.y2Val/e):0}function p(t){const e=Q(t);return e?r(t.yVal/e):0}function g(t,a){const o=Q(t);return o?e.tipFormat(t[a]/o):"없음"}lt.select(".monthRect").attr("width",xt).attr("height",i),lt.select(".dayAvgLineX").attr("y2",i),lt.select(".dayAvgTextX").attr("y",parseInt(u[1])),lt.select(".dayAvgLineY").attr("x2",xt),lt.select(".dayAvgTextY").attr("x",xt),lt.selectAll(".dayAvgLineX").attr("stroke",t=>{const e=m(t);return e>xt/2?s.stroke:s.xyStroke}).transition().delay((t,e)=>e*n.delay).attr("x1",m).attr("x2",m),lt.selectAll(".dayAvgTextX").attr("x",t=>{const e=m(t);return e+(e>xt/2?-2:2)}).style("text-anchor",t=>{const e=m(t);return e>xt/2?"end":"start"}).text(t=>g(t,"y2Val")),lt.selectAll(".dayAvgLineY").attr("stroke",t=>{const e=p(t);return e>i/2?s.xyStroke:s.stroke}).transition().delay((t,e)=>e*n.delay).attr("y1",p).attr("y2",p),lt.selectAll(".dayAvgTextY").attr("y",t=>{const e=p(t);return e>i/2?e-2:e+parseInt(u[1])+1}).text(t=>g(t,"yVal"))}():"calView"===e.graphType?function(){const e=n.node,a=e.radius?_t/2:null;(it=(it=lt.selectAll(".day").data(t=>t.values)).enter().append("rect").on("click",(e,a)=>{ye(e,0,a),F.click&&F.click(e,{container:t,selector:"daily"},{d:a,details:details})}).on("mouseenter",function(e,a){re(this,"yellow",3);const o={name:a.key,value:a.yVal,y2Val:a.y2Val};qt(o),F.mouseenter&&F.mouseenter(e,{container:t,selector:"daily"},o)}).on("mouseleave",function(e,a){re(this,null,1),ne(),F.mouseleave&&F.mouseleave(e,{container:t,selector:"daily"},a)}).on("mouseover",oe).attr("class",t=>"day c_"+t.key).attr("stroke",e.stroke).style("shape-rendering","crispEdges").attr("y",0).attr("x",t=>{const e=new Date(t.key);return i(e)*_t}).merge(it)).attr("width",_t).attr("height",_t).attrs({rx:a,ry:a}).style("fill",t=>void 0===t.y2Val?e.fillEmpty:t.y2Val?At(t.yVal):`url('${n.id}c2iTip')`).transition().delay((t,e)=>e*n.delay).attr("x",t=>{const e=new Date(t.key);return i(e)*_t}).attr("y",t=>{const e=new Date(t.key),a=s(e)-s(new Date(pt(e),c(e)-1,1));return a*_t})}():ie()}function ie(){const e=n.byMon,o=a.getScale("time"),r=a.getScale(e.yScale),i=a.getScale(e.yScale),s=5*_t,c=n.node,d=Z(U),u=Z(j),m=xt/31*.8,p=m,g=p/2,h=d[0]<0;if(r.domain(d).range([s,0]),i.domain(u).range([s,0]),o.domain([1,31]).range([1,xt-m]),function(t,a){const o=n.byYear,r=o.height,l=t=>t.unitNm?t.caption+" "+t.unitNm:t.caption,i=[{x:-12,y:r,text:l(R),mode:"tb"},{x:0,y:r-1,text:e.tipFormat(t[1])},{x:-g,y:r+6*_t,text:1},{x:xt/2,y:r+6*_t,text:15,anchor:"middle"},{x:xt+g,y:r+6*_t,text:30,anchor:"end"}];"bar"!==e.graphType&&(i.push({x:Se()-20,y:r-1,text:o.tipFormat(a[1]),anchor:"end"}),i.push({x:Se()-10,y:r+6*_t,text:o.tipFormat(a[0]),anchor:"end"}),i.push({x:Se()-10,y:r,text:l(V),mode:"tb"}));const s=R.fonts,c=[];let d="",u=0,m=0;n.data.forEach(()=>c.push(i));const p=f.selectAll(".gAxis").data(c),h=p.enter().append("g").attr("class","gAxis").merge(p).attr("transform",(t,e)=>"translate("+[De(),e*gt]+")").selectAll("text").data(t=>t);h.enter().append("text").style("font-family",s[0]).style("font-size",s[1]).style("fill",s[2]).style("writing-mode",t=>t.mode?t.mode:null).style("text-anchor",t=>t.anchor?t.anchor:null).merge(h).attr("x",(t,e)=>{if(e<5)return t.x;const a=u++<3?0:1;d!==n.data[a].key&&(d=n.data[a].key,m=Me()*n.data[a].values.length/12);const o=e%7?0:10;return m+o}).attr("y",t=>t.y).text(t=>t.text)}(d,u),(it=(it=lt.selectAll(".day").data(t=>t.values.filter(t=>void 0!==t.y2Val),l)).enter().append("rect").on("click",(e,a)=>{ye(e,0,a),F.click&&F.click(e,{container:t,selector:"daily"},{d:a,details:details})}).on("mouseenter",function(e,a){re(this,"yellow",3);const o={name:a.key,value:a.yVal,y2Val:a.y2Val};qt(o),F.mouseenter&&F.mouseenter(e,{container:t,selector:"daily"},o)}).on("mouseleave",function(e,a){re(this,null,1),ne(),F.mouseleave&&F.mouseleave(e,{container:t,selector:"daily"},a)}).on("mouseover",oe).attr("class",t=>"day c_"+t.key).attr("stroke",null).attr("fill-opacity",c.opacity).style("shape-rendering","crispEdges").merge(it)).style("fill",t=>t.y2Val?At(t.yVal):"none").attr("width",t=>t.y2Val?m:0).attr("x",t=>o(new Date(t.key).getDate())).attr("y",t=>h&&t.yVal<0?r(0):r(t.yVal)).transition().delay((t,e)=>e*n.delay).attr("height",t=>0===t.yVal?0:h?Math.abs(r(t.yVal)-r(0)):r(0)-r(t.yVal)),"barLine"===e.graphType){const t=xt+Ft,e=e=>{const n=new Date(e.key).getMonth()*t+g;return d3.line().curve(a.curve[V.curve]).defined(t=>V.drawZero&&void 0!==t.y2Val).x(t=>o(new Date(t.key).getDate())+n).y(t=>void 0===t.y2Val?s:i(t.y2Val))(e.values)};let n=rt.selectAll(".dayLine").data(t=>t.values,l);n.enter().append("path").attr("class","dayLine").attr("stroke",V.color).style("fill","none").merge(n).attr("d",t=>e(t)).each(function(){a.pathShow({sel:d3.select(this),dr:500,dashLen:0})})}else if("barDot"===e.graphType){let t=lt.selectAll(".dayCnt").data(t=>t.values.filter(t=>void 0!==t.y2Val),l);(t=t.enter().append("circle").style("pointer-events","none").attr("class",t=>"dayCnt c_"+t.key).attr("stroke","none").style("fill",V.color).style("fill-opacity",c.opacity).style("shape-rendering","crispEdges").merge(t)).attr("cx",t=>o(new Date(t.key).getDate())+g).transition().delay((t,e)=>e*n.delay).attr("r",t=>t.y2Val?p:0).attr("cy",t=>i(t.y2Val))}const y=R.fonts,_=.9*c.strokeWidth;function x(t){return r(t.avg)}function v(t){const e=Q(t);return e?i(t.y2Val/e):0}function b(t,a){const o=Q(t);return o?e.tipFormat(t[a]/o):"없음"}lt.select(".monthRect").empty()&&lt.append("rect").attr("class","monthRect").attr("fill","none").attr("stroke",c.stroke).style("stroke-width",c.strokeWidth).merge(lt.select(".monthRect")),lt.selectAll(".monthRect").attr("width",xt).attr("height",s),lt.select(".dayAvgText.Y").empty()&&lt.append("text").attr("class","dayAvgText Y").style("font-family",y[0]).style("font-size",y[1]).style("fill",y[2]).merge(lt.select(".dayAvgText.Y")),lt.select(".dayAvgText.Y2").empty()&&"bar"!==e.graphType&&lt.append("text").attr("class","dayAvgText Y2").style("font-family",y[0]).style("font-size",y[1]).style("fill",y[2]).style("text-anchor","end").merge(lt.select(".dayAvgText.Y2")),lt.selectAll(".dayAvgText.Y").attr("x",2).attr("y",parseInt(y[1])).text(t=>b(t,"yVal")),"bar"!==e.graphType&&lt.selectAll(".dayAvgText.Y2").attr("x",xt-2).attr("y",parseInt(y[1])).text(t=>b(t,"y2Val")),e.isDayAvgLine&&(lt.select(".dayAvgLine.Y").empty()&&lt.append("line").attr("class","dayAvgLine Y").style("stroke-width",_).style("stroke-dasharray",3).style("stroke",R.color).merge(lt.select(".dayAvgLine.Y")),lt.select(".dayAvgLine.Y2").empty()&&"bar"!==e.graphType&&lt.append("line").attr("class","dayAvgLine Y2").style("stroke-width",_).style("stroke-dasharray",3).style("stroke",V.color).merge(lt.select(".dayAvgLine.Y2")),lt.selectAll(".dayAvgLine.Y").attr("y1",x).attr("y2",x),"bar"!==e.graphType&&lt.selectAll(".dayAvgLine.Y2").attr("y1",v).attr("y2",v),lt.selectAll(".dayAvgLine").transition().delay((t,e)=>e*n.delay).attr("x2",xt)),function(){let t=h?n.data.map(()=>d[0]):[];const e=n.zero,a=f.selectAll(".yZeroLine").data(t);a.exit().remove(),a.enter().append("line").attr("transform","translate("+De()+","+n.byYear.height+")").attr("class","yZeroLine").style("shape-rendering","crispEdges").attr("x1",0).style("stroke-opacity",e.opacity).merge(a).attr("stroke",e.stroke).attr("stroke-width",e.strokeWidth).attr("x2",(t,e)=>Me()*n.data[e].values.length/12).attr("y1",(t,e)=>e*gt+r(0)).attr("y2",(t,e)=>e*gt+r(0)),t=h?n.data.map(()=>0):[];const o=f.selectAll(".yZeroValue").data(t);o.exit().remove(),o.enter().append("text").attr("transform","translate("+De()+","+n.byYear.height+")").attr("class","yZeroValue").style("font-family",y[0]).style("font-size",y[1]).style("fill",e.stroke).style("text-anchor","end").attr("x",-1.5).text("0").merge(o).attr("y",(t,e)=>e*gt+r(0)+3)}()}function se(t,e){let a="",o=0,r=0,l=0;n.data.some(e=>{if(pt(t)===e.key)return a=e.yVal,o=e.y2Val,e.values.forEach(t=>{t.y2Val&&l++;let e=0,a=0;t.values.forEach(t=>{t.y2Val&&(a++,e+=t.yVal)}),t.workDays=a,t.dAvg=a?e/a:0,r+=a}),e.workMonths=l,e.workDays=r,!0});const i=n.byYear,s=n.byMon,c=s.tipFormat,d=s.formatAvg;let m=pt(t)+i.unitNm+": "+c(a);if(m+=" ("+u(o)+"건, 건당: ",m+=o?d(a/o):"없음",m+=", "+r+"일, 일평균: ",m+=r?d(a/r):"없음",m+=", 월평균: "+(l?d(a/l):"없음")+")",!tt)return m;let p=e?e+i.unitNm+" ":"";p+="monthAgg"===et?s.unitNm+" "+R.caption:s.caption;const g=L.gen;return m=m+": "+p+" "+g.by+" ",m+="desc"===tt?g.desc:g.asc}function ce(t){const e=Mt>-1?wt:0;return"translate("+[0,7*_t+n.byYear.height+e+t]+")"}function de(t,e,o,r){t&&t.stopPropagation(),o?(K=""===K?"desc":"desc"===K?"asc":"",ue(e),s(),(ot=g.selectAll(".gGroupBy2").data(n.data,l)).transition().duration(yt).delay(Nt).attr("transform",(t,e)=>"translate("+[De(),e*gt]+")")):(e&&(tt=""===tt?"desc":"desc"===tt?"asc":"",me(e),""===tt&&(et="")),s(),function(){nt.style("fill",()=>tt?n.title&&n.title.subFonts[3]?n.title.subFonts[3]:"orange":n.byYear.fonts[2]).text(t=>("",se(new Date(t.key),"")));const t=n.byMon.lineChart,e=n.byMon.dotCircle;if(t&&t.draw){e.fillText[2];at.selectAll(".monthLine").attr("transform",ce(10)).attr("d",t=>Yt(t.values)).each(function(){a.pathShow({sel:d3.select(this),dr:yt,dashLen:0})});let o=Ot();if(n.isAvgLine){at.selectAll(".monthRectAll").attr("transform",ce(10)).attr("width",Se()-1),at.selectAll(".minMonth").attr("transform",ce(10)).attr("x",Se()-3),at.selectAll(".maxMonth").attr("transform",ce(10)).attr("x",Se()-3),at.selectAll(".avgLine").attr("transform",ce(10)).attr("x2",Se()-1).attr("y1",o).attr("y2",o);const a=d.invert(o),n=d3.rgb(t.stroke).brighter();at.selectAll(".avgText").style("fill",t=>void 0!==t.avg&&t.avg-a>0?n:e.fillText[0]).attr("transform",ce(10)).attr("x",Se()/2)}at.selectAll(".monthValues").attr("transform",ce(10)),at.selectAll(".monValue").data(t=>t.values,l).transition().duration(yt).delay(Nt).attr("transform",(t,e)=>{const a=Wt(t,e);let n=d(t.yVal);return`translate(${[a,n=n>o?n-20:n+20]})`})}e&&e.draw&&(at.selectAll(".circles").attr("transform",ce(10)),at.selectAll(".monthDot").data(t=>t.values,l).transition().duration(yt).delay(Nt).attr("cx",Wt).attr("cy",t=>d(t.yVal)))}(),function(){const t=n.byMon.lineChart;if(!t.fillColor)return;ot=f.selectAll(".gGroupBy2").data(n.data,l),t&&t.draw&&ot.selectAll(".monthLine2").attr("transform",ce(10)).attr("d",t=>zt(t.values)).each(function(){a.pathShow({sel:d3.select(this),dr:yt,dashLen:0})});const e=n.byMon.dotCircle;e&&e.draw&&(ot.selectAll(".circles2").attr("transform",ce(10)),ot.selectAll(".monthDot2").data(t=>t.values,l).transition().duration(yt).delay(Nt).attr("r",t=>t.yVal_2===k.sparseVal?0:e.radius).attr("cx",Wt).attr("cy",t=>T(t.yVal_2)));ot.selectAll(".lgGhost").attr("transform",ce(5)),ot.selectAll(".rectGhost").data(t=>t.values,l).transition().duration(yt).delay(Nt).attr("x",(t,e)=>e*Rt).attr("y",(t,e)=>-wt).attr("width",xt),ot.selectAll(".lgMonth").attr("transform",ce(5)),ot.selectAll(".rectMonth").data(t=>t.values,l).attr("y",(t,e)=>-wt).attr("width",0).transition().duration(yt).delay(Nt).attr("x",(t,e)=>{const a=t.yVal_2/t.yVal;if(!isNaN(t.yVal_2)&&t.yVal_2>0&&t.yVal>0&&a<=1){const t=Ct(a);return e*Rt+xt-t}return 0}).attr("width",t=>{const e=t.yVal_2/t.yVal;if(!isNaN(t.yVal_2)&&t.yVal_2>0&&t.yVal>0&&e<=1){const t=Ct(e);return t}return 0}),ot.selectAll(".lgValue").attr("transform",ce(5)),ot.selectAll(".lgMonValue").data(t=>t.values,l).transition().duration(yt).delay(Nt).attr("transform",(t,e)=>`translate(${e*Rt+xt}, ${-wt-1})`)}());const i=n.title;if(i&&i.subCaption){const t=n.byYear,e=L.gen,a="yearAgg"===J?t.unitNm+" "+R.caption:t.caption;let o,r=i.subCaption;"desc"===K?(r+=": "+a+" "+e.by+" "+e.desc,o=i.subFonts[3]):"asc"===K?(r+=": "+a+" "+e.by+" "+e.asc,o=i.subFonts[3]):o=i.subFonts[2],g.select(".subtitle").style("fill",o).text(r)}function s(){(at=g.selectAll(".gGroupBy").data(n.data,l)).transition().duration(yt).delay(Nt).attr("transform",(t,e)=>"translate("+[De(),e*gt]+")"),(lt=rt.selectAll("g.month").data(t=>t.values,l)).transition().duration(yt).delay(Nt).attr("transform",Vt)}}function ue(t){"year"===(J=t)?n.data=n.data.sort("desc"===K?(t,e)=>new Date(e.key)===new Date(t.key)?d3.descending(t.__id,e.__id):new Date(e.key)-new Date(t.key):"asc"===K?(t,e)=>new Date(e.key)===new Date(t.key)?d3.ascending(t.__id,e.__id):new Date(t.key)-new Date(e.key):(t,e)=>d3.ascending(t.__id,e.__id)):"yearAgg"===J&&function(){const t="yVal";n.data=n.data.sort("desc"===K?(e,a)=>a[t]===e[t]?d3.descending(e.__id,a.__id):a[t]-e[t]:"asc"===K?(e,a)=>a[t]===e[t]?d3.ascending(e.__id,a.__id):e[t]-a[t]:(t,e)=>d3.ascending(t.__id,e.__id))}()}function me(t){"month"===(et=t)?n.data=n.data.map(t=>(t.values.sort("desc"===tt?(t,e)=>new Date(e.key)===new Date(t.key)?d3.descending(t.__id,e.__id):new Date(e.key)-new Date(t.key):"asc"===tt?(t,e)=>new Date(e.key)===new Date(t.key)?d3.ascending(t.__id,e.__id):new Date(t.key)-new Date(e.key):(t,e)=>d3.ascending(t.__id,e.__id)).forEach((t,e)=>{t.__seq=e}),t)):"monthAgg"===et&&function(){const t="yVal";n.data=n.data.map(e=>(e.values.sort("desc"===tt?(e,a)=>a[t]===e[t]?d3.descending(e.__id,a.__id):a[t]-e[t]:"asc"===tt?(e,a)=>a[t]===e[t]?d3.ascending(e.__id,a.__id):e[t]-a[t]:(t,e)=>d3.ascending(t.__id,e.__id)).forEach((t,e)=>t.__seq=e),e))}()}function pe(){const t=n.margin,e=ft+xt+ht+t.bottom+(Mt>-1?wt:0);return n.height=e*n.data.length+(n.title?t.top:0)+10,e}function ge(){gt=pe(),g.attr("height",n.height+5),f.selectAll([".monthRectAll, .monthLine, .minMonth, .maxMonth, .avgLine, .avgText, .circles, .monthValues"]).transition().duration(yt).attr("transform",ce(10)),f.selectAll(".gGroupBy").attr("transform",(t,e)=>"translate("+[De(),e*gt]+")"),f.selectAll(".gAxis").attr("transform",(t,e)=>"translate("+[De(),e*gt]+")")}function fe(){const t=(Me()-11*Ft)/12/7;xt=7*(_t=t),Ct.range([0,xt]),gt=pe(),Rt=xt+Ft}function he(){const t=n.byMon;t.lineChart.fillColor=null,Mt=-1,f.selectAll(".gGroupBy2").remove(),ge(),t.graphType.indexOf("bar")>-1&&t.isDayAvgLine&&ie()}function ye(t,e,a){if(!t.altKey||!x)return;let r=[];const l=d3.timeFormat(n.formats[e]),i=(a.key,a.key);r=x(-1,!0).filter(t=>l(new Date(t[n.groupBy]))===l(new Date(i))),o.renderList()(-1,r)}function _e(){if(!g||!r.node().clientWidth)return;n.nonComponent?A=r.node().clientWidth:(A=parseInt(r.style("width"),10),n.height=parseInt(r.style("height"),10),n.height||(n.height=parseInt(A/n.aspect))),fe();const t=n.optWin;g.select(".gMenu").attr("transform",`translate(${A-(t.optBtnHide?0:15)}, 3)`),g.attr("width",A).attr("height",n.height+5),a.renderTitle(n,g,A,De,Se,Te);let e=A/gt/n.aspect;e>1&&(e=1),d.range([ht*e,0]),de(),Jt(),nt.attr("x",6*xt+11*Ft/2),lt.attr("transform",Vt),le()}function xe(){const t=n.byYear;ft=isNaN(t.height)||!t.draw?30:t.height}function ve(){const t=n.byMon.lineChart;ht=isNaN(t.height)||!t.draw?0:t.height,d.range([ht,0])}function be(){const t=h.filter(j);switch(w=d3.extent(t,U),n.node.scale){case"Quantile":At.domain(t.map(U));break;case"Quantize":At.domain(w);break;default:At.domain(w).nice()}}function ke(){n.node.isVertical?(St=150,Tt.range([St,0]),N=d3.axisLeft().tickPadding(5).tickSize(-15)):(St=260,Tt.range([0,St]),N=d3.axisBottom().tickPadding(5).tickSize(15))}function Ce(){const t=n.node;At="Quantile"===n.node.scale?d3.scaleQuantile():d3.scaleQuantize(),be(),ke();let e=a.getColorScheme(t.color);const o=e.length;if(y){const a=At.domain().length;let n=!1;t.colorCnt>o||0===t.color.indexOf("C2i")?(t.colorCnt=o,n=!0):a>t.colorCnt&&(t.colorCnt=Math.min(t.colorCnt,o,a),n=!0),n&&y.colorCnt!==t.colorCnt&&(y.colorCnt=t.colorCnt),e=e.filter((e,a)=>a<t.colorCnt)}else o>t.colorCnt?e=e.filter((e,a)=>a<t.colorCnt):t.colorCnt=o;At.range(e)}function we(t,e){g.select(".gMenu").select(t).style("opacity",e)}function Ne(){!function(){function t(t,e){"function"!=typeof t.format&&(e.format=a.formatAll(t.format,d3.format(",.0f")),e.formatAvg=a.formatAll(t.formatAvg,e.format),e.tipFormat=a.formatAll(t.tipFormat,d3.format(",.0f"))),t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),e.fonts=e.fonts?e.fonts:O.fonts}O=n.xDim,R=n.yDim,V=n.y2Dim,O&&O.tipFormat&&(n.formats[0]=O.tipFormat),V&&t(V,n.byYear),R&&t(R,n.byMon)}(),xe(),ve(),Ce(),function(){k=void 0,D=[],n.cols.filter(t=>t.isMeasure).forEach(t=>{D.push(t.colNm),t.isSelected&&(k=t)}),k||(k=n.cols[0]);k.sparseVal=n.sparseVal}(),st=(st=function(){C=d3.extent(h,q);const t=new Date(C[0]),e=t.getFullYear(),a=t.getMonth(),o=new Date(C[1]),n=o.getFullYear(),r=o.getMonth()+1;return m(e,a,n,r)}()).map(t=>{let e={};return e.key=ut(t),h.some(t=>{if(ut(t.key)===e.key)return e={key:e.key,...t.value},!0}),e}),Ae(),K=n.byYear.sort,ue(n.byYear.sortBy)}function Ae(){n.data=d3.nest().key(t=>mt(new Date(t.key))).entries(st),n.data=d3.nest().key(t=>(t.yVal=0,t.y2Val=0,t.values.forEach(e=>{void 0===e.yVal&&void 0===e.y2Val||(t.yVal+=e.yVal,t.y2Val+=e.y2Val,t.isValid=!0)}),pt(new Date(t.key)))).entries(n.data),C=[],n.data.sort((t,e)=>e.key-t.key?-1:1),n.data=n.data.map((t,e)=>{t.yVal=0,t.y2Val=0,t.values.forEach((e,a)=>{t.yVal+=e.yVal,t.y2Val+=e.y2Val,e.__seq=a,e.__id=a}),t.__id=e;const a=d3.extent(t.values.filter(t=>t.isValid),t=>t.yVal);return C.push(a[0]),C.push(a[1]),t}),C=d3.extent(C),d.domain(C)}function Le(t){if(t){const e=n.node;e.scale=t.lgScale,e.color=t.color,e.colorCnt=t.colorCnt,e.rotate=t.rotate,e.contentGab=t.contentGab,n.byMon.siblingGap=Ft=t.siblingGap,e.radius=t.isCircle,a.optionSetting(n,t)}M=!g,o.expandToggle(),Ce(),d3.select("#c2iOption_"+n.id.substr(1)).style("opacity",n.optWin.opacity)}function De(){return n.margin.left}function Se(){return A-n.margin.right}function Te(){return n.height-n.margin.bottom}function Me(){return A-n.margin.left-n.margin.right}xe(),ve(),o.render=function(){if(fe(),g?(be(),st=st.map(t=>{let e={};return e.key=t.key,h.some(t=>{if(ut(t.key)===e.key)return e={key:e.key,...t.value},!0}),e}),Ae(),et&&(me(et),function(){at.data(n.data,l).selectAll(".monthLine").attr("transform",ce(10)).attr("d",t=>Yt(t.values)).each(function(){a.pathShow({sel:d3.select(this),dr:yt,dashLen:0})}),at.selectAll(".circles").attr("transform",ce(10)),(lt=at.selectAll("g.month").data(t=>t.values,l)).transition().duration(yt).delay(Nt).attr("transform",Vt),at.selectAll(".monthDot").data(t=>t.values,l).transition().duration(yt).delay(Nt).attr("cx",Wt).attr("cy",t=>d(t.yVal));const t=n.byMon.lineChart;if(t&&t.draw){let t,e,a=Ot();at.selectAll(".monValue").data(t=>t.values,l).transition().duration(yt).delay(Nt).attr("transform",(o,n)=>(t=Wt(o,n),e=d(o.yVal),`translate(${[t,e=e>a?e-20:e+20]})`))}}()),K&&ue(J)):(n.aspect=A/gt,g=r.append("svg").attr("width",A).attr("height",n.height+5).attr("class","c2iCalView").on("mouseenter",()=>a.curOptWin(n,!0)).on("mouseleave",()=>a.curOptWin(n,!1)),function(){if(!n.optWin)return;const t=n.node,e=n.byMon,r=a.preset(n),l=a.loadOption(r);_=new dat.GUI({name:n.id.substr(1),autoPlace:!1,closeOnTop:!0,load:l||JSON,preset:r}),y=new function(){const r={...a.optionConstructor(n,o,I,M,L)};for(const t in r)this[t]=r[t];let l=Bt.findIndex(e=>e===t.scale);this.lgScale=Et[l],this.color=t.color,this.colorCnt=t.colorCnt,this.rotate=t.rotate,this.contentGab=t.contentGab,this.isVertical=t.isVertical,e.onlyCalview||(l=Gt.findIndex(t=>t===e.graphType),this.graphType=Pt[l],this.scatterScaleX=e.xScale,this.scatterScaleY=e.yScale),this.siblingGap=Ft=e.siblingGap,this.isCircle=!!t.radius,this.isDayAvgLine=e.isDayAvgLine,this.isAvgLine=n.isAvgLine},_.remember(y),l&&Le(l.remembered[r][0]);a.makeDefaultOption(n,o,_,z,y,L);const i=_.addFolder(L.gen.lgOption);i.add(y,"lgScale",Et).name(L.gen.lgScale).onChange(t=>{const e=Et.findIndex(e=>e===t);o.lgScaleChange(Bt[e])}).listen(),i.add(y,"color",a.colorSchemes).name("범례 색상").onChange(e=>{t.color=e,Ce(),he(),o.render()}),i.add(y,"colorCnt",2,12,1).name("범례 색상 갯수").onChange(e=>{t.colorCnt=e,Ce(),Mt>S.length&&he(),o.render()}).listen(),i.add(y,"rotate",0,45,1).name("눈금 값 회전").onChange(e=>{t.rotate=-e,Ht()}),i.add(y,"contentGab",0,100,1).name("제목과 범례 간격").onChange(e=>{t.contentGab=e,Ht()}),i.add(y,"isVertical").name("수직 범례").onChange(e=>{t.isVertical=e,ke(),g.select(".c2iLgQuantile").remove(),Ht()});const s=_.addFolder(L.gen.graphType);e.onlyCalview||(s.add(y,"graphType",Pt).name("일별 차트").onChange(t=>{const a=Pt.findIndex(e=>e===t);e.graphType=Gt[a],c()}),s.add(y,"scatterScaleX",["linear","sqrt"]).name("산포도 X축").onChange(t=>{e.xScale=t,"scatter"===e.graphType&&c()}),s.add(y,"scatterScaleY",["linear","sqrt"]).name("산포도,막대/점 Y축").onChange(t=>{e.yScale=t,"calView"!==e.graphType&&c()}));function c(){f.selectAll(".day,.dayCnt,.dayLine,.monthRect,.dayAvgTextX,.dayAvgLineX,.dayAvgTextY,.dayAvgLineY,.dayAvgText,.dayAvgLine,.yZeroLine,.yZeroValue,.gAxis").remove(),le()}s.add(y,"siblingGap",0,8,1).name("월별 간격").onFinishChange(t=>{e.siblingGap=Ft=t,_e()}),s.add(y,"isCircle").name("일별 원형").onChange(a=>{t.radius=a?_t/2:null,"calView"===e.graphType&&_e()}),s.add(y,"isDayAvgLine").name("월별 일 평균선").onChange(t=>{e.isDayAvgLine=t,-1!==e.graphType.indexOf("bar")&&(t?ie():f.selectAll(".dayAvgLine").style("stroke-width",2).style("stroke-dasharray",0).transition().duration(500).attr("x2",0).remove())}),s.add(y,"isAvgLine").name("전체 월 평균선").onChange(t=>{if(n.isAvgLine=t,t)f.remove(),f=null,ee(),Jt(!0);else{const t=d3.transition().duration(500);f.selectAll(".monthRectAll").transition(t).attr("width",0),f.selectAll(".avgLine").transition(t).attr("x2",0),f.selectAll(".minMonth, .maxMonth, .avgText").transition(t).attr("x",-Se())}}),a.makeBrushOption(n,o,_,y,g,()=>A)}(),a.setDefs(!0,g,n),a.renderTitle(n,g,A,De,Se,Te),function(){const t=n.tooltip;let e=[{id:"lgScale",img:"categorize.png",tip:"범례 스케일링.\n 1.최소~대 정밀분할: 최소,최대값 기준으로 n등분(기본 설정)\n 2.최소~대 간편분할: 1)번과 유사하나, 단수 값 정리\n 3.정렬 균등분할: 모든 값을 순위 & 정렬하여, 가능하면 구간별 같은 데이터 건수 설정.(값이 다른 데이터가 n개 이상 필요)"},{id:"tooltip",img:"tooltip.png",tip:"툴팁",opacity:t&&t.isShow?1:.4},{id:"expand",img:"expand.png",tip:"확장&축소\n: 축소시 이 차트는 그리지 않습니다."},{id:"export",img:"export.png",tip:"익스포트(이미지&데이터)"}],r={_svg:g,_width:A,_showToolbar:z,_dimension:I,cfg:n};r={...r,chart:o,menus:e,isLgScale:!0},a.renderMenu(r)}(),K="",J="",tt="",et=""),ee(),Ht(),Mt>-1){const t=S[Mt];t&&Kt(t)&&Jt(!0)}return o},o.resize=_e,o.byYear=function(t){return arguments.length?(n.byYear=t,xe(),o):n.byYear},o.byMon=function(t){return arguments.length?(n.byMon=t,ve(),o):n.byMon},o.node=function(t){return arguments.length?(n.node=t,Ce(),o):n.node},o.cols=function(t){return arguments.length?(n.cols=t,o):n.cols},o.data=function(t){return arguments.length?(h=t,Ne(),o):h},o.clear=function(){return g&&(g.remove(),g=f=void 0,a.removeOptionDom(n)),o},o.title=function(t){return arguments.length?(n.title=t,a.renderTitle(n,g,A,De,Se,Te),o):n.title},o.exportData=((t,e)=>{const{caption:o,colNms:r,colCaptions:l,data:i,filters2:s}={...a.exportFilters(n,e,P,j,ut,h)};a.exportData(o,r,l,i,t,e,O)}),o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),L=c2i.lang,o):n.lang},o.dimension=function(t){return arguments.length?(I=t,o):I},o.group=function(t){return arguments.length?(B=t,o.data(B.all()),o):B},o.groupAll=function(t){return arguments.length?(E=t,o):E},o.hasCurrentFilter=(()=>I&&I.hasCurrentFilter()),o.filterValues=function(){let e,a;const o=n.byMon,r=n.title&&n.title.caption?n.title.caption:t;return e=O.caption?O.caption:"X",e+="; "+Y.map(t=>o.tipFormat?o.tipFormat(t):t),a=Y.map(t=>t),{c2iCon:t,title:r,filters:e,filterRaws:a,colNm:"c2iFact"===n.groupBy?n.fact:n.groupBy,scale:O.scale}},o.expandToggle=(()=>{let t=null,e=null;M=!M,y.expand=M,M||(t="27px",e="none"),g.transition().style("height",t),g.select(".c2iLgQuantile").attr("display",e)}),o.isShow=(()=>M),o.lgScaleChange=(t=>{if(n.node.scale===t)return;n.node.scale=t||"Quantize";const e=Bt.findIndex(t=>t===n.node.scale);y.lgScale=Et[e],Ce(),o.render()}),o.toolbarToggle=((t,e)=>(z=a.toolbarToggle(t,n,g,z,e),o)),o.toolbarStatus=(()=>z),o.toolbarShrink=(()=>{(H=!H)?_.show():_.hide()}),o.toolbarShrinkStatus=(()=>H),o.saveOption=(()=>a.saveOption(_)),o.initOption=(()=>{a.removeOption(_);const t=n.title.caption;(n=a.mergeMeta(n,c2i.meta.insight,c2i.meta.iCalView)).title.caption=t,he(),Le(),o.clear(),o.render()}),o.tooltipToggle=(()=>y.tooltip=a.tooltipToggle(n,we)),o.container=function(t){return arguments.length?($=(p=t).aggInfos,G=p.isAvg,P=p.chartFilters,x=p.listData,v=p.renderList,o):p},o.aggInfos=function(t){return arguments.length?($=t,o):$()},o.isAvg=function(t){return arguments.length?(G=t,o):G()},o.chartFilters=function(t){return P=t,o},o.listData=function(t){return arguments.length?(x=t,o):x(-1)},o.renderList=function(t){return arguments.length?(v=t,o):v},o.renderAll=function(t){return arguments.length?(b=t,o):b()};return n.isResponsive&&a.resizeChart(n,t,_e,null),a.rebind(o,X,"on")},c2i.bi.iCountry=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;(e=e||{}).method=e.method||{};const o={};let n={isResponsive:!0,width:"100%",height:400,margin:{top:5,left:5,right:5,bottom:5},aspectRatio:"1:1.2",easing:"linear",duration:750,delay:10,data:void 0,title:void 0,map:void 0,mapping:void 0,area:void 0,mark:void 0,content:void 0,dim:void 0,tooltip:void 0,isDev:void 0};a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);let l,i,s,c,d,u,m,p,g,f,h,y,x,v,b,k,C,w,N,A,L,D,S,T,M,F,I=a.computeDim(r,n),B=c2i.lang,E=0,G=1,P=[],O=[],R=!0,V=n.xDim,W=n.yDim,Y=n.y2Dim,z=n.statistics,H=!(!z||!z.showToolbar)&&z.showToolbar,$=!0,X=0;const q=d3.zoom().scaleExtent([1,50]).on("zoom",function(t){if(!s)return;const e=[t.transform.x,t.transform.y],r=t.transform.k;s.attr("transform",`translate(${[_e()+e[0],be()+e[1]]})scale(${r})`),t.sourceEvent&&!o.zoomed()&&re(".resetFilter",1);if(G===r)return;bt&&It(r.toFixed(2));let l,i,c,p,g;G=r,Ft(),d3.select(n.id+"c2iTip").attr("patternTransform",`scale(${1/G})`),l=i=c=p=0,g=3,"mark"===n.content.place?s.selectAll(".content").attr("transform",t=>{const e=2*C(t[W.colNm])+3,a=0===i?e:i;return"translate("+[-l/G,(-a+e)/G]+")"}):s.selectAll(".content").attr("transform",t=>{const e=u.centroid(t);return"translate("+[e[0]-l/G,e[1]-i/G]+")"});if(s.selectAll(".cText").attr("dx",c).attr("dy",0+X*(-10/G)).style("font-size",parseFloat(W.fonts[1])/G+"px"),s.selectAll(".cMark").attr("r",t=>C(t[W.colNm])/G),a.isIE()){console.log("Supporting for IE.");const t=1/(lt.gLevel+1)/G;lt.gLevel>0&&(d.selectAll(".ghost.L1").style("stroke-width",1.2*t+"px"),d.selectAll(".ghost.L2").style("stroke-width",t+"px")),m.style("stroke-width",1.2*t+"px")}});let U=()=>{};const j=d3.brushX(),Z=t=>t[V.colNm],Q=t=>t.value[W.colNm],K=t=>t.value.yVal_sum,J=t=>t.value[Y.colNm];let tt,et,at,ot,nt="cd",rt="nm",lt=n.map,it=!1;const st=d3.drag().on("start",function(t){const e=t.sourceEvent;e.stopPropagation(),it=!1,e.srcElement.className.indexOf("slider")>-1&&(it=!0);tt=parseFloat(d3.select(this).style("left"))-e.pageX,et=parseFloat(d3.select(this).style("top"))-e.pageY}).on("drag",function(t){if(it)return;d3.select(this).classed("optionPosition")&&d3.select(this).classed("optionPosition",!1);const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",()=>e.pageX+tt+"px").style("top",()=>e.pageY+et+"px")}).on("end",function(){if(it)return;d3.select(this).style("opacity",1)}),ct=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this).style("opacity",.5)}).on("drag",function(t){const e=t.sourceEvent,a=e.offsetX?e.offsetX:t.x,o=e.offsetY?e.offsetY:t.y;a>0&&a<I&&o>0&&o<n.height-20&&d3.select(this).attr("transform","translate("+[a,o]+")")}).on("end",he),dt=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this.parentNode).style("opacity",.5)}).on("drag",function(t){const e=t.sourceEvent,a=e.offsetX?e.offsetX:t.x,o=e.offsetY?e.offsetY:t.y;if(a>0&&a<ke()&&o>0&&o<n.height-20){const t=[a,o];d3.select(this.parentNode).attr("transform","translate("+t+")")}}).on("end",function(){d3.select(this.parentNode).style("opacity",1)}),ut=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this).style("opacity",.5)}).on("drag",function(t){d3.select(this).attr("transform","translate("+[t.x,t.y-22]+")")}).on("end",he),mt=d3.format(",d");let pt=150,gt=d3.scaleLinear().range([pt,0]),ft=d3.axisLeft().tickPadding(5).tickSize(-15);const ht=t=>topojson.feature(n.dataMap,n.dataMap.objects["L"+t]),yt=d3.geoMercator(),_t=t=>n.data.find(e=>e.key===t.properties[nt]),xt=["시도","시군구","읍면동"],vt=xt.concat("일반지역 제거");let bt,kt,Ct;const wt=["Quantize","Quantize Nice","Quantile"],Nt=[B.legend.scale_Qtize,B.legend.scale_QtizeNice,B.legend.scale_Qtile];function At(){bt=null,r.select(".c2iSliderSimple").remove()}function Lt(){const t=G;bt=r.append("input").data([t]).on("input",ye).attr("class","c2iSliderSimple").attr("type","range").attr("title",t=>"줌 레벨: "+t).attr("value",t=>t).attr("min",q.scaleExtent()[0]).attr("max",q.scaleExtent()[1]).attr("step",(q.scaleExtent()[1]-q.scaleExtent()[0])/100)}function Dt(){let t;return(t=lt.autoTour?confirm("*.자동 투어 중에는 지원하지 않습니다. 투어를 종료 하시겠습니까?"):confirm("*.특정 지역 작업 중에는 지원하지 않습니다. 특정 지역 작업을 종료 하시겠습니까?"))&&(at&&(lt.autoTour=y.autoTour=!1,o.autoTour()),ot&&o.userTour()),t}function St(){let t={_svg:i,_aggBarG:S,_stat:z,cfg:n,chart:o};t={...t,_xVal:Z,_xStart:_e,_xEnd:xe,_yEnd:be,_contentH:Ce},a.renderAggBar(t)}function Tt(){const t=[],e=P.length;if(e===n.data.length)return void i.selectAll(".statInfo tspan").text("");let r=[P[0],P[e-1]];const l=n.dataMap.objects["L"+lt.level].geometries.filter(t=>t.properties[nt]&&r.indexOf(t.properties[nt])>-1).map(t=>t.properties).sort((t,e)=>t[nt]-e[nt]);if(2!==l.length){if(!l.length)return void a.alert(B.country.map_19+r);l[1]=l[0]}const s=Mt(l[0]);let c;c=1===e?s:Mt(l[1]),a.getFilterInfo(s,c,t,o),i.selectAll(".statInfo tspan").classed("c2iNegative",(e,a)=>2===a&&t[a]&&t[a].indexOf("-")>-1).html((e,a)=>t[a])}function Mt(t){return t[nt]?t[nt]+":"+t.nm+"("+t.cd+")":t.cd+":"+t.nm}function Ft(){let t=lt.level>0?lt.viewLabelEnlarge[lt.level-1]:1,e=lt.viewTypes[lt.level];s.selectAll(".placeLbl .areaLbl").attr("font-size",parseInt(e.fonts[1])/G).style("fill-opacity",G<t?0:1);const a=n.save?n.save.gLevel:h;if(a<0)return;let o=a>0?lt.viewLabelEnlarge[a-1]:lt.viewLabelEnlarge[0];lt.level!==lt.gLevel&&0===lt.gLevel&&(o=0),ot||at||(e=lt.viewTypes[a]),s.selectAll(".placeGhostLbl .ghostLbl").attr("font-size",parseInt(e.fonts[1])/G).style("fill-opacity",G<o?0:1)}function It(t){bt&&bt.property("value",t).attr("title",e=>"줌 레벨: "+t)}function Bt(){s||(s=i.insert("g","g.gTitle").attr("transform","translate("+[_e(),be()]+")").attr("class","body"),c=s.append("g").attr("class","boundary"),d=s.append("g").attr("class","boundaryGhost"),v=ht(lt.level)),yt.scale(1).translate([0,0]);const e=(u=d3.geoPath().projection(yt)).bounds(v),r=.95/Math.max((e[1][0]-e[0][0])/ke(),(e[1][1]-e[0][1])/Ce()),l=[(ke()-r*(e[1][0]+e[0][0]))/2,(Ce()-r*(e[1][1]+e[0][1]))/2];yt.scale(r).translate(l),(h=lt.gLevel)>-1?(Gt(),Pt(),function(t){if(ot||at)return;n.isDev&&console.log("_drawMesh...!!");let e=(t,e)=>t!==e;if(lt.onlyDataArea){if(lt.level===t)return;e=((t,e)=>!0)}const a=lt.viewTypes[t],o=topojson.mesh(n.dataMap,n.dataMap.objects["L"+t],e),r=d.selectAll("path").data([o]);r.exit().remove(),r.enter().append("path").attr("d",u).attr("class","ghost L"+t).attr("vector-effect","non-scaling-stroke").attr("pointer-events","none").style("fill","none").merge(r).attr("stroke",a.stroke).attr("stroke-width",a.strokeWidth)}(h)):(Pt(),(at||ot)&&Gt());const p=n.content.place;"area"!==p&&"both"!==p||!n.area||function(){n.isDev&&console.log("_drawArea...!!");m.style("fill",function(t){const e=_t(t);if(!e||!e.value.y2Val)return lt.landColor;const a=b(e.value[W.colNm]);return P.indexOf(e.key)>-1?a:(d3.select(this).attr("stroke",a),`url('${n.id}c2iTip')`)}),n.isDev&&console.log("_drawAreaContent...!!")}();const g=n.mark;("mark"===p||"both"===p)&&g&&g.symbol&&function(e){s.selectAll(".gMark").transition().style("opacity",0).remove();const a=s.append("g").attr("class","gMark").selectAll(".symbol").data((()=>void 0===e?n.data:n.data.filter(t=>t.value[W.colNm]>=e))()),o=n.mark.lonLat;a.enter().append("g").attr("class","symbol").attr("transform",t=>{const e=u.centroid(t);return console.log(e),"translate("+yt([t[o[0]],t[o[1]]])+")"}),a.append("circle").on("click",(e,a)=>{n.method.click&&n.method.click(e,{container:t,selector:"symbol"},a)}).on("mouseenter",function(t,e){$t(this,t,e,"symbol")}).on("mousemove",(t,e)=>Xt(t,e,"symbol")).on("mouseleave",function(t,e){qt(this,t,e,"symbol")}).attr("class","cMark").style("vector-effect","non-scaling-stroke").attr("r",0).style("stroke-width",W.strokeWidth).style("stroke",t=>{switch(t[W.colNm]){case C.domain()[0]:return W.minMaxColor[0];case C.domain()[1]:return W.minMaxColor[1];default:return W.stroke}}).style("fill",W.color).style("fill-opacity",0).attr("r",t=>C(t[W.colNm])/G).style("fill-opacity",n.mark.opacity),function(){const e=W.fonts;let o,r,l,i,s;o=r=l=i=0,s=3;const c=a.append("g").on("click",(e,a)=>{n.method.click&&n.method.click(e,{container:t,selector:"content"},a)}).on("mouseenter",function(t,e){$t(this,t,e,"content")}).on("mousemove",(t,e)=>Xt(t,e,"content")).on("mouseleave",function(t,e){qt(this,t,e,"content")}).attr("class","content").attr("transform",t=>{const e=2*C(t[W.colNm])+3,a=0===r?e:r;return"translate("+[-o/G,(-a+e)/G]+")"});if(!0===n.content.showLabel){const t=c.append("text").attr("class","cText").attr("x",-parseFloat(e[1])/2).attr("dy",0).style("font-family",e[0]).style("font-size",parseFloat(e[1])/G+"px").style("fill",t=>{switch(t[W.colNm]){case C.domain()[0]:return W.minMaxColor[0];case C.domain()[1]:return W.minMaxColor[1];default:return e[2]}}).attr("text-anchor","middle").style("pointer-events","none");t.append("tspan").attr("class","cName").attr("dx",parseFloat(e[1])/G/2).text(t=>t[n.content.colNm]),t.append("tspan").attr("class","cValue").style("fill",e[2]).attr("dy","1.1em").attr("x",0).text(t=>d3.format(W.format)(t[W.colNm])),X=0,n.content.subContent&&(n.content.subContent.forEach(e=>{let a;n.cols.some(t=>{if(t.colNm===e.colNm)return(a=t).color=e.color?e.color:t.fonts[2],X++,!0}),a&&t.append("tspan").attr("class","cSubValue").style("fill",a.color).attr("dy","1.1em").attr("x",0).text(t=>d3.format(a.format)(t[a.colNm]))}),X&&c.selectAll(".cText").attr("dy",0+-10*X))}}()}(),function(){if(!D)return;const t={...D.value()};a.aggSubtitle(i,t,o)}()}function Et(t){const e=u.centroid(t),a=n.height;return"31"===t.properties.cd?e[1]+=1/a+20:"34"===t.properties.cd&&(e[1]+=1/a+6),"translate("+e+")"}function Gt(){if(-1===h&&!ot)return;const t=ot?lt.level:h;let e=s.selectAll(".placeGhostLbl").data([null]);e=e.enter().append("g").attr("class","placeGhostLbl L"+t).merge(e);const a=lt.viewTypes[t];let o,r,l=[];t>-1&&lt.gShowLabel&&(l=at||ot?ht(t).features.filter(t=>{if(0===t.properties.cd.indexOf(lt.tour.cd)&&(o=t.properties[nt],r=!1,n.data.some(t=>{if(t.key===o)return r=!0,!0}),!r))return t}):ht(t).features.filter(t=>{if(o=t.properties[nt],r=!1,n.data.some(t=>{if(t.key===o)return r=!0,!0}),!r)return t}));const i=t>0&&lt.viewLabelEnlarge[t-1]>G?0:1,c=e.selectAll("text").data(l);c.exit().remove(),c.enter().append("text").attr("class","ghostLbl L"+t).attr("text-anchor","middle").attr("font-family",a.fonts[0]).style("pointer-events","none").merge(c).text(t=>t.properties.nm).attr("fill-opacity",.9*i).attr("font-size",parseInt(a.fonts[1])/G).style("fill",a.fonts[3]).attr("transform",Et)}function Pt(){let e;n.isDev&&console.log("_drawMap...!!"),lt.onlyDataArea&&n.area?(e=n.data.map(Z),e=v.features.filter(t=>{let a=!1;return e.some(e=>{if(t.properties[nt]===e)return a=!0,!0}),a})):e=v.features?v.features:v;const r=lt.viewTypes[lt.level];(m=c.selectAll("path").data(e)).exit().remove();const l=m.enter().append("path").attr("class",t=>"c2iMap _c"+t.properties.cd+" L"+lt.level).style("fill","none").attr("stroke-width",r.strokeWidth).attr("vector-effect","non-scaling-stroke").on("click",function(e,l){n.method.click&&n.method.click({container:t,selector:"map"},l.properties);const i=function(t){const e=_t(t);e&&(e.properties=t.properties);return e}(l);if(!i||!i.value.y2Val)return;const s=i.key;if(function(t,e){if(!t.altKey)return!1;if(p){const t=a.dimFn(n,V),r=p(-1,!0).filter(a=>t(a)===e);return o.renderList()(-1,r),!0}}(e,s))return;const d=P.indexOf(s),u=c.selectAll("path._c"+i.properties.cd);-1===d?(P.push(s),u.attr("stroke",r.stroke)):(u.attr("stroke",b(i.value[W.colNm])),1===P.length?P=n.data.map(Z):P.splice(d,1));let m=.4;P.length===n.data.length?(A.filterAll(),Tt()):(A.filter(a.multiValuesFilter(P)),m=1);re(".resetFilter",m),o.renderAll()}).on("mouseenter",function(t,e){if("mark"===n.content.place)return;const r=_t(e);if(r){d3.select(this).style("stroke","yellow").style("stroke-width",3);const t={name:e.properties.nm,value:r.value.yVal,y2Val:r.value.y2Val,key:r.key,cd:e.properties.cd};!function(t){const e=i.select(".c2iLgQuantile");let r=t.name+"("+t.cd+") "+W.caption;W.unitNm&&(r+=W.unitNm);let l="";if(t.y2Val){const r=W.tipFormat,i=r(t.value),s=mt(t.y2Val),c=gt(t.value),d=n.area.isVertical?{y1:c,y2:c}:{x1:c,x2:c};e.select(".indicator").transition().duration(350).attr("stroke-opacity",.8).attrs(d),l=i+(n.yDim&&n.yDim.unitNm?n.yDim.unitNm:"")+", "+s+(n.y2Dim&&n.y2Dim.unitNm?n.y2Dim.unitNm:"");const u=b.range().findIndex(e=>e===b(t.value)),m=O[u];let p={item:m,idx:u,chart:o,cfg:n,color:b,_lgData:O,_dragHtml:st,_table:Ct,_cntFmt:mt,tFmt:W.tipFormat,clsNm:"areaInfo"};if(p=a.lgStatInfo(p),kt=p.idx,Ct=p._table,n.tooltip.isShow){const{ndCnt:e,ndCntAvg:a,nY2Val:n}={...m},r=(d3.format(",.1%"),[{key:1,value:t.name,colspan:o.isAvg()?2:3,cls:"tipHeader"},{key:2,value:i,cls:"number"},{key:3,value:"-",cls:"number"},{key:4,value:s,cls:"number"}]),l=Ct.select(".areaInfo").style("display",null),c=l.selectAll("td").data(r,t=>t.key);c.exit().remove(),c.enter().append("td").attr("colspan",t=>t.colspan?t.colspan:null).merge(c).attr("class",t=>t.cls).text(t=>t.value)}}else e.select(".indicator").attr("stroke-opacity",0),r+=": 없음",n.tooltip.isShow&&Ct&&Ct.select(".areaInfo").style("display","none");e.select(".lgCaption").text(r),e.select(".lgValue").text(l)}(t)}}).on("mousemove",function(t,e){if("mark"===n.content.place)return;const a=_t(e);a&&(a.properties=e.properties,d3.select(this).attr("_c2i")||Xt(t,a,"map"))}).on("mouseleave",function(t,e){if("mark"===n.content.place)return;_t(e)&&(d3.select(this).style("stroke",null).style("stroke-width",1),function(){const t=n.tooltip;if(!t||!t.isShow)return;d3.select(".c2iMiniTip").classed("c2iHidden",!0)}())});let d,g;m=l.merge(m).attr("d",u).attr("stroke",r.stroke);let f=[];lt.showLabel&&(f=e.filter(t=>{if(d=t.properties[nt],g=!1,n.data.some(t=>{if(t.key===d)return g=!0,!0}),g)return t}));let h=s.selectAll(".placeLbl").data([null]);h=h.enter().append("g").attr("class","placeLbl").merge(h);const y=lt.level>0&&lt.viewLabelEnlarge[lt.level-1]>G?0:1,_=h.selectAll("text").data(f);_.exit().remove(),_.enter().append("text").attr("class","areaLbl L"+lt.level).attr("text-anchor","middle").attr("font-family",r.fonts[0]).style("pointer-events","none").merge(_).style("fill-opacity",y).text(t=>t.properties.nm).style("fill",r.fonts[2]).attr("font-size",parseInt(r.fonts[1])/G).attr("transform",Et)}function Ot(){let t={cfg:n,chart:o,_svg:i,dim:n.yDim,_extent:k,color:b,_lgScale:gt};t={...t={...t={...t,_xAxis:ft,_dragLgHandle:dt,_dragH:ut,_lgWH:pt,_lgData:O,_lgScale:gt,lgMouseEnter:zt,lgMouseLeave:Ht},lgClick:null,_dimAll:D,_gradeInfo:o.isAvg()?Vt:Rt},_xStart:_e,scale:n.area.scale,rotate:n.area.rotate},(t=a.renderLegend(t))&&(gt=t._lgScale,ft=t._xAxis,O=t._lgData)}function Rt(t){let e,a,o,r,l,i,s;return r=Number.MIN_VALUE,l=Number.MAX_VALUE,e=a=o=i=s=0,n.data.filter(a=>{if(!J(a))return;const n=Q(a);t[0]<=n&&n<t[1]&&(i+=J(a),e+=n,o++,n>r&&(r=n),n<l&&(l=n))}),a=0===o?0:e/o,s=0===i?0:e/i,r!==Number.MIN_VALUE&&0!==o||(r=0),l!==Number.MAX_VALUE&&0!==o||(l=0),{...{from:t[0],to:t[1],ndSum:e,ndAvg:a,ndMin:l,ndMax:r},ndCnt:o,nY2Val:i,y2ValAvg:s}}function Vt(t){let e,a,o,r,l,i;return r=Number.MIN_VALUE,l=Number.MAX_VALUE,e=a=o=i=0,n.data.filter(a=>{if(!J(a))return;const n=Q(a);t[0]<=n&&n<t[1]&&(i+=J(a),e+=K(a),o++,n>r&&(r=n),n<l&&(l=n))}),a=0===o?0:e/i,r!==Number.MIN_VALUE&&0!==o||(r=0),l!==Number.MAX_VALUE&&0!==o||(l=0),{from:t[0],to:t[1],ndAvg:a,ndMin:l,ndMax:r,ndCnt:o,nY2Val:i}}function Wt(t){let e,a;return Array.isArray(t)?(e=t[0],a=t[1]):(e=t.from,a=t.to),{from:e,to:a}}function Yt(t){if(t){let{from:e,to:a}=Wt(t);const o=m.filter(t=>{const o=t.properties[nt],r=n.data.find(t=>t.key===o);return!!r&&(r.value.y2Val&&e<=r.value.yVal&&r.value.yVal<a)});if(o){m.style("fill-opacity",.1),o.style("fill-opacity",1);const t=s.selectAll(".placeLbl .areaLbl").filter(t=>{const o=t.properties[nt],r=n.data.find(t=>t.key===o);return!!r&&(r.value.y2Val&&e<=r.value.yVal&&r.value.yVal<a)});t&&(s.selectAll(".placeLbl .areaLbl").attr("fill-opacity-save",function(){return d3.select(this).attr("fill-opacity")}).attr("fill-opacity",.1),t.attr("fill-opacity",1))}}else m.style("fill-opacity",null),s.selectAll(".placeLbl .areaLbl").attr("fill-opacity",function(){const t=d3.select(this).attr("fill-opacity-save");return d3.select(this).attr("fill-opacity-save",null),t})}function zt(t,e){Yt(e);const r=b(e.from),l=".c_"+r.substr(1),s=".lgRect"+l+",.c2iGhost"+l;let c,d;i.select(".c2iLgQuantile").selectAll(s).style("stroke-width",1).style("stroke-dasharray",1.5).style("stroke",a.colorHover(r,!0));let{from:u,to:m}=Wt(e);O.some((t,e)=>{if(t.from===u&&t.to===m)return c=t,d=e,!0});let p={item:c,idx:d,chart:o,cfg:n,color:b,_lgData:O,_dragHtml:st,_table:Ct,_cntFmt:mt};p.tFmt=W.tipFormat,p.clsNm="areaInfo",p=a.lgStatInfo(p),kt=p.idx,(Ct=p._table).select(".areaInfo").style("display","none")}function Ht(t,e){Yt();const a=".c_"+b(e.from).substr(1),o=".lgRect"+a+",.c2iGhost"+a;i.select(".c2iLgQuantile").selectAll(o).style("stroke-width",null).style("stroke",null)}function $t(e,a,o,r){switch(r){case"symbol":case"point":d3.select(a).attr("r",parseFloat(d3.select(a).attr("r"))+3/G);break;case"map":d3.select(a).attr("stroke-width",2*parseFloat(d3.select(a).attr("stroke-width")));break;case"content":const t=d3.select(a).select(".cImage");t.attr("width",parseFloat(t.attr("width"))+3/G).attr("height",parseFloat(t.attr("height"))+3/G)}w&&n.tooltip.isShow&&(w.classed("c2iHidden",!1).style("opacity",n.tooltip.opacity),function(){w.select("#name").text(o[n.content.colNm]),w.select("#measure").html(d3.format(W.format)(o[W.colNm])+W.unitNm),function(t){w.select("tbody").classed("c2iHidden",!1);const e=["tipHeader","number"],a=[];let o;n.cols.forEach(function(e){const n=[];n[0]=e.caption,o=t.data?t.data[e.colNm]:t[e.colNm],n[1]=d3.format(e.format)(o)+e.unitNm,a.push(n)});let r,l,i=w.select("table").select("tbody");if(i.empty()){i=w.select("table").append("tbody");const t=(r=i.selectAll(".level1").data(a)).enter().append("tr").attr("class","level1");l=(l=t.merge(r).selectAll("td").data(t=>t)).enter().append("td").attr("class",(t,a)=>e[a]).merge(l)}else r=i.selectAll(".level1").data(a),l=r.merge(r).selectAll("td").data(t=>t);l.text(t=>t)}(o)}(),void 0===N&&function(){const t=parseInt(w.select("table").style("width")),e=parseInt(w.select("table").style("height"));let a,o;a=_e()-t,o=ve()-e,w.select(".c2iCloseBtn").classed("c2iHidden",!1).on("click",()=>w.classed("c2iHidden",!0)),a<5&&(a=5);o<5&&(o=5);w.style("left",a+"px").style("top",o+"px"),N=!1}()),n.method.mouseenter&&n.method.mouseenter(e,{container:t,selector:r},o)}function Xt(e,r,l){n.tooltip.isShow&&(!function(t,e){a.tooltipOn({e:t,d:e,cfg:n,_yVal:Q,_y2Val:J,_aggInfoData:M,chart:o})}(e,r),n.method.mousemove&&n.method.mousemove(e,{container:t,selector:l},r))}function qt(e,o,r,l){switch(l){case"symbol":i.select("#indicator").transition().attrs({x1:E,x2:E});case"point":d3.select(o).attr("r",parseFloat(d3.select(o).attr("r"))-3/G);break;case"map":i.select("#indicator").transition().attrs({x1:E,x2:E}),d3.select(o).attr("stroke-width",parseFloat(d3.select(o).attr("stroke-width"))/2),a.tooltipOff(n.tooltip);break;case"content":const t=d3.select(o).select(".cImage");t.attr("width",parseFloat(t.attr("width"))-3/G).attr("height",parseFloat(t.attr("height"))-3/G)}n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:l},r)}function Ut(){const t=n.tooltip;(w=n.method.mouseenter&&t&&void 0!==t.id?d3.select(t.id):void 0)&&!w.empty()&&(w.style("pointer-events","all").style("cursor","move").call(st),t.opacity=t.opacity?t.opacity:.7,t.isShow=!!t.isShow)}function jt(){lt.showOnlyHeres=2!==lt.showOnlyHeres.length?["-1","-1"]:lt.showOnlyHeres,lt.showOnlyHeresNm=lt.showOnlyHeres,n.L0=lt.showOnlyHeres[0],n.L1=lt.showOnlyHeres[1],ot=null}function Zt(){if(!(lt=n.map))return alert(B.map_3),!1;const t=lt.src;if("object"!=typeof t||!t.folder)return alert(B.map_4),!1;t.country=void 0!==t.country?t.country.toLowerCase():"ko",t.resolution=void 0!==t.resolution?t.resolution.substr(0,1).toUpperCase():"M",".json"===t.folder.slice(-5)?t.srcFull=t.folder:(t.mapLevel=void 0!==t.mapLevel&&t.mapLevel>=1&&t.mapLevel<=2?t.mapLevel:1,t.folder=t.folder+("/"===t.folder.slice(-1)?"":"/"),a._mapSrc||a.mapSrc(t.folder),t.srcFull=a.mapSrc()+t.country+"_L"+t.mapLevel+t.resolution+".json"),lt.landColor=lt.landColor?lt.landColor:"none",lt.level=void 0!==lt.level&&lt.level>-1&&lt.level<3?lt.level:0,lt.showLabel=!!lt.showLabel,lt.onlyDataArea=!!lt.onlyDataArea,lt.gShowLabel=!!lt.gShowLabel,jt(),lt.gLevel=lt.gLevel>-2&&lt.gLevel<3?lt.gLevel:-1,lt.gShowLabel&&(Array.isArray(lt.viewLabelEnlarge)?(lt.viewLabelEnlarge[0]=lt.viewLabelEnlarge[0]>=1&&lt.viewLabelEnlarge[0]<=15?lt.viewLabelEnlarge[0]:1.2,lt.viewLabelEnlarge[1]=lt.viewLabelEnlarge[1]>=1&&lt.viewLabelEnlarge[1]<=50?lt.viewLabelEnlarge[1]:2.2):lt.viewLabelEnlarge=[1.2,2.2]),Array.isArray(lt.viewTypes)||(console.info(B.country.map_5),lt.viewTypes=[{fonts:["helvetica","14px","currentColor","#999"],stroke:"#ddd",strokeWidth:"1.2px",opacity:.7},{fonts:["helvetica","12px","currentColor","#888"],stroke:"#bbb",strokeWidth:"0.9px",opacity:.7},{fonts:["helvetica","10px","currentColor","#777"],stroke:"#999",strokeWidth:"0.3px",opacity:.7}]),lt.viewType&&(lt.viewTypes[lt.level]=a.mergeMeta(lt.viewTypes[lt.level],lt.viewType))}function Qt(){const t=n.mapping;return t?t.fileNm&&t.type?(t.codeColNm&&(nt=t.codeColNm),t.nameColNm&&(rt=t.nameColNm),t.srcFull=a.mapSrc(),void(t.folder?t.srcFull+=t.folder+"/"+t.fileNm:t.srcFull+=t.fileNm)):(alert(B.country.map_7),!1):(console.info(B.country.map_6),!0)}function Kt(){n.area.isVertical?(pt=120,gt.range([pt,0]),ft=d3.axisLeft().tickPadding(5).tickSize(-15)):(pt=200,gt.range([0,pt]),ft=d3.axisBottom().tickPadding(5).tickSize(15))}function Jt(){const t=n.area;return t?t.scale&&t.color?(ee(),void Kt()):(alert(B.country.map_9),!1):(console.info(B.country.map_8),!0)}function te(){const t=n.mark;if(!t)return console.info(B.country.map_10),!0;t.symbol&&(t.range=t.range?t.range:[5,5],t.opacity=t.opacity?t.opacity:.9),function(t){C=a.getScale(t.scale);const e=(o=J,d3.extent(n.data.filter(t=>t.value.y2Val),o));var o;C.domain(e).range(t.range)}(t)}function ee(){b="Quantile"===n.area.scale?d3.scaleQuantile():d3.scaleQuantize(),ae(),oe()}function ae(){const t=n.data.filter(J);switch(k=d3.extent(t,Q),n.area.scale){case"Quantile":b.domain(t.map(Q));break;case"Quantize":b.domain(k);break;default:b.domain(k).nice()}}function oe(){const t=n.area;let e=a.getColorScheme(t.color);const o=e.length;if(y){const a=b.domain().length;let n=!1;t.colorCnt>o||0===t.color.indexOf("C2i")?(t.colorCnt=o,n=!0):a>t.colorCnt&&(t.colorCnt=Math.min(t.colorCnt,o,a),n=!0),n&&y.colorCnt!==t.colorCnt&&(y.colorCnt=t.colorCnt),e=e.filter((e,a)=>a<t.colorCnt)}else o>t.colorCnt?e=e.filter((e,a)=>a<t.colorCnt):t.colorCnt=o;b.range(e)}function ne(){const t=n.content;if(!t)return alert(B.country.map_11),!1;t.place=void 0!==t.place?t.place:"area",t.showLabel=void 0!==!!t.showLabel}function re(t,e){i.select(".gMenu").select(t).style("opacity",e),o.zoomed(1===e)}function le(){me(),pe(),ge(),function(){const t=n.legend;if(t){if(!t.id)return alert(B.cm.lg_2),!1;t.fonts=t.fonts?t.fonts:["helvetica","12px"],t.padding=t.padding?t.padding:"10px 10px 10px 10px",t.backColor=t.backColor?t.backColor:"",t.itemGap=t.itemGap?t.itemGap:"10px"}else console.log(B.cm.lg_1)}(),P=n.data.map(Z),Zt(),Qt(),Jt(),te(),ne(),Ut(),a.setTheme(n,t,!1),a.setTitle(n),n.isDev&&a.devMode(n),n.meta=_.merge({},n)}function ie(){const t=lt.viewTypes[lt.level];let e=i.selectAll(".curAreaNm").data([null]);e.exit().remove(),e=e.enter().append("text").attr("class","curAreaNm").attr("text-anchor","middle").style("fill",t.fonts[3]).attr("font-size",5*parseInt(t.fonts[1])+"px").attr("y",n.margin.top+5*parseInt(t.fonts[1])+5).style("fill-opacity",.3).style("pointer-events","none").merge(e);const a=.8*lt.tourInterval;return ot?l(a):(l(a),c.transition().duration(a).attr("transform",r).transition().attr("transform","scale(1)")),o.resetTransform(),e;function r(){return`translate(${I/2}, ${Ce()/2})scale(0.05)`}function l(t){d.transition().duration(t).attr("transform",r).style("opacity",0).remove(),at&&s.selectAll(".placeGhostLbl .ghostLbl, .placeLbl .areaLbl").transition().duration(t).attr("transform",r).style("opacity",0).remove()}}function se(){const t=ht(lt.level).features.filter(t=>0===t.properties.cd.indexOf(lt.tour.cd));v={type:"FeatureCollection",features:t},i.select("text.curAreaNm").attr("x",ke()/2).text(lt.tour.nm),Bt()}function ce(t){lt.gLevel=t.gLevel,lt.gShowLabel=t.gShowLabel,lt.viewLabelEnlarge=t.viewLabelEnlarge,lt.onlyDataArea=t.onlyDataArea,delete n.save,y.gLevel=vt[lt.gLevel],y.gShowLabel=lt.gShowLabel,y.viewLabelL1=lt.viewLabelEnlarge[0],y.viewLabelL2=lt.viewLabelEnlarge[1],y.onlyDataArea=lt.onlyDataArea,s.remove(),s=lt.tour=null,i.select("text.curAreaNm").remove(),o.resetTransform(),Bt()}function de(){if(!i||!parseInt(r.style("width"),10))return;I=parseInt(r.style("width"),10),n.height=parseInt(I/n.aspect);const t=n.optWin;i.select(".gMenu").attr("transform",`translate(${I-(t.optBtnHide?0:15)}, 3)`),i.attr("width",I).attr("height",n.height),i.select(".statInfo").attr("transform",`translate(${.7*I}, ${Ce()})`),a.renderTitle(n,i,I,_e,xe,ve),s&&(s.remove(),s=null),o.resetTransform(),o.render(),ot&&n.save&&o.userTour("-1"===n.L0?0:1)}function ue(t){if(t){const e=n.area;e.scale=t.lgScale,e.color=t.color,e.colorCnt=t.colorCnt,e.rotate=t.rotate,e.contentGab=t.contentGab,lt.onlyDataArea=t.onlyDataArea,lt.src.resolution=t.resolution,lt.viewLabelEnlarge[(t.viewLabelL1,t.viewLabelL2)],lt.autoTour=t.autoTour,lt.tourInterval=1e3*t.tourInterval,lt.gLevel=vt.indexOf(t.gLevel),lt.showLabel=t.showLabel,lt.gShowLabel=t.gShowLabel,lt.viewTypes[0].fonts[2]=t.areaNmColorL0,lt.viewTypes[1].fonts[2]=t.areaNmColorL1,lt.viewTypes[2].fonts[2]=t.areaNmColorL2,lt.viewTypes[0].stroke=t.areaStrokeColorL0,lt.viewTypes[1].stroke=t.areaStrokeColorL1,lt.viewTypes[2].stroke=t.areaStrokeColorL2,lt.viewTypes[0].fonts[3]=t.ghostNmColorL0,lt.viewTypes[1].fonts[3]=t.ghostNmColorL1,lt.viewTypes[2].fonts[3]=t.ghostNmColorL2,lt.viewTypes[0].stroke=t.areaStrokeColorL0,lt.viewTypes[1].stroke=t.areaStrokeColorL1,lt.viewTypes[2].stroke=t.areaStrokeColorL2,a.optionSetting(n,t)}R=!i,i&&o.expandToggle(),ee(),d3.select("#c2iOption_"+n.id.substr(1)).style("opacity",n.optWin.opacity)}function me(){(V=n.xDim).caption=V.caption?V.caption:"",V.unitNm=V.unitNm?V.unitNm:"",V.colNm=V.colNm?V.colNm:"key",V.scaleSave=V.scaleSave?V.scaleSave:V.scale,V.scale="ordinal",V.color=V.color?V.color:"Tab10",V.expX="... "+(V.caption?V.caption:"X")+" ...",V.format=V.format?a.formatAll(V.format,d3.format(",.0f")):null,V.tipFormat=V.tipFormat?a.formatAll(V.tipFormat,d3.format(",.0f")):null,V.fonts&&3===V.fonts.length||(V.fonts=["helvetica","11px","gray"]),V.captionFonts&&3===V.captionFonts.length||(V.captionFonts=["helvetica","14px","dimgray"])}function pe(){fe(n.yDim,"y")}function ge(){fe(Y,"y2")}function fe(t,e){(t="y"===e?n.yDim:n.y2Dim).caption=t.caption?t.caption:"",t.unitNm=t.unitNm?t.unitNm:"",t.colNm=t.colNm?t.colNm:"y"===e?"yVal":"y2Val",t.color=t.color?t.color:"y"===e?"steelblue":"#fd7e14",t.colorBg=t.colorBg?t.colorBg:"y"===e?"lightgrey":"#acacac","function"!=typeof t.format&&(t.format=a.formatAll(t.format,d3.format(",.0f")),t.formatAvg=a.formatAll(t.formatAvg,t.format),t.tipFormat=a.formatAll(t.tipFormat,d3.format(",.0f"))),t.isShow=void 0===t.isShow||t.isShow,t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","11px","dimgray"])}function he(){d3.select(this).style("opacity",1)}function ye(){q.scaleTo(i,d3.select(this).property("value")),d3.select(this).attr("title","줌 레벨: "+G)}function _e(){return n.margin.left}function xe(){return I-n.margin.right}function ve(){return n.height-n.margin.bottom}function be(){return n.margin.top}function ke(){return I-n.margin.left-n.margin.right}function Ce(){return n.height-n.margin.top-n.margin.bottom}o.render=function(){if(!i){if(i=r.append("svg").attr("width",I).attr("height",n.height).on("mouseenter",()=>a.curOptWin(n,!0)).on("mouseleave",()=>a.curOptWin(n,!1)).call(q),function(){if(!n.showSlider)return;At(),Lt()}(),function(){if(!n.optWin)return;const t=a.L0;let e=[];const r=a.preset(n),l=a.loadOption(r);x=new dat.GUI({name:n.id.substr(1),autoPlace:!1,closeOnTop:!0,load:l||JSON,preset:r}),y=new function(){const t={...a.optionConstructor(n,o,A,R,B)};for(let e in t)this[e]=t[e];const e=n.area,r=wt.findIndex(t=>t===e.scale);this.lgScale=Nt[r],this.color=e.color,this.colorCnt=e.colorCnt,this.rotate=e.rotate,this.contentGab=e.contentGab,this.isVertical=e.isVertical,this.onlyDataArea=lt.onlyDataArea,this.viewLabelL1=lt.viewLabelEnlarge[0],this.viewLabelL2=lt.viewLabelEnlarge[1],this.autoTour=lt.autoTour,this.tourInterval=lt.tourInterval/1e3,this.showSlider=n.showSlider,lt.level&&(this.L0=n.L0),lt.level>1&&(this.L1=n.L1),this.gLevel=vt[lt.gLevel],this.showLabel=lt.showLabel,this.gShowLabel=lt.gShowLabel;const l=lt.viewTypes[0],i=lt.viewTypes[1],s=lt.viewTypes[2];this.areaNmColorL0="currentColor"===l.fonts[2]?"#444":l.fonts[2],this.areaStrokeColorL0=l.stroke,this.areaNmColorL1="currentColor"===i.fonts[2]?"#444":i.fonts[2],this.areaStrokeColorL1=i.stroke,this.areaNmColorL2="currentColor"===s.fonts[2]?"#444":s.fonts[2],this.areaStrokeColorL2=s.stroke,this.ghostNmColorL0="currentColor"===l.fonts[3]?"#444":l.fonts[3],this.gStrokeColorL0=l.stroke,this.ghostNmColorL1="currentColor"===i.fonts[3]?"#444":i.fonts[3],this.gStrokeColorL1=i.stroke,this.ghostNmColorL2="currentColor"===s.fonts[3]?"#444":s.fonts[3],this.gStrokeColorL2=s.stroke},x.remember(y),l&&ue(l.remembered[r][0]);a.makeDefaultOption(n,o,x,H,y,B);const u=x.addFolder(B.gen.lgOption);u.add(y,"lgScale",Nt).name(B.gen.lgScale).onChange(t=>{const e=Nt.findIndex(e=>e===t);o.lgScaleChange(wt[e])}).listen(),u.add(y,"color",a.colorSchemes).name("범례 색상").onChange(t=>{n.area.color=t,oe(),o.render()}),u.add(y,"colorCnt",2,12,1).name("범례 색상 갯수").onChange(t=>{n.area.colorCnt=t,oe(),o.render()}).listen(),u.add(y,"rotate",-25,25,1).name("눈금 값 회전").onChange(t=>{n.area.rotate=-t,Ot()}),u.add(y,"contentGab",0,100,1).name("제목과 범례 간격").onChange(t=>{n.area.contentGab=t,Ot()}),u.add(y,"isVertical").name("수직 범례").onChange(t=>{n.area.isVertical=t,Kt(),i.select(".c2iLgQuantile").remove(),Ot()});const m=x.addFolder(B.gen.mapOptions);function p(t,e){let a="";for(let t=0;t<e.length;t++){const o="<option value='"+e[t].cd+"'>"+e[t].nm+"</option>";a+=o}""!=a&&(t.domElement.children[0].innerHTML=a)}m.add(y,"viewLabelL1",1,15,.2).name("시군구명 줌 레벨").onChange(t=>{lt.viewLabelEnlarge[0]=t,Ft()}).listen(),m.add(y,"viewLabelL2",1,30,1).name("읍변동명 줌 레벨").onChange(t=>{lt.viewLabelEnlarge[1]=t,Ft()}).listen(),m.add(y,"showSlider").name("줌 술라이더 토글").onChange(function(t){n.showSlider=t,t?Lt():At()});const g=xt[lt.level],f=x.addFolder(`데이터 발생지역 레벨: ${g}`);let _,v;lt.level&&(p(_=f.add(y,"L0",[]).name("특정 시도").onChange(a=>{!at||"-1"===a||Dt()?"-1"!==a?(ot=!0,lt.level>1&&(e=[],n.dataMap.objects.L1.geometries.forEach(t=>{0===t.properties.cd.indexOf(a+"-")&&e.push({cd:t.properties.cd,nm:t.properties.nm})}),e.sort((t,e)=>d3.ascending(t.nm,e.nm)),e.unshift({cd:-1,nm:"시군구 선택"}),p(v,e)),n.L0=a+"-",y.L1=n.L1="-1",lt.showOnlyHeres=[n.L0,n.L1],t.some(t=>{if(t.cd===parseInt(a))return lt.showOnlyHeresNm=[t.nm,n.L1],!0}),o.userTour("-1"===n.L0?0:1)):o.userTour():y.L0=n.L0}).listen(),t),lt.level>1&&(v=f.add(y,"L1",["선택 안함"]).name("특정 시군구").onChange(t=>{"선택 안함"!==t&&(!at||Dt()?(n.L1=t+"-",lt.showOnlyHeres[1]=n.L1,e.some(e=>{e.cd!==t||(lt.showOnlyHeresNm[1]=e.nm)}),o.userTour(2)):y.L1=n.L1)}).listen()));f.add(y,"autoTour").name(B.gen.autoTour).onChange(function(t){t&&ot&&o.userTour(),lt.autoTour=t,o.autoTour()}).listen(),f.add(y,"tourInterval",1,20,1).name("투어 시간").onFinishChange(t=>{lt.tourInterval=1e3*t,o.autoTour()}),f.add(y,"onlyDataArea").name("발생지역 경계만").onChange(t=>{if(lt.onlyDataArea=t,at||ot){const t=n.save;return t||(t.onlyDataArea=lt.onlyDataArea,lt.onlyDataArea&&(t.gShowLabel=y.gShowLabel=lt.gShowLabel=!1)),void Bt()}s.remove(),s=null,o.render()}).listen();const b=["시도 경계","시군구 경계","읍면동 경계"];b.forEach((t,e)=>{e===lt.level&&D(f,"areaStrokeColorL"+e,"발생지역 경계",t=>{t=t,C=e,w="path.c2iMap",lt.viewTypes[C].stroke=t,c.selectAll(`${w}.L${C}`).attr("stroke",t)})}),S(f,"showLabel","발생지역 명칭 토글",t=>{T(t,"showLabel")});var k,C,w;const N=["시도 명칭","시군구 명칭","읍면동 명칭"];N.forEach((t,e)=>{e===lt.level&&D(f,"areaNmColorL"+e,"발생지역 명칭",t=>{M(t,e,2,".areaLbl")})});const L=x.addFolder("일반지역 옵션");function D(t,e,a,o){t.addColor(y,e).name(a).onChange(o)}function S(t,e,a,o){t.add(y,e).name(a).onChange(o).listen()}function T(t,e){lt[e]=t,"showLabel"===e?Pt():(at||ot)&&Gt()}function M(t,e,a,o){lt.viewTypes[e].fonts[a]=t,s.selectAll(`${o}.L${e}`).style("fill",t)}(function(t,e,a,o,n){t.add(y,e,o).name(a).onChange(n).listen()})(L,"gLevel","지역 레벨",vt,t=>{!function(t,e){let a;switch(t){case"시도":a=0;break;case"시군구":a=1;break;case"읍면동":a=2;break;default:a=-1}lt[e]=h=a,at?-1===h&&s.selectAll(".placeGhostLbl .ghostLbl").remove():de()}(t,"gLevel")}),b.forEach((t,e)=>{D(L,"gStrokeColorL"+e,t,t=>{!function(t,e,a){lt.viewTypes[e].stroke=t,d.selectAll(`${a}.L${e}`).attr("stroke",t)}(t,e,".ghost")})}),S(L,"gShowLabel","지역 명칭 토글",t=>{T(t,"gShowLabel")}),N.forEach((t,e)=>{D(L,"ghostNmColorL"+e,t,t=>{M(t,e,3,".ghostLbl")})}),a.makeBrushOption(n,o,x,y,i,()=>I)}(),a.setDefs(n.top,i,n),a.setTitleDesc(n),a.renderTitle(n,i,I,_e,xe,ve,ct),!B)return;!function(){if(!i.select(".statInfo").empty())return;i.append("text").attr("class","statInfo").attr("cursor","move").attr("text-anchor","middle").attr("font-family",V.brush.fonts[0]).attr("font-size",V.brush.fonts[1]).style("fill",V.brush.fonts[2]).attr("transform",`translate(${.7*I}, ${Ce()})`).call(ct).selectAll("tspan").data(["x","value","ratioDiff"]).enter().append("tspan").attr("class",t=>t).attr("x",0).attr("dy",(t,e)=>e?"1.1em":"-0.8em").text(t=>t)}(),function(){const t=n.tooltip;let e=[{id:"resetFilter",img:"resetFilter.png",tip:B.gen.resetFilter,opacity:.4},{id:"lgScale",img:"categorize.png",tip:"범례 스케일링.\n 1.최소~대 정밀분할: 최소,최대값 기준으로 n등분(기본 설정)\n 2.최소~대 간편분할: 1)번과 유사하나, 단수 값 정리\n 3.정렬 균등분할: 모든 값을 순위 & 정렬하여, 가능하면 구간별 같은 데이터 건수 설정.(값이 다른 데이터가 n개 이상 필요)"},{id:"tooltip",img:"tooltip.png",tip:"툴팁",opacity:t&&t.isShow?1:.4},{id:"expand",img:"expand.png",tip:"확장&축소\n: 축소시 이 차트는 그리지 않으나,\n 설정된 조건은 다른 차트에 반영됩니다."},{id:"export",img:"export.png",tip:"익스포트(이미지&데이터)"},{id:"aggBar",img:"aggBar.png",tip:"점유율 막대",opacity:z.aggBar?1:.4,exclude:!(D&&!o.isAvg())}],r={_svg:i,_width:I,_showToolbar:H,_dimension:A,cfg:n};r={...r,chart:o,menus:e,isLgScale:!0},a.renderMenu(r)}()}return St(),ae(),Ot(),M=U(),n.initMap?Bt():t(),Tt(),o;function t(t){const e=n.mapping,a=[];a.push(d3.json(lt.src.srcFull)),e&&e.srcFull&&a.push(function(){switch(e.type){case"csv":return d3.csv;case"tsv":return d3.tsv;default:return d3.json}}()(e.srcFull)),Promise.all(a).then(function([t,e]){n.initMap=!0;const a=[];if(e){for(let t=0;t<lt.level+1;t++)a.push("L"+t);a.forEach(a=>{t.objects[a].geometries.forEach(t=>{e.some(e=>{if(t.properties.cd===e.cd)return t.properties[nt]=e[nt],rt&&(t.properties.nm=e[rt]),!0})})})}n.dataMap=t,Bt()}).catch(t=>{throw alert(B.country.map_1),console.error("*.cfg.map.src.srcFull: "+lt.src.srcFull),console.log(t),t})}},o.resize=de,o.setWidth=(t=>r.style("width",t+"px")),o.autoTour=function(){let t,e,a=[];if(lt.autoTour){at&&at.stop();const o=lt.level?lt.level-1:0;a=n.dataMap.objects["L"+o].geometries.map(t=>t.properties).sort((t,e)=>t.cd-e.cd),n.save||(n.save={},(t=n.save).gLevel=lt.gLevel,t.gShowLabel=lt.gShowLabel,t.viewLabelEnlarge=lt.viewLabelEnlarge,t.onlyDataArea=lt.onlyDataArea),lt.gLevel=lt.level,lt.onlyDataArea=!1,lt.gShowLabel=!0,lt.viewLabelEnlarge=[1,1],y.gLevel=vt[lt.level],y.gShowLabel=lt.gShowLabel,y.viewLabelL1=y.viewLabelL2=1,at=d3.interval(t=>{!function(){let t=-1;lt.tour&&a.some(function(e,a){if(e.cd===lt.tour.cd)return t=a,!0});t=t===a.length-1?0:t+1,lt.tour=a[t],se()}()},lt.tourInterval);lt.viewTypes[lt.level];e=ie()}else{if(t=n.save,!at||!t)return;at.stop(),at=null,ce(t)}},o.userTour=function(t){let e,a,o=[];if(t){const r=t<2?0:1,l=lt.showOnlyHeresNm,s=l[0]+("-1"!==l[1]?" "+l[1]:"");if(lt.tour={cd:lt.showOnlyHeres[r],nm:s},o=n.dataMap.objects["L"+t].geometries.filter(t=>0===t.properties.cd.indexOf(lt.tour.cd)).sort((t,e)=>t.cd-e.cd),n.save)a=i.select("text.curAreaNm");else{n.save={},(e=n.save).gLevel=lt.gLevel,e.gShowLabel=lt.gShowLabel,e.viewLabelEnlarge=lt.viewLabelEnlarge,e.onlyDataArea=lt.onlyDataArea,lt.gLevel=-1,lt.gShowLabel=!0,lt.viewLabelEnlarge=[1,1],lt.onlyDataArea=!1,y.gLevel="일반지역 제거",y.gShowLabel=!0,y.viewLabelL1=y.viewLabelL2=1,y.onlyDataArea=!1;lt.viewTypes[lt.level];a=ie()}se()}else{if(!(e=n.save))return;y.L0=n.L0="-1",lt.level>1&&(y.L1=n.L1="-1"),lt.showOnlyHeres=lt.showOnlyHeresNm=["-1","-1"],ot=null,ce(e)}},o.brushInfoDisplay=(t=>{V=t,Tt()}),o.statInfoFill=(t=>{V=t,i.select(".statInfo").style("fill",V.brush.fonts[2])}),o.listRows=function(t){return t?(n.dataList.listRows=t,l.listRows(t),o):n.dataList.listRows},o.map=function(t){return arguments.length?(n.map=t,Zt(),o):n.map},o.mapping=function(t){return arguments.length?(n.mapping=t,Qt(),o):n.mapping},o.area=function(t){return arguments.length?(n.area=t,Jt(),o):n.area},o.mark=function(t){return arguments.length?(n.mark=t,te(),o):n.mark},o.content=function(t){return arguments.length?(n.content=t,ne(),o):n.content},o.dim=function(t){return arguments.length?(n.dim=t,_setDim(),o):n.dim},o.zoomed=function(t){return arguments.length?(n.zoomed=t,o):n.zoomed},o.tooltip=function(t){return arguments.length?(n.tooltip=t,Ut(),o):n.tooltip},o.xDim=function(t){return arguments.length?(n.xDim=t,me(),o):n.xDim},o.yDim=function(t){return arguments.length?(W=n.yDim=t,pe(),o):n.yDim},o.y2Dim=function(t){return arguments.length?(Y=n.y2Dim=t,ge(),o):n.y2Dim},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.clear=function(){return i&&(at&&(at.stop(),at=null),i.remove(),i=s=void 0,a.removeOptionDom(n)),o},o.title=function(t){return arguments.length?(n.title=t,a.setTitle(n),a.renderTitle(n,i,I,_e,xe,ve),o):n.title},o.data=function(t){return arguments.length?(n.data=t,le(),o):n.data},o.exportData=function(t,e){const{caption:o,colNms:r,colCaptions:l,data:i,filters2:s}={...a.exportFilters(n,e,F,J)};r.splice(1,0,"key_name,"),l.splice(1,0,"지역명,");const c=v.features.map(t=>t.properties);i.forEach(t=>{c.some(e=>{if("cd"!==nt){if(e[nt]&&t.key===e[nt])return t.key_name=e.nm+(nt?" ("+e.cd+")":""),!0;if("cd"===nt&&t.key===e.cd)return t.key_name=e.nm,!0}})}),a.exportData(o,r,l,i,t,s,V)},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),B=c2i.lang,o):n.lang},o.dimension=function(t){return arguments.length?(A=t,o):A},o.group=function(t){if(!arguments.length)return L;let e;if(L=t,n.isSort&&n.isSort.type){const t="y"===n.isSort.whichY?W.colNm:Y.colNm;e=L.all().slice().sort((e,a)=>a.value[t]-e.value[t])}else e=L.all();return o.data(e),o},o.groupAll=function(t){return arguments.length?(D=t,o):D},o.resetTransform=function(){i&&i.transition().duration(750).call(q.transform,d3.zoomIdentity),re(".resetFilter",.4)},o.resetFilter=function(){o.resetTransform();const t=lt.viewTypes[lt.level];s.selectAll("path.c2iMap").attr("stroke",t.stroke),A.filterAll(),P=n.data.map(Z),o.renderAll()},o.hasCurrentFilter=(()=>A&&A.hasCurrentFilter()),o.filterValues=function(){let e,a=[];const o=n.title&&n.title.caption?n.title.caption:t;e=V.caption?V.caption:"X";const r=v.features.filter(t=>P.indexOf(t.properties[nt])>-1).map(t=>t.properties).sort((t,e)=>t[nt]-e[nt]);return e+="; ",r.forEach((t,o)=>{t[nt]?e+=t[nt]+":"+t.nm+"("+t.cd+"),":e+=t.cd+":"+t.nm+",",a.push(t),o&&o%10==0&&(e+="\r\n")}),{c2iCon:t,title:o,filters:e,filterRaws:a.substring(0,a.length-2),colNm:"c2iFact"===n.groupBy?n.fact:n.groupBy,scale:V.scale}},o.lazyFilter=(()=>n.lazyFilter),o.tooltipToggle=(()=>y.tooltip=a.tooltipToggle(n,re)),o.expandToggle=(()=>{R=!R,y.expand=R,i.transition().style("height",R?null:"29px")}),o.isShow=(()=>R),o.lgScaleChange=(t=>{if(n.area.scale===t)return;n.area.scale=t||"Quantize";const e=wt.findIndex(t=>t===n.area.scale);y.lgScale=Nt[e],ee(),o.render()}),o.aggBarToggle=(()=>{o.isAvg()||(z.aggBar=!z.aggBar,re(".aggBar",z.aggBar?1:.4),St())}),o.topToggle=(t=>{if(!n.top)return;const e=n.top;if(e.isShow=!e.isShow,re(".top",e.isShow?1:.4),n.title){let t="once"===e.type?"Top":"everyNew"===e.type?"N top":"top";t="("+t+" "+e.rank+")",e.isShow?n.title.caption+=t:n.title.caption=n.title.caption.replace(t,""),a.renderTitle(n,i,I,_e,xe,ve)}}),o.toolbarToggle=((t,e)=>(H=a.toolbarToggle(t,n,i,H,e),o)),o.toolbarStatus=(()=>H),o.toolbarShrink=(()=>{($=!$)?x.show():x.hide()}),o.toolbarShrinkStatus=(()=>$),o.saveOption=(()=>{a.saveOption(x)}),o.initOption=(()=>{lt.autoTour&&(lt.autoTour=!1,o.autoTour()),ot&&o.userTour(),a.removeOption(x),n=a.mergeMeta(n,c2i.meta.insight,c2i.meta.iCountry);const t=_.merge({},n.meta);n.duration=t.duration,n.dataList=t.dataList,n.title=t.title,n.height=t.height,n.top=t.top,n.tooltip=t.tooltip,n.mapping=t.mapping,n.area=t.area,n.mark=t.mark,n.content=t.content,V=n.xDim=t.xDim,W=n.yDim=t.yDim,Y=n.y2Dim=t.y2Dim,lt=n.map=t.map,G=1,It(1),jt(),ue(),o.clear(),o.render()}),o.container=function(t){return arguments.length?(U=(l=t).aggInfos,T=l.isAvg,F=l.chartFilters,p=l.listData,g=l.renderList,o):l},o.aggInfos=function(t){return arguments.length?(U=t,o):U()},o.isAvg=function(t){return arguments.length?(T=t,o):T()},o.chartFilters=function(t){return F=t,o},o.listData=function(t){return arguments.length?(p=t,o):p(-1)},o.renderList=function(t){return arguments.length?(g=t,o):g},o.renderAll=function(t){return arguments.length?(f=t,o):f()},o.tooltipMini=(t=>t?(n.tooltip=t,o):n.tooltip);return n.isResponsive&&a.resizeChart(n,t,de,null),a.rebind(o,j,"on")},c2i.bi.iDonut=((t,e)=>{"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;const o={};let n={width:"100%",height:150,margin:{top:30,bottom:30},lazyFilter:!1,data:void 0,duration:200,title:void 0,xDim:void 0,yDim:void 0,y2Dim:void 0,tooltip:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);let l,i,s,c,d,u,m,p,g,f,h,y,_,x,v,b,k=a.computeDim(r,n),C=c2i.lang,w=!1,N=[],A=!0,L=n.xDim,D=n.yDim,S=n.y2Dim,T=n.statistics,M=!(!T||!T.showToolbar)&&T.showToolbar,F=!0,I=()=>{};const B=d3.brushX(),E=t=>t[L.colNm],G=t=>t.value[D.colNm],P=t=>t.value[S.colNm],O=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this).style("opacity",.5)}).on("drag",function(t){const e=t.sourceEvent,a=e.offsetX?e.offsetX:t.x,o=e.offsetY?e.offsetY:t.y;a>0&&a<k&&o>0&&o<n.height-20&&d3.select(this).attr("transform","translate("+[a,o]+")")}).on("end",function(){d3.select(this).style("opacity",1)}),R=t=>a.getIndex(s.selectAll("#"+t.currentTarget.parentNode.id+" path"),t.currentTarget),V=d3.pie().sort(null);let W=(n.height-n.margin.top)/6,Y=(n.height+n.margin.top/1.5)/2;function z(){let t={_svg:i,_aggBarG:_,_stat:T,cfg:n,chart:o};t={...t,_xVal:E,_xStart:ot,_xEnd:nt,_yEnd:lt,_contentH:it,_negative:w},_=a.renderAggBar(t)}function H(){const t=[],e=N.length;if(e===n.data.length)return void i.selectAll(".statInfo tspan").text("");let r=[N[0],N[e-1]];const l=n.data.filter(t=>r.indexOf(t.key)>-1),s=l[0].key?l[0].key:L.tipFormat(r[0]),c=1===e?s:l[1].key?l[1].key:L.tipFormat(r[1]);a.getFilterInfo(s,c,t,o),i.selectAll(".statInfo tspan").classed("c2iNegative",(e,a)=>2===a&&t[a]&&t[a].indexOf("-")>-1).html((e,a)=>t[a])}function $(t,e){const a=1===t?10:2;return d3.arc().innerRadius(a+W*t).outerRadius(W*(t+1)+e)}function X(t,e){const r=R(t),l=n.data[r];a.tooltipOn({e:t,d:l,cfg:n,_yVal:G,_y2Val:P,_aggInfoData:v,chart:o})}function q(t,e){const o=R(t);s.selectAll(".values").selectAll(".c_"+o).transition().attr("d",function(t,e){return $("y2Val"===this.parentNode.id?1:2,0)(t)}),a.tooltipOff(n.tooltip)}function U(){const t=c.domain().length;let e=a.getColorScheme(L.color);const o=e.length;let n=!1;L.colorCnt>o||0===L.color.indexOf("C2i")?(L.colorCnt=o,n=!0):t>L.colorCnt&&(L.colorCnt=Math.min(o,t),n=!0),d&&n&&(d.colorCnt=L.colorCnt),e=e.filter((t,e)=>e<L.colorCnt),c.range(e)}function j(){(L=n.xDim).caption=L.caption?L.caption:"",L.unitNm=L.unitNm?L.unitNm:"",L.colNm=L.colNm?L.colNm:"key",L.scaleSave=L.scaleSave?L.scaleSave:L.scale,L.scale="ordinal",L.color=L.color?L.color:"Tab10",L.expX="... "+(L.caption?L.caption:"X")+" ...",L.format=L.format?a.formatAll(L.format,d3.format(",.0f")):null,L.tipFormat=L.tipFormat?a.formatAll(L.tipFormat,d3.format(",.0f")):null,c=a.getScale(L.scale),U(),L.fonts&&3===L.fonts.length||(L.fonts=["helvetica","11px","gray"]),L.captionFonts&&3===L.captionFonts.length||(L.captionFonts=["helvetica","14px","dimgray"])}function Z(){K(n.yDim,"y")}function Q(){K(S,"y2")}function K(t,e){(t="y"===e?n.yDim:n.y2Dim).caption=t.caption?t.caption:"",t.unitNm=t.unitNm?t.unitNm:"",t.colNm=t.colNm?t.colNm:"y"===e?"yVal":"y2Val",t.color=t.color?t.color:"y"===e?"steelblue":"#fd7e14",t.colorBg=t.colorBg?t.colorBg:"y"===e?"lightgrey":"#acacac","function"!=typeof t.format&&(t.format=a.formatAll(t.format,d3.format(",.0f")),t.formatAvg=a.formatAll(t.formatAvg,t.format),t.tipFormat=a.formatAll(t.tipFormat,d3.format(",.0f"))),t.isShow=void 0===t.isShow||t.isShow,t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","11px","dimgray"])}function J(t,e){i.select(".gMenu").select(t).style("opacity",e)}function tt(){n.top.isShow=!1,j(),Z(),Q(),N=n.data.map(E),c.domain(N)}function et(){if(!i||!r.node().clientWidth)return;n.nonComponent?k=r.node().clientWidth:(k=parseInt(r.style("width"),10),n.height=parseInt(r.style("height"),10),n.height||(n.height=parseInt(k/n.aspect))),Y=(n.height+n.margin.top/1.5)/2,W=(Math.min(n.height,k)-n.margin.top)/6;const t=n.optWin;i.attr("width",k).attr("height",n.height),i.select(".gMenu").attr("transform",`translate(${k-(t.optBtnHide?0:15)}, 3)`),s.attr("transform","translate("+[k/2,Y]+")"),i.select(".statInfo").attr("transform",`translate(${k/2}, ${Y})`),a.renderTitle(n,i,k,ot,nt,rt),o.render()}function at(t){t&&(L.color=t.color,L.colorCnt=t.colorCnt,a.optionSetting(n,t)),A=!i,o.expandToggle(),d3.select("#c2iOption_"+n.id.substr(1)).style("opacity",n.optWin.opacity)}function ot(){return n.margin.left}function nt(){return k-n.margin.right}function rt(){return n.height-n.margin.bottom}function lt(){return n.margin.top}function it(){return n.height-n.margin.top-n.margin.bottom}o.render=function(){if(!i){if(i=r.append("svg").attr("width",k).attr("height",n.height).on("mouseenter",()=>a.curOptWin(n,!0)).on("mouseleave",()=>a.curOptWin(n,!1)),function(){if(!n.optWin)return;d=new function(){const t={...a.optionConstructor(n,o,f,A,C)};for(let e in t)this[e]=t[e];this.color=L.color,this.colorCnt=L.colorCnt};const t=a.preset(n),e=a.loadOption(t);e&&at(e.remembered[t][0]);(u=new dat.GUI({name:n.id.substr(1),autoPlace:!1,closeOnTop:!0,load:e||JSON,preset:t})).remember(d),a.makeDefaultOption(n,o,u,M,d,C);const r=u.addFolder("도넛 옵션");r.add(d,"color",a.colorSchemes).name(C.gen.colorPicker).onChange(function(t){L.color=t,U(),o.render()}),r.add(d,"colorCnt",2,12,1).name("범례 색상 갯수").onChange(t=>{L.colorCnt=t,U(),o.render()}).listen(),a.makeBrushOption(n,o,u,d,i,()=>k)}(),a.setTitleDesc(n),a.renderTitle(n,i,k,()=>0,()=>k,rt,O),!C)return;s=i.insert("g","g.gTitle").attr("class","body").attr("transform","translate("+[k/2,Y]+")"),function(){if(!i.select(".statInfo").empty())return;i.append("text").attr("class","statInfo").attr("cursor","move").attr("text-anchor","middle").attr("font-family",L.brush.fonts[0]).attr("font-size",L.brush.fonts[1]).attr("fill",L.brush.fonts[2]).attr("transform",`translate(${k/2}, ${Y})`).call(O).selectAll("tspan").data(["x","value","ratioDiff"]).enter().append("tspan").attr("class",t=>t).attr("x",0).attr("dy",(t,e)=>e?"1.2em":"-0.8em").text(t=>t)}(),function(){const t=n.tooltip;let e=[{id:"resetFilter",img:"resetFilter.png",tip:C.gen.resetFilter,opacity:.4},{id:"tooltip",img:"tooltip.png",tip:"툴팁",opacity:t&&t.isShow?1:.4},{id:"expand",img:"expand.png",tip:"확장&축소\n: 축소시 이 차트는 그리지 않으나,\n 설정된 조건은 다른 차트에 반영됩니다."},{id:"export",img:"export.png",tip:"익스포트(이미지&데이터)"},{id:"aggBar",img:"aggBar.png",tip:"점유율 막대",opacity:T.aggBar?1:.4,exclude:!(y&&!o.isAvg())}],r={_svg:i,_width:k,_showToolbar:M,_dimension:f,cfg:n};r={...r,chart:o,menus:e},a.renderMenu(r)}()}return w=!1,n.data.some(t=>{if(G(t)<0)return w=!0,console.log("*.음수 값의 파이 및 도넛 처리는 0로 처리함."),!0}),z(),v=I(),function(){const t={yVal:[],y2Val:[]};n.data.forEach(e=>{t.yVal.push(e.value.yVal>=0?e.value.yVal:0),n.y2Dim.draw&&t.y2Val.push(e.value.y2Val>=0?e.value.y2Val:0)});const e=s.selectAll("g.values").data(Object.values(t));e.exit().remove();const r=e.enter().append("g").attr("class","values").attr("id",(e,a)=>Object.keys(t)[a]).merge(e).selectAll("path").data(V);r.enter().append("path").on("click",function(t,e){const r=R(t),l=n.data[r].key,i=N.indexOf(l);t.altKey?-1===i?N.push(l):1===N.length?N=n.data.map(E):N.splice(i,1):N=1===N.length&&0===i?n.data.map(t=>t.key):[l];let s=.4;N.length===n.data.length?(f.filterAll(),H()):(f.filter(a.multiValuesFilter(N)),s=1),J(".resetFilter",s),o.renderAll()}).on("mousemove",X).on("mouseleave",q).on("mouseenter",function(t,e){const a=R(t);s.selectAll(".values").selectAll(".c_"+a).transition().duration(350).attr("d",function(t){return $("y2Val"===this.parentNode.id?1:2,6)(t)})}).attr("class",(t,e)=>"c_"+e).merge(r).attr("fill",(t,e)=>c(n.data[e].key)).attr("opacity",(t,e)=>N.indexOf(n.data[e].key)>-1?1:.1).attr("d",function(t){return t.arc=$("y2Val"===this.parentNode.id?1:2,0),t.arc(t)});const l=s.selectAll("g.labels").data(Object.values(t));l.exit().remove();const i=l.enter().append("g").attr("class","labels").attr("id",(e,a)=>Object.keys(t)[a]+"_lbl").merge(l).selectAll("text").data(t=>V(t));i.enter().append("text").attr("dy",".35em").attr("pointer-events","none").attr("text-anchor","middle").attr("font-family",L.fonts[0]).attr("font-size",L.fonts[1]).attr("fill",L.fonts[2]).text((t,e)=>L.xLabel.cutLength?(n.data[e].key+"").substr(0,L.xLabel.cutLength):n.data[e].key).merge(i).attr("transform",function(t){return t.arc=$("y2Val_lbl"===this.parentNode.id?1:2,0),"translate("+t.arc.centroid(t)+")rotate("+function(t){const e=90*(t.startAngle+t.endAngle)/Math.PI-90;return e>90?e-180:e}(t)+")"}).attr("fill-opacity",function(t,e){return"y2Val_lbl"===this.parentNode.id?0:t.endAngle-t.startAngle>.12?1:0})}(),function(){if(!y)return;const t={...y.value()};a.aggSubtitle(i,t,o)}(),H(),o},o.resetFilter=function(){J(".resetFilter",.4),s.selectAll("g.values path").attr("stroke",null),f.filterAll(),N=n.data.map(E),o.renderAll()},o.resize=et,o.setWidth=(t=>r.style("width",t+"px")),o.brushInfoDisplay=H,o.hasCurrentFilter=(()=>f&&f.hasCurrentFilter()),o.filterValues=function(){let e,a;const o=n.title&&n.title.caption?n.title.caption:t;return e=L.caption?L.caption:"X",e+="; "+N.map(t=>L.tipFormat?L.tipFormat(t):t),a=N.map(t=>t),{c2iCon:t,title:o,filters:e,filterRaws:a,colNm:"c2iFact"===n.groupBy?n.fact:n.groupBy,scale:L.scale}},o.lazyFilter=(()=>n.lazyFilter),o.tooltipToggle=(()=>d.tooltip=a.tooltipToggle(n,J)),o.expandToggle=(()=>{A=!A,d.expand=A,i.transition().style("height",A?null:"29px")}),o.isShow=(()=>A),o.aggBarToggle=(()=>{o.isAvg()||(T.aggBar=!T.aggBar,J(".aggBar",T.aggBar?1:.4),z())}),o.toolbarToggle=((t,e)=>(M=a.toolbarToggle(t,n,i,M,e),o)),o.toolbarStatus=(()=>M),o.toolbarShrink=(()=>{(F=!F)?u.show():u.hide()}),o.toolbarShrinkStatus=(()=>F),o.saveOption=(()=>a.saveOption(u)),o.initOption=(()=>{a.removeOption(u);const t=n.title.caption;(n=a.mergeMeta(n,c2i.meta.insight)).title.caption=t,j(),Z(),Q(),at(),o.clear(),o.render()}),o.statInfoFill=(t=>{L=t,i.select(".statInfo").attr("fill",L.brush.fonts[2])}),o.listRows=function(t){return t?(n.dataList.listRows=t,l.listRows(t),o):n.dataList.listRows},o.clear=function(){return i&&(i.remove(),i=void 0,a.removeOptionDom(n)),o},o.title=function(t){if(!arguments.length)return n.title;n.title=t;return a.setTitle(n),a.renderTitle(n,i,k,()=>0,()=>k,rt,O),o},o.xDim=function(t){return arguments.length?(n.xDim=t,j(),o):n.xDim},o.yDim=function(t){return arguments.length?(D=n.yDim=t,Z(),o):n.yDim},o.y2Dim=function(t){return arguments.length?(S=n.y2Dim=t,Q(),o):n.y2Dim},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(t){return arguments.length?(n.data=t,tt(),o):n.data},o.exportData=function(t,e){const{caption:o,colNms:r,colCaptions:l,data:i,filters2:s}={...a.exportFilters(n,e,b,P)};a.exportData(o,r,l,i,t,s,L)},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),C=c2i.lang,o):n.lang},o.dimension=function(t){return arguments.length?(f=t,o):f},o.group=function(t){if(!arguments.length)return h;let e;if(h=t,n.isSort&&n.isSort.type){const t="y"===n.isSort.whichY?D.colNm:S.colNm;e=h.all().slice().sort((e,a)=>a.value[t]-e.value[t])}else e=h.all();return o.data(e),o},o.groupAll=function(t){return arguments.length?(y=t,o):y},o.container=function(t){return arguments.length?(I=(l=t).aggInfos,x=l.isAvg,b=l.chartFilters,m=l.listData,p=l.renderList,o):l},o.aggInfos=function(t){return arguments.length?(I=t,o):I()},o.isAvg=function(t){return arguments.length?(x=t,o):x()},o.chartFilters=function(t){return b=t,o},o.listData=function(t){return arguments.length?(m=t,o):m(-1)},o.renderList=function(t){return arguments.length?(p=t,o):p},o.renderAll=function(t){return arguments.length?(g=t,o):g()},o.tooltipMini=(t=>t?(n.tooltip=t,o):n.tooltip);return n.isResponsive&&a.resizeChart(n,t,et,null),a.rebind(o,B,"on")}),c2i.bi.iFilterDlg=function(t,e){"use strict";const a=c2i.util;if(!e.isNoCheck&&!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;let o={},n={data:void 0,id:void 0,fonts:["Roboto","12px","currentColor"],duration:350,easing:"exp",dbMgr:void 0,isDev:void 0};e.method=e.method||{},a.init(n,e);const r=d3.select(t).on("mouseenter",()=>d3.select(o.id()).classed("c2iSelectTarget",!0)).on("mouseleave",()=>d3.select(o.id()).classed("c2iSelectTarget",!1));let l,i,s,c,d,u,m,p,g,f,h,y,x,v,b,k,C,w,N,A,L=c2i.lang,D=[];const S=n.dbMgr,T=d3.format("d"),M=d3.drag().on("start",function(t){const e=t.sourceEvent;e.stopPropagation();const a=this.parentNode.parentNode;N=parseFloat(d3.select(a).style("left"))-e.pageX,A=parseFloat(d3.select(a).style("top"))-e.pageY}).on("drag",function(t){const e=t.sourceEvent;d3.select(this.parentNode.parentNode).style("opacity",.5).style("left",()=>e.pageX+N+"px").style("top",()=>e.pageY+A+"px")}).on("end",function(t){d3.select(this.parentNode.parentNode).style("opacity",.9)});function F(){let t=[];Array.isArray(n.data)?n.data.forEach(e=>t.push(e.groupNm)):new Set(Object.values(n.data.forEach(t=>t.groupNm))).forEach(e=>t.push(e)),$(".groupItems span",t),t.length?W(t[0]):W("그룹명칭?"),i=s=-1,(l=r.select(".groupItems ul").selectAll("li").data(t,t=>t)).exit().remove(),l.enter().append("li").on("click",(t,e)=>{R();const a=r.select(".groupItems ul").selectAll("li");if(t.altKey)d3.select(t.currentTarget).classed("c2iSelected",!d3.select(t.currentTarget).classed("c2iSelected"));else{if(t.shiftKey){d3.select(t.currentTarget).classed("c2iSelected",!0);let e=[];return a.nodes().filter((t,a)=>{d3.select(t).classed("c2iSelected")&&e.push(a)}),e=d3.extent(e),i=e[0],s=e[1],a.classed("c2iSelected",!1),void a.nodes().filter((t,e)=>e>=i&&e<=s).forEach(t=>d3.select(t).classed("c2iSelected",!0))}a.classed("c2iSelected",!1),d3.select(t.currentTarget).classed("c2iSelected",!0),r.select(".tarGrpItem ul").selectAll("li.c2iSelected").remove(),n.data.some(t=>{if(t.groupNm===e)return c=t,!0}),W(e),I(),E()}}).on("mouseover",(t,e)=>{d3.select(t.currentTarget).style("background-color","dimgray")}).on("mouseleave",(t,e)=>{d3.select(t.currentTarget).style("background-color",null)}).merge(l).classed("c2iSelected",(t,e)=>0===e).text(t=>t),z("renderGroupList",n.data)}function I(){let t=[];if(Array.isArray(c.values)){t=c.values;const e={};c.values.forEach(t=>{e[t]=t}),c.values=e}else new Set(Object.values(c.values)).forEach(e=>t.push(e));$(".tarGrpItem span",t),u=m=-1,(d=r.select(".tarGrpItem ul").selectAll("li").data(t,t=>t)).exit().remove(),d.enter().append("li").on("click",(t,e)=>{const a=r.select(".tarGrpItem ul").selectAll("li");if(t.altKey)d3.select(t.currentTarget).classed("c2iSelected",!d3.select(t.currentTarget).classed("c2iSelected"));else{if(t.shiftKey){d3.select(t.currentTarget).classed("c2iSelected",!0);let e=[];return a.nodes().filter((t,a)=>{d3.select(t).classed("c2iSelected")&&e.push(a)}),e=d3.extent(e),u=e[0],m=e[1],a.classed("c2iSelected",!1),void a.nodes().filter((t,e)=>e>=u&&e<=m).forEach(t=>d3.select(t).classed("c2iSelected",!0))}a.classed("c2iSelected",!1),d3.select(t.currentTarget).classed("c2iSelected",!0),r.select(".targetItem ul").selectAll("li.c2iSelected").remove(),p=[];for(let t in c.values)c.values[t]===e&&p.push(t);V(e),B()}}).on("mouseover",(t,e)=>{d3.select(t.currentTarget).style("background-color","dimgray")}).on("mouseleave",(t,e)=>{d3.select(t.currentTarget).style("background-color",null)}).merge(d).classed("c2iSelected",(t,e)=>{if(0===e){p=[];for(let e in c.values)c.values[e]===t&&p.push(e);return V(t),B(),!0}return!1}).text(t=>t),z("renderGroup",c)}function B(){f=h=-1,$(".targetItem span",p),(g=r.select(".targetItem ul").selectAll("li").data(p,t=>t)).exit().remove(),g.enter().append("li").on("dblclick",(t,e)=>{p=p.filter(t=>t!==e),y.push(e),O(),B(),E()}).on("click",(t,e)=>{const a=r.select(".targetItem ul").selectAll("li");if(t.altKey)d3.select(t.currentTarget).classed("c2iSelected",!d3.select(t.currentTarget).classed("c2iSelected"));else{if(t.shiftKey){d3.select(t.currentTarget).classed("c2iSelected",!0);let e=[];return a.nodes().filter((t,a)=>{d3.select(t).classed("c2iSelected")&&e.push(a)}),e=d3.extent(e),f=e[0],h=e[1],a.classed("c2iSelected",!1),void a.nodes().filter((t,e)=>e>=f&&e<=h).forEach(t=>d3.select(t).classed("c2iSelected",!0))}a.classed("c2iSelected",!1),d3.select(t.currentTarget).classed("c2iSelected",!0)}}).on("mouseover",(t,e)=>{d3.select(t.currentTarget).style("background-color","dimgray")}).on("mouseleave",(t,e)=>{d3.select(t.currentTarget).style("background-color",null)}).merge(g).text(t=>t),Y(),z("renderTarget",c)}function E(t){v=b=-1,(x=r.select(".srcItem ul").selectAll("li").data(t?D:y,t=>t)).exit().style("opacity",0).remove(),$(".srcItem span",t?D:[]),x.enter().append("li").on("dblclick",(t,e)=>{y=y.filter(t=>t!==e),D.length&&r.select("#c2iSearchNm").property("value").length&&(D=D.filter(t=>t!==e)),p.push(e),O(),B(),E()}).on("click",(t,e)=>{const a=r.select(".srcItem ul").selectAll("li");if(t.altKey)d3.select(t.currentTarget).classed("c2iSelected",!d3.select(t.currentTarget).classed("c2iSelected"));else{if(t.shiftKey){d3.select(t.currentTarget).classed("c2iSelected",!0);let e=[];return a.nodes().filter((t,a)=>{d3.select(t).classed("c2iSelected")&&e.push(a)}),e=d3.extent(e),v=e[0],b=e[1],a.classed("c2iSelected",!1),void a.nodes().filter((t,e)=>e>=v&&e<=b).forEach(t=>d3.select(t).classed("c2iSelected",!0))}a.classed("c2iSelected",!1),d3.select(t.currentTarget).classed("c2iSelected",!0)}}).on("mouseover",(t,e)=>{d3.select(t.currentTarget).style("background-color","dimgray")}).on("mouseleave",(t,e)=>{d3.select(t.currentTarget).style("background-color",null)}).merge(x).text(t=>t),Y(),z("renderSrc",c)}function G(){if(S){n.isDev&&(w={storeNm:"c2iFilter",indexNm:"factNm_colNm",keys:["포스매출실적(건별)","매출구분"]});const{storeNm:t,indexNm:e,keys:a}={...w};S.getRangeData(t,e,a,P)}else o.data(a.deepClone(C)),P()}function P(t){if(S){if(!t||!t.isOk)return void alert("*.DB 검색시 문제 발생하였습니다. 다시 시도해 보세요.");o.data(t.values)}W("그룹명칭?"),V("분류명칭?"),F(),I(),B(),E()}function O(){switch(c.op){case void 0:case"New":c.op="New";break;case"Qry":c.op="Upd"}}function R(){let t=null;return y.length===k?(c.values=y,t=c.colNm):y.length&&y.forEach(t=>{c.values[t]!==t?c.values[t]=t:alert('*.이미 "'+t+'"와 동일한 분류명칭이 존재합니다. 수정 후 재 실행하세요.')}),y=p=[],t}function V(t){if(!arguments.length)return r.select("#c2iFilterNm").property("value");r.select("#c2iFilterNm").property("value",t)}function W(t){if(!arguments.length)return r.select("#c2iGroupNm").property("value");r.select("#c2iGroupNm").property("value",t)}function Y(){const t=y.length;r.select(".sourceCaption").text(c.caption+` (${T(t)}/${T(k)}건)`)}function z(t,e){n.isDev&&(d3.select("#InfoJson").html(JSON.stringify(e,null,2)),console.log(t,JSON.stringify(e,null,2)))}function H(t){r.classed("c2iHidden",t)}function $(t,e){e.length?r.select(t).text(T(e.length)+"건"):r.select(t).text("")}function X(){if(c=Array.isArray(n.data)?n.data[0]:n.data,k=Array.isArray(c.values)?c.values.length:Object.keys(c.values).length,Array.isArray(c.values))y="자동생성"===c.groupNm?[]:[...c.values];else{y=[];const t=new Set(Object.values(c.values));for(const e in c.values)t.has(c.values[e])||y.push(e)}let t=r.select(".caption").attr("c2iFormat");t=a.templateFormat(t,c.caption),r.select(".caption").text(t||"개발 중"),p=[],z("Init",c)}return r.select(".c2iFilterHandle").call(M),o.render=function(){if(H(!1),n.data)return F(),I(),B(),E(),o},r.select(".c2iCloseBtn").on("click",()=>H(!0)),r.select(".c2iMinimizeBtn").on("click",function(){let t,e,o=!0,l=.3,i="300px",s="300px";r.style("min-height")===s?(o=!1,l=0,e=r.style("height"),r.attr("height",e),s=e="33px",t=i,r.attr("min-width",t),r.transition().duration(n.duration).ease(a.ease[n.easing]).style("height",e).style("min-height",s).transition().duration(n.duration).ease(a.ease[n.easing]).style("width",i).style("min-width",t)):(e=r.attr("height"),i=r.attr("width"),r.transition().duration(n.duration).ease(a.ease[n.easing]).style("width",i).style("min-width",t).transition().duration(n.duration).ease(a.ease[n.easing]).style("height",e).style("min-height",s));r.selectAll(".column>.infoFilters").style("margin-top",0).style("opacity",o?.3:0).transition().delay(n.duration).style("font-size","0px").transition().duration(1.5*n.duration).style("margin-top",null).style("font-size",o?"16px":"0px").style("opacity",o?.3:0)}),r.select(".c2iGrpRefresh").on("click",G),r.select(".c2iGrpNew").on("click",function(){const t=new Set(Object.keys(c.values));y=[],t.forEach(t=>y.push(t)),p=[],delete(c=a.deepClone(c)).id,c.createdAt=null,c.modifier=null,c.modifiedAt=null,c.groupNm="",c.values=[],c.op="New",W("그룹명칭?"),V("분류명칭?"),l.classed("c2iSelected",!1),I(),B(),E()}),r.select(".c2iGrpRemove").on("click",function(){if(1===C.length)return void alert("*.최소 1개는 존재해야 합니다.");if(S)S.deleteData("c2iFilter",c.id,t=>{t.isOk&&G()});else{const t=r.select(".groupItems ul").selectAll("li.c2iSelected").data();t.length&&(o.data(a.deepClone(C.filter(e=>0!==t.indexOf(e.groupNm)))),X(),P())}}),r.select(".c2iGrpFilterRun").on("click",function(){const t=W();if(!t.length||"그룹명칭?"===t)return void alert("*.그룹 명칭을 입력하세요.");const e=R();z("grpFilterRun",c),V("분류명칭?"),I(),B(),E(),n.method.execute?(n.method.execute(e||c),H(!1)):alert("*.연동할 메서드를 정의 한 후, method: {execute: 여기} 함수를 넣으세요.")}),r.select(".c2iRawFilterRun").on("click",function(){n.method.execute?(n.method.execute(c.colNm),H(!1)):alert("*.연동할 메서드를 정의 한 후, method: {execute: 여기} 함수를 넣으세요.")}),r.select(".c2iGrpCommit").on("click",function(){const t=W();if(!t.length||"그룹명칭?"===t)return void alert("*.그룹 명칭을 입력하세요.");t!==c.groupNm&&O();if("Qry"===c.op)return void alert("*.저장할 변경 사항이 없습니다.");switch(R(),c.op){case"New":if(Array.isArray(c.values)){alert("*.저장할 내용이 없습니다.");break}delete c.op,c.groupNm=t,S?S.addData("c2iFilter",c,G):(C.push(c),G());break;case"Upd":delete c.op,c.groupNm=t,S?S.updateData("c2iFilter",c,G):(n.data.some(t=>{if(t.groupNm===c.groupNm)return t=_.merge({},c),!0}),C=a.deepClone(n.data),G())}}).attr("title",S?"DB에 필터그룹 저장":"메모리에 필터그룹 저장.(다음 로드시 지워집니다.)"),r.select(".c2iFilterNew").on("click",function(){const t=c.values;if(Array.isArray(t))y=y.concat(p);else if(p.length){let e;for(const a in t)(e=p.indexOf(a))>-1&&p.splice(e,1);y=y.concat(p)}O(),I(),V("분류명칭?"),d.classed("c2iSelected",!1),p=[],B(),E(),$(".targetItem span",[])}),r.select(".c2iFilterRemove").on("click",function(){const t=r.select(".tarGrpItem ul").selectAll("li.c2iSelected").data();if(!t.length)return;const e=c.values,a={};for(const o in e)-1===t.indexOf(e[o])?a[o]=e[o]:y.push(o);c.values=a,O(),p=[],V("분류명칭?"),I(),B(),E()}),r.select(".c2iFilterSave").on("click",function(){if("Qry"===c.op)return void alert("*.저장할 추가 및 변경 사항이 없습니다.");if(!p.length)return void alert("*.선택한 분류가 없으니, 기존 분류 항목을 선택하거나, 새로운 분류를 생성하세요.");const t=V().replace(/[~|.|'|@|+|\?]/g,"-");if(!t.length||"분류명칭-"===t)return void alert("*.분류 명칭을 입력하세요.");const e={};p.forEach(a=>e[a]=t),Array.isArray(c.values)?c.values={...e}:c.values={...c.values,...e};if(y.length)for(let t in c.values)y.indexOf(t)>-1&&delete c.values[t];V("분류명칭?"),p=[],r.select(".targetItem ul").selectAll("li.c2iSelected").remove(),I(),B(),E()}),r.select(".c2iGrpRefresh img").attr("src",a.imgSrc()+"refresh.png"),r.select(".c2iGrpNew img").attr("src",a.imgSrc()+"newFilter.png"),r.select(".c2iGrpRemove img").attr("src",a.imgSrc()+"filtersRemove.png"),r.select(".c2iGrpCommit img").attr("src",a.imgSrc()+(S?"dbCommit.png":"save.png")),r.select(".c2iFilterNew img").attr("src",a.imgSrc()+"filter.png"),r.select(".c2iFilterRemove img").attr("src",a.imgSrc()+"filterRemove.png"),r.select(".c2iFilterSave img").attr("src",a.imgSrc()+"save.png"),r.select(".c2iGrpFilterRun img").attr("src",a.imgSrc()+"running.png"),r.select(".c2iRawFilterRun img").attr("src",a.imgSrc()+"raw.png"),r.select(".c2iHeader3 img").attr("src",a.imgSrc()+"clear.png"),r.select("#c2iSearchNm").on("keyup",_.debounce(function(t){const e=t.target.value.toLowerCase();D=y.filter(t=>-1!==t.toLowerCase().indexOf(e)),E(!0)},500)),r.select("#c2iSearchClear").on("click",function(){D=[],r.select("#c2iSearchNm").property("value").length&&(r.select("#c2iSearchNm").property("value",""),E())}),r.select("#srcItemAdd").on("click",function(){const t=r.select(".srcItem ul").selectAll("li.c2iSelected").data();if(0===t.length)return;p=t.concat(p),r.select(".srcItem ul").selectAll("li.c2iSelected").remove(),y=y.filter(t=>-1===p.indexOf(t)),O(),B(),E()}),r.select("#srcItemClear").on("click",function(){const t=r.select(".targetItem ul").selectAll("li.c2iSelected").data();if(0===t.length)return;y=t.concat(y),r.select(".targetItem ul").selectAll("li.c2iSelected").remove(),p=r.select(".targetItem ul").selectAll("li").data();for(let e in c.values)t.indexOf(e)>-1&&delete c.values[e];console.log("srcItemClear _targetData",p),O(),B(),E()}),o.data=function(t){return arguments.length?(t&&t.forEach(t=>t.op=t.op?t.op:"Qry"),n.data=t,C=a.deepClone(t),X(),o):n.data},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),L=c2i.lang,o):n.lang},o.dbProps=(t=>t?(w=t,o):w),a.createAccessor(o,n)},c2i.bi.insight=((t,e)=>{"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;const o={};let n={width:"100%",height:150,margin:{top:30,left:30,right:30,bottom:30},lazyFilter:!1,duration:200,data:void 0,title:void 0,xDim:void 0,yDim:void 0,y2Dim:void 0,tooltip:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t),l=t.substr(1)+"-clip",i=`url('${n.id}c2iTx')`,s=`url('${n.id}c2iTxNeg')`,c=`url('${n.id}c2iTxD')`,d=`url('${n.id}c2iTxNegD')`;n.white?a.defaultColor.white:a.defaultColor.dark;let u,m,p,g,f,h,y,x,v,b,k,C,w,N,A,L,D,S,T,M,F,I,B,E,G,P,O,R,V=a.computeDim(r,n),W=c2i.lang,Y=!1,z=[],H=[],$=!0,X=n.xDim,q=n.yDim,U=n.y2Dim,j=n.statistics,Z=[],Q=1,K=!(!j||!j.showToolbar)&&j.showToolbar,J=!0,tt=()=>{},et=()=>{},at=[-1,Ht()];const ot=d3.brushX(),nt=t=>t[X.colNm],rt=t=>t.value[q.colNm],lt=t=>t.value[U.colNm],it=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),d3.select(this).style("opacity",.5)}).on("drag",function(t){const e=t.sourceEvent,a=e.offsetX?e.offsetX:t.x,o=e.offsetY?e.offsetY:t.y;if(a>0&&a<V&&o>0&&o<n.height-20){const t=[a,o];"gTitle"!==d3.select(this).attr("class")&&(at=t),d3.select(this).attr("transform","translate("+t+")")}}).on("end",function(){d3.select(this).style("opacity",1)}),st=t=>Y&&rt(t)<0?x(0):x(rt(t)),ct=t=>void 0===rt(t)?0:Y?Math.abs(x(rt(t))-x(0)):x(0)-x(rt(t)),dt=function(t,e,a){a.selectAll("."+e+" .tick > text").style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).attr("fill",t.fonts[2])},ut=["rect","ellipse"],mt=["desc","asc",""],pt=["y","y2"],gt=["막대 차트","타원 차트"],ft=["내림차순","오름차순","정렬안함"],ht=["Y축","Y2축"];let yt;function _t(e){const a=o.container();if(!yt&&a.filterDlg()&&(yt=a.filterDlg()),!yt)return void alert("*.사용자 그룹 설정 환경 오류 입니다. 관리자에게 문의하세요.");yt.id(n.id).isDev(n.isDev).method({execute:function(e){n.groupBy=e,a.cfg().charts.some(a=>{if(a.id===t)return a.groupBy=e,!0}),r.classed("c2iSelectTarget",!1),a.clear().render()}});let l,i,s={};"object"==typeof n.groupBy?(s=n.groupBy).caption=s.caption?s.caption:X.caption:(s.colNm=n.groupBy,s.caption=X.caption?X.caption:n.groupBy,s.values=Object.values(n.data.map(t=>t.key)),n.groupBy=s),yt.dbMgr().getRangeData("c2iFilter","factNm_colNm",[n.factNm,s.colNm],t=>{t&&t.isOk&&t.values.length||(s.factNm=n.factNm,s.dataType=n.cols.find(t=>t.colNm===s.colNm).type,s.groupNm="자동생성",s.op="New",t.values.push(s));const e=yt.dbMgr().meta().find(t=>"c2iFilter"===t.storeNm),a={storeNm:e.storeNm,indexNm:e.indexes[0].name,keys:[n.factNm,s.colNm]};yt.data(t.values).dbProps(a).render()}),e?(l=Math.max(10,e.pageX-480)+"px",i=e.pageY+28+"px"):(l=(e=window.event).offsetX/3*-1+"px",i=-1*e.offsetY+28+"px"),d3.select("#c2iFilterDlg").style("top",i).style("left",l)}function xt(t){let e,a,o,r,l,i,s,c;if("y"===t)e=q,a=rt,o=n.beginZero[0],r=x,l=N,i=D,s=[Wt(),Ht()],c=(()=>e.captionV?"start":"end");else{if(!U.draw)return;e=U,a=lt,o=n.beginZero[1],r=v,l=A,i=S,s=[Yt(),Ht()],c=(()=>e.captionV?"end":"start")}const d=n.data;let u=d3.max(d,a),m=0;Y?(m=d3.min(d,a),m*=m>=0?e.minGap:2-e.minGap,u<0&&(u=0)):o||(m=d3.min(d,a),m*=m>=0?e.minGap:2-e.minGap),r.domain([m,u]).range([Xt(),"y"===t?0:7]).nice();let p=e.ticks;switch(p){case 0:p=0;break;case-1:p=Xt()>e.tickWidth?Math.ceil(Xt()/e.tickWidth):0}const f=e.showGrid?-$t():e.tickSize;if(l.scale(r).ticks(p).tickFormat(e.format).tickSizeInner(f).tickSizeOuter(0),i||(i=(i=g.selectAll("."+t+".axis").data(e.isShow?[null]:[])).enter().append("g").attr("class",t+" axis").style("opacity",e.opacity).merge(i),"y"===t?D=i:S=i),i.attr("transform","translate("+s+")").call(l),i.selectAll("line").style("stroke-opacity",()=>p?.3:0),e.caption){const a=e.unitNm?[e.caption,e.unitNm]:[e.caption];let o=i.selectAll("."+t+"Caption").data([e.caption]);if((o=o.enter().append("text").attr("class",t+"Caption").style("pointer-events","none").style("font-family",e.captionFonts[0]).style("font-size",e.captionFonts[1]).attr("fill",e.captionFonts[2]).attr("dx",e.dx).attr("y",e.dy/(a.length>1?1:2)).style("writing-mode",e.captionV?"tb":"").style("text-anchor",c).merge(o)).selectAll("tspan").empty()){o.selectAll("tspan").data(a).enter().append("tspan").attr("x",(t,a)=>a?e.dx:0).attr("dy",(t,e)=>1.1*e+"em").text(t=>t)}}"y"===t?dt(q,"y",i):dt(U,"y2",i)}function vt(){let t={_svg:m,_aggBarG:G,_stat:j,cfg:n,chart:o};t={...t,_xVal:nt,_xStart:Wt,_xEnd:Yt,_yEnd:Ht,_contentH:Xt},G=a.renderAggBar(t)}function bt(){let t=n.data.length;switch(X.scale){case"point":et=(t=>Math.ceil(y(nt(t))-y.step()/2)),Q=(t=>y.step()*X.barWidthRatio),y.padding(.5);break;case"band":et=(t=>Math.ceil(y(nt(t)))),Q=y.bandwidth,y.padding(.1);break;case"linear":case"sqrt":et=(t=>y(nt(t))),X.minMax&&X.interval&&(t=(X.minMax[1]-X.minMax[0])/X.interval),Q=$t()/t*X.barWidthRatio;break;case"time":et=(t=>y(nt(t)));const e=[n.data[0][X.colNm],n.data[t-1][X.colNm]];"day"===X.round?t=d3.timeDay.count(e[0],e[1])+1:"month"===X.round?t=d3.timeMonth.count(e[0],e[1])+1:"year"===X.round?t=d3.timeYear.count(e[0],e[1])+1:"week"===X.round&&(t=d3.timeWeek.count(e[0],e[1])+1),Q=$t()/t,Q*=X.barWidthRatio;break;default:a.alert("*.X 축 스케일 미설정 오류.\n 정상 실행 불가.")}w=d3.axisBottom(),y.rangeRound([0,$t()])}function kt(t){"y"===t?N=d3.axisLeft():A=d3.axisRight()}function Ct(){Et(".resetFilter",.4),T.selectAll("#"+l+" rect").attr("x",0).attr("width",$t()),m.selectAll(".handleBar").style("display","none"),M.filterAll(),H=z=[]}function wt(t){n.isDev&&console.log(t),"band"===X.scale||"point"===X.scale?z.length?M.filter(a.multiValuesFilter(z)):M.filterAll():H.length?(C=H,M.filterRange(H)):(C=null,M.filterAll())}function Nt(){const t=[];if("band"===X.scale||"point"===X.scale){const e=z.length;if(0===e)return;let r=[z[0],z[e-1]];const l=n.data.filter(t=>r.indexOf(t.key)>-1),i=l[0].key?l[0].key:X.tipFormat(H[0]),s=1===e?i:l[1].key?l[1].key:X.tipFormat(H[1]);a.getFilterInfo(i,s,t,o)}else{if(2!==H.length)return;if(!d3.bisectRight(n.data.map(t=>t.key),H[0]))return;if(!d3.bisectLeft(n.data.map(t=>t.key),H[1]))return;const e=X.tipFormat(H[0]),r=X.tipFormat(H[1]);a.getFilterInfo(e,r,t,o)}m.selectAll(".statInfo tspan").classed("c2iNegative",(e,a)=>2===a&&t[a]&&t[a].indexOf("-")>-1).html((e,a)=>t[a])}function At(){if(F){if(T.call(ot),Et(".resetFilter",1),"band"===X.scale||"point"===X.scale)M.filter(a.multiValuesFilter(F));else{M.filterRange(F);const t=F.map(y);F=!1,ot.move(T,t)}F=!1}Dt(),function(){if(!U.draw)return;const t={values:n.data,key:0};let e=0;"band"===X.scale?e=y.bandwidth()/2:"linear"!==X.scale&&"sqrt"!==X.scale&&"time"!==X.scale||(e=$t()/n.data.length/2);const o=t=>d3.line().curve(a.curve[U.curve]).defined(t=>!!U.drawZero||rt(t)&&lt(t)>0).x(t=>y(t[X.colNm])+e).y(t=>void 0===lt(t)?Xt():v(lt(t)))(t);let r=p.select(".y2.c2iBack"),i=p.select(".y2.c2iFore");(r.empty()||i.empty())&&(r=p.append("g").attr("class","y2 c2iBack").attr("fill","none").attr("stroke",U.colorBg).attr("stroke-width",U.strokeWidth),i=p.append("g").attr("class","y2 c2iFore").attr("fill","none").attr("stroke",U.color).attr("stroke-width",U.strokeWidth).attr("clip-path",`url(#${l})`));const s=r.selectAll("path").data([t],t=>t.key);s.enter().append("path").style("fill","none").merge(s).attr("d",t=>o(t.values));const c=i.selectAll("path").data([t],t=>t.key);c.enter().append("path").style("fill","none").merge(c).attr("d",t=>o(t.values)),function(){const t=U.drawDot;if(!t)return;if(!t.draw)return void p.select(".y2.c2iDot").remove();let e=t.scale?t.scale:"linear";const o=d3.symbol().type(a.symbols[t.symbol]);let r=0;"band"===X.scale?r=y.bandwidth()/2:"linear"!==X.scale&&"sqrt"!==X.scale&&"time"!==X.scale||(r=$t()/n.data.length/2);let i=p.select(".y2.c2iDot");i.empty()&&(i=p.append("g").attr("class","y2 c2iDot").attr("stroke-width",1.2).attr("clip-path",`url(#${l})`));!function(o){e=a.getScale(e);const r=d3.extent(n.data,lt);e.domain(r).rangeRound(t.range).nice()}();const s=n.data.filter(t=>U.drawZero?t:rt(t)&&lt(t)>0),c=i.selectAll("path").data(s,t=>t.key);c.exit().remove(),c.enter().append("path").attr("fill",U.color).merge(c).attr("d",t=>o.size(e(lt(t)))()).attr("transform",t=>{const e=et(t)+r,a=v(lt(t));return"translate("+[e,a.toFixed(2)]+")"})}()}(),Lt()}function Lt(){if(!E)return;const t={...E.value()};a.aggSubtitle(m,t,o);let e=p.select(".c2iAgg");e.empty()&&(e=p.append("g").attr("class","c2iAgg"));const r=[];if(j.avgLine){const e=n.data.length;if(q.draw){const a=0===e?0:t[q.colNm]/(o.isAvg()?1:e);r.push({key:"y",value:a})}if(U.draw){const a=0===e?0:t[U.colNm]/e;r.push({key:"y2",value:a})}}const l=e.selectAll("g.avgLine").data(r);l.exit().remove();const i=l.enter().append("g").attr("class",t=>"avgLine "+t.key);let s,c;i.append("line").attr("stroke",t=>"y"===t.key?q.colorAvg:U.colorAvg).attr("stroke-width",t=>"y"===t.key?q.avgStrokWidth:1.5*U.avgStrokWidth).attr("stroke-dasharray",t=>"y"===t.key?q.avgDashArray:3*U.avgDashArray).merge(l.select("line")).attr("x1",0).attr("x2",$t()).attr("y1",t=>"y"===t.key?x(t.value):v(t.value)).attr("y2",t=>"y"===t.key?x(t.value):v(t.value)),n.isSort&&n.isSort.type?U.draw&&(s=(t=>"y"===t.key?$t()-150:$t()-5),c=(t=>"y"===t.key?x(t.value)-5:v(t.value)-5)):U.draw&&(s=(t=>"y"===t.key?5:$t()-5),c=(t=>"y"===t.key?x(t.value)-5:v(t.value)+10)),U.draw||(s=(()=>$t()),c=(t=>x(t.value)-5)),i.append("text").attr("text-anchor",t=>"y"===t.key&&U.draw?"start":"end").style("font-family",t=>"y"===t.key?q.fonts[0]:U.fonts[0]).style("font-size",t=>"y"===t.key?q.fonts[1]:U.fonts[1]).attr("fill",q.colorAvg).merge(l.select("text")).text(t=>"y"===t.key?q.formatAvg(t.value):U.formatAvg(t.value)).attr("x",s).attr("y",c)}function Dt(){const t=n.data;let e;const o=n.top;o&&o.isShow&&"once"!==o.type&&(e=a.topKeyN(t,o.rank,X.colNm,q.colNm));let r=p.select(".y.c2iGhost"),u=p.select(".y.c2iBack"),m=p.select(".y.c2iFore");r.empty()&&(u=p.append("g").attr("class","y c2iBack"),m=p.append("g").attr("class","y c2iFore").attr("clip-path",`url(#${l})`),r=p.append("g").attr("class","y c2iGhost").attr("fill","transparent")),u.attr("fill",q.colorBg),m.attr("fill",q.color);const g=r.selectAll("rect").data(t,nt);let f;g.enter().append("rect").attr("class",(t,e)=>"c"+e).on("click",Pt).on("mousemove",St).on("mouseleave",Tt).merge(g).attr("x",et).attr("y",0).attr("width",Q).attr("height",Xt()),"rect"===n.yDim.graphType?function(){const e=u.selectAll("rect").data(t,nt);e.enter().append("rect").attr("class",(t,e)=>"c"+e).merge(e).attr("x",et).attr("y",st).attr("width",Q).attr("height",ct),(f=m.selectAll("rect").data(t,nt)).enter().append("rect").attr("class",(t,e)=>"c"+e).merge(f).attr("fill",t=>Z.length&&o.isShow&&Z.indexOf(t.key)>-1?rt(t)>=0?i:s:rt(t)<0?q.colorNeg:null).attr("x",et).attr("y",st).attr("width",Q).attr("height",ct)}():function(){const e=u.selectAll("ellipse").data(t,nt);e.enter().append("ellipse").attr("class",(t,e)=>"c"+e).merge(e).attr("cx",t=>et(t)+("function"==typeof Q?Q(t)/2:Q/2)).attr("rx",t=>"function"==typeof Q?Q(t)/2:Q/2).attr("cy",t=>st(t)+ct(t)/2).attr("ry",t=>ct(t)/2),(f=m.selectAll("ellipse").data(t,nt)).enter().append("ellipse").attr("class",(t,e)=>"c"+e).merge(f).attr("fill",t=>Z.length&&o.isShow&&Z.indexOf(t.key)>-1?rt(t)>=0?i:s:rt(t)<0?q.colorNeg:null).attr("cx",t=>et(t)+("function"==typeof Q?Q(t)/2:Q/2)).attr("rx",t=>"function"==typeof Q?Q(t)/2:Q/2).attr("cy",t=>st(t)+ct(t)/2).attr("ry",t=>ct(t)/2)}(),f&&e&&o.isShow?"everyNew"===o.type?f.attr("fill",t=>e.indexOf(t.key)>-1?rt(t)>=0?i:s:rt(t)<0?q.colorNeg:null):f.style("fill",function(t){const a=d3.select(this).attr("fill");if(!a||a!==i&&a!==s)return e.indexOf(t.key)>-1?rt(t)>=0?c:d:rt(t)<0?q.colorNeg:null}):o&&m.selectAll(n.yDim.graphType).style("fill",null)}function St(t,e){a.tooltipOn({e:t,d:e,cfg:n,_yVal:rt,_y2Val:lt,_aggInfoData:O,chart:o}),d3.select(this).attr("fill",q.colorHover).attr("fill-opacity",.35)}function Tt(){d3.select(this).attr("fill",null).attr("fill-opacity",null),a.tooltipOff(n.tooltip)}function Mt(){(X=n.xDim).caption=X.caption?X.caption:"",X.unitNm=X.unitNm?X.unitNm:"",X.colNm=X.colNm?X.colNm:"key",X.scaleSave=X.scaleSave?X.scaleSave:X.scale,X.scale=X.scale?X.scale.toLowerCase():"band","linear"===X.scale||"time"===X.scale?X.expX="≤ "+(X.caption?X.caption:"X")+" <":X.expX="... "+(X.caption?X.caption:"X")+" ...","time"===X.scale?("string"==typeof X.format&&(X.format=X.format?d3.timeFormat(X.format):null),"string"==typeof X.tipFormat&&(X.tipFormat=X.tipFormat?d3.timeFormat(X.tipFormat):null),"year"===X.round&&(X.timeTicks=d3.timeYear)):("string"==typeof X.format&&(X.format=X.format?a.formatAll(X.format,d3.format(",.0f")):null),"string"==typeof X.tipFormat&&(X.tipFormat=X.tipFormat?a.formatAll(X.tipFormat,d3.format(",.0f")):null)),X.barWidthRatio=X.barWidthRatio?Math.max(.5,Math.min(.95,X.barWidthRatio)):.9,X.dy=void 0!==X.dy?X.dy:35,X.ticks=void 0!==X.ticks?X.ticks:10,X.tickWidth=X.tickWidth?X.tickWidth:20,X.tickPad=X.tickPad?X.tickPad:0,X.tickSize=X.tickSize?X.tickSize:0,X.showGrid=void 0===X.showGrid||X.showGrid,X.isShow=void 0===X.isShow||X.isShow,void 0===X.xLabel?X.xLabel={rotate:0,dx:0,dy:0,cutLength:!1}:(void 0===X.xLabel.rotate&&(X.xLabel.rotate=0),void 0===X.xLabel.dx&&(X.xLabel.dx=0),void 0===X.xLabel.dy&&(X.xLabel.dy=12),void 0===X.xLabel.cutLength&&(X.xLabel.cutLength=!1)),y=a.getScale(X.scale),X.fonts&&3===X.fonts.length||(X.fonts=["helvetica","11px","gray"]),X.captionFonts&&3===X.captionFonts.length||(X.captionFonts=["helvetica","14px","dimgray"]),X.brush=X.brush?X.brush:{fonts:["Roboto","11px","orange"],height:25,fill:"#eee",stroke:"#666"},n.scaleAuto=void 0!==n.scaleAuto&&n.scaleAuto,n.beginZero=void 0!==n.beginZero?n.beginZero:[!0,!0],Array.isArray(n.beginZero)||(n.beginZero=[n.beginZero,n.beginZero])}function Ft(){x=Bt(q,x,"y","rect")}function It(){v=Bt(U,v,"y2","line")}function Bt(t,e,o,n){return t.caption=t.caption?t.caption:"",t.unitNm=t.unitNm?t.unitNm:"",t.colNm=t.colNm?t.colNm:"y"===o?"yVal":"y2Val",t.graphType=t.graphType?t.graphType:n,"bar"===t.graphType&&(t.graphType="rect"),t.strokeWidth=t.strokeWidth?t.strokeWidth:3,t.color=t.color?t.color:"y"===o?"steelblue":"#fd7e14",t.colorSave=t.colorSave?t.colorSave:t.color,t.colorHover=a.colorHover(t.colorSave),t.colorBg=t.colorBg?t.colorBg:"y"===o?"lightgrey":"#acacac",t.colorAvg=t.colorAvg?t.colorAvg:"y"===o?"orange":"orangered",t.avgStrokWidth=t.avgStrokWidth||2,t.avgDashArray=t.avgDashArray||.6,t.scale=t.scale?t.scale.toLowerCase():"linear","function"!=typeof t.format&&(t.format=a.formatAll(t.format,d3.format(",.0f")),t.formatAvg=a.formatAll(t.formatAvg,t.format),t.tipFormat=a.formatAll(t.tipFormat,d3.format(",.0f"))),t.dx=void 0!==t.dx?t.dx:8,t.dy=void 0!==t.dy?t.dy:3,t.ticks=void 0!==t.ticks?t.ticks:3,t.tickWidth=t.tickWidth?t.tickWidth:30,t.tickSize=t.tickSize?t.tickSize:0,t.showGrid=void 0===t.showGrid||t.showGrid,t.isShow=void 0===t.isShow||t.isShow,t.minGap=t.minGap&&t.minGap>0&&t.minGap<=.5?1-t.minGap:1,t.maxGap=t.maxGap&&t.maxGap>0&&t.maxGap<=.5?t.maxGap+1:1,t.opacity=void 0!==t.opacity?t.opacity:.7,t.curve=void 0!==t.curve?t.curve:"linear",e=a.getScale(t.scale),t.captionV=void 0===t.captionV||t.captionV,t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","11px","dimgray"]),e}function Et(t,e){m.select(".gMenu").select(t).style("opacity",e)}function Gt(){Mt(),Ft(),It(),n.top&&(Z=a.topKeyN(n.data,n.top.rank,X.colNm,q.colNm)),n.meta=_.merge({},n),delete n.meta.data,delete n.meta.cols,delete n.meta.margin}function Pt(t,e){if(!t.altKey)return!1;if(f){const t=a.dimFn(n,X),r=a.groupFn(n,X),l=f(-1,!0).filter(a=>r(t(a))===e.key);return o.renderList()(o.listRows(),l,!0),!0}}function Ot(){if(!m||!r.node().clientWidth)return;n.nonComponent?V=r.node().clientWidth:(V=parseInt(r.style("width"),10),n.height=parseInt(r.style("height"),10),n.height||(n.height=parseInt(V/n.aspect)));const t=n.optWin;m.attr("width",V).attr("height",n.height),m.select(".gMenu").attr("transform",`translate(${V-(t.optBtnHide?0:15)}, 3)`),a.renderTitle(n,m,V,Wt,Yt,zt),T.select("#"+l).select("rect").attr("width",$t()).attr("height",Xt()),n.resizing=!0,bt(),o.render(),n.resizing=!1}function Rt(){let t;const e=n.isSort;if(e&&e.type){const a="y"===e.whichY?q.colNm:U.colNm;if(t=I.all().slice(),t="desc"===e.type?t.sort((t,e)=>e.value[a]-t.value[a]):t.sort((t,e)=>t.value[a]-e.value[a]),e&&Array.isArray(e.rankRanges)){const a=e.rankRanges[0]<=0?0:e.rankRanges[0],o=e.rankRanges[1]>0?e.rankRanges[1]:t.length;a>=0&&o>0&&(t=t.slice(a,o))}}else t=I.all();return"linear"!==X.scale&&"sqrt"!==X.scale||-1===t.findIndex(t=>t.key===X.minMax[0])&&t.unshift(function(t){const e={key:t,value:{}};n.dummy?(e.value[q.colNm]=n.dummy[q.colNm],U&&(e.value[U.colNm]=n.dummy[U.colNm])):(e.value[q.colNm]=0,e.value[U.colNm]=0);return e}(X.minMax[0])),t}function Vt(t){if(t){if(X.captionFonts[2]=t.xCaptionColor,X.fonts[2]=t.xFonts,X.showGrid=t.xGrid,q.captionFonts[2]=t.yCaptionColor,q.fonts[2]=t.yFonts,q.scale=t.yScale,n.beginZero=[t.yBeginZero,t.y2BeginZero],q.showGrid=t.yGrid,q.color=t.yColor,q.colorBg=t.yColorBg,q.colorNeg=t.yColorNeg,q.colorAvg=t.yColorAvg,n.zero.strokeWidth=t.zeroStrokeWidth,U.draw){U.captionFonts[2]=t.y2CaptionColor,U.fonts[2]=t.y2Fonts,U.scale=t.y2Scale,U.showGrid=t.y2Grid,U.color=t.y2Color,U.colorBg=t.y2ColorBg,U.strokeWidth=t.y2StrokeWidth,U.drawZero=t.drawZero;const e=U.drawDot;e.symbol=t.y2DotSymbol,e.scale=t.y2DotScale,e.range[1]=t.y2DotRange,e.draw=t.y2DotDraw}a.optionSetting(n,t)}$=!m,m&&o.expandToggle(),d3.select("#c2iOption_"+n.id.substr(1)).style("opacity",n.optWin.opacity)}function Wt(){return n.margin.left}function Yt(){return V-n.margin.right}function zt(){return n.height-n.margin.bottom}function Ht(){return n.margin.top}function $t(){return V-n.margin.left-n.margin.right}function Xt(){return n.height-n.margin.top-n.margin.bottom}o.render=function(){if(!m){if(m=r.append("svg").attr("width",V).attr("height",n.height).on("mouseenter",()=>a.curOptWin(n,!0)).on("mouseleave",()=>a.curOptWin(n,!1)),function(){if(!n.optWin)return;b=new function(){const t={...a.optionConstructor(n,o,M,$,W)};for(let e in t)this[e]=t[e];let e;this.xCaptionColor="currentColor"===X.captionFonts[2]?"#444":X.captionFonts[2],this.xFonts="currentColor"===X.fonts[2]?"#444":X.fonts[2],this.xGrid=X.showGrid;const r=n.isSort;r&&r.type&&(e=pt.findIndex(t=>t===r.whichY),this.whichY=ht[e],e=mt.findIndex(t=>t===r.type),this.sortType=ft[e],r.rankRanges||(r.rankRanges=[0,0]),this.fromRange=r.rankRanges[0],this.toRange=r.rankRanges[1]);"object"!=typeof n.groupBy&&"c2iFact"===n.groupBy||(this.filterApply=_t);Array.isArray(o.xDim().minMax)&&("band"!==X.scale&&"linear"!==X.scale||(this.xMinVal=X.minMax[0],this.xMaxVal=X.minMax[1],this.topValue=X.topValue,X.interval&&(this.interval=X.interval),X.intervalMinutes&&(this.intervalMinutes=X.intervalMinutes),this.doApply=i));if(e=ut.findIndex(t=>t===q.graphType),this.yGraphType=gt[e],this.yCaptionColor="currentColor"===q.captionFonts[2]?"#444":q.captionFonts[2],this.yFonts="currentColor"===q.fonts[2]?"#444":q.fonts[2],this.yScale=q.scale,this.yBeginZero=n.beginZero[0],this.yGrid=q.showGrid,this.yColor=d3.rgb(q.colorSave).formatHex(),this.yColorScale=q.colorScale,this.ySolid=q.solid,this.yColorBg=d3.rgb(q.colorBg).formatHex(),this.yColorNeg=d3.rgb(q.colorNeg).formatHex(),this.yColorAvg=d3.rgb(q.colorAvg).formatHex(),this.zeroStrokeWidth=n.zero.strokeWidth,!U.draw)return;this.y2CaptionColor="currentColor"===U.captionFonts[2]?"#444":U.captionFonts[2],this.y2Fonts="currentColor"===U.fonts[2]?"#444":U.fonts[2],this.y2Scale=U.scale,this.y2BeginZero=n.beginZero[1],this.y2Grid=U.showGrid,this.y2Color=d3.rgb(U.color).formatHex(),this.y2ColorBg=d3.rgb(U.colorBg).formatHex(),this.y2Curve=U.curve,this.y2StrokeWidth=U.strokeWidth,this.drawZero=U.drawZero;const l=U.drawDot;this.y2DotSymbol=l.symbol,this.y2DotScale=l.scale,this.y2DotRange=l.range[1],this.y2DotDraw=l.draw};const t=a.preset(n),e=a.loadOption(t);e&&Vt(e.remembered[t][0]);(k=new dat.GUI({name:n.id.substr(1),autoPlace:!1,closeOnTop:!0,load:e||JSON,preset:t})).remember(b),a.makeDefaultOption(n,o,k,K,b,W);const l=o.container();(function(){const t=k.addFolder("x축 옵션");t.addColor(b,"xCaptionColor").name("x축 제목").onChange(t=>{X.captionFonts[2]=t,L.select(".xCaption").attr("fill",t)}),t.addColor(b,"xFonts").name("x축 눈금값").onChange(t=>{X.fonts[2]=t,L.selectAll(".x .tick text").attr("fill",t)}),t.add(b,"xGrid").name("그리드").onChange(t=>{X.showGrid=t,o.render()});const e=n.isSort;if(e&&e.type){t.add(b,"whichY",ht).name("정렬 기준 축").onChange(t=>{const a=ht.findIndex(e=>e===t);e.whichY=pt[a],r()}),t.add(b,"sortType",ft).name("정렬 방법").onChange(t=>{const a=ft.findIndex(e=>e===t);e.type=mt[a],2===a&&(e.rankRanges=[0,0]),r()});const a=I.all().length-1;t.add(b,"fromRange",0,a).step(1).name("시작 등수").onFinishChange(t=>{e.rankRanges[0]!==t&&(e.rankRanges[0]=t,r())}),t.add(b,"toRange",0,a).step(10>a?1:10).name("종료 등수").onFinishChange(t=>{e.rankRanges[1]!==t&&(e.rankRanges[1]=t,r())})}if(!n.nonGroupFilter){const t=n.groupBy;if("c2iFact"===t&&Array.isArray(X.minMax)&&!n.factFixed&&function(){const t=X.changeStep,e=l.minMax()[l.currentMeasure().caption],a=d3.mean(e);let o,n;a>b.xMinVal&&(o=b.xMinVal>0?.1*a:1.1*a),a>b.xMaxVal?(n=b.xMaxVal>0?.1*b.xMaxVal:1.1*b.xMaxVal,n=Math.min(n,b.xMaxVal)):n=o>0?1.1*o:.9*o;const r=e[1]>0?1.1*e[1]:.9*e[1];let i=e[1]>0?.99*e[1]:1.11*e[1];const s=k.addFolder(`x: ${q.tipFormat(e[0])} ~ ${q.tipFormat(e[1])}`);s.add(b,"xMinVal",Math.min(e[0],b.xMinVal),o,t).name("m:표시 최소값").onFinishChange(t=>X.minMax[0]=t),s.add(b,"xMaxVal",n,r,t).name("M:표시 최대값").onFinishChange(t=>{X.minMax[1]!==t&&(X.minMax[1]=t,X.topValue=t+-1)}),X.interval&&s.add(b,"interval",1,i,t).name("i:구간(M+m) % i=0").onFinishChange(t=>{X.interval!==t&&0!==t&&(X.interval=t)}),X.intervalMinutes&&s.add(b,"intervalMinutes",10,X.intervalMinutes,100).name("구간").onFinishChange(t=>{if(X.intervalMinutes!==t&&(X.intervalMinutes=t,(X.minMax[0]+X.minMax[1])%X.intervalMinutes==0&&X.minMax[1]>X.topValue)){let t=l.currentMeasure();t.groupByC2iFact?t.groupByC2iFact[0].xDim={...X}:t.xDim={...X},l.clear().render()}}),s.add(b,"doApply").name("검증 후 적용")}(),"object"==typeof t||"c2iFact"!==t){let e=!1;const a="object"==typeof t?t.colNm:t;n.cols.some(t=>{if(t.colNm===a)return e="string"===t.type||"string"===t.dataType,!0}),e?k.addFolder("사용자 그룹핑").add(b,"filterApply").name("그룹 설정 후 적용"):console.log("*.현재 "+a+"와 같은 타입(문자 이외)은 차기 버전에서 지원합니다.")}}function r(){if(0!==e.rankRanges[0]&&e.rankRanges[0]>e.rankRanges[1])return;Ct();const t=Rt();o.clear().data(t).render(),a.renderTitle(n,m,V,Wt,Yt,zt,it)}})(),function(){const t=n.zero,e=k.addFolder("y축 옵션");e.add(b,"yGraphType",gt).name("차트 타입").onChange(t=>{p.select(".y.c2iBack").selectAll(q.graphType).remove(),p.select(".y.c2iFore").selectAll(q.graphType).remove();const e=gt.findIndex(e=>e===t);q.graphType=ut[e],Dt()}),e.addColor(b,"yCaptionColor").name("y축 제목").onChange(t=>{q.captionFonts[2]=t,D.select(".yCaption").attr("fill",t)}),e.addColor(b,"yFonts").name("y축 눈금값").onChange(t=>{q.fonts[2]=t,D.selectAll(".y .tick text").attr("fill",t)}),e.add(b,"yScale",["linear","sqrt"]).name("척도(Scale)").onChange(t=>{q.scale=t,x=a.getScale(q.scale),o.render()}),e.add(b,"yBeginZero").name("0(영)부터 그리기").onChange(t=>{n.beginZero[0]=t,o.render()}),e.add(b,"yGrid").name("그리드").onChange(t=>{q.showGrid=t,o.render()}),e.addColor(b,"yColor").name("선택영역").onChange(t=>{q.colorSave=t,q.color=t,0!==q.solid&&a.setDefs(n.top,m,n),p.select(".y.c2iFore").attr("fill",q.color)}),e.add(b,"yColorScale",["linear","radial","없음"]).name("선택색상 스케일").onChange(t=>{q.colorScale=t,"없음"!==t?a.setDefs(n.top,m,n):q.color=q.colorSave,p.select(".y.c2iFore").attr("fill",q.color)}),e.add(b,"ySolid",-100,100,1).name("선택영역 입체").onChange(t=>{q.solid=t,0!==q.solid?a.setDefs(n.top,m,n):q.color=q.colorSave,p.select(".y.c2iFore").attr("fill",q.color)}),e.addColor(b,"yColorBg").name("미 선택영역").onChange(t=>{q.colorBg=t,p.select(".y.c2iBack").attr("fill",t)}),e.addColor(b,"yColorAvg").name("평균 색상").onChange(t=>{q.colorAvg=t,p.selectAll(".c2iAgg .avgLine line").attr("stroke",t),p.selectAll(".c2iAgg .avgLine text").attr("fill",t)}),e.addColor(b,"yColorNeg").name("음수영역/라인").onFinishChange(e=>{q.colorNeg=e,t.stroke=e,o.render()}),e.add(b,"zeroStrokeWidth",.5,6).step(.1).name("0(영)라인 두께").onChange(e=>{t.strokeWidth=e,t.dashLength=3*e,p.selectAll(".yZeroLine").attr("stroke-dasharray",t.dashLength).attr("stroke-width",e)})}(),U.draw&&function(){const t=k.addFolder("y2축 옵션");t.addColor(b,"y2CaptionColor").name("y2축 제목").onChange(t=>{U.captionFonts[2]=t,S.select(".y2Caption").attr("fill",t)}),t.addColor(b,"y2Fonts").name("y2축 눈금값").onChange(t=>{U.fonts[2]=t,S.selectAll(".y2 .tick text").attr("fill",t)}),t.add(b,"y2Scale",["linear","sqrt"]).name("척도(Scale)").onChange(t=>{U.scale=t,v=a.getScale(U.scale),o.render()}),t.add(b,"y2BeginZero").name("0(영)부터 그리기").onChange(t=>{n.beginZero[1]=t,o.render()}),t.add(b,"y2Grid").name("그리드").onChange(t=>{U.showGrid=t,o.render()}),t.addColor(b,"y2Color").name("선택영역").onChange(t=>{U.color=t,p.select(".y2.c2iFore").attr("stroke",t)}),t.addColor(b,"y2ColorBg").name("미 선택영역").onChange(t=>{U.colorBg=t,p.select(".y2.c2iBack").attr("stroke",t)}),t.add(b,"y2Curve",["monotone","basis","linear","step","cardinal","curveMonotoneY","natural","catmullRom"]).name("라인 유형").onChange(t=>{U.curve=t,At()}),t.add(b,"y2StrokeWidth",1,10).step(.1).name("라인 두께").onChange(t=>{U.strokeWidth=t,p.selectAll(".y2.c2iBack, .y2.c2iFore").attr("stroke-width",t)}),t.add(b,"drawZero").name("0(영) 그리기").onChange(t=>{U.drawZero=t,At()}),t.add(b,"y2DotSymbol",Object.keys(a.symbols)).name("도형 선택").onChange(t=>{U.drawDot.symbol=t,o.render()}),t.add(b,"y2DotScale",["linear","sqrt","log"]).name("도형 척도(Scale)").onChange(t=>{U.drawDot.scale=t,o.render()}),t.add(b,"y2DotRange",3,200,1).name("도형 최대").onChange(t=>{U.drawDot.range[1]=t,o.render()}),t.add(b,"y2DotDraw").name("도형 그리기").onChange(t=>{U.drawDot.draw=t,At()})}();function i(){const t=Math.abs(X.minMax[0]),e=Math.abs(X.minMax[1]);if(X.minMax[0]+X.interval<X.minMax[1]){if(X.minMax[0]<0&&t%Math.abs(X.interval)!=0)return void alert("*.0(영)이 특별한 의미를 표시하기에 최소값이 음수인 경우, 최소값("+q.tipFormat(X.minMax[0])+")에 대해 반드시 구간 값("+q.tipFormat(X.interval)+")은 음,양과 무관하게 배수 관계가 성립되어야 합니다.");let e=l.currentMeasure();return e.groupByC2iFact?e.groupByC2iFact[0].xDim={...X}:e.xDim={...X},r.classed("c2iSelectTarget",!1),void l.clear().render()}alert("*.최소값 + 간격값 = "+q.tipFormat(X.minMax[0]+X.interval)+" 은 최대값 "+q.tipFormat(e)+" 보다 작어야 합니다.")}a.makeBrushOption(n,o,k,b,m,()=>V)}(),a.setDefs(n.top,m,n),a.setTitleDesc(n),a.renderTitle(n,m,V,Wt,Yt,zt,it),!W)return;p=m.insert("g","g.gTitle").attr("class","body").attr("transform","translate("+Wt()+","+Ht()+")"),bt(),kt("y"),kt("y2"),g=m.append("g").attr("class","axes"),function(){const t=n.tooltip;let e=[{id:"resetFilter",img:"resetFilter.png",tip:W.gen.resetFilter,opacity:.4},{id:"tooltip",img:"tooltip.png",tip:"툴팁",opacity:t&&t.isShow?1:.4},{id:"expand",img:"expand.png",tip:"확장&축소\n: 축소시 이 차트는 그리지 않으나,\n 설정된 조건은 다른 차트에 반영됩니다."},{id:"export",img:"export.png",tip:"익스포트(이미지&데이터)"},{id:"avgLine",img:"avgLine.png",tip:"평균라인",opacity:j.avgLine?1:.4,exclude:!E},{id:"aggBar",img:"aggBar.png",tip:"점유율 막대",opacity:j.aggBar?1:.4,exclude:!(E&&!o.isAvg())}],r={_svg:m,_width:V,_showToolbar:K,_dimension:M,cfg:n};r={...r,chart:o,menus:e},a.renderMenu(r)}()}return Y=!1,n.data.some(t=>{if(rt(t)<0)return Y=!0,!0}),function(){const t=n.data;let e;"band"===X.scale||"point"===X.scale?(e=t.map(nt),X.minMax&&e.push(X.minMax[1])):e=X.minMax?X.minMax:d3.extent(t.map(nt));y.domain(e).range([0,$t()]);let a=X.ticks;a=0===a?n.data.length:$t()>X.tickWidth?$t()/X.tickWidth:1;const o=!0===X.showGrid?-Xt():X.tickSize;w.scale(y).tickPadding(X.tickPad).tickSizeInner(o).tickSizeOuter(0),"time"===X.scale&&"year"===X.round?w.ticks(X.timeTicks):w.ticks(a);"linear"===X.scale&&w.tickFormat(X.format);if((L=(L=g.selectAll(".x.axis").data(X.isShow?[null]:[])).enter().append("g").attr("class","x axis").merge(L)).attr("transform","translate("+[Wt(),zt()]+")").call(w),function(){if("band"===X.scale||"point"===X.scale){let t=-1;switch(X.ticks){case 0:t=-1;break;case-1:t=$t()>X.tickWidth?Math.ceil(y.domain().length/($t()/X.tickWidth)):0;break;default:t=parseInt(y.domain().length/X.ticks)}L.style("font-family",X.fonts[0]).style("font-size",X.fonts[1]).attr("fill",X.fonts[2]).style("fill-opacity",(e,a)=>a%t==0||-1===t?1:0),L.selectAll("line").style("stroke-opacity",(e,a)=>a%t==0||-1===t?.3:0)}}(),function(){const t=L.selectAll(".x .tick > text"),e=X.xLabel.cutLength;e&&L.selectAll(".axes .x.axis g").each(function(){const t=d3.select(this).select("text").text();d3.select(this).select("text").text(t.length>e?t.substring(0,e)+"...":t)}),t.attr("fill",X.fonts[2]),X.xLabel.isVertical?t.style("writing-mode","tb").attr("dx",X.xLabel.dx).attr("dy",X.xLabel.dy).style("text-anchor","start"):void 0!==X.xLabel.rotate&&0!==X.xLabel.rotate?t.style("text-anchor",X.xLabel.rotate>0?"start":"end").attr("dx",X.xLabel.dx).attr("dy",X.xLabel.dy).attr("transform",()=>"rotate("+X.xLabel.rotate+")"):t.attr("dx",X.xLabel.dx).attr("dy",X.xLabel.dy)}(),X.caption&&!X.hideCaption){const t=L.selectAll(".xCaption").data([X.caption]);t.enter().append("text").attr("class","xCaption").style("font-family",X.captionFonts[0]).style("font-size",X.captionFonts[1]).attr("fill",X.captionFonts[2]).style("text-anchor","middle").attr("dy",X.dy).text(t=>X.unitNm?t+X.unitNm:t).merge(t).attr("x",$t()/2)}}(),xt("y"),xt("y2"),function(){const t=Y?[null]:[],e=n.zero,a=p.selectAll(".yZeroLine").data(t);a.exit().remove(),a.enter().append("line").attr("class","yZeroLine").style("shape-rendering","crispEdges").attr("x1",0).style("stroke-opacity",e.opacity).merge(a).attr("stroke",e.stroke).attr("stroke-width",e.strokeWidth).attr("stroke-dasharray",e.dashLength).attr("x2",$t()).attr("y1",x(0)).attr("y2",x(0))}(),function(){T||(T=m.append("g").attr("class","xBrush").attr("transform","translate("+Wt()+","+Ht()+")").on("click",t=>{t.altKey&&("object"!=typeof n.groupBy&&"c2iFact"===n.groupBy||_t(t))})).append("clipPath").attr("id",l).append("rect").attr("width",$t()).attr("height",Xt());ot.extent([[0,Xt()],[$t(),Xt()+d3.max([25,n.margin.bottom])]]),T.call(ot);const t=T.selectAll(".handleBar").data([{type:"w"},{type:"e"}]);t.enter().append("path").attr("class","handleBar brush-handle").attr("cursor","ew-resize").attr("fill",X.brush.fill).attr("stroke",X.brush.stroke).style("opacity",.5).style("display","none").merge(t).attr("d",function(t){const e=+("e"===t.type),a=e?1:-1,o=Xt()/2;let n="M"+.5*a+","+o+"A6,6 0 0 "+e+" "+6.5*a+",";return n+=o+6+"V"+(2*o-6)+"A6,6 0 0 "+e+" "+.5*a+",",n+=2*o+"ZM"+2.5*a+","+(o+8)+"V"+(2*o-8),n+="M"+4.5*a+","+(o+8)+"V"+(2*o-8)});const e=m.selectAll(".statInfo").data([null]);if(e.enter().append("text").attr("class","handleBar statInfo").style("cursor","move").style("font-family",X.brush.fonts[0]).style("font-size",X.brush.fonts[1]).attr("fill",X.brush.fonts[2]).style("text-anchor","middle").style("display","none").call(it).merge(e),e.selectAll("tspan").empty()){const t=e.selectAll("tspan").data(["x","value","ratioDiff"]);t.enter().append("tspan").attr("class",t=>t).attr("x",0).attr("dy","1.1em").text(t=>t)}if(!n.resizing)return;let a;n.resizing=!1;const o=z.length;if(0!==o){if(H=[y(z[0]),y(z[o-1])],"band"===X.scale&&(a=[H[0],H[1]+y.bandwidth()]),"point"===X.scale){const t=y.step()/2;a=[H[0]-t,H[1]+t]}}else 0!==H.length&&(a=H.map(y));a&&T.call(ot.move,a)}(),vt(),O=tt(),At(),Nt(),o},ot.on("start.chart",()=>Et(".resetFilter",1)),ot.on("brush.chart",function(t){const e=t.selection||d3.brushSelection(this),a=y&&y.range();let n=e||a;if(!(n&&2===n.length&&!isNaN(n[0])&&!isNaN(n[1])))return;const r=t.sourceEvent;let i,s;if("band"===X.scale||"point"===X.scale){const t=y.domain().map(y);(i=d3.bisectLeft(t,n[0]))===(s=d3.bisectLeft(t,n[1]))&&(i===t.length?i--:s++);const e=(z=y.domain().slice(i,s)).length;if(0===e)return;if(H=[y(z[0]),y(z[e-1])],"band"===X.scale&&(n=[H[0],H[1]+y.bandwidth()]),"point"===X.scale){const t=y.step()/2;n=[H[0]-t,H[1]+t]}r&&"mousemove"===r.type&&d3.select(this).call(ot.move,n)}else H=n.map(y.invert),r&&r.shiftKey&&"linear"===X.scale&&(n=function(t){const e=X.interval?X.interval:1,a=d3.range(X.minMax[0],X.minMax[1],e).concat(X.minMax[1]);let o=a.findIndex(t=>t>=H[0]);a[o]!==H[0]&&o&&--o;let n=a.findIndex(t=>t>=H[1]);return n=Math.max(0,n),H=[a[o],a[n]],H.map(y)}(),d3.select(this).call(ot.move,n));B&&(H=H.map(B),n=H.map(y),r&&"mousemove"===r.type&&d3.select(this).call(ot.move,n)),Nt(),T.selectAll(".brush-handle").style("display",null).attr("transform",(t,e)=>`translate(${n[e]}, 0)`);const c=n[1]-n[0],d=-1===at[0]?n[0]+c/2+5+Wt():at[0];m.selectAll(".statInfo").style("display",null).attr("transform",()=>`translate(${d}, ${at[1]})`),T.select("#"+l+" rect").attr("x",n[0]).attr("width",c),o.lazyFilter()||wt("brush")}),ot.on("end.chart",function(){d3.brushSelection(this)||Ct(),o.lazyFilter()&&wt("end")}),o.resize=Ot,o.brushInfoDisplay=(t=>{X=t,Nt()}),o.statInfoFill=(t=>{X=t,m.select(".statInfo").attr("fill",X.brush.fonts[2])}),o.lazyFilter=function(t){if(!arguments.length)return n.lazyFilter;n.lazyFilter=t},o.listRows=function(t){return t?(n.dataList.listRows=t,u.listRows(t),o):n.dataList.listRows},o.clear=function(){return m&&(m.remove(),m=D=S=T=void 0,a.removeOptionDom(n)),o},o.title=function(t){return arguments.length?(n.title=t,a.setTitle(n),a.renderTitle(n,m,V,Wt,Yt,zt,it),o):n.title},o.xDim=function(t){return arguments.length?(n.xDim=t,Mt(),o):n.xDim},o.yDim=function(t){return arguments.length?(q=n.yDim=t,Ft(),o):n.yDim},o.y2Dim=function(t){return arguments.length?(U=n.y2Dim=t,It(),o):n.y2Dim},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(t){return arguments.length?(n.data=t,Gt(),o):n.data},o.exportData=function(t,e){const{caption:o,colNms:r,colCaptions:l,data:i,filters2:s}={...a.exportFilters(n,e,R,lt)};a.exportData(o,r,l,i,t,s,X)},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),W=c2i.lang,o):n.lang},o.dimension=function(t){return arguments.length?(M=t,o):M},o.group=function(t){if(!arguments.length)return I;I=t;const e=Rt();return o.data(e),o},o.groupAll=function(t){return arguments.length?(E=t,o):E},o.filter=function(t){return t&&(F=t,ot.extent(t),"band"===X.scale||"point"===X.scale?M.filter(a.multiValuesFilter(t)):M.filterRange(H)),o},o.resetFilter=function(){ot.clear(T),Ct(),at=[-1,Ht()]},o.hasCurrentFilter=(()=>M&&M.hasCurrentFilter()),o.filterValues=function(){let e,a;const o=n.title&&n.title.caption?n.title.caption:t;return"band"===X.scale||"point"===X.scale?(e=X.caption?X.caption:"X",e+="; "+z.map(t=>X.tipFormat?X.tipFormat(t):t),a=z.map(t=>t)):(a=H,e=(e=H.map(t=>X.tipFormat?X.tipFormat(t):t))[0]+" "+X.expX+" "+e[1]),{c2iCon:t,title:o,filters:e,filterRaws:a,colNm:"c2iFact"===n.groupBy?n.fact:n.groupBy,scale:X.scale}},o.round=function(t){if(!arguments.length)return B;switch(t){case"year":B=d3.timeYear.round;break;case"month":B=d3.timeMonth.round;break;case"week":B=d3.timeWeek.round;break;case"day":B=d3.timeDay.round;break;case"hour":B=d3.timeHour.round;break;default:B=void 0}return o},o.tooltipToggle=(()=>b.tooltip=a.tooltipToggle(n,Et)),o.expandToggle=(()=>{$=!$,b.expand=$,m.transition().style("height",$?null:"29px")}),o.isShow=(()=>$),o.avgLineToggle=(()=>{j.avgLine=!j.avgLine,b.avgLine=j.avgLine,Et(".avgLine",j.avgLine?1:.4),Lt()}),o.aggBarToggle=(()=>{o.isAvg()||(j.aggBar=!j.aggBar,Et(".aggBar",j.aggBar?1:.4),vt())}),o.topToggle=(()=>{if(!n.top)return;const t=n.top;t.isShow=!t.isShow,o.topRank()}),o.topRank=(()=>{const t=n.top;if(b.topShow=t.isShow,Et(".top",t.isShow?1:.4),Dt(),n.title){const e=d3.format(",d");let o="once"===t.type?"Top":"everyNew"===t.type?"N top":"top";o="("+o+" "+e("once"===t.type?Z.length:t.rank)+")";const r=n.isSort;if(r&&r.type&&r.rankRanges){const t=e(r.rankRanges[0])+" ~ "+e(r.rankRanges[1]);o=("desc"===r.type?" 내림차순 ":" 오름차순 ")+t+" 기준"+o}n.title.captionTopN=t.isShow?o:null,a.renderTitle(n,m,V,Wt,Yt,zt,it),a.changeOptionTitle(n)}}),o.toolbarToggle=((t,e)=>(K=a.toolbarToggle(t,n,m,K,e),o)),o.toolbarStatus=(()=>K),o.toolbarShrink=(()=>{(J=!J)?k.show():k.hide()}),o.toolbarShrinkStatus=(()=>J),o.saveOption=(()=>{a.saveOption(k)}),o.initOption=(()=>{a.removeOption(k),n=a.mergeMeta(n,c2i.meta.insight);const t=_.merge({},n.meta);n.duration=t.duration,n.dataList=t.dataList,n.beginZero=t.beginZero,n.zero=t.zero,n.title=t.title,n.top=t.top,n.tooltip=t.tooltip,X=n.xDim=t.xDim,q=n.yDim=t.yDim,U=n.y2Dim=t.y2Dim,j=n.statistics=t.statistics,Vt(),o.clear(),n.resizing=!0,o.render()}),o.container=function(t){return arguments.length?(tt=(u=t).aggInfos,P=u.isAvg,R=u.chartFilters,f=u.listData,h=u.renderList,o):u},o.aggInfos=function(t){return arguments.length?(tt=t,o):tt()},o.isAvg=function(t){return arguments.length?(P=t,o):P()},o.chartFilters=function(t){return R=t,o},o.listData=function(t){return arguments.length?(f=t,o):f(-1)},o.renderList=function(t){return arguments.length?(h=t,o):h},o.tooltipMini=(t=>t?(n.tooltip=t,o):n.tooltip);return n.isResponsive&&a.resizeChart(n,t,Ot,null),a.rebind(o,ot,"on")}),c2i.bi.iContainer=(options=>{"use strict";const _u=c2i.util;if(!_u.checkLicenseLocale(options))return!1;const iCon={};let cfg={theme:"none",margin:void 0,dataList:{},charts:void 0,statistics:{isCompute:!0},tooltip:{id:"#tooltip",opacity:.9,isShow:!0},isDev:!0};_u.init(cfg,options),cfg.imgSrc&&_u.imgSrc(cfg.imgSrc);const cfgMeta=_u.deepClone(cfg);let _Metas,_xDragPos,_yDragPos;delete cfgMeta.charts;let _chartFilters=[];const _list=cfgMeta.dataList,_stat=cfgMeta.statistics,_tooltip=cfgMeta.tooltip,_fmtSignNumber=d3.format("+,.0f"),_fmtNumber=d3.format(",.0f"),_fmtRatio=d3.format(".3%"),_dragHandle=d3.drag().on("start",__start).on("drag",__drag).on("end",__end);let _filterDlg,_dbMgr,_tipSeriesNm="건수",_dataCf,_all,_c2iCharts,_c2iList,_listDim,_listRows,_allAgg,_curM,_aggInfos=[];const _m=c2i.meta;function renderAll(){_computeAgg(),_c2iCharts.each(_draw),_renderList(_listRows),_renderTooltip()}function _renderList(t,e,a){if(!_list.isShow)return void(cfg.sendData&&r([]));let o,n;function r(t){t.length||(t=_listDim?_listDim.top(1/0):[]);const e=cfg.charts.filter(t=>cfg.dataList&&t.id===cfg.dataList.chartId),{groupBy:a,xDim:o}={...e[0]};cfg.sendData(_curM,t,{groupBy:a,xDim:o},iCon)}a?(o=e,n=t||t>-1?o.slice(0,t):o):(n=e||iCon.listData(t),o=[]),_c2iList||(_c2iList=c2i.bi.iList(_list.listId,options).container(iCon)),_c2iList.altData(o).data(n).render(),cfg.sendData&&r(o)}function _draw(t){t.isShow()&&d3.select(this).call(t.render)}function _computeAgg(){(_aggInfos=[]).push(_allAgg);let t={..._all.value()};const e={key:"ratio",values:{caption:"점유율",yVal:0===_allAgg.values.yVal?0:t.yVal/_allAgg.values.yVal,y2Val:0===_allAgg.values.y2Val?0:t.y2Val/_allAgg.values.y2Val,avg:0===t.y2Val?0:t.yVal/t.y2Val-_allAgg.values.avg}};t={key:"range",values:{caption:"검색 결과",yVal:t.yVal,y2Val:t.y2Val,avg:0===t.y2Val?0:t.yVal/t.y2Val}},_aggInfos.push(t),_curM.isAvg||_aggInfos.push(e)}function _renderTooltip(){if(!_tooltip.isShow)return;let t,e,a=d3.select(_tooltip.id+" table");if(a.empty())return void _u.alert("*.툴팁 DOM Tag 정보 없음. 통계정보 제공 누락.");if(a.select("tbody").selectAll("tr").remove(),c2i.utilEx.resetTooltip(d3.select(_tooltip.id),_tooltip.width?_tooltip.width:a.style("width"),null),a.select("#name").text(_tooltip.caption?_tooltip.caption:"툴팁 제목 없음"),(t=a.select("tbody")).empty()){a.select(".c2iShrinkBtn").on("touchstart",()=>_topShrinkToggle(t)).on("click",()=>_topShrinkToggle(t)),a.select(".c2iCloseBtn").on("touchstart",_tipToggle).on("click",_tipToggle),d3.select(_tooltip.id).style("pointer-events","all").style("cursor","move").call(_dragHandle);const e=(t=a.append("tbody")).append("tr").attr("class","level0"),o=[{cls:"tipName",c2i18n:"gen.tipContent",caption:"내역"},{cls:"tipAll",caption:_curM.caption},{cls:"tipSeries",caption:_tipSeriesNm}];_curM.isAvg||o.push({cls:"tipGroup",c2i18n:"gen.avg",caption:"평균"}),e.selectAll("td").data(o).enter().append("td").attr("class",t=>t.cls).attr("data-c2i18n",t=>t.c2i18n).text(t=>t.caption)}d3.select(_tooltip.id).classed("c2iHidden",!_tooltip.isShow);let o=t.selectAll("tr.level1").data(_aggInfos,t=>t.key);o.exit().remove();const n=(o=o.enter().append("tr").attr("class",t=>"level1 "+t.key).merge(o)).selectAll("td").data(t=>{let{caption:e,yVal:a,y2Val:o,avg:n}={...t.values};_curM.isAvg&&(a=n);const r=[{value:e,cls:"tipHeader"},{value:a,cls:"yVal number",isRatio:"ratio"===t.key},{value:o,cls:"y2Val number",isRatio:"ratio"===t.key}];return _curM.isAvg||r.push({value:n,cls:"avg number"}),r});n.exit().remove(),n.enter().append("td").attr("type",function(){return this.parentNode.className.split(" ")[1]}).merge(n).attr("class",function(t){return e=t.cls,"avg number"===t.cls&&"ratio"===d3.select(this).attr("type")&&(e+=t.value<0?" negative":t.value>0?" positive":""),e}).text(function(t,e){return e&&"avg number"===t.cls&&"ratio"===d3.select(this).attr("type")?_fmtSignNumber(t.value):e?t.isRatio?_fmtRatio(t.value):_fmtNumber(t.value):t.value})}function cfCallback(t){console.log("*.Action..; ",t)}function __getFormat(t){return t.chartFormat?t.chartFormat:t.listFormat?t.listFormat:".0f"}function __getFormatAvg(t){return t.formatAvg?t.formatAvg:t.chartFormat?t.chartFormat:".0f"}function __getTipFormat(t){return t.tipFormat?t.tipFormat:t.listFormat?t.listFormat:".0f"}function currentMeasure(){let t;if(_curM||(_tipSeriesNm="건수",iCon.currentMeasureY2(cfg.y2ColNm),cfg.cols.some(e=>{if(e.isMeasure){if(e.isSelected)return(_curM=e).whichY="y",_curM.y2ColNm=iCon.currentMeasureY2(),_curM.tipFormat||(_curM.tipFormat=__getTipFormat(_curM)),_curM.formatAvg||(_curM.formatAvg=__getFormatAvg(_curM)),t=void 0,!0;t||(t=e)}})),!_curM){let e;if(!t)return e="*.현재 계산할 Measure 컬럼(예:판매금액,수량등에서 1개)을 지정하세요.\n ; 작업 오류.",_u.alert(e),!1;_curM=t,t.isSelected=!0,cfg.charts.forEach(e=>{"dimFn"!==e.fact&&(e.fact=_curM.colNm);const a=e.yDim;a.caption=t.caption?t.caption:"컬럼명 없음",a.unitNm=t.unitNm?t.unitNm:"",a.format=__getFormat(t),a.tipFormat=t.tipFormat?t.tipFormat:a.format}),e="*.현재 계산할 Measure 컬럼(예:판매금액,수량등에서 1개)이 미설정되어,(",e+=t.caption+")으로 임의 지정되어 설정 및 실행됩니다.",e+="\n 설정을 조정하면 이 메시지가 나오지 않습니다.",_u.alert(e)}return _curM&&_curM.groupByC2iFact&&_curM.groupByC2iFact.forEach(t=>{cfg.charts=cfg.charts.map(e=>(e.id===t.id&&(e=_.merge({},e,t)),e.xDim.minMax&&"byData"!==e.xDim.minMax&&_setUpMaxValue(e.xDim),e))}),!0}function _setUpMaxValue(t){void 0!==t.topDiff&&(t.topValue=t.minMax[1]+t.topDiff)}function _topShrinkToggle(t){t.empty()||t.classed("c2iHidden",!t.classed("c2iHidden"))}function _tipToggle(t){if(_tooltip.isShow=!_tooltip.isShow,d3.select(_tooltip.id).classed("c2iHidden",!_tooltip.isShow),_renderTooltip(),t)return _tooltip.isShow;_tooltip&&"function"==typeof _tooltip.fn&&_tooltip.fn()}function _dataConvert(){const convertFns={};let isConvert=!1,start,colNm,currentNow;if(start=(new Date).getTime(),cfg.isDev&&console.log(">> 데이터 건수: ",cfg.data.length),cfg.preBuildData&&_preBuildData(),cfg.cols.forEach((m,i)=>{m.convertFn&&(convertFns[m.colNm]="string"==typeof m.convertFn?eval(m.convertFn):m.convertFn,isConvert=!0),"currentNow"===m.colNm&&(currentNow=d3.timeFormat("%Y%m%d")(start))}),isConvert&&cfg.data.forEach((t,e)=>{for(colNm in currentNow&&(t.currentNow=currentNow),convertFns)t[colNm]=convertFns[colNm](t[colNm])}),cfg.minMax={},cfg.cols.forEach(t=>{t.isMeasure&&(cfg.minMax[t.caption]=d3.extent(cfg.data,e=>e[t.colNm]),t.groupType||(t.groupType=t.caption))}),cfg.isDev){const t=(new Date).getTime();console.log(">> 데이터 컨버전 종료(ms); ",t-start)}}function _preBuildData(){console.log(">> 데이터 Pre-build Start");const t=[];cfg.cols.forEach(e=>{e.isMeasure||t.push(e.colNm)});const e=cfg.data.length,a=cfg.preBuildData,o=a.measureNms,n=a.facts,r=a.newDimNm,l=[];let i,s,c,d,u,m,p,g,f,h;if(o.length>1)for(i=0;i<e;i++){for(p=cfg.data[i],g={},s=0;s<t.length;s++)g[u=t[s]]=p[u];for(f={},c=0;c<o.length;c++)for(m=o[c],d=0;d<n.length;d++)h=parseFloat(p[m+"_"+n[d]]),isNaN(h)||(f[m]=h,f[r]=n[d],l.push({...g,...f}))}else for(m=o[0],i=0;i<e;i++){for(p=cfg.data[i],g={},s=0;s<t.length;s++)g[u=t[s]]=p[u];for(f={},d=0;d<n.length;d++)h=parseFloat(p[n[d]]),isNaN(h)||(f[m]=h,f[r]=n[d],l.push({...g,...f}))}cfg.data=l,console.log(">> Pre-build End, 데이터 건수: ",cfg.data.length)}function __start({sourceEvent:t}){t.stopPropagation(),_xDragPos=parseFloat(d3.select(this).style("left"))-t.pageX,_yDragPos=parseFloat(d3.select(this).style("top"))-t.pageY}function __drag({sourceEvent:t}){d3.select(this).style("opacity",.5).style("left",()=>t.pageX+_xDragPos+"px").style("top",()=>t.pageY+_yDragPos+"px")}function __end(){d3.select(this).style("opacity",_tooltip.opacity)}function __setYDim(t,e){return t.caption=e.caption,t.unitNm=e.unitNm?e.unitNm:"",t.format=e.chartFormat?e.chartFormat:e.listFormat?e.listFormat:t.format?t.format:".0f",t.formatAvg=e.formatAvg?e.formatAvg:t.format,t.tipFormat=e.tipFormat?e.tipFormat:t.format,t}function __chartClear(){_c2iCharts&&_c2iCharts.each(t=>t.clear()),_c2iList&&_c2iList.clear(),d3.select(_tooltip.id+" table tbody").remove()}return iCon.render=function(){if(_dataCf=crossfilter(cfg.data),cfg.isDev&&_dataCf.onChange(cfCallback),!currentMeasure())return iCon;_Metas=cfg.charts.map(t=>{let e={};switch(t.graphType){case"calView":e=_u.mergeMeta(_m.insight,cfgMeta,_m.iCalView,t);break;case"countryMap":e=_u.mergeMeta(_m.insight,cfgMeta,_m.iCountry,t);break;default:e=_u.mergeMeta(_m.insight,cfgMeta,t)}let{listFormat:a,tipFormat:o,formatAvg:n}={..._curM};return n||(n=a),e.yDim={...e.yDim,listFormat:a,tipFormat:o,formatAvg:n},e.y2Dim&&(e.y2Dim={...e.y2Dim,formatAvg:n}),e}),_all=_dataCf.groupAll().reduce(_u.rdAdd(_curM.colNm,"yVal","y2Val",cfg.y2ColNm),_u.rdRemove(_curM.colNm,"yVal","y2Val",cfg.y2ColNm),_u.rdInit(["yVal","y2Val"])),_allAgg={key:"all",values:{caption:"전체 정보",yVal:(_allAgg={..._all.value()}).yVal,y2Val:_allAgg.y2Val,avg:_allAgg.yVal/_allAgg.y2Val}};let t,e,a,o,n,r,l,i,s=[];if(_Metas.forEach(c=>{if(t=c.xDim,e=c.yDim,a=c.y2Dim,"byData"===t.minMax)if("time"===t.scale&&t.round){const e=_u.rounded(t.round);t.minMax=d3.extent(cfg.data,t=>e(t[c.groupBy])),"day"===t.round&&t.minMax[1].setDate(t.minMax[1].getDate()+1),"month"===t.round&&t.minMax[1].setMonth(t.minMax[1].getMonth()+1),"year"===t.round&&t.minMax[1].setFullYear(t.minMax[1].getFullYear()+1)}else t.minMax=d3.extent(cfg.data,t=>t[c.groupBy]);else t.minMax&&_setUpMaxValue(t);if(i=_u.dimFn(c,t),o=_dataCf.dimension(i),r=_u.groupFn(c,t),n=o.group(r),l=_stat&&_stat.isCompute?o.groupAll():null,_curM.isAvg){const t=e.colNm+"_sum";"dimFn"===c.fact&&i?(n=n.reduce(_u.rdAddFnAvg(i,e.colNm,a.colNm),_u.rdRemoveFnAvg(i,e.colNm,a.colNm),_u.rdInit([e.colNm,a.colNm,t])),l&&(l=l.reduce(_u.rdAddFnAvg(i,e.colNm,a.colNm),_u.rdRemoveFnAvg(i,e.colNm,a.colNm),_u.rdInit([e.colNm,a.colNm,t])))):(n=n.reduce(_u.rdAddAvg(c.fact,e.colNm,a.colNm),_u.rdRemoveAvg(c.fact,e.colNm,a.colNm),_u.rdInit([e.colNm,a.colNm,t])),l&&(l=l.reduce(_u.rdAddAvg(c.fact,e.colNm,a.colNm),_u.rdRemoveAvg(c.fact,e.colNm,a.colNm),_u.rdInit([e.colNm,a.colNm,t]))))}else"dimFn"===c.fact&&i?(n=n.reduce(_u.rdAddFn(i,e.colNm,a.colNm,cfg.y2ColNm),_u.rdRemoveFn(i,e.colNm,a.colNm,cfg.y2ColNm),_u.rdInit([e.colNm,a.colNm])),l&&(l=l.reduce(_u.rdAddFn(i,e.colNm,a.colNm,cfg.y2ColNm),_u.rdRemoveFn(i,e.colNm,a.colNm,cfg.y2ColNm),_u.rdInit([e.colNm,a.colNm])))):(n=n.reduce(_u.rdAdd(c.fact,e.colNm,a.colNm,cfg.y2ColNm),_u.rdRemove(c.fact,e.colNm,a.colNm,cfg.y2ColNm),_u.rdInit([e.colNm,a.colNm])),l&&(l=l.reduce(_u.rdAdd(c.fact,e.colNm,a.colNm,cfg.y2ColNm),_u.rdRemove(c.fact,e.colNm,a.colNm,cfg.y2ColNm),_u.rdInit([e.colNm,a.colNm]))));let d;d=(d="donut"===c.graphType?c2i.bi.iDonut(c.id,c).renderAll(renderAll):"calView"===c.graphType?c2i.bi.iCalView(c.id,c).renderAll(renderAll):"countryMap"===c.graphType?c2i.bi.iCountry(c.id,c).renderAll(renderAll):c2i.bi.insight(c.id,c).round(t.round)).dimension(o).group(n).groupAll(l).container(iCon),c.filter&&(d=d.filter(c.filter)),s.push(d),_list&&_list.chartId&&_list.chartId===c.id&&(_listDim=o)}),d3.select(".c2iMiniTip").empty()&&d3.select("body").append("div").attr("class","c2iMiniTip c2iHidden"),_c2iCharts=d3.selectAll(".c2iBi").data(s).each(t=>{t.on("end",renderAll),t.lazyFilter&&!t.lazyFilter()&&t.on("brush",renderAll)}),_list&&_listDim){if(_listRows=_list.listRows,cfg.dataList&&cfg.dataList.isFloating){const t=d3.select(".c2iDataList").attr("class");-1===t.indexOf("c2iDataListFloat")&&d3.select(".c2iDataList").attr("class",t+" c2iDataListFloat "+(_list.listId&&_list.isShow?"":"c2iHidden")).call(_dragHandle)}_list.listId&&_list.isShow&&(_c2iList=c2i.bi.iList(_list.listId,options).data(iCon.listData(_listRows)).container(iCon))}return renderAll(),iCon},iCon.aggInfos=(()=>_aggInfos),iCon.cfg=(()=>cfg),iCon.isAvg=(()=>_curM&&_curM.isAvg),iCon.minMax=(()=>cfg.minMax),iCon.tooltipToggle=(()=>_tipToggle(!0)),iCon.tooltipShowStatus=(()=>_tooltip.isShow),iCon.avgLineToggle=(()=>_c2iCharts.each(t=>t.avgLineToggle&&t.avgLineToggle())),iCon.aggBarToggle=(()=>_c2iCharts.each(t=>t.aggBarToggle&&t.aggBarToggle())),iCon.topToggle=(()=>_c2iCharts.each(t=>t.topToggle&&t.topToggle())),iCon.resetAll=(()=>{_c2iCharts.each(t=>t.resetFilter&&t.resetFilter()),renderAll()}),iCon.closeAllOptions=(()=>{_c2iCharts.each(t=>{t.toolbarStatus&&t.toolbarToggle(event,!1)})}),iCon.shrinkAllOptions=(()=>{_c2iCharts.each(t=>{t.toolbarShrinkStatus&&t.toolbarShrink()})}),iCon.renderAll=(()=>renderAll()),iCon.renderList=((t,e,a)=>_renderList(t,e,a)),iCon.brushToggle=(()=>_c2iCharts.each(t=>{t.lazyFilter&&t.on("brush",t.lazyFilter()?null:renderAll)})),iCon.measures=(t=>{if(!t)return cfg.cols;cfg.cols=t}),iCon.currentMeasure=(t=>t?(cfg.cols.some(e=>{e.isMeasure&&(e.caption===t?(e.isSelected=!0,(_curM={..._curM,...e}).whichY="y"):e.isSelected=!1)}),_curM&&cfg.charts.filter(t=>!t.factFixed).forEach(t=>{"dimFn"!==t.fact&&(t.fact=_curM.colNm),__setYDim(t.yDim,_curM)}),__chartClear(),iCon):_curM),iCon.currentMeasureY2=(t=>{if(!t)return cfg.y2ColNm;let e;return cfg.y2ColNm=void 0,cfg.cols.some(a=>{if(a.isMeasure&&a.caption===t)return e=a,cfg.y2ColNm=a.colNm,void(_curM&&(_curM.y2ColNm=a.colNm))}),e?(cfg.charts.forEach(t=>{e.unitNm=e.unitNm?e.unitNm:_m.insight.y2Dim.unitNm,e.tipFormat=e.tipFormat?e.tipFormat:_m.insight.y2Dim.tipFormat,_curM&&(_curM.whichY="y2",_curM.y2Dim=__setYDim(t.y2Dim,e))}),_tipSeriesNm=(e.y2Dim?e.y2Dim.caption:e.caption)+" "+e.unitNm):(console.log("*.Y2축은 데이터 건수 개념으로 처리됩니다."),cfg.charts.forEach(e=>{e.y2Dim={..._m.insight.y2Dim},e.y2Dim.caption=t,cfgMeta.defaultUnitNm&&(e.y2Dim.unitNm=cfgMeta.defaultUnitNm),_curM&&(_curM.whichY="y2",_curM.y2Dim=e.y2Dim)}),_tipSeriesNm=_curM.y2Dim?_curM.y2Dim.caption+" "+_curM.y2Dim.unitNm:cfgMeta.defaultUnitNm?cfgMeta.defaultUnitNm:"건수"),__chartClear(),iCon}),iCon.listToggle=(t=>{t?d3.select(".c2iDataList").classed("c2iHidden",!0):(_list.isShow=!_list.isShow,_list.listId&&d3.select(".c2iDataList").classed("c2iHidden",!_list.isShow),_c2iList&&!_list.isShow&&_c2iList.clear())}),iCon.listData=function(t,e){const a=-1===t||void 0===t?1/0:t;if(e){if(!_list.isShow)return[];d3.select(".c2iDataList").classed("c2iHidden",!1)}return _listDim?_listDim.top(a):[]},iCon.listRows=function(t){_list.listRows=-1===t||void 0===t?1/0:t,_listRows=_list.listRows},iCon.exportData=function(t){iCon.chartFilters(),_c2iCharts.each(e=>e.exportData(t,_chartFilters)),_chartFilters=[]},iCon.chartFilters=(()=>(_chartFilters=[],_c2iCharts.each(t=>{t.hasCurrentFilter()&&_chartFilters.push(t.filterValues())}),_chartFilters)),iCon.filterDlg=(t=>t?(_filterDlg=t,iCon):_filterDlg),iCon.clear=(()=>(iCon&&_c2iCharts&&(_c2iCharts.each(t=>t.clear()),_c2iList&&_c2iList.clear(),_c2iCharts=void 0),iCon)),iCon.data=(t=>t?(cfg.data=t,_dataConvert(),iCon):cfg.data),iCon.dbMgr=(t=>t?(_dbMgr=t,iCon):_dbMgr),iCon}),c2i.ui.legendOrdinal=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;e=e||{};const o={},n={cutLength:12};if(a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme,!e.targetChartObject)return void alert(c2i.lang.cm.nonTargetChart);let r,l,i,s,c,d,u,m,p,g,f,h,y,_,x,v=e.targetChartObject,b=e.padding||5,k=void 0!==e.duration?e.duration:750,C=(void 0!==e.delay&&e.delay,e.rectSize||{width:12,height:12,radius:2,dy:0}),w=e.labelGap||.9,N=e.labelDistance||10,A=e.valueDistance,L=e.fonts||["helvetica","12px","dimgray"],D=e.isReadOnly,S=e.width||400,T=e.height||400,M=e.layout||["leftright",1];W(),e.measure&&(l=l.map(function(t){var e={caption:t,draw:!0};return e[i]=t,e[r.measure.colNm]=t,e})),M[0]=M[0].toLowerCase();const F=t=>t[i],I=t=>{if(t.__id)return t.__id;return l.findIndex(e=>{if(e[i]&&e[i]===t[i])return!0})},B=d3.select(t),E=d3.format("string"===d?u:""),G=d3.drag().on("start",function(t){const e=t.sourceEvent;e.stopPropagation(),O=parseFloat(d3.select(this).style("left"))-e.pageX,R=parseFloat(d3.select(this).style("top"))-e.pageY}).on("drag",function(t){const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",function(){return e.pageX+O+"px"}).style("top",function(){return e.pageY+R+"px"})}).on("end",function(){d3.select(this).style("opacity",1)});let P,O,R,V=!0;function W(){r=v.getConfig(),l=e.values?e.values:r.lgData?r.measures:r.data,i=r.keyCol,s=r.lgData?"caption":r.keyCol,c=r.lgData?void 0:r.measure.colNm,d=r.measure.dataType||"string",u=r.measure.format||",f",m=r.measure.unit||"",p=e.colors?e.colors:r.pieceColors,g=r.c2iCon,f=e.theme||r.theme,h=r.method.click,y=r.method.mouseenter,_=r.method.mouseleave,x="string"==typeof p?a.getColorScheme(p.toLowerCase()):d3.scaleOrdinal().range(p)}return v&&v.setLegend&&v.setLegend(function(t){p=t,x=d3.scaleOrdinal().range(p),P.selectAll("g.vizLegend > .indicator").attr("fill",t=>x(t.__id))}),B.select("svg").remove(),o.render=function(){P||(P=d3.select(t).call(G).append("svg").on("click",t=>{t.altKey&&B.classed("c2iLegendFloat",!B.classed("c2iLegendFloat"))}).on("dblclick",function(){V=!V,d3.select(this).transition().duration(k).attr("width",V?S:8).attr("height",V?T:30).attr("opacity",V?null:.3).style("background",V?null:"yellow").style("cursor",V?null:"pointer")}).attr("width",S).attr("height",T).style("background",f||null).append("g").attr("transform","translate(0,0)"));const a=P.selectAll("g.vizLegend").data(l,F),i=S/("topbottom"===M[0]?M[1]:Math.ceil(l.length/M[1]));C.dy=C.dy?C.dy:0,C.padding=C.padding?C.padding:b/2;const d=a.enter().append("g").attr("class","vizLegend").attr("transform",function(t,e){return"topbottom"===M[0]?"translate("+[5+i*(e%M[1]),Math.floor(e/M[1])*(C.height+b)]+")":"translate("+[5+Math.floor(e/M[1])*i,e%M[1]?e%M[1]*(C.height+b)+b:b]+")"});function u(a,o){if(!o.draw)return;let n;const l=I(o);d3.select(this).attr("fill",d3.rgb(x(l)).brighter()).classed("rectHover",!0).style("opacity",.9),v.chartToggle?v.chartToggle(o.colNm,!0):r.outStyle?(n="."+g.substr(1)+"C"+l,d3.select(g).selectAll(n).attr("fill",d3.rgb(x(l)).brighter()).style("stroke-width","3px")):e.measure?d3.select(g).selectAll(".c2iNode").style("opacity",function(){return+d3.select(this).attr("c2i"+e.measure)===l?1:.2}):d3.select(g).selectAll(".series").style("opacity",function(){return d3.select(this).classed(o.colNm)?1:.2}),y&&y(a,{container:t,selector:"legend"},o)}function p(a,o){if(!o.draw)return;const n=I(o);if(d3.select(this).attr("fill",x(n)).classed("rectHover",!1).style("opacity",0),v.chartToggle)v.chartToggle(o.colNm,!1);else if(r.outStyle){const t="."+g.substr(1)+"C"+n;d3.select(g).selectAll(t).attr("fill",x(n)).style("stroke-width","1px")}else e.measure?d3.select(g).selectAll(".c2iNode").style("opacity",1):d3.select(g).selectAll(".series").style("opacity",1);_&&_(a,{container:t,selector:"legend"},o)}function O(e,a){P.selectAll("rect.indicator").nodes().indexOf(this);let o="."+t.substr(1)+"C"+I(a)+"ind";if(h&&h(e,{container:t,selector:"legend"},a),!D)if(a.draw=!a.draw,d3.select(o).attr("opacity",a.draw?1:.2),v.selectedMeasures){const n=v.selectedMeasures();e.shiftKey?a.draw?l.forEach(function(e,r){a.yDim===e.yDim&&(e.draw=!0,o="."+t.substr(1)+"C"+I(e,r)+"ind",d3.select(o).attr("opacity",1),-1===n.indexOf(e.colNm)&&n.push(e.colNm))}):l.forEach(function(e,r){a.yDim===e.yDim&&(e.draw=!1,o="."+t.substr(1)+"C"+I(e,r)+"ind",d3.select(o).attr("opacity",.2),n.indexOf(e.colNm)>-1&&n.splice(n.indexOf(e.colNm),1))}):a.draw?-1===n.indexOf(a.colNm)&&n.push(a.colNm):n.splice(n.indexOf(a.colNm),1),v.selectedMeasures(n),v.renderFromLegend()}else e.shiftKey&&(l.forEach(function(t){t.draw=a.draw}),d3.selectAll(t+" .indicator").attr("opacity",a.draw?1:.2)),v.render(!0)}return d.append("rect").attr("class",e=>"back "+t.substr(1)+"C"+I(e)).style("opacity",0).attr("width",.95*i).attr("height",C.height+2*C.padding).attr("y",C.dy).on("click",(e,a)=>{h&&h(e,{container:t,selector:"legend"},a)}).on("touchstart",u).on("touchend",p).on("mouseenter",u).on("mouseleave",p),d.append("rect").on("click",O).on("touchstart",O).style("cursor","pointer").attr("class",e=>"indicator "+t.substr(1)+"C"+I(e)+"ind").style("stroke-width",void 0===C.strokeWidth?1:C.strokeWidth).attr("fill","#ccc").attr("opacity",t=>t.draw?1:.2).attr("fill",t=>x(I(t))).attr("width",C.width).attr("height",C.height).attr("x",3).attr("y",C.dy+C.padding).attr("rx",C.radius).attr("ry",C.radius),A&&c?d.append("text").attr("class","legendText").style("font-family",L[0]).style("font-size",L[1]).attr("fill",L[2]).text(t=>E(t[c])+m).attr("x",A+"px").attr("dy",w+"em").style("text-anchor","end").style("pointer-events","none").style("fill-opacity",1):(d.append("text").attr("class","legendText").style("font-family",L[0]).style("font-size",L[1]).attr("fill",L[2]).text(function(t){const e=t[s];return n.cutLength?e.substr(0,n.cutLength):e}).attr("x",C.width+N).attr("dy",w+"em").style("text-anchor","start").style("pointer-events","none").style("fill-opacity",1),d.append("title").text(t=>{const e=t[s];return e.length>n.cutLength?e:null})),o},o.data=(t=>t?(l=t,o):l),o.options=(t=>t?(S=(e=t).width||400,T=e.height||400,M=e.layout||["leftright",1],o):l),o.targetChartObject=(t=>t?(v=t,W(),o):targetChartObject),o.clear=(()=>(P&&(B.select("svg").remove(),P=void 0),o)),o.indicatorView=((a,o)=>{if(!P)return;const n=d3.select(a.self).attr("c2i"+e.measure),r="."+t.substr(1)+"C"+n,l=P.select(r+"ind").attr("fill");P.select(r).style("fill",d3.rgb(l).brighter(2)).classed("rectHover",!0).style("opacity",o?.9:0)}),o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),o):n.lang},a.createAccessor(o,n)},c2i.ui.legendQuantile=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;(e=e||{}).method=e.method||{};const o={},n={threshold:void 0};a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;let r,l,i=e.width||400,s=e.height||50,c=c2i.lang,d=e.type?e.type.toLowerCase():"horizontal",u=void 0!==e.duration?e.duration:750,m=void 0!==e.delay?e.delay:30,p=e.measureColNm,g=e.rectInfo||{width:12,height:.9,top:10,showTick:!0,tickGap:3,opacity:.8,opacityHover:1,strokeHover:"dimgray",indicatorColor:"dimgray",colors:d3.schemeCategory10().range()},f=e.format||",.0f",h=e.fonts||["helvetica","11px","dimgray"],y=e.unitGap||.9;r="string"==typeof g.colors?a.getColorScheme(g.colors.toLowerCase()).range():g.colors;const _=d.indexOf("hor")>-1;let x,v,b,k,C,w;l=_?i*(g.width<.5||g.width>.99?.9:g.width):s*(g.height<.5||g.height>.99?.9:g.height);let N=d3.format(f);const A=d3.drag().on("start",function(t){t.sourceEvent.stopPropagation(),C=parseFloat(d3.select(this).style("left"))-t.sourceEvent.pageX,w=parseFloat(d3.select(this).style("top"))-t.sourceEvent.pageY}).on("drag",function(t){d3.select(this).style("opacity",.5).style("left",function(){return t.sourceEvent.pageX+C+"px"}).style("top",function(){return t.sourceEvent.pageY+w+"px"})}).on("end",function(){d3.select(this).style("opacity",1)});function L(t){return v.selectAll("rect").nodes().indexOf(t)}return o.render=function(){if(!c2i.lang)return;let e,d,C,w;d3.select(t).select("svg").remove(),x=d3.select(t).call(A).append("svg").attr("width",i).attr("height",s).style("background",n.theme?n.theme:null);const D="first"===p||"second"===p||"third"===p?p+"_":"legend_";(e=n.data?d3.extent(n.data,t=>t[p]):n.targetChartObject.getExtent(p))[0]===e[1]&&(e[0]=e[0]*(e[0]>0?.9:1.1),e[1]=e[1]*(e[1]>0?1.1:.9));const S=d3.scaleQuantile().domain(e).range(r);if(n.threshold=d3.scaleThreshold().domain(S.quantiles()).range(r),n.targetChartObject){switch(d=n.targetChartObject.getInfo(),n.measureColNm){case"first":d._cm=d.cm;break;case"second":d._cm=d.cm2;break;default:d._cm=d.cm3}if(void 0===d._cm){const t=a.templateFormat(c.legend.lgQ_1,n.measureColNm);return void alert(t)}n.caption=d._cm.caption?d._cm.caption:n.caption?n.caption:"",n.unitNm=void 0!==d._cm.unitNm?d._cm.unitNm:n.unitNm?n.unitNm:"",n.unit=d._cm.unit?d._cm.unit:n.unit?n.unit:1,f=d._cm.format2?d._cm.format2:d._cm.format?d._cm.format:n.format?n.format:",f",N=d3.format(f)}else void 0===n.caption?n.caption="":n.caption+=" ",void 0===n.unitNm&&(n.unitNm=""),n.unit=n.unit?n.unit:1;k=d3.scaleLinear().domain(e).range([0,l]);const T=_?g.height+g.tickGap:g.width+g.tickGap,M=_?d3.axisBottom():d3.axisTop();M.scale(k).tickSize(T).tickValues(n.threshold.domain()).tickFormat(t=>N(t));const F=(v=x.append("g").attr("class","c2iLegendQuantile").attr("transform","translate("+((_?i:s)-l)/2+","+g.top+")")).selectAll("rect").data(n.threshold.range().map(t=>{const e=n.threshold.invertExtent(t);if(e[0]||(e[0]=k.domain()[0]),!e[1]){const t=k.domain()[1];e[1]=t+(t>0?1e-6:-1e-6)}return e})).enter().append("rect").on("click",function(e,a){if(n.method.click){const o=L(this);n.method.click(e,{container:t,selector:D+(o+1)},a)}}).on("mouseenter",function(e,a){b=d3.select(this).style("stroke");const o=d3.select(this).style("fill");if(d3.select(this).style("stroke-width",3).style("stroke",g.strokeHover),n.method.mouseenter){const o=L(this);n.method.mouseenter(e,{container:t,selector:D+(o+1)},a)}if(!d)return;let r,l,i,s,u,m;s=Number.MIN_VALUE,u=Number.MAX_VALUE,r=l=i=m=0;const p=n.targetChartObject.getInfo().type;let f;switch(p){case"hi":f="."+n.measureColNm+"Content";break;case"corR":f=".cell";break;case"std3D":f=".c2iNode";break;default:f=".cell"}d3.select(d.container).selectAll(f).filter(function(t){if(t.isSparse)return;const e="function"==typeof d._cm.colNm?d._cm.colNm(t):t[d._cm.colNm];if(void 0!==e&&a[0]<=e&&e<a[1]){if(t._removed)return void m++;r+=e,i++,e>s&&(s=e),e<u&&(u=e)}}),l=0===i?0:r/i,s!==Number.MIN_VALUE&&0!==i||(s=0),u!==Number.MAX_VALUE&&0!==i||(u=0),C=d3.select("body").select("#tooltipLegend");const h=d._cm.caption+": "+N(a[0]/n.unit)+" ~ "+N(a[1]/n.unit)+(""!==n.unitNm?" "+n.unitNm:"");if(C.empty()){let t="360px",e="150px",a="130px";n.tooltip&&(t=n.tooltip.width,e=n.tooltip.top,a=n.tooltip.left),C=d3.select("body").append("div").attr("id","tooltipLegend").style("top",e).style("left",a).attr("class","c2iTooltip"),(w=C.append("table").style("width",t)).append("tr").append("td").attr("colspan","hi"!==p?5:6).append("p").attr("class","tipHeader").style("color",o).text(h);const d=c.cm,g=c.gen;let f;I((f="hi"!==p?[[d.sum,d.max,d.min,d.avg,g.count],["cm.sum","cm.max","cm.min","cm.avg","gen.count"],[N(r),N(s),N(u),N(l),d3.format(",d")(i)]]:[[d.sum,d.max,d.min,d.avg,g.normal,g.remove],["cm.sum","cm.max","cm.min","cm.avg","gen.normal","gen.remove"],[N(r),N(s),N(u),N(l),d3.format(",d")(i),d3.format(",d")(m)]])[0],"tipHeader",f[1]),I(f[2],"number")}else{let t;C.attr("class","c2iTooltip"),C.select(".tipHeader").style("color",o).text(h),t="hi"!==p?[N(r),N(s),N(u),N(l),d3.format(",d")(i)]:[N(r),N(s),N(u),N(l),d3.format(",d")(i),d3.format(",d")(m)],C.selectAll(".number").data(t).text(t=>t)}}).on("mousemove",t=>{if(!C)return;const e=parseInt(C.select("table").style("width")),a=parseInt(C.select("table").style("height"));let o=t.pageX+5,n=t.pageY+25;const r=parseInt(d3.select(d.container).style("width")),l=parseInt(d3.select(d.container).style("height"));o>r-e&&(o-=e+5),n>l-a&&(n-=2*a),o<0&&(o=0),n<0&&(n=0),C.style("left",o+"px").style("top",n+"px")}).on("mouseleave",function(e,a,o){if(d3.select(this).style("stroke-width",1).style("stroke",b),n.method.mouseleave){const o=L(this);n.method.mouseleave(e,{container:t,selector:D+(o+1)},a)}C&&C.classed("c2iHidden",!0)}).attr("class",t=>"c_"+n.threshold(t[0]).substr(1)).attr("x",t=>_?k(t[0]):0).attr("y",t=>_?0:k(t[0])).attr("width",_?0:g.width).attr("height",_?g.height:0).style("fill-opacity",n.rectInfo.opacity).style("fill",t=>n.threshold(t[0]));function I(t,e,a){w.append("tr").selectAll("th").data(t).enter().append("th").attr("class",e).attr("data-c2i18n",(t,e)=>a?a[e]:null).text(t=>t)}return F.transition().duration(u).delay((t,e)=>e*m).attr("width",t=>_?k(t[1])-k(t[0]):g.width).attr("height",t=>_?g.height:k(t[1])-k(t[0])),d||F.append("title").text(t=>N(t[0]/n.unit)+" ~ "+N(t[1]/n.unit)+(""!==n.unitNm?" "+n.unitNm:"")),v.append("line").attr("id","indicator").attr("x1",_?0:-3).attr("x2",0).attr("y1",_?-3:0).attr("y2",0).style("stroke",g.indicatorColor).style("stroke-width","4px").style("stroke-opacity",0).attr("x2",_?0:g.width+5).attr("y2",_?g.height+5:0),v.call(M).append("text").attr("class","unit").attr("dx",n.dx?n.dx:null).attr("dy",n.dy?n.dy:null).attr("y",_?y+"em":l+18+"px").style("font-family",h[0]).style("font-size",h[1]).style("fill",h[2]).style("fill-opacity",0).text(n.caption+" "+n.unitNm).transition().duration(u+m*r.length).style("fill-opacity",1),v.selectAll(".c2iLegendQuantile .tick > text").style("font-family",h[0]).style("font-size",h[1]).style("fill",h[2]).style("fill-opacity",0).text(t=>N(t/n.unit)).transition().duration(u).delay((t,e)=>e*m).style("fill-opacity",1),v.selectAll(".c2iLegendQuantile .tick > line").attr(_?"y2":"x2",0).style("stroke-opacity",0).transition().duration(u).delay((t,e)=>e*m).attr(_?"y2":"x2",(_?g.height:g.width)+3).style("stroke-opacity",()=>g.showTick?1:0),d3.selectAll(".c2iLegendQuantile .domain").style("fill","none").style("stroke","none"),o},o.colorPicker=(()=>n.threshold),o.clear=(()=>{x&&(x.remove(),x=b=k=void 0)}),o.indicatorView=function(t){if(!x)return;let e=0,a=0;if(t){if(void 0===t.value)return;e=k(t.value),a=.7}if(x.select("#indicator").transition().duration(n.duration).style("stroke-opacity",a).attr("x1",function(){return _?e:d3.select(this).attr("x1")}).attr("x2",function(){return _?e:d3.select(this).attr("x2")}).attr("x2",e).attr("y1",function(){return _?d3.select(this).attr("y1"):e}).attr("y2",function(){return _?d3.select(this).attr("y2"):e}),n.showFocusLabel&&t){const e=n.fontsFocusLabel?n.fontsFocusLabel:n.fonts;x.select(".unit").style("font-weight",e[0]).style("font-size",e[1]).style("fill",e[2]).text(n.caption+": "+N(t.value/n.unit)+n.unitNm+(t.name?" "+t.name:""))}},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),c=c2i.lang,o):n.lang},a.createAccessor(o,n)},c2i.ui.checkBox=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;const o={},n={key:"colNm",text:"caption",checkedColNm:"",data:void 0,className:"",fonts:["Roboto","14px","currentColor"],opacity:.8};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);return o.render=function(){return r.style("background",n.theme&&"none"!==n.theme?n.theme:null),r.selectAll(t+" .c2iCheckBox").data(n.data).enter().append("label").text(t=>t[n.text]).style("font-family",n.fonts[0]).style("font-size",n.fonts[1]).style("color",n.fonts[2]).attr("class","c2iChecked").append("input").on("change",function(e,a){n.method.click&&n.method.click(e,{container:t,selector:"select"},a)}).attr("class",n.className).attr("type","checkbox").attr("name","c2iCheckBox").attr("checked",t=>t[n.checkedColNm]?"checked":null).attr("value",t=>t[n.key]),o},o.theme=function(t){return arguments.length?(n.theme="base"===t?n.themeInit:t,r.style("background",t),o):n.theme},o.data=function(t){return arguments.length?(n.data=t,o):n.data},o.clear=function(){return r.remove(),o},a.createAccessor(o,n)},c2i.ui.selectBox=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;const o={},n={key:"colNm",text:"caption",selectedColNm:"",data:void 0,classNames:["c2iSelectBox","c2iSelection"],fonts:["Roboto","14px","green"],opacity:.8};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);return o.render=function(){return r.style("background",n.theme&&"none"!==n.theme?n.theme:null),r.selectAll(t+" ."+n.classNames[0]).data(n.data).enter().append("label").text(t=>t.label.length>10?t.label.substr(0,9):t.label).style("font-family",n.fonts[0]).style("font-size",n.fonts[1]).style("color",n.fonts[2]).attr("class",n.classNames[0]).append("select").on("change",function(e,a){n.method.click&&n.method.click(e,{container:t,selector:"select"},a)}).attr("class",n.classNames[1]).style("font-family",n.fonts[0]).style("font-size",n.fonts[1]).style("color",n.fonts[2]).each(function(t){d3.select(this).selectAll("option").data(t.data).enter().append("option").text(t=>t[n.text]).attr("value",t=>t[n.key]).attr("selected",t=>t[n.selectedColNm]?"selected":null)}),o},o.theme=function(t){return arguments.length?(n.theme="base"===t?n.themeInit:t,r.style("background",t),o):n.theme},o.data=function(t){return arguments.length?(n.data=t,o):n.data},o.clear=function(){return r.remove(),o},a.createAccessor(o,n)},c2i.ui.boxPlot=function(t,e){"use strict";const a=c2i.util;let o={},n={isResponsive:!0,nonComponent:!0,width:"100%",height:50,margin:{top:2,left:5,right:5,bottom:2},easing:"linear",duration:0,isHorizontal:!1,key:"_All_",captionAll:"전체 이상치 매출액",outLierCaptionAll:"이상치(매출액 평균)",captions:["1분위","3분위","사분위수 범위"],measure:{colNm:"samesAmt",caption:"매출금액",format:",.1f"},xyPadding:.2,centerLine:{stroke:"lightgray",strokeWidth:1},box:{stroke:"black",fill:"#c5c5c5",opacity:.4},medianLine:{caption:"중앙값",stroke:"orange",strokeWidth:1.5},meanLine:{caption:"산술평균",stroke:"red",strokeWidth:1},modeLine:{caption:"최빈값 (건수)",stroke:"#64d988",strokeWidth:1},minMaxLine:{stroke:["steelblue","dimgray"],strokeWidth:1},dotInfo:{stroke:"#bbb",interpolator:"interpolatePlasma",fill:"#69b3a2",outlierColor:"red",radius:2,showDots:100,onlyOutlier:!0,outLier:"이상치(Outlier)",isDraw:!0},tooltipId:"#tooltip",tipWidth:300,outLiers:0,data:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);let l,i,s,c,d,u,m,p,g,f,h,y,_,x,v,b,k=a.computeDim(r,n),C=c2i.lang;n.isHorizontal?(_=d3.scaleLinear().range([0,P()]),x=d3.scaleBand().range([O(),0]).padding(n.xyPadding)):(_=d3.scaleBand().range([0,P()]).padding(n.xyPadding),x=d3.scaleLinear().range([O(),0]));const w=d3.select(n.tooltipId),N=d3.format(n.measure.format),A=d3.format(",d"),L=d3.scaleSequential().interpolator(d3[n.dotInfo.interpolator]),D=t=>_(t.key)+v-b,S=t=>x(t.key)+v-b,T=t=>`<tr><td  class='c2iMiniUi subTitle'>${n.captions[1]}</td><td>${N(t.q3)}</td></tr>\n  <tr style='color: ${n.medianLine.stroke}'><td class='c2iMiniUi subTitle'>${n.medianLine.caption}</td><td>${N(t.median)}</td></tr>\n  <tr><td class='c2iMiniUi subTitle'>${n.captions[0]}</td><td>${N(t.q1)}</td></tr>\n  <tr><td class='c2iMiniUi subTitle'>${n.captions[2]}</td><td>${N(t.IQR)}</td></tr>\n  <tr style='color: ${n.meanLine.stroke}'><td class='c2iMiniUi subTitle'>${n.meanLine.caption}</td><td>${N(t.mean)}</td></tr>\n  <tr style='color: ${n.modeLine.stroke}'><td class='c2iMiniUi subTitle'>${n.modeLine.caption}</td><td>${N(t.mode)} (${A(t.modeCnt)})</td></tr>`,M=(t,e)=>{w.select("table").style("width",n.tipWidth+"px"),w.classed("c2iHidden",!1);let a=T(e);n.outLiers&&(a+=`<tr><td class='c2iMiniUi mainTitle'>${n.dotInfo.outLier}</td><td>${A(n.outLiers)}</td></tr>`),w.select("table").html(a),w.style("left",t.x-n.tipWidth/2+"px").style("top",t.pageY-(n.outLiers?230:210)+"px")},F=t=>w.style("left",t.x-n.tipWidth/2+"px").style("top",t.pageY-(n.outLiers?230:210)+"px"),I=()=>w.classed("c2iHidden",!0),B=(t,e)=>{let a,o;w.select("table").style("width",n.tipWidth+"px"),w.classed("c2iHidden",!1),"_All_"===n.key?(o=n.outLierCaptionAllOk?n.outLierCaptionAll:n.captionAll,a=n.data[0]):(a=n.data.find(t=>t.key===e[n.key]),o=e[n.key]);let r=`<tr style='color: ${n.dotInfo.outlierColor}''><td class='c2iMiniUi mainTitle'>${o}</td>\n    <td class='c2iMiniUi mainTitle'>${N(e[n.measure.colNm])}</td></tr>`;r+=T(a),n.outLiers&&(r+=`<tr><td class='c2iMiniUi mainTitle'>${n.dotInfo.outLier}</td><td>${A(n.outLiers)}</td></tr>`),w.select("table").html(r).style("left",t.x-n.tipWidth/2+"px").style("top",t.pageY-(n.outLiers?250:230)+"px")},E=t=>w.style("left",t.x-n.tipWidth/2+"px").style("top",t.pageY-(n.outLiers?250:230)+"px");function G(){a.setTheme(n,t,!1),function(){let t,a,o,r,l,i,c,d,u,m,p,g;const f=e.measure.colNm;n.data=d3.rollup(s,e=>((t=e.map(t=>+t[f])).sort(d3.ascending),i=d3.quantile(t,.25),o=d3.quantile(t,.5),r=d3.mean(t),l=d3.mode(t),u=t.filter(t=>t===l).length,c=d3.quantile(t,.75),g=o-1.5*(d=c-i),m=d3.min(t.filter(t=>t>=g)),g=o+1.5*d,p=d3.max(t.filter(t=>t<=g)),a=d3.extent(t),{median:o,mean:r,mode:l,modeCnt:u,q1:i,q3:c,IQR:d,extent:a,qMin:m,qMax:p}),t=>"_All_"===n.key?"_All_":t[n.key]),n.data=Array.from(n.data).map(t=>({...t[1],key:t[0]}));const h=d3.min(n.data,t=>t.qMin),y=d3.max(n.data,t=>t.qMax),v=d3.min(n.data,t=>t.extent[0]),b=d3.max(n.data,t=>t.extent[1]);n.isHorizontal?(_.domain([Math.min(h,v),Math.max(y,b)]),x.domain(n.data.map(t=>t.key)),L.domain(_.domain())):(x.domain([Math.min(h,v),Math.max(y,b)]),_.domain(n.data.map(t=>t.key)),L.domain(x.domain()))}()}function P(){return k-n.margin.left-n.margin.right}function O(){return n.height-n.margin.top-n.margin.bottom}o.render=function(){if(!(k<50))return l||(d3.select(t).select("svg").remove(),l=d3.select(t).append("svg").attr("width",k).attr("height",n.height).style("background",n.theme?n.theme:null)),function(){if(!i){const{centerLine:t,box:e,medianLine:a,meanLine:o,modeLine:r,minMaxLine:k}=n;i=l.append("g").attr("class","body").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),c=i.selectAll(".centerLine").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","centerLine").attr("stroke",t.stroke).style("stroke-width",t.strokeWidth),d=i.selectAll(".box_q1_q3").data(n.data).enter().append("rect").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","box_q1_q3").attr("stroke",e.stroke).style("fill",e.fill).style("opacity",e.opacity),u=i.selectAll(".medianLine").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","medianLine").attr("stroke",a.stroke).style("stroke-width",a.strokeWidth),m=i.selectAll(".meanLine").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","meanLine").attr("stroke",o.stroke).style("stroke-width",o.strokeWidth),p=i.selectAll(".modeLine").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","modeLine").attr("stroke",r.stroke).style("stroke-width",r.strokeWidth),g=i.selectAll(".gMin").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","gMin").attr("stroke",k.stroke[0]).style("stroke-width",k.strokeWidth),f=i.selectAll(".gMax").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","gMax").attr("stroke",k.stroke[0]).style("stroke-width",k.strokeWidth),h=i.selectAll(".min").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","min").attr("stroke",k.stroke[1]).style("stroke-width",k.strokeWidth),y=i.selectAll(".max").data(n.data).enter().append("line").on("mouseover",M).on("mousemove",F).on("mouseleave",I).attr("class","max").attr("stroke",k.stroke[1]).style("stroke-width",k.strokeWidth),v=n.isHorizontal?x.bandwidth():_.bandwidth(),b=v/5,n.dotInfo.isDraw&&function(){const t=.8*v,e=n.dotInfo;let a,o,r=s;const l=()=>{if(r=s.filter(t=>{a=+t[n.measure.colNm];const e="_All_"===n.key?n.data[0]:n.data.find(e=>e.key===t[n.key]);return a<e.qMin||a>e.qMax}),n.outLiers=r.length,r.length>e.showDots&&e.showDots>0){console.log(">> 너무 많은("+r.length.toFixed()+") 이상치 데이터가 존재하여 1개의 큰 Dot(점)로 표현합니다."+`\nThere are too many outlier data(${r.length.toFixed()}), so it is expressed as one large dot..!!`),o=2.5*e.radius,r.sort((t,e)=>e[n.measure.colNm]-t[n.measure.colNm]);const t=d3.mean(r.map(t=>t[n.measure.colNm]));(r=[r[r.length-1]])[0][n.measure.colNm]=t,n.outLierCaptionAllOk=!0}else o=e.radius,n.outLierCaptionAllOk=!1};e.onlyOutlier?l():!e.showDots||e.showDots>s.length?(r=s.map(t=>{const e={...t};return e[n.measure.colNm]=+t[n.measure.colNm],e}),o=e.radius,n.outLierCaptionAllOk=!1):l();let c=i.selectAll(".c2iPoint").data(r).enter().append("circle").on("mouseover",B).on("mousemove",E).on("mouseleave",I).attr("class","c2iPoint").attr("r",o).attr("opacity",e.stroke).attr("stroke",e.opacity).style("fill",e.fill);n.isHorizontal?c.attr("cx",t=>_(t[n.measure.colNm])).attr("cy",e=>x("_All_"===n.key?"_All_":e[n.key])+v/2-t/2+Math.random()*t):c.attr("cy",t=>x(t[n.measure.colNm])).attr("cx",e=>_("_All_"===n.key?"_All_":e[n.key])+v/2-t/2+Math.random()*t);"_All_"===n.key?function(){const t=n.data[0];c.style("fill",o=>(a=+o[n.measure.colNm])<t.qMin||a>t.qMax?e.outlierColor:L(a))}():c.style("fill",t=>{a=+t[n.measure.colNm];const o=n.data.find(e=>e.key===t[n.key]);return a<o.qMin||a>o.qMax?e.outlierColor:L(a)})}()}n.isHorizontal?(c.merge(c).attr("x1",t=>_(t.qMin)).attr("x2",t=>_(t.qMax)).attr("y1",t=>x(t.key)+v/2).attr("y2",t=>x(t.key)+v/2),d.merge(d).attr("x",t=>_(t.q1)).attr("width",t=>_(t.q3)-_(t.q1)).attr("y",t=>x(t.key)).attr("height",v),u.merge(u).attr("x1",t=>_(t.median)).attr("x2",t=>_(t.median)).attr("y1",t=>x(t.key)).attr("y2",t=>x(t.key)+v/2),m.merge(m).attr("x1",t=>_(t.mean)).attr("x2",t=>_(t.mean)).attr("y1",t=>x(t.key)+v/2).attr("y2",t=>x(t.key)+v),p.merge(p).attr("x1",t=>_(t.mode)).attr("x2",t=>_(t.mode)).attr("y1",t=>x(t.key)).attr("y2",t=>x(t.key)+v),g.merge(h).attr("x1",t=>_(t.qMin)).attr("x2",t=>_(t.qMin)).attr("y1",t=>x(t.key)+b).attr("y2",S),f.merge(y).attr("x1",t=>_(t.qMax)).attr("x2",t=>_(t.qMax)).attr("y1",t=>x(t.key)+b).attr("y2",S),h.merge(h).attr("x1",t=>_(t.extent[0])).attr("x2",t=>_(t.extent[0])).attr("y1",t=>x(t.key)+b).attr("y2",S),y.merge(y).attr("x1",t=>_(t.extent[1])).attr("x2",t=>_(t.extent[1])).attr("y1",t=>x(t.key)+b).attr("y2",S)):(c.merge(c).attr("y1",t=>x(t.extent[0])).attr("y2",t=>x(t.extent[1])).attr("x1",t=>_(t.key)+v/2).attr("x2",t=>_(t.key)+v/2),d.merge(d).attr("y",t=>x(t.q3)).attr("height",t=>Math.abs(x(t.q3)-x(t.q1))).attr("x",t=>_(t.key)).attr("width",v),u.merge(u).attr("y1",t=>x(t.median)).attr("y2",t=>x(t.median)).attr("x1",t=>_(t.key)).attr("x2",t=>_(t.key)+v/2),m.merge(m).attr("y1",t=>x(t.mean)).attr("y2",t=>x(t.mean)).attr("x1",t=>_(t.key)+v/2).attr("x2",t=>_(t.key)+v),p.merge(p).attr("y1",t=>x(t.mode)).attr("y2",t=>x(t.mode)).attr("x1",t=>_(t.key)).attr("x2",t=>_(t.key)+v),g.merge(h).attr("y1",t=>x(t.qMin)).attr("y2",t=>x(t.qMin)).attr("x1",t=>_(t.key)+b).attr("x2",D),f.merge(y).attr("y1",t=>x(t.qMax)).attr("y2",t=>x(t.qMax)).attr("x1",t=>_(t.key)+b).attr("x2",D),h.merge(h).attr("y1",t=>x(t.extent[0])).attr("y2",t=>x(t.extent[0])).attr("x1",t=>_(t.key)+b).attr("x2",D),y.merge(y).attr("y1",t=>x(t.extent[1])).attr("y2",t=>x(t.extent[1])).attr("x1",t=>_(t.key)+b).attr("x2",D));n.method.mouseenter&&n.method.mouseenter({container:t,selector:"boxPlot"})}(),o},o.outLiers=(()=>n.outLiers),o.clear=function(){return l&&(l.remove(),l=i=void 0),o},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(t){return arguments.length?(s=t,G(),o):n.data},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),C=c2i.lang,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,function(){l&&r.node().parentNode.clientWidth&&(n.nonComponent?k=r.node().parentNode.clientWidth:(k=parseInt(r.style("width"),10),n.height=parseInt(k/n.aspect)),l&&k&&(l.attr("width",k).attr("height",n.height),x.range([O(),0]),_.range([0,P()]),o.render()))},null),a.createAccessor(o,n)},c2i.ui.histogram=function(t,e){"use strict";const a=c2i.util;let o={},n={isResponsive:!0,nonComponent:!0,width:"100%",height:40,margin:{top:5,left:5,right:5,bottom:5},easing:"linear",duration:0,key:"dummy",bins:20,barColors:["#69b3a2","orange"],stroke:"lightgray",caption:"실판매금액",format:",.0f",format2:",.2f",sFormat:".2s",binned:"구간",freq:"빈도수",freqMean:"빈도수 평균",sum:"합계",count:"빈도수",mean:"평균",median:"중앙값",variance:"분산",deviation:"표준편차",quantile:"사분위",nullInfo:"Null_Value",q123:["1분위","2분위","3분위"],binsMean:{caption:"산술평균",stroke:"orange",strokeWidth:1},kde:{color:"yellow",thresholds:40,strokeWidth:.5,isDraw:!0},tooltipId:"#tooltip",tipWidth:400,data:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);let l,i,s,c,d,u,m,p,g=a.computeDim(r,n),f=c2i.lang;const h=d3.scaleLinear().range([0,T()]),y=d3.scaleLinear().range([M(),0]),_=d3.select(n.tooltipId),x=d3.format(n.format),v=d3.format(n.format2);let b=d3.format(n.sFormat);const k=d3.format(",.0f"),C=t=>h(t.x1)-h(t.x0)-(h(t.x1)-h(t.x0)>1?1:0),w=(e,a)=>t+" .cls"+e.seq+a,N=function(t,e){let a,o,r,l,i,s;_.select("table").style("width",n.tipWidth+"px"),_.classed("c2iHidden",!1),e.length?(1===e.length?l=i=n.nullInfo:(l=v(d3.variance(e)),i=v(d3.deviation(e))),a=x(d3.sum(e)),o=x(d3.mean(e)),r=x(d3.median(e)),s=[x(d3.quantile(e,.25)),x(d3.quantile(e,.5)),x(d3.quantile(e,.75))]):(a=o=r=l=i=s=n.nullInfo,s=[n.nullInfo,n.nullInfo,n.nullInfo]),d3.select(w(e,".c2iFgBar")).style("fill",n.barColors[1]);const c=`<tr><td colspan='3' class='c2iMiniUi mainTitle'>${x(e.x0)}&nbsp;<=&nbsp;${n.caption}&nbsp;${n.binned}&nbsp;<&nbsp;${x(e.x1)}\n      <br/><span style='color:orange'>${n.freqMean}:&nbsp;${k(p)}</td></tr>\n      <tr><td class='c2iMiniUi subTitle'>${n.freq}</td><td class='c2iMiniUi subTitle'>${n.sum}</td><td class='c2iMiniUi subTitle'>${n.mean}</td></tr>\n      <tr><td>${k(e.length)}</td><td>${a}</td><td>${o}</td></tr>\n      <tr><td class='c2iMiniUi subTitle'>${n.median}</td><td class='c2iMiniUi subTitle'>${n.variance}</td><td class='c2iMiniUi subTitle'>${n.deviation}</td></tr>\n      <tr><td>${r}</td><td>${l}</td><td>${i}</td></tr>\n      <tr><td class='c2iMiniUi subTitle'>${n.q123[0]}</td><td class='c2iMiniUi subTitle'>${n.q123[1]}</td><td class='c2iMiniUi subTitle'>${n.q123[2]}</td></tr>\n      <tr><td>${s[0]}</td><td>${s[1]}</td><td>${s[2]}</td></tr>`;_.select("table").html(c),_.style("left",t.x-n.tipWidth/2+"px").style("top",t.pageY-250+"px")},A=function(t){_.style("left",t.x-n.tipWidth/2+"px").style("top",t.pageY-250+"px")},L=function(t,e){d3.select(w(e,".c2iFgBar")).style("fill",n.barColors[0]),_.classed("c2iHidden",!0)};function D(){a.setTheme(n,t,!1),function(){const t=s.map(t=>+t[n.key]);h.domain(d3.extent(t)),h.domain()[1]<1e4&&(b=x);if(m=(m=d3.bin().thresholds(h.ticks(n.bins))(t)).map((t,e)=>(t.seq=e,t)),y.domain([0,d3.max(m,t=>t.length)]),n.kde.isDraw){d=y.copy();const e=.2,a=t.length,o=Math.pow(d3.deviation(t)*(4/(3*a)),e),r=h.ticks(n.kde.thresholds);c=c2i.util.kdeFn(c2i.util.epanechnikovFn(o),r,t),d.domain([0,d3.max(c,t=>t[1])])}}(),n.data=s}function S(){return n.margin.top}function T(){return g-n.margin.left-n.margin.right}function M(){return n.height-n.margin.top-n.margin.bottom}o.render=function(){if(!(g<50))return l||(d3.select(t).select("svg").remove(),l=d3.select(t).append("svg").attr("class","c2iHistogramMiniUi").attr("width",g).attr("height",n.height).style("background",n.theme?n.theme:null)),function(){if(!i){(i=l.append("g").attr("class","body").attr("transform","translate("+n.margin.left+","+S()+")")).selectAll(".c2iFgBar").data(m).join("rect").attr("class",t=>"cls"+t.seq+" c2iFgBar").attr("transform",t=>`translate(${h(t.x0)} , ${y(t.length)})`).attr("width",C).attr("height",t=>M()-y(t.length)).style("fill",n.barColors[0]).attr("stroke",n.stroke),i.selectAll(".c2iBgBar").data(m).join("rect").attr("class",t=>"cls"+t.seq+" c2iBgBar").on("mouseover",N).on("mousemove",A).on("mouseleave",L).attr("transform",t=>`translate(${h(t.x0)} , ${S()})`).attr("width",C).attr("height",M()).style("fill","transparent");const t=m.map(t=>t.length),e=d3.sum(t);p=e/t.length;const a=n.binsMean;if(i.append("line").attr("class",".c2iBinMean").attr("stroke",a.stroke).style("stroke-width",a.strokeWidth).attr("x2",T()).attr("y1",y(p)).attr("y2",y(p)).attr("stroke-opacity","0.7").style("pointer-events","none"),i.append("g").attr("transform",`translate(0, ${M()})`).call(d3.axisBottom(h).ticks(n.ticks).tickSize(n.tickSize).tickFormat(b)),i.select("path.domain").attr("opacity",.5),n.kde.isDraw){const t=d3.line().curve(d3.curveBasis);(u=i.append("path").attr("class","c2iKde").datum(c)).attr("fill","none").attr("stroke",n.kde.color).attr("stroke-width",n.kde.strokeWidth).attr("stroke-linejoin","round"),u.merge(u).attr("d",t.x(t=>h(t[0])).y(t=>d(t[1])))}}}(),o},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(t){return arguments.length?(s=t,D(),o):n.data},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),f=c2i.lang,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,function(){l&&r.node().parentNode.clientWidth&&(n.nonComponent?g=r.node().parentNode.clientWidth:(g=parseInt(r.style("width"),10),n.height=parseInt(g/n.aspect)),l&&g&&(l.attr("width",g).attr("height",n.height),y.range([M(),0]),h.range([0,T()]),o.render()))},null),a.createAccessor(o,n)},c2i.ui.density=function(t,e){"use strict";const a=c2i.util;let o={},n={isResponsive:!0,nonComponent:!0,width:"100%",height:40,margin:{top:5,left:5,right:5,bottom:5},easing:"linear",duration:0,key:"dummy",thresholds:40,color:"yellow",strokeWidth:.5,data:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);let l,i,s,c,d=a.computeDim(r,n),u=c2i.lang;const m=d3.line().curve(d3.curveBasis),p=d3.scaleLinear().range([y(),0]),g=d3.scaleLinear().range([0,h()]);function f(){a.setTheme(n,t,!1),function(){const t=s.map(t=>t[n.key]);g.domain(d3.extent(t));const e=Math.pow(d3.deviation(t)*(4/(3*t.length)),.2),a=g.ticks(n.thresholds);s=function(t,e,a){return e.map(e=>[e,d3.mean(a,a=>t(e-a))])}(function(t){return e=>Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}(e),a,t),p.domain([0,d3.max(s,t=>t[1])])}(),n.data=s}function h(){return d-n.margin.left-n.margin.right}function y(){return n.height-n.margin.top-n.margin.bottom}o.render=function(){return l||(d3.select(t).select("svg").remove(),l=d3.select(t).append("svg").attr("width",d).attr("height",n.height).style("background",n.theme?n.theme:null)),function(){i||(i=l.append("g").attr("class","body").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),(c=i.append("path").attr("class","c2iKde").datum(n.data)).attr("fill","none").attr("stroke",n.color).attr("stroke-width",n.strokeWidth).attr("stroke-linejoin","round"));c.merge(c).attr("d",m.x(t=>g(t[0])).y(t=>p(t[1])))}(),o},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(t){return arguments.length?(s=t,f(),o):n.data},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),u=c2i.lang,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,function(){l&&r.node().parentNode.clientWidth&&(n.nonComponent?d=r.node().parentNode.clientWidth:(d=parseInt(r.style("width"),10),n.height=parseInt(d/n.aspect)),l&&d&&(l.attr("width",d).attr("height",n.height),p.range([y(),0]),g.range([0,h()]),o.render()))},null),a.createAccessor(o,n)},c2i.ui.barPlot=function(c2iCon,options){"use strict";const _u=c2i.util;if(!_u.checkLicenseLocale(options))return!1;if(!_u.checkConfig(c2iCon,options))return!1;let chart={},cfg={isResponsive:!0,nonComponent:!0,width:"100%",height:40,margin:{top:5,left:5,right:5,bottom:5},lang:"ko",easing:"linear",duration:0,otherCnt:-1,extent:void 0,x:{colNm:"Country",dataType:"string",format:"",convertFn:null,showLabel:!1,isVertical:!1,rotate:-30,maxTickLabel:5},y:{colNm:"Value",format:",.0f",sFormat:".2s",showLabel:!1},pareto:{caption:"파레토 라인",radius:3,curve:"monotone",axisPos:"right",ticks:0,fill:"gray",opacity:.6,stroke:"#aaa",strokeWidth:1,posRatio:.8,posColor:"yellow",showValue:!1,isDraw:!0},barColors:["#69b3a2","orange","red"],meanLine:{caption:"평균",stroke:"orange",strokeWidth:.7,showValue:!1},total:{caption:"총계",stroke:"#64d988",captionCum:"누적 합계"},tipInfo:"차이값 및 점유율",tooltipId:"#tooltip",tipWidth:350,method:{}};options.method=options.method||{},_u.init(cfg,options),cfg.themeInit=cfg.themeInit?cfg.themeInit:cfg.theme;const _c2iCon=d3.select(c2iCon);let _width=_u.computeDim(_c2iCon,cfg),_lang=c2i.lang,_svg,_bodyG,_rawData,_mean,_meanAll,_total,_sFmt;const _xScale=d3.scaleBand().range([0,_contentW()]).padding(.1),_yScale=d3.scaleLinear().range([_contentH(),0]),_yScalePareto=d3.scaleLinear().range([_contentH(),0]),tooltip=d3.select(cfg.tooltipId),xFmt="date"===cfg.x.dataType?d3.timeFormat(cfg.x.format):null,yFmt=d3.format(cfg.y.format),avgFmt=d3.format(cfg.y.sFormat?cfg.y.sFormat:cfg.y.format),cntFmt=d3.format(",d"),rFmt=d3.format(",.1%"),_tipHalfW=cfg.tipWidth/2;"string"==typeof cfg.x.convertFn&&(cfg.x.convertFn=eval(cfg.x.convertFn));const xFmtFn=t=>xFmt&&cfg.x.convertFn?xFmt(cfg.x.convertFn(t)):t,_c2iSel=(t,e)=>c2iCon+" .cls"+t.seq+e,_c2iPartoSel=(t,e)=>c2iCon+" "+e+t.seq,mouseenter=function(t,e){tooltip.select("table").style("width",cfg.tipWidth+"px"),tooltip.classed("c2iHidden",!1),d3.select(_c2iSel(e,".c2iFgBar")).style("fill",cfg.barColors[1]);let a,o=e[cfg.x.colNm];const n=`<tr><td class='c2iMiniUi mainTitle'>${e.seq}. ${o}</td><td>${cntFmt(e[cfg.y.colNm])}</td><td class='c2iMiniUi mainTitle'>${cfg.tipInfo}</td></tr>`,r=`<tr><td class='c2iMiniUi subTitle'>${cfg.total.caption}</td><td>${cntFmt(_total)}</td><td>${cntFmt(e[cfg.y.colNm]-_total)} (${rFmt(e[cfg.y.colNm]/_total)})</tr>`;a=`<tr><td class='c2iMiniUi subTitle'>${cfg.total.captionCum}</td><td>${cntFmt(e.cumVal)}</td><td>${cntFmt(e.cumVal-_total)} (${rFmt(e.cumVal/_total)})</td></tr>`,e.otherCnt>0?(o+=" ("+cntFmt(e.allCnt)+")",a+=`<tr><td class='c2iMiniUi subTitle'>${e[cfg.x.colNm]} ${cfg.meanLine.caption}</td><td>${cntFmt(e.otherMean)}</td><td>${cntFmt(e[cfg.y.colNm]-e.otherMean)}</td></tr>`):a+=`<tr style='color:${cfg.meanLine.stroke}'><td class='c2iMiniUi subTitle'>${cfg.meanLine.caption}</td><td>${avgFmt(_mean)}</td><td>${avgFmt(e[cfg.y.colNm]-_mean)} (${rFmt(e[cfg.y.colNm]/_mean)})</td></tr>`,a=n+a+r,tooltip.select("table").html(a),tooltip.style("left",t.x-_tipHalfW+"px").style("top",t.pageY-140+"px"),cfg.method.mouseenter&&cfg.method.mouseenter(t,{container:c2iCon,selector:"barPlot"},e)},mousemove=function(t){tooltip.style("left",t.x-cfg.tipWidth/2+"px").style("top",t.pageY-140+"px")},mouseleave=function(t,e){tooltip.classed("c2iHidden",!0),e.cumRatio>=cfg.pareto.posRatio&&d3.select(_c2iSel(e,".c2iFgBar")).classed("paretoPosBar")?d3.select(_c2iSel(e,".c2iFgBar")).style("fill",cfg.pareto.posColor):(d3.select(_c2iSel(e,".c2iFgBar")).style("fill",e.seq===cfg.otherCnt+1?cfg.barColors[2]:cfg.barColors[0]),cfg.method.mouseleave&&cfg.method.mouseleave(t,{container:c2iCon,selector:"barPlot"},e))},mouseenterPareto=function(t,e){tooltip.select("table").style("width",cfg.tipWidth+"px"),tooltip.classed("c2iHidden",!1),d3.select(_c2iSel(e,".c2iFgBar")).style("fill",cfg.barColors[1]),d3.select(_c2iPartoSel(e,".paretoPos.pareto")).style("fill",cfg.barColors[1]);let a,o=e[cfg.x.colNm],n=`<tr><td class='c2iMiniUi mainTitle'>${cfg.pareto.caption}</td><td>${rFmt(e.cumRatio)}</td><td class='c2iMiniUi mainTitle'>${yFmt(e.cumVal)}</td></tr>`;n+=`<tr><td class='c2iMiniUi subTitle'>${e.seq}. ${o}</td><td>${cntFmt(e[cfg.y.colNm])}</td><td class='c2iMiniUi subTitle'>${cfg.tipInfo}</td></tr>`;const r=`<tr><td class='c2iMiniUi subTitle'>${cfg.total.caption}</td><td>${cntFmt(_total)}</td><td>${cntFmt(e[cfg.y.colNm]-_total)} (${rFmt(e[cfg.y.colNm]/_total)})</tr>`;e.otherCnt>0?(o+=" ("+cntFmt(e.allCnt)+")",a=`<tr><td class='c2iMiniUi subTitle'>${e[cfg.x.colNm]} ${cfg.meanLine.caption}</td><td>${cntFmt(e.otherMean)}</td><td>${cntFmt(e[cfg.y.colNm]-e.otherMean)}</td></tr>`):a=`<tr style='color:${cfg.meanLine.stroke}'><td class='c2iMiniUi subTitle'>${cfg.meanLine.caption}</td><td>${avgFmt(_mean)}</td><td>${avgFmt(e[cfg.y.colNm]-_mean)} (${rFmt(e[cfg.y.colNm]/_mean)})</td></tr>`,a=n+a+r,tooltip.select("table").html(a).style("left",t.x-_tipHalfW+"px").style("top",t.pageY-140+"px"),cfg.method.mouseenter&&cfg.method.mouseenter(t,{container:c2iCon,selector:"pareto"},e)},mousemovePareto=function(t){tooltip.style("left",t.x-_tipHalfW+"px").style("top",t.pageY-140+"px")},mouseleavePareto=function(t,e){mouseleave(t,e),d3.select(_c2iPartoSel(e,".paretoPos.pareto")).style("fill",cfg.pareto.fill),cfg.method.mouseleave&&cfg.method.mouseleave(t,{container:c2iCon,selector:"pareto"},e)};function renderBody(){_bodyG||(_bodyG=_svg.append("g").attr("class","body")),_bodyG.attr("transform","translate("+_xStart()+","+_yEnd()+")");let t=0;if(_bodyG.selectAll(".c2iFgBar").data(cfg.data).join("rect").attr("class",t=>"cls"+t.seq+" c2iFgBar").attr("x",t=>_xScale(t[cfg.x.colNm])).attr("y",t=>_yScale(t[cfg.y.colNm])).attr("width",_xScale.bandwidth()).attr("height",t=>_contentH()-_yScale(t[cfg.y.colNm])).style("fill",function(e){return!t&&e.cumRatio>=cfg.pareto.posRatio?(d3.select(this).classed("paretoPosBar",!0),t=e.cumRatio,cfg.pareto.posColor):e.seq===cfg.otherCnt+1?cfg.barColors[2]:cfg.barColors[0]}),_bodyG.selectAll(".c2iBgBar").data(cfg.data).join("rect").on("mouseenter",mouseenter).on("mousemove",mousemove).on("mouseleave",mouseleave).attr("class",t=>"cls"+t.seq+" c2iBgBar").attr("x",t=>_xScale(t[cfg.x.colNm])).attr("width",_xScale.bandwidth()).attr("height",_contentH()).style("fill","transparent"),cfg.x.showLabel){const t=cfg.x.maxTickLabel,e=_xScale.domain(),a=e.length;let o=a<=t?e:[e[0],e[a/2-1],e[a-1]];if(a<=t)o=e;else{const n=e.map((t,e)=>e);o=d3.range(t).map(a=>e[Math.round(d3.quantile(n,a/t))]),(o=Array.from(new Set(o))).length<t&&o[o.length-1]!==e[a-1]&&o.push(e[a-1])}o=o.filter(t=>t);let n=_bodyG.selectAll(".xAxis");n.empty()&&(n=_bodyG.append("g").attr("class","xAxis c2iNoSelect")),n.attr("transform",`translate(0, ${_contentH()})`);const r=n.transition().duration(cfg.duration).call(d3.axisBottom(_xScale).ticks(t).tickSize(3).tickValues(o)).selectAll("text");cfg.x.isVertical?r.attr("y",0).attr("text-anchor","start").attr("writing-mode","tb"):r.attr("transform",`translate(0,0)rotate(${cfg.x.rotate})`).style("text-anchor","end"),n.selectAll("path.domain").attr("opacity",.5)}if(cfg.y.showLabel){let t=_bodyG.selectAll(".yAxis");_sFmt=d3.format(_yScale.domain()[1]<1e4?cfg.y.format:cfg.y.sFormat),t.empty()&&(t=_bodyG.append("g").attr("class","yAxis")),t.transition().duration(cfg.duration).call(d3.axisLeft(_yScale).ticks(3).tickSize(3).tickFormat(_sFmt)),t.selectAll("path.domain").attr("opacity",.5)}const e=_xScale.bandwidth()/2;_bodyG.selectAll(".meanLine").data([_mean]).join("line").attr("class","meanLine").attr("stroke",cfg.meanLine.stroke).attr("stroke-width",cfg.meanLine.strokeWidth).attr("x1",e).attr("x2",e).attr("y1",t=>_yScale(t)).attr("y2",t=>_yScale(t)).transition().duration(cfg.duration).attr("x2",_contentW()-e),cfg.meanLine.showValue&&_bodyG.selectAll(".meanValue").data([_mean]).join("text").attr("class","meanValue").attr("stroke",cfg.meanLine.stroke).attr("stroke-width",cfg.meanLine.strokeWidth).attr("x",_contentW()-5).attr("y",t=>_yScale(t)-5).style("text-anchor","end").style("pointer-events","none").text(t=>_lang.gen.avg+": "+avgFmt(t)),cfg.pareto.isDraw&&(_bodyG.selectAll(".paretoLine, .paretoPos, .paretoValue").remove(),_bodyG.append("path").datum(cfg.data).attr("class","paretoLine").attr("stroke",cfg.pareto.stroke).attr("stroke-width",cfg.pareto.strokeWidth).attr("stroke-opacity",cfg.pareto.opacity).style("fill","none").style("pointer-events","none").attr("d",d3.line().x(t=>_xScale(t[cfg.x.colNm])+e).y(t=>_yScalePareto(t.cumRatio))),_bodyG.selectAll(".paretoPos").data(cfg.data.filter(t=>t.showRatio)).join("circle").on("mouseenter",mouseenterPareto).on("mousemove",mousemovePareto).on("mouseleave",mouseleavePareto).attr("class",t=>`paretoPos pareto${t.seq}`).attr("r",cfg.pareto.radius).attr("stroke",cfg.pareto.stroke).attr("opacity",cfg.pareto.opacity).attr("stroke-width",cfg.pareto.strokeWidth).style("fill",cfg.pareto.fill).attr("cx",t=>_xScale(t[cfg.x.colNm])+_xScale.bandwidth()/2).attr("cy",t=>_yScalePareto(t.cumRatio)),cfg.pareto.showValue&&_bodyG.selectAll(".paretoValue").data(cfg.data.filter(t=>t.showRatio)).join("text").attr("class",t=>`paretoValue paretoValue${t.seq}`).attr("stroke",cfg.pareto.stroke).attr("stroke-width",cfg.pareto.strokeWidth).attr("opacity",cfg.pareto.opacity).attr("x",t=>_xScale(t[cfg.x.colNm])+_xScale.bandwidth()/2).attr("y",(t,e)=>3===e?20:_yScalePareto(t.cumRatio)-7).style("text-anchor","middle").style("pointer-events","none").text(t=>rFmt(t.cumRatio)))}function _layoutData(){_u.setTheme(cfg,c2iCon,!1);const t=d3.cumsum(_rawData,t=>t[cfg.y.colNm]),e=t[t.length-1];let a,o;cfg.otherCnt>0?(a=_rawData.slice(0,cfg.otherCnt),o=_rawData[cfg.otherCnt]):a=_rawData;const n=d3.extent(a,t=>+t[cfg.y.colNm]);let r,l;n[0]=n[0]*(n[0]<0?1.1:.9),n[1]=1.1*n[1],_yScale.domain(n),_mean=d3.mean(a.map(t=>+t[cfg.y.colNm])),_total=d3.sum(a.map(t=>+t[cfg.y.colNm]));const i=parseInt(a.length/3),s=d3.rank(a,(t,e)=>d3.descending(+t[cfg.y.colNm],+e[cfg.y.colNm]));cfg.data=a.map((a,o)=>(r=t[o],l=parseFloat((r/e).toFixed(3)),{...a,cumVal:r,cumRatio:l,showRatio:o%i==0,seq:o+1,rank_:s[o]+1,[cfg.x.colNm]:xFmtFn(a[cfg.x.colNm])})),o?(_total+=o.data_cnt,_meanAll=_total/o.allCnt,o.seq=cfg.otherCnt+1,o.cumVal=_total,o.cumRatio=1,o.showRatio=!0,cfg.data.push(o)):cfg.data[a.length-1].showRatio=!0,_xScale.domain(cfg.data.map(t=>t[cfg.x.colNm]))}function resize(){_svg&&_c2iCon.node().parentNode.clientWidth&&(cfg.nonComponent?_width=_c2iCon.node().parentNode.clientWidth:(_width=parseInt(_c2iCon.style("width"),10),cfg.height=parseInt(_width/cfg.aspect)),_svg&&_width&&(_svg.attr("width",_width).attr("height",cfg.height),_yScale.range([_contentH(),0]),_xScale.range([0,_contentW()]),chart.render()))}function _xStart(){return cfg.margin.left}function _yEnd(){return cfg.margin.top}function _contentW(){return _width-cfg.margin.left-cfg.margin.right}function _contentH(){return cfg.height-cfg.margin.top-cfg.margin.bottom}chart.render=function(){if(!(_width<50))return _svg||(d3.select(c2iCon).select("svg").remove(),_svg=d3.select(c2iCon).append("svg").attr("class","c2iBarMiniUi").attr("width",_width).attr("height",cfg.height).style("background",cfg.theme?cfg.theme:null)),renderBody(),chart},chart.clear=function(){return _svg&&(_svg.remove(),_svg=_bodyG=void 0),chart},chart.theme=function(t){return arguments.length?(cfg.theme="base"===t?cfg.themeInit:t,_u.setTheme(cfg,c2iCon,!0),chart):cfg.theme},chart.data=function(t){return arguments.length?(_rawData=t,_layoutData(),chart):cfg.data},chart.lang=function(t){return arguments.length?(cfg.lang=t.toLowerCase(),_u.locale(cfg),_lang=c2i.lang,chart):cfg.lang};let _timer=null;return cfg.isResponsive&&_u.resizeChart(cfg,c2iCon,resize,_timer),_u.createAccessor(chart,cfg)},c2i.ui.pie=function(t,e){"use strict";const a=c2i.util;let o={},n={isResponsive:!0,nonComponent:!0,width:"100%",height:50,margin:{top:5,left:5,right:5,bottom:5},easing:"linear",duration:0,color:"Tab10",stroke:["#69b3a2","orange"],strokeWidth:.5,ratioCaption:"점유율",format:",.0f",format2:".1%",sFormat:".2s",formatAvg:",.2f",baseVal:1e5,sumInfo:{x:0,y:-15,fill:"#aaa",fontSize:"13px",caption:"합계",isShow:!0},avgInfo:{x:0,y:15,fill:"#aaa",fontSize:"14px",caption:"평균"},labelInfo:{stroke:"yellow",fill:"orange",fontSize:"11px",showLabel:!1},tooltipId:"#tooltip",tipWidth:250,data:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);let l,i,s,c,d,u=a.computeDim(r,n),m=c2i.lang;const p=d3.select(n.tooltipId),g=n.isTime?d3.timeFormat(n.format):d3.format(n.format),f=d3.format(n.format2),h=d3.format(n.sFormat),y=d3.format(n.formatAvg),_=n.labelInfo.showLabel?(n.margin.left+n.margin.right)/2:0,x=Math.min(u-n.margin.left-n.margin.right,n.height-n.margin.top-n.margin.bottom)/2-_,v=c2i.util.getColorScheme(n.color),b=d3.scaleOrdinal().range(v),k=d3.pie().value(t=>t),C=d3.arc().innerRadius(.6*x).outerRadius(x),w=d3.arc().innerRadius(.9*x).outerRadius(.9*x),N=function(e,a){p.select("table").style("width",n.tipWidth+"px"),p.classed("c2iHidden",!1),d3.select(`${t} .cls${a.index}.c2iFgBar`).style("stroke",n.stroke[1]);let o=`<tr><td colspan='3' class='c2iMiniUi mainTitle'>${n.data[0][a.index]}: ${g(a.data)}</td></tr>`;n.sumInfo.isShow||(o+=`<tr><td colspan='3' class='c2iMiniUi subTitle'>${n.sumInfo.caption}: ${g(c)}</td></tr>`),o+=`<tr><td colspan='3' class='c2iMiniUi subTitle'>${n.ratioCaption}: ${f(a.data/c)}</td></tr>`,p.select("table").html(o),p.style("left",e.x-n.tipWidth/2+"px").style("top",e.y+25+"px"),d3.select(this).attr("stroke",n.stroke[1]).style("stroke-width",2*n.strokeWidth)},A=function(t){p.style("left",t.x-n.tipWidth/2+"px").style("top",t.y+25+"px")},L=function(e,a){d3.select(`${t} .cls${a.index}.c2iFgBar`).style("stroke",n.stroke[0]),p.classed("c2iHidden",!0),d3.select(this).attr("stroke",n.stroke[0]).style("stroke-width",n.strokeWidth)};o.render=function(){if(!(u<50))return l||(d3.select(t).select("svg").remove(),l=d3.select(t).append("svg").attr("class","c2iPieMiniUi").attr("width",u).attr("height",n.height).style("background",n.theme?n.theme:null)),function(){const t=d<=n.baseVal?g:h,e=d<=n.baseVal?y:h,a=k(n.data[1]);let o=e(d),r=t(c);if(!i){(i=l.append("g").attr("class","body").attr("transform",`translate(${u/2}, ${n.height/2})`)).selectAll("whatever").data(a).join("path").attr("d",C).on("mouseover",N).on("mousemove",A).on("mouseleave",L).attr("fill",t=>b(t)).attr("stroke",n.stroke[0]).style("stroke-width",n.strokeWidth);const e=i.append("text").attr("text-anchor","middle").attr("transform","translate(0, 0)");if(n.sumInfo.isShow){const t=n.sumInfo;e.append("tspan").attr("x",t.x).attr("y",t.y).attr("fill",t.fill).attr("font-size",t.fontSize).text(r),e.append("tspan").attr("x",t.x).attr("y",t.y+parseInt(t.fontSize)+1).attr("fill",t.fill).attr("font-size",t.fontSize).text(t.caption)}const s=n.avgInfo;e.append("tspan").attr("x",s.x).attr("y",s.y).attr("fill",s.fill).attr("font-size",s.fontSize).text(o),e.append("tspan").attr("x",s.x).attr("y",s.y+parseInt(s.fontSize)+1).attr("fill",s.fill).attr("font-size",s.fontSize).text(s.caption),n.labelInfo.showLabel&&(i.selectAll("allPolylines").data(a).join("polyline").attr("stroke",n.labelInfo.stroke).style("fill","none").attr("stroke-width",1).attr("points",function(t){const e=C.centroid(t),a=w.centroid(t),o=w.centroid(t),n=t.startAngle+(t.endAngle-t.startAngle)/2;return o[0]=.95*x*(n<Math.PI?1:-1),[e,a,o]}),i.selectAll("allLabels").data(a).enter().append("text").text(e=>t(e.value)).attr("fill",n.labelInfo.fill).attr("font-size",n.labelInfo.fontSize).attr("transform",function(t){const e=w.centroid(t),a=t.startAngle+(t.endAngle-t.startAngle)/2;return e[0]=.99*x*(a<Math.PI?1:-1),"translate("+e+")"}).style("text-anchor",function(t){const e=t.startAngle+(t.endAngle-t.startAngle)/2;return e<Math.PI?"start":"end"}))}}(),o},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(e){return arguments.length?(s=e,a.setTheme(n,t,!1),n.data=s,c=d3.sum(n.data[1],t=>t),d=d3.mean(n.data[1],t=>t),o):n.data},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),m=c2i.lang,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,function(){l&&r.node().parentNode.clientWidth&&(n.nonComponent?u=r.node().parentNode.clientWidth:(u=parseInt(r.style("width"),10),n.height=parseInt(u/n.aspect)),l&&u&&(l.attr("width",u).attr("height",n.height),o.render()))},null),a.createAccessor(o,n)},c2i.ui.corrMixAdv=function(t,e){"use strict";const a=c2i.util;let o={},n={isResponsive:!0,nonComponent:!0,width:"100%",margin:{top:5,left:5,right:5,bottom:5},easing:"linear",duration:0,nullInfo:"Null_Value",preBuildData:!0,cutLength:12,chartGap:20,minSize:250,maxRows:3e3,key:"",analysisColNm:"",aggSQL:"sum",measures:[],groupBy:{colNm:"",caption:"",format:"",dFormat:"",sFormat:""},xyBothNumber:!0,histogram:{ticks:3,tickSize:2,bins:20,barColors:["#67998d","orange"],stroke:"lightgray",caption:{color:"orange",fontSize:12,opacity:.5},binned:"구간",freq:"빈도수",sum:"합계",count:"빈도수",mean:"평균",median:"중앙값",variance:"분산",deviation:"표준편차",quantile:"사분위",q123:["1분위","2분위","3분위"],kde:{color:"#d11753",thresholds:40,strokeWidth:.9,isDraw:!0}},scatter:{isBrush:!1,colors:"Tab10",stroke:"lightgray",radius:3,ticks:3,tickSize:2,opacity:.7,tipWidth:300,trendLine:{method:"leastSquares",each:!1,allStroke:"lightgray",allStrokeWidth:[1.5,.7],totTrendCaption:"전체 추세선",strokeWidth:.7,opacity:.7,exceptZero:!1,methodNm:"최소 자승법",isMedian:!0,isMean:!0,meanMedian:{fill:["red","lightgray"],symbol:["cross","triangle"]},terms:{equation:"방정식",corrCoeff:"상관계수",spearmanCoeff:"상관계수(스피어먼)",coVariance:"공분산",rSquare:"R2"},dotStroke:"dimgray",dotRadius:2,isDraw:!0}},boxPlot:{sort:"desc",growCnt:5,ticks:3,tickSize:2,padding:.2,captions:["1분위","3분위","사분위수 범위"],centerLine:{stroke:"lightgray",strokeWidth:1},box:{stroke:"dimgray",fill:"#c5c5c5",opacity:.5},medianLine:{caption:"중앙값",stroke:"orange",strokeWidth:1.5},dotInfo:{stroke:"#bbb",interpolator:"interpolatePlasma",outlierColor:"#ff7373",radius:3,showDots:100,onlyOutlier:!0,outLier:"이상치(Outlier)",opacity:.5,isDraw:!0},tipWidth:300},tooltipId:"#tooltip",tipWidth:400,data:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t);let l,i,s,c,d,u,m,p,g,f,h,y,_,x,v,b=a.computeDim(r,n),k=c2i.lang;const C=d3.select(n.tooltipId),w=d3.format(",.0f"),N=n.groupBy,A=n.boxPlot,L=A.dotInfo,D=n.scatter,S=D.trendLine,T=d3.scaleSequential().interpolator(d3[L.interpolator]),M=d3.line().curve(d3.curveBasis),F=d3.scaleBand(),I=d3.scaleOrdinal().range(a.getColorScheme(D.colors)),B=n.histogram,E=n.chartGap,G=E/2,P=(t,e,a)=>t[a](e[H[a].colNm]);let O,R,V,W,Y,z,H=n.measures;const $=()=>{x&&v&&i.property("value").length&&x.clear(v)},X=(t,e)=>C.style("left",t+"px").style("top",e+"px"),q=t=>{C.select("table").style("width",t+"px"),C.classed("c2iHidden",!1)},U=function(t,e){$(),q(n.tipWidth);let a=H[parseInt(e.seq.split("_")[1])];const o=d3.format(a.format),r=d3.format(a.dFormat);let l,s,c,d,u,m;e.length?(1===e.length?d=u=n.nullInfo:(d=r(d3.variance(e)),u=r(d3.deviation(e))),l=o(d3.sum(e)),s=o(d3.mean(e)),c=o(d3.median(e)),m=[o(d3.quantile(e,.25)),o(d3.quantile(e,.5)),o(d3.quantile(e,.75))]):(l=s=c=d=u=m=n.nullInfo,m=[n.nullInfo,n.nullInfo,n.nullInfo]);const p=`<tr style='color:orange'><td colspan='3' class='c2iMiniUi mainTitle'>${o(e.x0)}&nbsp;<=&nbsp;${a.caption}&nbsp;${B.binned}&nbsp;<&nbsp;${o(e.x1)}</tr>\n          <tr><td class='c2iMiniUi subTitle'>${B.freq}</td><td class='c2iMiniUi subTitle'>${B.sum}</td><td class='c2iMiniUi subTitle'>${B.mean}</td></tr>\n          <tr><td>${w(e.length)}</td><td>${l}</td><td>${s}</td></tr>\n          <tr><td class='c2iMiniUi subTitle'>${B.median}</td><td class='c2iMiniUi subTitle'>${B.variance}</td><td class='c2iMiniUi subTitle'>${B.deviation}</td></tr>\n          <tr><td>${c}</td><td>${d}</td><td>${u}</td></tr>\n          <tr><td class='c2iMiniUi subTitle'>${B.q123[0]}</td><td class='c2iMiniUi subTitle'>${B.q123[1]}</td><td class='c2iMiniUi subTitle'>${B.q123[2]}</td></tr>\n          <tr><td>${m[0]}</td><td>${m[1]}</td><td>${m[2]}</td></tr>`;C.select("table").html(p),X(t.x-n.tipWidth/2,t.pageY-240),z=".c2iFgBar ."+(z=t.currentTarget.classList[0]),i.select(z).attr("fill",B.barColors[1]),i.selectAll(".c2iScatters circle").classed("hidden",t=>e.x0>t[e.colNm]||t[e.colNm]>e.x1)},j=t=>X(t.x-n.tipWidth/2,t.pageY-240),Z=function(){i.select(z).attr("fill",B.barColors[0]),C.classed("c2iHidden",!0),i.selectAll(".c2iScatters circle").classed("hidden",!1)},Q=(t,e)=>null===t||isNaN(t)||void 0===t?n.nullInfo:e(t),K=(t,e)=>{$(),q(D.tipWidth);let a=t.currentTarget.parentNode.parentNode.classList[1];a=a.split("_");const o=H[a[1]],r=H[a[2]],l=d3.format(o.format),s=d3.format(r.format),c=n.key?e[n.key]:"",d=n.preBuildData?e[N.colNm]:"";let u=`<tr><td class='c2iMiniUi mainTitle' colspan='2'>${c?d+c:d}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>X: ${o.caption}</td><td class='c2iMiniUi subTitle'>${Q(e[o.colNm],l)}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>Y: ${r.caption}</td><td class='c2iMiniUi subTitle'>${Q(e[r.colNm],s)}</td></tr>`;C.select("table").html(u),X(t.x-D.tipWidth/2,t.pageY-120),i.selectAll(".dots.c_"+e._key).style("fill","red").style("r",1.5*D.radius),d3.select(t.currentTarget).style("stroke","#ddd").style("r",2*D.radius);const m=[];m.push(`.c2iHist.cls_${a[1]}_${a[1]}`+" .c2iFgBar>rect"),m.push(`.c2iHist.cls_${a[2]}_${a[2]}`+" .c2iFgBar>rect"),m.forEach((t,n)=>{let l=n?e[r.colNm]:e[o.colNm];i.selectAll(t).each(t=>{t.x0<=l&&(t.isLast?l<=t.x1:l<t.x1)&&(a=".c2iFgBar > ."+t.seq,d3.select(a).style("fill",B.barColors[1]))})})},J=t=>X(t.x-D.tipWidth/2,t.pageY-120),tt=(t,e)=>{C.classed("c2iHidden",!0),i.selectAll(".dots.c_"+e._key).style("stroke",null).style("fill",t=>null).style("r",null),d3.selectAll(".c2iFgBar>rect").style("fill",null)},et=(t,e)=>{$(),q(A.tipWidth);let a={};i.selectAll(".c2iScatters circle").classed("hidden",t=>e.q1>t[e._colNm]||t[e.c_olNm]>e.q3||(e.groupBy!==t[N.colNm]||(a[t._key]||(a[t._key]=1),!1))),d3.select(t.currentTarget).style("opacity",1);let o=t.currentTarget.parentNode.parentNode.classList[1];o=o.split("_");const n=d3.format(H[o[1]].format);a=d3.sum(Object.values(a));let r=((t,e,a)=>`<tr><td colspan='2' class='c2iMiniUi mainTitle'>${t.groupBy?t.groupBy:t._colCaption} ${B.freq} : ${a}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>${A.captions[1]}</td><td>${e(t.q3)}</td></tr>\n        <tr style='color: ${A.medianLine.stroke}'><td class='c2iMiniUi subTitle'>${A.medianLine.caption}</td><td>${e(t.median)}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>${A.captions[0]}</td><td>${e(t.q1)}</td></tr>\n        <tr style='color:yellow'><td class='c2iMiniUi subTitle'>${A.captions[2]}</td><td>${e(t.IQR)}</td></tr>`)(e,n,w(a));e.outLiers&&(r+=`<tr><td class='c2iMiniUi mainTitle'>${L.outLier}</td><td>${w(e.outLiers)}</td></tr>`),C.select("table").html(r),C.style("left",t.x-A.tipWidth/2+"px").style("top",t.pageY-170+"px")},at=t=>C.style("left",t.x-A.tipWidth/2+"px").style("top",t.pageY-170+"px"),ot=t=>{C.classed("c2iHidden",!0),d3.select(t.currentTarget).style("opacity",null),i.selectAll(".c2iScatters circle").classed("hidden",!1)},nt=(t,e)=>{$(),q(A.tipWidth);let a,o,r=`<tr><td colspan='2' class='c2iMiniUi mainTitle'>${e._colCaption}</td></tr>`;N.format?(a=d3.format(N.format),r+=`<tr><td colspan='2' class='c2iMiniUi mainTitle'>${o=N.caption+": "+a(e[N.colNm])}</td></tr>`):r+=`<tr><td colspan='2' class='c2iMiniUi mainTitle'>${N.colNm}</td></tr>`;let l=t.currentTarget.parentNode.parentNode.classList[1];l=l.split("_"),a=d3.format(H[l[1]].format),o=e[n.key]?e[n.key]+"("+e._colCaption+")":e._colCaption,e[n.key]?r+=`<tr style='color: ${L.outlierColor}''><td class='c2iMiniUi mainTitle'>${e[n.key]}</td>\n            <td class='c2iMiniUi mainTitle'>${a(e[e._colNm])}</td></tr>`:r+=`<tr style='color: ${L.outlierColor}''>\n                <td colspan='2' class='c2iMiniUi mainTitle'>${a(e[e._colNm])}</td></tr>`;let s=0;e.outLiers?s=e.outLiers:i.selectAll(".scatter>circle").each(function(t){e[N.colNm]===t.groupByNm&&(d3.select(this).style("fill","red"),t.xCol!==e._colNm&&t.yCol!==e._colNm||t.xVal!==e[e._colNm]&&t.yVal!==e[e._colNm]?d3.select(this).style("fill",null):(d3.select(this).style("fill","red"),s++))}),s&&(r+=`<tr><td class='c2iMiniUi mainTitle'>${L.outLier}</td><td>${w(s)}</td></tr>`),C.select("table").html(r),X(t.x-A.tipWidth/2,t.pageY-150)},rt=t=>X(t.x-A.tipWidth/2,t.pageY-150),lt=()=>C.classed("c2iHidden",!0),it=(t,e)=>{$(),q(D.tipWidth);let a=t.currentTarget.parentNode.parentNode.classList[1];a=a.split("_");let o=((t,e)=>`<tr><td colspan='2' class='c2iMiniUi mainTitle'>${t.caption}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>X: ${e(t.x)}</td><td >Y: ${e(t.y)}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>${S.terms.rSquare}: ${t.rSquare}</td><td>${S.terms.equation}: ${t.equation}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>${S.terms.coVariance}</td><td>${t.coVariance}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>${S.terms.corrCoeff}</td><td>${t.corrCoeff}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>${S.terms.spearmanCoeff}</td><td>${t.spearmanCoeff}</td></tr>`)(e,d3.format(H[a[1]].format));C.select("table").html(o),X(t.x-D.tipWidth/2,t.pageY-200)},st=t=>C.style("left",t.x-n.tipWidth/2+"px").style("top",t.pageY-200+"px"),ct=(t,e)=>{$(),q(D.tipWidth);let a=((t,e)=>`<tr style="color:${e}"><td class='c2iMiniUi mainTitle' colspan='2'>${t.caption.methodNm}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>X: ${t.caption.x}</td><td class='c2iMiniUi subTitle'>${t.viewVal.x}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>Y: ${t.caption.y}</td><td class='c2iMiniUi subTitle'>${t.viewVal.y}</td></tr>`)(e,S.meanMedian.fill["mean"===e.method?0:1]);C.select("table").html(a),X(t.x-D.tipWidth/2,t.pageY-120),d3.select(t.currentTarget).attr("r",2.5*D.radius)},dt=t=>X(t.x-D.tipWidth/2,t.pageY-120);function ut(t){const e=n.xyBothNumber?n.data.filter(t=>!isNaN(t[m.colNm])).map(t=>t[m.colNm]):n.data.map(t=>t[m.colNm]);g=d3.extent(e);const o=t=>r(t.x1)-r(t.x0)-(r(t.x1)-r(t.x0)>1?1:0),r=d3.scaleLinear().domain(g).nice().rangeRound([G,W]);let l=d3.bin().thresholds(r.ticks(B.bins))(e);l=l.map((e,a)=>(e.seq=t+a,e.colNm=m.colNm,e));const s=d3.scaleLinear().domain([0,d3.max(l,t=>t.length)]).range([V-E,0]);let d;if(B.kde.isDraw){d=s.copy();const t=.2,o=e.length,n=Math.pow(d3.deviation(e)*(4/(3*o)),t),l=r.ticks(B.thresholds);c=a.kdeFn(a.epanechnikovFn(n),l,e),d.domain([0,d3.max(c,t=>t[1])])}const u=i.append("g").attr("class","c2iHist "+t).attr("transform","translate("+F(m.colNm)+","+F(p.colNm)+")");y=d3.format(r.domain()[1]<1e4?m.format:m.sFormat),u.append("g").attr("transform",`translate(0,${W})`).call(d3.axisBottom(r).ticks(B.ticks).tickSize(B.tickSize).tickFormat(y)),y=d3.format(s.domain()[1]<1e3?",d":".3s"),u.append("g").attr("transform",`translate(${G},${G})`).call(d3.axisLeft(s).ticks(B.ticks).tickSize(B.tickSize).tickFormat(y)),u.append("g").attr("class","c2iFgBar").attr("transform","translate(0,"+G+")").selectAll(".c2iFgBar>rect").data(l).enter().append("rect").attr("class",t=>t.seq).attr("transform",t=>"translate("+r(t.x0)+","+s(t.length)+")").attr("width",o).attr("height",t=>V-E-s(t.length)).attr("fill",B.barColors[0]),u.append("g").attr("class","c2iBgBar").attr("transform","translate(0,"+G+")").selectAll(".c2iBgBar>rect").data(l).join("rect").attr("class",t=>t.seq).on("mouseover",U).on("mousemove",j).on("mouseleave",Z).attr("transform",t=>`translate(${r(t.x0)} , 0)`).attr("width",o).attr("height",V-E).attr("fill","transparent"),u.append("text").attr("class","c2iCorrMixLabel").attr("x",17).attr("y",10).attr("opacity",B.caption.opacity).attr("fill",B.caption.color).attr("font-size",B.caption.fontSize+"px").style("pointer-events","none").text(m.caption.length>n.cutLength?m.caption.substr(0,n.cutLength):m.caption),m.caption.length>n.cutLength&&u.append("title").text(m.caption);const f=u.append("path").attr("class","c2iKde").datum(c);f.attr("transform","translate(0,"+G+")").attr("fill","none").attr("stroke","red").style("pointer-events","none").attr("stroke-width",.7).attr("stroke-linejoin","round"),f.merge(f).attr("d",M.x(t=>r(t[0])).y(t=>d(t[1])))}function mt(t,e){const o=n.xyBothNumber?n.data.filter(t=>!isNaN(t[m.colNm])&&!isNaN(t[p.colNm])):n.data;I.domain(o.map(t=>t[N.colNm])),g=d3.extent(n.data.map(t=>t[m.colNm]));const r=d3.scaleLinear().domain(g).nice().rangeRound([G,W]);f=d3.extent(n.data,t=>t[p.colNm]);const l=d3.scaleLinear().domain(f).nice().rangeRound([V-E,0]),s=i.append("g").attr("class","c2iScatters "+t).attr("transform",`translate(${F(m.colNm)},${F(p.colNm)})`),c=d3.format(r.domain()[1]<=n.baseVal?m.format:m.sFormat);s.append("g").attr("transform",`translate(0,${W})`).call(d3.axisBottom(r).ticks(D.ticks).tickSize(D.tickSize).tickFormat(c));const d=d3.format(l.domain()[1]<=n.baseVal?p.format:p.sFormat);s.append("g").attr("transform",`translate(${G},${G})`).call(d3.axisLeft(l).ticks(D.ticks).tickSize(D.tickSize).tickFormat(d)),s.append("g").attr("class","scatter c_"+e).selectAll(".dots>circle").data(o,t=>t._key).join("circle").on("mouseover",K).on("mousemove",J).on("mouseleave",tt).attr("class",t=>"dots c_"+t._key).attr("cx",t=>r(t[m.colNm])).attr("cy",t=>l(t[p.colNm])+G).attr("r",D.radius).attr("opacity",D.opacity).attr("fill",t=>I(t[N.colNm]));const u=d3.format(m.format),h=d3.format(p.format);S.isDraw&&(pt(u,h,o),function(){const t=_.filter(t=>"line"===t.type).map(t=>{const e=d3.format(t.value.yFmt),a=e(t.value.slope)+"x + "+e(t.value.intercept);return{groupBy:t.groupBy,caption:t.caption,x1:t.data[0].x,y1:t.data[0].y,x2:t.data[1].x,y2:t.data[1].y,exceptZero:S.exceptZero,coVariance:t.coVariance,corrCoeff:t.corrCoeff,spearmanCoeff:t.spearmanCoeff,equation:a,rSquare:e(t.value.rSquare)}}),e=t[t.length-1];if(isNaN(e.x1)||isNaN(e.x2)||isNaN(e.y1)||isNaN(e.y2))return void console.log("데이터가 추세선등을 유추하기에 부적합니다.");s.append("g").attr("class","trendLines").selectAll(".trendLines>line").data(t,t=>t._key).join("line").style("pointer-events","none").attr("x1",t=>r(t.x1)).attr("y1",t=>l(t.y1)+G).attr("x2",t=>r(t.x2)).attr("y2",t=>l(t.y2)+G).attr("opacity",S.opacity).attr("stroke-width",t=>"_All_"===t.groupBy?S.allStrokeWidth[0]:S.allStrokeWidth[1]).attr("stroke",t=>"_All_"===t.groupBy?S.allStroke:I(t.groupBy));const o=[];t.forEach(t=>{let e={...t};e.x=t.x1,e.y=t.y1,o.push(e),(e={...e}).x=t.x2,e.y=t.y2,o.push(e)}),s.append("g").attr("class","trendLineDots").selectAll(".trendLineDots>circle").data(o).join("circle").on("mouseover",it).on("mousemove",st).on("mouseleave",lt).attr("cx",t=>r(t.x)).attr("cy",t=>l(t.y)+G).attr("r",S.dotRadius).attr("opacity",S.opacity).attr("stroke",S.dotStroke).attr("stroke-width",S.dotStroke).attr("fill",t=>"_All_"===t.groupBy?S.allStroke:I(t.groupBy));const n=S.meanMedian;s.append("g").attr("class","meanMedianDots").selectAll(".meanMedianDots>path").data(_.filter(t=>"circle"===t.type)).join("path").on("mouseover",ct).on("mousemove",dt).on("mouseleave",lt).attr("d",t=>d3.symbol().type(a.symbols["mean"===t.method?n.symbol[0]:n.symbol[1]]).size(30*("mean"===t.method?3:4))()).attr("transform",t=>`translate(${r(t.x)},${l(t.y)+G})`).attr("stroke",t=>"_All_"===t.groupBy?S.allStroke:I(t.groupBy)).attr("stroke-width",S.dotStroke).attr("fill",t=>"mean"===t.method?n.fill[0]:n.fill[1])}())}function pt(t,e,o){let n,r;if(_=[],S.each){let t=d3.rollup(o,t=>t,t=>t[N.colNm]);(t=Array.from(t).map(t=>({...t[1],groupBy:t[0]}))).forEach((t,o)=>{const l=[];for(let e in t)"object"==typeof t[e]&&l.push(t[e]);n=l.map(t=>({...t,x:t[m.colNm],y:t[p.colNm]})).sort((t,e)=>t.x-e.x),r={type:"line",groupBy:t.groupBy,caption:t.groupBy},(r=gt(n,r,e))._key=a.getClassPure(m.colNm+"_"+p.colNm)+"_"+o,_.push(r)})}n=o.map(t=>({...t,x:t[m.colNm],y:t[p.colNm]})).sort((t,e)=>t.x-e.x),r={type:"line",groupBy:"_All_",caption:S.totTrendCaption},(r=gt(n,r,e))._key=a.getClassPure(m.colNm+"_"+p.colNm)+"_"+_.length,_.push(r),S.isMedian&&ft(n,"median","전체 중앙값",t,e),S.isMean&&ft(n,"mean","전체 평균",t,e)}function gt(t,e,a,o=!0){const n=t.map(t=>t.x),r=t.map(t=>t.y),l=a(c2i.stat.covariance(n,r)),i=c2i.stat.corrcoeff(n,r).toFixed(2),s=c2i.stat.spearmancoeff(n,r).toFixed(2),c=S.method;let d,u={...e,coVariance:l,corrCoeff:i,spearmanCoeff:s,methodNm:S.methodNm};return["leastSquares","linearRegression"].indexOf(c)>-1?(o&&(u.caption+="("+S.methodNm+")"),d=c2i.util.trendLinear(t,c,S.exceptZero),u.data=d.data,u.value=d.value):(d=c2i.util.trendLogarithmic(t),u={...u,...d},o&&(u.caption+="("+S.methodNm+")")),u}function ft(t,e,a,o,n){const r=d3[e](t,t=>t.x),l=d3[e](t.sort((t,e)=>t.y-e.y),t=>t.y),i={type:"circle",x:r,y:l,method:e,caption:{x:m.caption,y:p.caption,methodNm:a},viewVal:{x:o(r),y:n(l)}};_.push(i)}function ht(t){let e,o,r,l,s,c,d,u,g;const _=n.xyBothNumber?n.data.filter(t=>!isNaN(t[p.colNm])):n.data;let x=d3.rollup(_,t=>(o=t.map(t=>t[p.colNm]).sort(d3.ascending),l=d3.quantile(o,.25),r=d3.quantile(o,.5),s=d3.quantile(o,.75),g=r-1.5*(c=s-l),d=d3.min(o.filter(t=>t>=g)),g=r+1.5*c,u=d3.max(o.filter(t=>t<=g)),{median:r,q1:l,q3:s,IQR:c,qMin:d,qMax:u}),t=>t[N.colNm]);x=Array.from(x).map(t=>({...t[1],groupBy:t[0],format:n.format,_colNm:p.colNm,_colCaption:p.caption})),"desc"===A.sort?x.sort((t,e)=>e.groupBy-t.groupBy):x.sort((t,e)=>t.groupBy-e.groupBy);const{centerLine:v,box:b,medianLine:k,dotInfo:C,padding:w,ticks:D,tickSize:S}=A;e=d3.scaleBand().domain(x.map(t=>t.groupBy)).range([0,Y]).padding(w),h=e.bandwidth(),f=d3.extent(_,t=>t[p.colNm]);const M=d3.scaleLinear().domain(f).nice().range([W-G,0]);T.domain(f);const I=h/2,P=F(m.colNm)+E+F.step(),O=F(p.colNm)+E-G,R=i.append("g").attr("class","c2iBoxplot "+t).attr("transform",`translate(${P},${O})`),V=R.append("g").attr("transform",`translate(0,${W-G})`);V.call(d3.axisBottom(e).tickSize(S)),1===x.length&&V.select(".tick").remove(),y=d3.format(M.domain()[1]<1e3?p.format:p.sFormat),R.append("g").call(d3.axisLeft(M).ticks(D).tickSize(S).tickFormat(y));const z=R.append("g").attr("class","c2iBoxplotOne").attr("transform",`translate(${I},0)`);z.selectAll(".centerLine").data(x).enter().append("line").attr("class","centerLine").attr("pointer-events","none").attr("x1",t=>e(t.groupBy)).attr("x2",t=>e(t.groupBy)).attr("y1",t=>M(t.qMin)).attr("y2",t=>M(t.qMax)).attr("stroke",v.stroke).attr("stroke-width",v.strokeWidth),z.selectAll(".box").data(x).enter().append("rect").on("mouseover",et).on("mousemove",at).on("mouseleave",ot).attr("class","box").attr("x",t=>e(t.groupBy)-I).attr("y",t=>M(t.q3)).attr("height",t=>M(t.q1)-M(t.q3)).attr("width",h).attr("opacity",b.opacity).attr("stroke",b.stroke).attr("fill",b.fill),z.selectAll(".medianLine").data(x).enter().append("line").attr("class","medianLine").attr("pointer-events","none").attr("x1",t=>e(t.groupBy)-I).attr("x2",t=>e(t.groupBy)+I).attr("y1",t=>M(t.median)).attr("y2",t=>M(t.median)).attr("stroke",k.stroke).attr("stroke-width",k.strokeWidth);let H=R.append("text").attr("class","c2iCorrMixLabel").attr("opacity",B.caption.opacity).attr("fill",B.caption.color).attr("font-size",B.caption.fontSize+"px").text(p.caption.length>n.cutLength?p.caption.substr(0,n.cutLength):p.caption);p.caption.length>n.cutLength&&R.append("title").text(p.caption),a.korean(p.caption)?H.attr("x",Y+G).attr("y",-10).attr("writing-mode","tb"):H.attr("x",Y).attr("y",3).attr("text-anchor","end"),!N.format&&x.length>1&&V.selectAll(".tick > text").attr("transform",()=>"rotate(-13)"),C.isDraw&&function(t,e,o,r){let l,i,s,c,d=.7*h;const u=e=>{i=[];const o=e?"qMin":"q1",r=e?"qMax":"q3";if(_.forEach((e,s)=>{const d={...e};d.format=n.format,d._colNm=p.colNm,d._colCaption=p.caption,d._key=d._key+isNaN(p.colNm)?p.colNm:a.getClassPure(p.colNm),d._key+="_"+s,l=d[p.colNm],c=t.find(t=>t.groupBy===d[N.colNm]),(l<c[o]||l>c[r])&&i.push(d)}),i.length>L.showDots&&L.showDots>0){console.log(">> 너무 많은("+i.length.toFixed()+") 이상치 데이터가 존재하여 1개의 큰 Dot(점)로 표현합니다."+`\nThere are too many outlier data(${i.length.toFixed()}), so it is expressed as one large dot..!!`),s=1.5*L.radius,i.sort((t,e)=>e[p.colNm]-t[p.colNm]);const e=[];let a,o,r;t.forEach(t=>{let n=i;n.length&&(n.sort((t,e)=>t[p.colNm]-e[p.colNm]),a=n[0],t.q1>a[p.colNm]?(r=n.filter(e=>t.q1>=e[p.colNm]),a.outLiers=r.length,e.push(a),(o=n[n.length-1])[p.colNm]>t.q3&&(r=n.filter(e=>e[p.colNm]>t.q3),o.outLiers=r.length,e.push(o))):a[p.colNm]>t.q3&&(n.length>1?e.push(n[n.length-1]):e.push(a),e[e.length-1].outLiers=n.length))}),d=0,i=e,n.outLierCaptionAllOk=!0}else s=L.radius,n.outLierCaptionAllOk=!1};L.onlyOutlier?u(L.onlyOutlier):!L.showDots||L.showDots>_.length?(i=_.map((t,e)=>{const o={...t};return o[p.colNm]=t[p.colNm],o.format=n.format,o._colNm=p.colNm,o._colCaption=p.caption,o._key=o._key+isNaN(p.colNm)?p.colNm:a.getClassPure(p.colNm),o._key+="_"+e,o}),s=L.radius,n.outLierCaptionAllOk=!1):u();r.selectAll(".dotPoint").data(i,t=>t._key).enter().append("circle").on("mouseover",nt).on("mousemove",rt).on("mouseleave",ot).attr("class",t=>"dotPoint key_"+t._key).attr("cx",t=>e(t[N.colNm])+d-(d?d/2+Math.random()*d:0)).attr("cy",t=>o(t[[t._colNm]])).attr("r",s).attr("stroke",L.stroke).attr("opacity",L.opacity).attr("fill",t=>{l=t[t._colNm];const e=_.find(e=>e[N.colNm]===t[N.colNm]);return l<e.qMin||l>e.qMax?L.outlierColor:T(l)})}(x,e,M,z)}function yt(){a.setTheme(n,t,!1),function(){if(n.preBuildData)s=s.map((t,e)=>{const a={[N.colNm]:t[N.colNm]};return H.forEach(e=>a[e.colNm]=+t[e.colNm]),a._key=e,n.key&&(a[n.key]=t[n.key]),a});else{const t=[...new Set(s.map(t=>t[N.colNm]))];let e;H&&H.length||(e={},H=t.map((a,o)=>(e[a]=n.aggSQL.toLowerCase(),"sum"!==e[a]&&(e[a]="avg"),{colNm:a,caption:t[o],format:",.0f",dFormat:",.2f",sFormat:".2s",aggSQL:e[a]}))),e||(e={},H=H.map(t=>(e[t.colNm]=n.aggSQL.toLowerCase(),"sum"!==e[t.colNm]&&(e[t.colNm]="avg"),{...t,aggSQL:e[t.colNm]}))),H.sort("desc"===A.sort?(t,e)=>d3.descending(t.caption,e.caption):(t,e)=>d3.ascending(t.caption,e.caption));let a,o=[];const r=d3.rollup(s,t=>t,t=>t[n.key],t=>t[N.colNm]),l=Array.from(r).map(t=>({data:Array.from(t[1]).map(t=>({...t[1],groupBy:t[0],aggSQL:e[t[0]]})),groupBy:t[0]}));l.forEach((t,e)=>{const r={[n.key]:t.groupBy};t.data.forEach(t=>{a=d3[t.aggSQL](Object.values(t).map(t=>+t[n.analysisColNm])),r[t.groupBy]=a}),r._key=e,o.push(r)}),s=o}s.length>n.maxRows&&(s=s.slice(0,n.maxRows-1),console.log(`결합한 데이터는 최대 ${n.maxRows.toLocaleString()}건 까지 하용되며, 그 이상은 무시됩니다.`))}(),n.data=s;const e=H.length;b=Math.min(0===b?1e6:b,e*n.minSize),n.height=b,R=(b-n.margin.left-n.margin.right)/e,W=(V=R-E)-G;const o=H.map(t=>t.colNm);F.domain(o).range([0,V*e]),I.domain(o),Y=V*(e>A.growCnt?e/A.growCnt:1),b+=Y+E}return o.render=function(){return l||(l=d3.select(t).append("svg").attr("class","c2iCorrMixUi").attr("width",b).attr("height",n.height).attr("viewBox",[0,0,b,n.height]).style("background",n.theme?n.theme:null)).append("style").text("circle.hidden { fill: #999; fill-opacity: 0.9; r: 0.8px; }"),function(){if(!i){i=l.append("g").attr("class","body").attr("transform","translate("+n.margin.left+","+n.margin.top+")");const t=d3.range(H.length),e=t.length-1;if(D.isBrush)O=d3.cross(t,t).filter(t=>t[0]!==t[1]),function(){const t=H.map(t=>(t=>d3.scaleLinear().domain(d3.extent(n.data,e=>e[t.colNm])).nice().rangeRound([G,W]))(t)),e=t.map(t=>t.copy().range([W,G]));I.domain(n.data.map(t=>t[N.colNm]));const o=d3.axisBottom().ticks(D.ticks).tickSize(D.tickSize),r=d3.axisLeft().ticks(D.ticks).tickSize(D.tickSize);let l,s,c,d,u;i.append("g").attr("class","xAxisTop").call(e=>e.selectAll("g.xAxisTop").data(t.filter((e,a)=>a<t.length-1)).join("g").attr("transform",(t,e)=>`translate(${e*V},${V*H.length-G})`).each(function(t,e){const a=d3.format(t.domain()[1]<=n.baseVal?H[e].format:H[e].sFormat);return d3.select(this).call(o.scale(t).tickFormat(a))})).selectAll(".domain").remove(),i.append("g").attr("class","yAxisTop").call(t=>t.selectAll("g.yAxisTop").data(e.filter((t,e)=>e>0)).join("g").attr("transform",(t,e)=>`translate(${G},${(e+1)*V})`).each(function(t,e){const a=d3.format(t.domain()[1]<=n.baseVal?H[e].format:H[e].sFormat);return d3.select(this).call(r.scale(t).tickFormat(a))})).selectAll(".domain").remove(),i.append("g").attr("class","xAxisBottom").call(e=>e.selectAll("g.xAxisBottom").data(t.filter((t,e)=>e>0)).join("g").attr("transform",(t,e)=>`translate(${e*V+V},${W})`).each(function(t){return d3.select(this).call(o.scale(t))})).selectAll(".domain").remove(),i.append("g").attr("class","yAxisBottom").call(t=>t.selectAll("g.yAxisBottom").data(e.filter((t,a)=>a<e.length-1)).join("g").attr("transform",(t,e)=>`translate(${V*(H.length-1)+G},${e*V})`).each(function(t){return d3.select(this).call(r.scale(t))})).selectAll(".domain").remove(),(v=i.append("g").attr("class","c2iScatters").selectAll("g").data(O).join("g").attr("transform",([t,e])=>`translate(${t*V},${e*V})`)).append("line").attr("stroke","#aaa").attr("stroke-width",.5).attr("x1",G+.5).attr("y1",W).attr("x2",W).attr("y2",W),v.append("line").attr("stroke","#aaa").attr("stroke-width",.5).attr("x1",G+.5).attr("y1",G+.5).attr("x2",G+.5).attr("y2",W),v.each(function([o,r]){const i=n.data.filter(t=>!isNaN(t[H[o].colNm])&&!isNaN(t[H[r].colNm]));d3.select(this).attr("class","scatter c_"+`${r}_${o}`).selectAll("circle").data(i).join("circle").style("pointer-events","none").attr("class",t=>`dots c_${t._key}`).attr("cx",e=>P(t,e,o)).attr("cy",t=>P(e,t,r)).attr("r",D.radius).attr("opacity",D.opacity).attr("fill",t=>I(t[N.colNm])),c=d3.select(this),d=t[o],u=e[r],m=H[o],p=H[r],l=d3.format(m.format),s=d3.format(p.format),S.isDraw&&(pt(l,s,i),function(){const t=_.filter(t=>"line"===t.type).map(t=>{const e=d3.format(t.value.yFmt),a=e(t.value.slope)+"x + "+e(t.value.intercept);return{groupBy:t.groupBy,caption:t.caption,x1:t.data[0].x,y1:t.data[0].y,x2:t.data[1].x,y2:t.data[1].y,exceptZero:S.exceptZero,coVariance:t.coVariance,corrCoeff:t.corrCoeff,spearmanCoeff:t.spearmanCoeff,equation:a,rSquare:e(t.value.rSquare)}}),e=t[t.length-1];if(isNaN(e.x1)||isNaN(e.x2)||isNaN(e.y1)||isNaN(e.y2))return void console.log("데이터가 추세선등을 유추하기에 부적합니다.");c.append("g").attr("class","trendLines").selectAll(".trendLines>line").data(t,t=>t._key).join("line").style("pointer-events","none").attr("x1",t=>d(t.x1)).attr("y1",t=>u(t.y1)).attr("x2",t=>d(t.x2)).attr("y2",t=>u(t.y2)).attr("opacity",S.opacity).attr("stroke-width",t=>"_All_"===t.groupBy?S.allStrokeWidth[0]:S.allStrokeWidth[1]).attr("stroke",t=>"_All_"===t.groupBy?S.allStroke:I(t.groupBy));const o=[];t.forEach(t=>{let e={...t};e.x=t.x1,e.y=t.y1,o.push(e),(e={...e}).x=t.x2,e.y=t.y2,o.push(e)}),c.append("g").attr("class","trendLineDots").selectAll(".trendLineDots>circle").data(o).join("circle").style("pointer-events","none").attr("cx",t=>d(t.x)).attr("cy",t=>u(t.y)).attr("r",S.dotRadius).attr("opacity",S.opacity).attr("stroke",S.dotStroke).attr("stroke-width",S.dotStroke).attr("fill",t=>"_All_"===t.groupBy?S.allStroke:I(t.groupBy));const n=S.meanMedian;c.append("g").attr("class","meanMedianDots").selectAll(".meanMedianDots>path").data(_.filter(t=>"circle"===t.type)).join("path").style("pointer-events","none").attr("d",t=>d3.symbol().type(a.symbols["mean"===t.method?n.symbol[0]:n.symbol[1]]).size(30*("mean"===t.method?3:4))()).attr("transform",t=>`translate(${d(t.x)},${u(t.y)})`).attr("stroke",t=>"_All_"===t.groupBy?S.allStroke:I(t.groupBy)).attr("stroke-width",S.dotStroke).attr("fill",t=>"mean"===t.method?n.fill[0]:n.fill[1])}())});const g=v.selectAll("circle");v.call(function(a,o,r){let l;x=d3.brush().extent([[G,G],[W,W]]).on("start.chart",function(){l!==this&&(d3.select(l).call(x.move,null),l=this)}).on("brush.chart",function({selection:a},[l,i]){let s=[];if(a){const[[r,c],[d,u]]=a;o.classed("hidden",a=>r>P(t,a,l)||d<P(t,a,l)||c>P(e,a,i)||u<P(e,a,i)),s=n.data.filter(a=>r<=P(t,a,l)&&d>=P(t,a,l)&&c<=P(e,a,i)&&u>=P(e,a,i))}r.property("value",s).dispatch("input")}).on("end.chart",function({selection:t}){if(t)return;r.property("value",[]).dispatch("input"),o.classed("hidden",!1)}),a.call(x)},g,i),i.property("value",[])}(),(O=d3.cross(t,t).filter(t=>t[0]===t[1])).forEach((t,a)=>{m=H[a],p=H[a],ut(`cls_${a}_${a}`),m=H[e],p=H[a],ht(`cls_${a}_bp`)});else{let a,o;for(d in t){for(u in o=`cls_${d}_`,t)m=H[d],p=H[u],a=o+u,d===u?ut(a):mt(a,u);m=H[e],p=H[d],ht(a+"bp")}}i.selectAll(".domain").attr("stroke-width",.5).attr("stroke","#ccc"),i.selectAll(".tick>line").attr("stroke-width",.5).attr("stroke","#ccc"),i.selectAll(".tick>text").attr("fill","#ccc")}}(),o},o.clear=function(){return l&&(l.remove(),l=i=void 0),o},o.isBrush=function(t){return arguments.length?(n.scatter.isBrush=t,l&&(l.remove(),l=i=v=x=void 0),o):n.scatter.isBrush},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(t){return arguments.length?(s=t,yt(),o):n.data},o.getConfig=function(){return n.measure=void 0,n.measures.forEach(function(t,e){t.draw&&!n.measure&&(n.measure=t),t.__id=e}),n.measure||(n.measure=n.measures[0]),n.pieceColors=I.range(),n.keyCol="colNm",n.lgData=!0,n.c2iCon=t,n},o.exportData=function(t,e){const o=n.title&&n.title.caption?n.title.caption:"",r=[],l=[];let i;e||(r.push(n.groupBy.colNm+","),(i=n.groupBy.caption?n.groupBy.caption:n.groupBy.colNm).search(/["|,|\n]/g)>=0?l.push('"'+i+'",'):l.push(i+","),n.measures.forEach(function(t){t.caption.search(/["|,|\n]/g)>=0?l.push('"'+t.caption+'",'):l.push(t.caption+","),r.push(t.colNm+",")})),a.exportData(o,r,l,n.data,t)},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),k=c2i.lang,o):n.lang},a.rebind(o,n)},c2i.ui.patternDraw=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;const o={},n={grid:{row:10,col:10},rect:{width:12,height:12,bColor:"#005a5a",opacity:.75},data:void 0,method:{onApply:void 0}};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;let r,l,i,s=n.grid.row,c=n.grid.col,d=c2i.lang,u=n.rect.width,m=n.rect.height;const p=d3.drag().on("start",function(t){const e=t.sourceEvent;e.stopPropagation(),l=parseFloat(d3.select(this).style("left"))-e.pageX,i=parseFloat(d3.select(this).style("top"))-e.pageY}).on("drag",function(t){const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",function(){return e.pageX+l+"px"}).style("top",function(){return e.pageY+i+"px"})}).on("end",function(){d3.select(this).style("opacity",.9)});function g(){let t=[],e=1,a=27,o=u,r=m;n.data&&n.data.length>0?(s=n.data.length,c=n.data[0].length):n.data=[];for(var l=0;l<s;l++){t.push([]);for(var i=0;i<c;i++){var d={x:e,y:a,width:o,height:r,selected:n.data.length?n.data[l][i]:0};t[l].push(d),e+=o}e=1,a+=r}n.data=t}return n.data&&n.data.length>0&&g(),o.render=function(){let e,a=c*u;n.rect.baseColor=n.rect.baseColor?n.rect.baseColor:"#fdf",r||(r=d3.select("body").select(t).call(p).attr("id",t.substr(1)).style("cursor","move").style("opacity",.9),n.data||g());const l=r.append("svg").attr("width",a+"px").attr("height",s*m+55+"px"),i=l.selectAll(".c2iNoSelect").data([{x:1,y:5,width:a/2,color:"#797979",caption:d.gen.clear},{x:a/2+1,y:5,width:a/2,color:"#3e3e3e",caption:d.gen.hide},{x:1,y:27+s*m,width:a,color:"#3e3e3e",caption:d.gen.applyPattern}]).enter().append("g").attr("class","c2iNoSelect command");i.append("rect").on("click",function(t,e){switch(e.caption){case d.gen.applyPattern:!function(){let t=!1;n.data.some(function(e){if(e.some(function(e){if(e.selected)return t=!0}),t){if(n.method.onApply){const t=[];n.data.forEach(function(e){const a=[];e.forEach(function(t){a.push(t.selected?1:0)}),t.push(a)}),n.method.onApply(t)}else console.log(d.cm.onApply);return t}})}();break;case d.gen.clear:n.data.forEach(function(t){t.forEach(function(t){t.selected=0})}),f.data(n.data).selectAll(".col").style("fill",n.rect.baseColor);break;default:o.hideShow()}}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",22).style("cursor","default").style("stroke",function(t){return t.color}).style("fill",function(t){return t.color}),i.append("text").attr("x",function(t){return t.x+t.width/2}).attr("y",function(t){return t.y+15}).attr("font-size","10px").attr("fill","white").style("text-anchor","middle").style("pointer-events","none").text(function(t){return t.caption});const f=l.selectAll(".row").data(n.data).enter().append("g").attr("class","row").style("shape-rendering","crispEdges");return f.selectAll(".col").data(function(t){return t}).enter().append("rect").attr("class","col").style("cursor","pointer").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).style("fill",function(t){return t.selected?n.rect.bColor:n.rect.baseColor}).style("fill-opacity",n.rect.opacity).style("stroke","#222").on("mousedown",function(t,a){(e=!e)&&(a.selected=!a.selected,d3.select(this).style("fill",a.selected?n.rect.bColor:n.rect.baseColor))}).on("mouseenter",function(t,a){e&&(a.selected=!a.selected,d3.select(this).style("fill",a.selected?n.rect.bColor:n.rect.baseColor))}),o},o.clear=function(){return r&&(r.remove(),r=void 0),o},o.data=function(t){return arguments.length?(n.data=t,g(),o):n.data},o.hideShow=function(t){return void 0===t&&(t=!r.classed("c2iHidden")),r.classed("c2iHidden",t),o},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.setLang(n),d=c2i.lang,o):n.lang},a.createAccessor(o,n)},c2i.chart.pCoord=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;let o={},n={isResponsive:!1,width:"100%",margin:{top:30,left:30,right:30,bottom:30},aspectRatio:"1:1",easing:"linear",duration:300,cutLength:12,data:void 0,title:void 0,foreground:void 0,background:void 0,summary:void 0,grid:void 0,measures:void 0,legend:void 0,isDev:void 0};e.method=e.method||{},a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;let r=["Tab10","Cat10","Accent","Dark2","Paired","Pastel1","Pastel2"];r=r.concat("Set1","Set2","Set3");const l=d3.select(t),s=(t,e)=>{const a=z(t);return e?a.formatAvg:a.format};let c,d,u,m,p,g,f=a.computeDim(l,n),h=c2i.lang,y=[];const _={sum:h.cm.sum,avg:h.cm.avg,count:h.cm.count,min:h.cm.min,max:h.cm.max};let x,v,b,k,C,w,N,A=[],L=[],D=[],S={},T={},M=!1,F=!1,I="steelblue";const B=d3.scalePoint(),E=d3.line(),G=d3.axisLeft(),P=d3.axisRight(),O=d3.scaleOrdinal(),R=d3.scaleOrdinal();function V(){d||(d=c.append("g").attr("class","body").attr("transform","translate("+J()+","+n.margin.top+")"),n.grid&&n.grid.id&&(p=d3.select(n.grid.id))),S={};const e=n.foreground,l=n.background;function i(t){const e=T[t];return void 0!==e?e:B(t)}function u(t){return t.transition().duration(n.duration).ease(a.ease[n.easing])}function m(t){return E.curve(a.curve[e.curve])(A.map(e=>[i(e),v[e](t[e])]))}!function(){let t=n.data.length;n.measures.forEach(a=>{const o=a.colNm;if(a.draw){let r;const l=d3.extent(n.data,t=>t[o]);if(v?r=v[o]&&v[o].brush?v[o].brush:void 0:v={},"point"===a.scale){let r=[];switch(a.sort){case"asc":r=n.data.map(t=>t[o]).sort();break;case"desc":r=n.data.map(t=>t[o]).sort((t,e)=>e-t?1:-1);break;default:r=n.data.map(t=>t[o])}if(v[o]=d3.scalePoint().domain(r).rangeRound([ot(),0]),e.keyColNm!==o){const e=n.data.map(t=>t[o]);t=e.filter(X).length}S[o]={sum:0,avg:0,count:t,min:0,max:0}}else{switch(a.scale){case"linear":v[o]=d3.scaleLinear();break;case"sqrt":v[o]=d3.scaleSqrt();break;default:v[o]=d3.scaleLog()}v[o].domain([l[0]*(l[0]>0?.99:1.01),l[1]*(l[1]>0?1.01:.99)]).range([ot(),0]).clamp(!0);let e=0;n.data.forEach(t=>{e+=t[o]}),S[o]={sum:e,avg:e/t,count:t,min:l[0],max:l[1]}}-1===A.indexOf(o)&&A.push(o),r&&(v[o].brush=r)}else A.indexOf(o)>-1&&(A.splice(A.indexOf(o),1),v[o]&&delete v[o])}),B.domain(A).rangeRound([0,at()])}(),function(){if(!n.background.draw)return;b||(b=d.append("g").attr("class","background"));const t=b.selectAll("path").data(n.data,t=>t.__id);t.enter().append("path").style("fill","none").style("stroke",l.color).style("stroke-width",e.strokeWidth+"px").style("stroke-opacity",l.opacity).merge(t).attr("d",m)}(),function(){if(!k){let t;t=r.indexOf(e.color)>-1?a.getColorScheme(e.color):d3.scaleOrdinal().range(e.color).range(),C=d3.scaleOrdinal().domain(n.data.map(t=>t[e.keyColNm])).range(t),k=d.append("g").attr("class","foreground")}const o=k.selectAll("path").data(n.data,t=>t.__id);o.enter().append("path").on("mouseenter",function(a,o){if(F)return;k.selectAll("path").style("stroke-opacity",e.opacity/4),d3.select(this).style("stroke-width","5px").style("stroke-dasharray",5).style("stroke-opacity",1);let r=".tick text";M&&(r+=".fd"),d.select(".dim."+e.keyColNm).selectAll(r).style("fill-opacity",.1),r=d3.select(this).attr("class").split(" ")[0],d.select("."+e.keyColNm+" .tick ."+r).style("font-size","12px").style("fill-opacity",1),W(o),n.method.mouseenter&&n.method.mouseenter(a,{container:t,selector:"pCoord"},o)}).on("mouseleave",function(a,o){if(F)return;k.selectAll("path").style("stroke-opacity",e.opacity),d3.select(this).style("stroke-width",e.strokeWidth+"px").style("stroke-dasharray",null);let r=".tick text";M&&(r+=".fd"),d.select(".dim."+e.keyColNm).selectAll(r).style("fill-opacity",1),r=d3.select(this).attr("class").split(" ")[0],d.select("."+e.keyColNm+" .tick ."+r).style("font-size",e.tickFonts[3]),n.method.mouseleave&&n.method.mouseleave(a,{container:t,selector:"pCoord"},o)}).attr("class",t=>a.getClassName("",t[e.keyColNm])+" _selected_").style("fill","none").style("stroke-opacity",e.opacity).style("stroke-width",e.strokeWidth+"px").style("stroke",t=>C(t[e.keyColNm])).merge(o).attr("d",m)}(),function(){(x=d.selectAll(".dim").data(A,t=>t)).exit().remove();const o=x.enter().append("g").attr("class",t=>"dim "+t).call(d3.drag().subject(t=>({x:B(t)})).on("start",(t,e)=>{T[e]=B(e),b&&b.attr("visibility","hidden")}).on("drag",function(t,e){T[e]=Math.min(at(),Math.max(0,t.x)),k.selectAll("path").attr("d",m),A.sort((t,e)=>i(t)-i(e)),B.domain(A),x.attr("transform",t=>"translate("+i(t)+")")}).on("end",function(t,e){delete T[e],u(d3.select(this)).attr("transform","translate("+B(e)+")"),u(k.selectAll("path")).attr("d",m),b&&b.selectAll("path").attr("d",m).attr("visibility",null)})),r=o.append("g").attr("class","axis").each(function(o,r){const l=this,i=o===e.keyColNm?3:1;c(l,o,r),d3.select(l).select(".domain").style("stroke-width","1px").style("stroke",I||O(o)).style("fill","none").style("shape-rendering","crispEdges"),d3.select(l).selectAll("line").style("stroke-width","1px").style("stroke",I||O(o)),d3.select(l).selectAll(".tick text").on("click",(e,a)=>{F||n.method.click&&n.method.click(e,{container:t,selector:"pCoord"},a)}).on("mouseenter",function(r,i){if(F)return;const s=z(o);let c=!0;if((o===e.keyColNm||"point"===s.scale)&&(M?d3.select(this).attr("class").indexOf("fd")>-1?d3.select(this).style("font-size","12px"):c=!1:(d3.select(l).selectAll(".tick text").style("fill-opacity",.3),d3.select(this).style("font-size","12px").style("fill-opacity",1)),c)){d.selectAll("path."+a.getClassName("",i)).style("stroke-width","5px").style("stroke-dasharray",5);const t=n.data.filter(t=>t[o]===i);W(t[0])}n.method.mouseenter&&n.method.mouseenter(r,{container:t,selector:"pCoord"},i)}).on("mouseleave",function(r,i){if(F)return;const s=z(o);let c=!0;o!==e.keyColNm&&"point"!==s.scale||(M?d3.select(this).attr("class").indexOf("fd")>-1?d3.select(this).style("font-size",e.tickFonts[3]):c=!1:(d3.select(l).selectAll(".tick text").style("fill-opacity",1),d3.select(this).style("font-size",e.tickFonts[3])),c&&d.selectAll("path."+a.getClassName("",i)).style("stroke-width",e.strokeWidth+"px").style("stroke-dasharray",null)),n.method.mouseleave&&n.method.mouseleave(r,{container:t,selector:"pCoord"},i)}).attr("class",t=>o===e.keyColNm?a.getClassName("",t):null).style("font-family",e.tickFonts[0]).style("font-size",e.tickFonts[i]).style("fill",e.tickFonts[2]).style("cursor",o===e.keyColNm?"pointer":"default").style("pointer-events",o===e.keyColNm?"all":"none").text(t=>t&&t.length>n.cutLength?t.substr(0,n.cutLength):t),d3.select(l).selectAll(".tick text").append("title").text(t=>t&&t.length>n.cutLength?t:null)});r.append("text").attr("class","dimNm").style("font-family",e.fonts[0]).style("font-size",e.fonts[1]).style("fill",t=>I||O(t)).style("text-anchor",e.xLabel.anchor?e.xLabel.anchor:"middle").style("cursor","move").attr("x",e.xLabel.dx).attr("y",e.xLabel.dy).text(t=>{const e=z(t).caption;return e.length>n.cutLength?e.substr(0,n.cutLength):e}).attr("transform","rotate("+e.xLabel.rotate+")"),r.append("title").attr("class","dimNmTitle").text(t=>{const e=z(t).caption;return e.length>14?e:null});const l=o.append("g").attr("class","brush").each(function(t){v[t].brush=d3.brushY().extent([[-10,0],[10,ot()]]).on("start",H).on("brush",$).on("end",$),d3.select(this).call(v[t].brush)});l.selectAll("rect").attr("x",-e.brush.width/2).attr("width",e.brush.width),l.selectAll(".selection").style("fill",e.brush.color[0]).style("stroke",e.brush.color[0]).style("fill-opacity",.3),l.selectAll(".handle").style("fill",e.brush.color[1]).style("stroke",e.brush.color[1]).style("fill-opacity",.3),(x=o.merge(x)).attr("transform",t=>"translate("+B(t)+")"),x.selectAll(".brush").each(function(t){const e=v[t];e.brush?e.brush.extent([[-10,0],[10,ot()]]):e.brush=d3.brushY().extent([[-10,0],[10,ot()]]).on("start",H).on("brush",$).on("end",$),n.resizing&&d3.select(this).call(e.brush)}),n.resizing&&(x.each(function(t,e){c(this,t,e)}),console.log(">> D3 문제로 브러시 및 축 값의 표현 오류 발생할 경우, \n\t다시 브러싱 또는 더블클릭으로 해결하세요.!"));function c(t,a,o){if(v[a].range()[0]===v[a].range()[1])return;let n,r;if(0===o)n="left";else{z(a);n="left"}(r="left"===n?G:P).scale(v[a]).ticks(e.ticks,s(a)),d3.select(t).call(r),d3.select(t.parentNode).attr("orient",n)}!function(){const t=n.summary;if(t&&t.isShow){const a=_[t.type],n=ot()+1.5*Math.abs(e.xLabel.dy),r=o.append("g").attr("class","axisAgg").append("text").style("text-anchor","middle").style("cursor","move").style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).style("fill",t.fonts[2]);r.append("tspan").attr("data-c2i18n",e=>y.indexOf(e)>-1?"cm.count":"cm."+t.type).attr("class","aggValue").text(e=>{if(y.indexOf(e)>-1)return S[e]?_.count+": "+d3.format(",.0f")(S[e].count):"";{const o="count"===t.type?",.0f":s(e,"avg"===t.type);return S[e]?a+": "+d3.format(o)(S[e][t.type]):""}}),r.append("tspan").attr("data-c2i18n","gen.value").attr("class","currentValue").attr("x",0).attr("dy",t.dy).text(h.gen.value+"?"),r.append("tspan").attr("data-c2i18n","gen.ratio").attr("class","diffRatio").attr("x",0).attr("dy",t.dy).text(h.gen.ratio+"?"),w=x.selectAll(".axisAgg").attr("transform","translate(0,"+n+")")}}()}(),p&&n.grid.draw&&(p.isCsv?o.selectedData=n.data.slice(0,g):p.text(d3.tsvFormat(n.data.slice(0,g)))),n.method.mouseenter&&n.method.mouseenter({container:t,selector:"pCoord"},n.data.slice(0,g))}function W(t){w.selectAll("tspan.currentValue").text(e=>{const a=s(e);return y.indexOf(e)>-1?t[e]:d3.format(a)(t[e])}),N=t,Y()}function Y(){const t=n.summary;w.selectAll("tspan.diffRatio").text(e=>y.indexOf(e)>-1||0===Object.keys(S).length||!N?"":0===S[e][t.type]?0:d3.format(",.1%")(N[e]/S[e][t.type])).style("fill",e=>0!==Object.keys(S).length&&N?N[e]/S[e][t.type]>1?t.resultColor[1]:t.resultColor[0]:"")}function z(t){let e;return n.measures.some(a=>{if(a.colNm===t)return e=a,!0}),e||console.error(a.templateFormat(h.cm.nonExistMeasure,t)),e}function H(t,e){F=!0,v[e]&&v[e].brush&&(v[e].brush.extentSave=void 0),t.sourceEvent&&t.sourceEvent.stopPropagation()}function $(t,e){let a,r=[],l=[];const i=n.foreground;x.selectAll(".brush").filter(function(t){return t===e?a=d3.brushSelection(this):d3.brushSelection(this)}).each(function(t){const e=z(t),o=v[t];if(a=d3.brushSelection(this),o.brush.extentSave=a,"point"!==e.scale)o.brush.extentSave=[o.invert(a[0]),o.invert(a[1])];else{const t=new Array(2);t[0]=o.domain()[a[0]/o.step()],t[1]=o.domain()[a[1]/o.step()],o.brush.extentSave=t}r.push({dimension:t,extent:a})}),k.selectAll("path").style("display",function(t){const e=r.every((e,a)=>{const o=e.dimension,n=v[o](t[o]);return y.indexOf(o),e.extent[0]<=n&&n<=e.extent[1]})?null:"none";return d3.select(this).classed("_selected_",!e),e||l.push(t[i.keyColNm]),e});const c=d.select(".dim."+i.keyColNm).selectAll(".axis .tick text");if(l.length?c.classed("fd",t=>l.indexOf(t)>-1).style("fill-opacity",t=>l.indexOf(t)>-1?i.opacity:0):c.classed("fd",!1).style("fill-opacity",0),M=!!r.length,w&&function(){const t=d.selectAll("._selected_").data();S={},t.length&&Object.keys(t[0]).filter(t=>"__id"!==t).forEach(e=>{let a=t.length;if(-1===y.indexOf(e)){let o=0;t.forEach(t=>o+=t[e]);const n=d3.extent(t,t=>t[e]);S[e]={sum:o,avg:o/a,count:a,min:n[0],max:n[1]}}else if(y.indexOf(e)>-1){if(i.keyColNm!==e){const o=t.map(t=>t[e]);a=o.filter(X).length}S[e]={sum:0,avg:0,count:a,min:0,max:0}}});const e=n.summary,a=_[e.type];w.selectAll("tspan.aggValue").text(t=>{if(y.indexOf(t)>-1)return S[t]?_.count+": "+d3.format(",.0f")(S[t].count):"";{const o="count"===e.type?",.0f":s(t,"avg"===e.type);return S[t]?a+": "+d3.format(o)(S[t][e.type]):""}}),Y(),p&&n.grid.draw&&(p.isCsv?o.selectedData=n.data.slice(0,g):p.text(d3.tsvFormat(n.data.slice(0,g))))}(),n.foreground.brush.endFn){const t=d.selectAll("._selected_").data();n.foreground.brush.endFn(t)}F=!1}function X(t,e,a){return a.indexOf(t)===e}function q(){const t=n.foreground;if(!t.keyColNm)throw alert("*. Error: C2i Foreground-Key 미정의."),error;I=t.labelColor,t.color?Array.isArray(t.color)||-1===r.indexOf(t.color)&&(t.color="Tab10"):t.color="Tab10",t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.tickFonts&&4===t.tickFonts.length||(t.tickFonts=["helvetica","11px","dimgray","8px"]),t.opacity=void 0!==t.opacity?t.opacity:.7,t.curve=void 0!==t.curve?t.curve:"linear";const e=t.xLabel;void 0===e?t.xLabel={pos:"top",rotate:0,isVertical:!1,dy:-20}:(void 0===e.pos&&(e.pos="top"),void 0===e.rotate&&(e.rotate=0),void 0===e.dy&&(e.dy="top"===e.pos?-15:15)),t.ticks=void 0!==t.ticks?t.ticks:5;const a=t.brush;if(a){a.fonts&&3===a.fonts.length||(a.fonts=["helvetica","10px","red"]);const e=a.color;e&&Array.isArray(e)&&2===e.length||(a.color=["#ff4412","#f94943"]),t.width=void 0!==t.width?t.width:16}else t.brush={fonts:["helvetica","10px","red"],color:["#ff4412","#f94943"],width:16}}function U(){const t=n.background;t?(t.draw=void 0===t.draw||t.draw,t.opacity=void 0!==t.opacity?t.opacity:.5,t.color=t.color?t.color:"gray"):n.background={draw:!0,color:"gray",opacity:.5}}function j(){const t=n.summary;t?(t.pos=void 0!==t.pos?t.pos:"bottom",t.type=void 0!==t.type?t.type:"sum",t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","12px","#ff0"]),t.resultColor&&2===t.resultColor.length||(t.resultColor=["orange","steelblue"]),t.isShow=void 0===t.isShow||t.isShow):n.summary={pos:"bottom",type:"sum",fonts:["helvetica","12px","#ff0"],resultColor:["orange","steelblue"],isShow:!0}}function Z(){const t=n.grid;t?(t.rowsPerPage=void 0!==t.rowsPerPage?t.rowsPerPage:25,g="all"===t.rowsPerPage?n.data.length:t.rowsPerPage,t.draw=void 0===t.draw||t.draw):n.grid={draw:!1,rowsPerPage:25}}function Q(){const t=n.measures;D=[];for(let e=t.length-1;e>-1;e--)t[e].scale&&0!==t[e].scale.length||(t[e].scale="linear"),t[e].axisPos=void 0===t[e].axisPos?"left":t[e].axisPos,(void 0===t[e].draw||t[e].draw)&&(t[e].draw=!0,D.push(t[e].colNm)),void 0===t[e].color&&(t[e].color="steelblue");let e,o;if(n.yDim&&"each"!==n.yDim.color[0])for(e=a.getColorScheme(n.yDim.color[0]).range(),i=0,o=t.length;i<o;i++)"y"===t[i].yDim&&(t[i].color[0]=e[i%e.length],t[i].fonts[2]=a.invertColor(t[i].color),0);O.domain(t.map(t=>t.colNm)).range(t.map(t=>t.color)),R.domain(t.map(t=>t.colNm)).range(t.map(t=>t.fonts))}function K(){q(),U(),j(),Q(),function(){const t=n.legend;if(t){if(!t.id)return alert(h.cm.lg_2),!1;t.fonts=t.fonts?t.fonts:["helvetica","12px"],t.padding=t.padding?t.padding:"10px 10px 10px 10px",t.backColor=t.backColor?t.backColor:"",t.labelGap=t.labelGap?t.labelGap:"5px",t.itemGap=t.itemGap?t.itemGap:"10px"}else h&&console.log(h.cm.lg_1)}(),a.setTheme(n,t,!1),a.setTitle(n),y=[],u.forEach((t,e)=>{t.__id=e,n.measures.forEach(e=>{"point"!==e.scale?t[e.colNm]=+t[e.colNm]:-1===y.indexOf(e.colNm)&&y.push(e.colNm)})}),n.data=u,Z(),n.isDev&&a.devMode(n)}function J(){return n.margin.left}function tt(){return f-n.margin.right}function et(){return n.height-n.margin.bottom}function at(){return f-n.margin.left-n.margin.right}function ot(){return n.height-n.margin.top-n.margin.bottom}o.render=function(){return c||(c=d3.select(t).append("svg").on("dblclick",()=>{c.remove(),c=d=b=k=void 0,A=[],n.foreground.brush.endFn&&n.foreground.brush.endFn(n.data),o.render()}).attr("width",f).attr("height",n.height).style("background",n.theme?n.theme:null),a.renderTitle(n,c,f,J,tt,et),n.legend&&function(){const t=n.legend;if(!t)return;const e=[];n.measures.forEach(t=>e.push(t)),d3.select(t.id).selectAll(".c2iLgItem").remove();const a=d3.select(t.id).style("padding",t.padding).style("background",t.backColor&&"none"!==t.backColor?t.backColor:null);function r(e,r){n.measures.some(e=>{if(r.colNm===e.colNm)return e.draw=a.select(t.id+e.colNm).property("checked"),!0}),function(t,e){d3.select(t).property("checked")?D.push(e.colNm):D.splice(D.indexOf(e.colNm),1);o.renderFromLegend()}(e,r)}e.forEach(function(e){a.append("input").attr("id",t.id.substr(1)+e.colNm).attr("class","c2iLgItem").attr("type","checkbox").property("checked",e.draw).attr("value",e.colNm).style("margin-left",()=>t.itemGap).on("touchstart",function(t){t.preventDefault(),t.stopPropagation(),d3.select(this).property("checked",!d3.select(this).property("checked")),r(this,e)}).on("click",function(l){l.shiftKey?(d3.select(this).property("checked")?(D=[],n.measures.forEach(e=>{e.draw=!0,a.select(t.id+e.colNm).property("checked",!0),D.push(e.colNm)})):(n.measures.forEach(e=>{e.draw=!1,a.select(t.id+e.colNm).property("checked",!1)}),D=[]),o.renderFromLegend()):r(this,e)}),a.append("label").attr("class","c2iLgItem "+e.colNm).text(e.caption).style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).style("margin-left",t.labelGap).style("color",e.color)})}()),V(),o},o.renderFromLegend=function(){V()},o.selectedData=function(t){if(!arguments.length)return L;L=t},o.selectedMeasures=function(t){if(!arguments.length)return A;A=t},o.clear=function(){return c&&(c.remove(),c=d=void 0),o},o.config=function(t){return arguments.length?(a.init(n,t),a.locale(n),o):n},o.title=function(t){return arguments.length?(n.title=t,a.setTitle(n),o):n.title},o.foreground=function(t){return arguments.length?(n.foreground=t,q(),o):n.foreground},o.background=function(t){return arguments.length?(n.background=t,U(),o):n.background},o.summary=function(t){return arguments.length?(n.summary=t,j(),o):n.summary},o.grid=function(t){return arguments.length?(n.grid=t,Z(),o):n.grid},o.measures=function(t){return arguments.length?(n.measures=t,Q(),o):n.measures},o.theme=function(e){return arguments.length?(n.theme="base"===e?n.themeInit:e,a.setTheme(n,t,!0),o):n.theme},o.data=function(t){return arguments.length?(u=t,m=void 0,K(),o):n.data},o.exportData=((t,e)=>{const o=n.title&&n.title.caption?n.title.caption:"",r=[],l=[];e||n.measures.forEach(t=>{t.caption.search(/["|,|\n]/g)>=0?l.push('"'+t.caption+'",'):l.push(t.caption+","),r.push(t.colNm+",")}),a.exportData(o,r,l,u,t)}),o.getConfig=(()=>(n.measure=void 0,n.measures.forEach((t,e)=>{t.draw&&!n.measure&&(n.measure=t),t.__id=e}),n.measure||(n.measure=n.measures[0]),n.pieceColors=O.range(),n.keyCol="colNm",n.lgData=!0,n.c2iCon=t,n)),o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),h=c2i.lang,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,function(){c&&l.node().parentNode.clientWidth&&(n.nonComponent?f=l.node().parentNode.clientWidth:(f=parseInt(l.style("width"),10),n.height=parseInt(f/n.aspect)),c.attr("width",f).attr("height",n.height),a.renderTitle(n,c,f,J,tt,et),n.resizing=!0,o.render(),n.resizing=!1)},null),a.createAccessor(o,n)},c2i.bi.pyramid=function(c2iCon,options){"use strict";const _u=c2i.util;if(!_u.checkLicenseLocale(options))return!1;if(!_u.checkConfig(c2iCon,options))return!1;let chart={},cfg={isResponsive:!0,width:"100%",margin:{top:5,left:5,right:5,bottom:5},aspectRatio:"1:0.8",easing:"linear",duration:1e3,delay:150,data:void 0,preBuildData:!1,rawStructure:void 0,title:void 0,xDim:void 0,yDim:void 0,measures:void 0,legendId:void 0,tooltip:void 0,isDev:void 0};_u.init(cfg,options),cfg.themeInit=cfg.themeInit?cfg.themeInit:cfg.theme;const _c2iCon=d3.select(c2iCon),_oID="#c2iOption",_key=t=>t[_xColNm],_colorMeasure=d3.scaleOrdinal(),_fontsMeasure=d3.scaleOrdinal(),_txY=d3.scaleOrdinal(),_txY2=d3.scaleOrdinal();let _width=_u.computeDim(_c2iCon,cfg),_meta,_svg,_bodyG,_axesG,_yAxis,_y2Axis,_yAsisG,_y2AxisG,_rawData,_xValues,_tip,_tipFirst,_option,_xDragPos,_yDragPos,_selectedMeasures=[],_xTextWidth,_xAllWidth,_xChartlWidth,_xCaption,_xUnitNm,_xColNm,_xFormat,_xAxisPos,_xPos,_xDy,_xTicks,_xTickPad,_xIsShow,_xShowGrid,_xPad,_yCaption,_yUnitNm,_yUnitNm2,_yScale,_yFormat,_y2Format,_yAxisPos,_yDx,_yDy,_yTicks,_yIsShow,_yShowGrid,_yMinGap,_yMaxGap,_yBaseValue,_xScale="band",_xX,_yY,_avgLeft,_avgRight,mLeft,mRight,_mLeftBefore,_mRightBefore;const _dragHandle=d3.drag().on("start",__dragStart).on("drag",__dragMove).on("end",__dragEnd);function __dragStart(t){const e=t.sourceEvent;e.stopPropagation(),_xDragPos=parseFloat(d3.select(this).style("left"))-e.pageX,_yDragPos=parseFloat(d3.select(this).style("top"))-e.pageY,"c2iOption"!==this.id||d3.selectAll("#c2iColorPickerPop").empty()||d3.selectAll("#c2iColorPickerPop").remove()}function __dragMove(t){const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",()=>e.pageX+_xDragPos+"px").style("top",()=>e.pageY+_yDragPos+"px")}function __dragEnd(){d3.select(this).style("opacity","c2iOption"===this.id?cfg.optWin.opacity:cfg.tooltip.opacity)}let timeSec=500;function renderAxes(){_axesG?_yIsShow&&_renderUpdateAxis():(_axesG=_svg.append("g").attr("class","axes"),_yIsShow&&function(){var t=_xChartlWidth<200&&_yTicks>2?2:_yTicks;const e=_yShowGrid?-_contentH()+cfg.margin.top:0;_yY.range([_xChartlWidth,0]),_yAxis||(_yAxis="top"===_yAxisPos?d3.axisTop():d3.axisBottom()).tickPadding(6);_yAxis.scale(_yY).ticks(t,_yFormat).tickFormat(_u.formatAll(_yFormat,_yFormat,!1)).tickSize(e),_yAsisG=_axesG.append("g").attr("class","y axis").attr("transform","translate("+[_xStart(),_yStart()]+")").call(_yAxis),_yY.range([0,_xChartlWidth]),_y2Axis||(_y2Axis="top"===_yAxisPos?d3.axisTop():d3.axisBottom()).tickPadding(6);_y2Axis.scale(_yY).ticks(t,_yFormat).tickFormat(_u.formatAll(_yFormat,_yFormat,!1)).tickSize(e),_y2AxisG=_axesG.append("g").attr("class","y2 axis").attr("transform","translate("+[_xStart()+_xChartlWidth+_xAllWidth,_yStart()]+")").call(_y2Axis);var a=cfg.yDim;_yAsisG.selectAll(".y .tick > text").style("font-family",a.fonts[0]).style("font-size",a.fonts[1]).style("fill",a.fonts[2]),_y2AxisG.selectAll(".y2 .tick > text").style("font-family",a.fonts[0]).style("font-size",a.fonts[1]).style("fill",a.fonts[2])}(),_svg.selectAll(".axes .axis .domain").style("fill","none").style("stroke","dimgray").style("stroke-width","1px"),_svg.selectAll("g.tick line").style("stroke","dimgray").style("stroke-width","1px").style("stroke-opacity",".3"))}function _renderUpdateAxis(){const t=_yShowGrid?-_contentH()+cfg.margin.top:0,e=_xChartlWidth<200&&_yTicks>2?2:_yTicks;_yY.range([_xChartlWidth,0]),_yAxis.scale(_yY).ticks(e,_yFormat).tickSize(t),_yAsisG.transition().duration(cfg.duration).attr("transform","translate("+[_xStart(),_yStart()]+")").call(_yAxis),_yY.range([0,_xChartlWidth]),_y2Axis.scale(_yY).ticks(e,_yFormat).tickSize(t),_y2AxisG.transition().duration(cfg.duration).attr("transform","translate("+[_xStart()+_xChartlWidth+_xAllWidth,_yStart()]+")").call(_y2Axis)}function defineBodyClip(){let t=_svg.select("g.c2iDefs");t.empty()&&((t=_svg.append("g").attr("class","c2iDefs")).append("defs").attr("id",c2iCon.substr(1)+"_c2iGradBar"),t.append("defs").attr("id",c2iCon.substr(1)+"_c2iGradCircle"),t.append("defs").attr("id",c2iCon.substr(1)+"_c2iArrow"));let e=_svg.select("g.c2iTextures");e.empty()&&(e=_svg.append("g").attr("class","c2iTextures"));const a=_colorMeasure.range();_txY.range().forEach(function(t,o){t.fill&&t.fill(a[o]),t.stroke(a[o]),e.call(t)});let o=0;cfg.measures.forEach(function(t){"left"===t.yDim&&o++}),_txY2.range().forEach(function(t,n){t.fill&&t.fill(a[n+o]),t.stroke(a[n+o]),e.call(t)})}function _makeOptionView(){function __selectTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.options&&Array.isArray(t.options)&&t.options.forEach(function(t){t.label&&(t.c2i18n=[t.label],t.label=___translate2(t.label,0))})}function __buttonTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.label&&(t.c2i18n=[t.label],t.label=___translate2(t.label,0))}function __divTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.labels&&Array.isArray(t.labels)&&t.labels.forEach(function(t){t.label&&(t.c2i18n=[t.label],t.label=___translate2(t.label,0)),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0))})}_meta||(_meta=_u.deepClone(c2i.meta.pyramid),_meta.title=___translate2(_meta.title,0),_meta.data.forEach(function(t){switch(t.type){case"select":__selectTrans(t);break;case"button":__buttonTrans(t);break;default:__divTrans(t)}})),d3.select(_oID).remove(),d3.select("body").append("div").attr("id",_oID.substr(1)).attr("class","c2iOption");var table=d3.select(_oID).call(_dragHandle).append("table").style("width",cfg.optWin.width?cfg.optWin.width:"300px"),theadTr=table.append("thead").style("cursor","move").append("tr").append("th").attr("colspan",3).attr("class","tipHeader"),tbody=table.append("tbody"),bodyTrs,trTds,options,method,func,tmp;theadTr.append("div").attr("class","c2iCloseBtn").attr("data-c2i18n","gen.closeX,gen.close").attr("title",function(){return ___translate(this,1)}).text(function(){return ___translate(this,0)}).on("click",function(){d3.select(_oID).classed("c2iHidden",!0)}),theadTr.append("div").append("p").append("strong").append("span").attr("id","optionName").attr("data-c2i18n","std.title").html(_meta.title);var nodes=[],realNodes=[],data,isPlaceEmpty=d3.selectAll(".c2iPlace").empty();function ___translate2(t,e){if(t.indexOf(",")>-1)t=t.split(",");else{if(e>0)return null;t=[t]}return t[e].indexOf(".")>-1?(t=t[e].split("."),c2i.lang[t[0]][t[1]]):c2i.lang.pyramid[t[e]]}function ___translate(t,e){var a=d3.select(t).attr("data-c2i18n");return a?___translate2(a,e):null}function ___bodyTrs_trTds(t){bodyTrs=tbody.selectAll("tr."+t.node+t.seq).data(data.filter(function(e){return e.type===t.node&&e.seq===t.seq})),(trTds=bodyTrs.enter().append("tr").attr("class",function(e){return e.dev?t.node+t.seq+" isDev":t.node+t.seq})).append("td").attr("class","caption").attr("data-c2i18n",function(t){return t.c2i18n}).attr("title",function(){return ___translate(this,1)}).text(function(){return ___translate(this,0)})}function __renderSelect(d0){___bodyTrs_trTds(d0);var select=trTds.append("td").append(d0.node).attr("id",t=>t.id).attr("class",t=>t.cls);if(d0.method&&2===d0.method.length&&(method=d0.method[0],func=eval(d0.method[1]),select.on(method,func)),options=select.selectAll("option").data(function(t){return t.options.filter(function(t){return void 0===t.group||t.group===cfg.groupType})}),options.enter().append("option").property("disabled",t=>t.separator?"disabled":null).attr("data-c2i18n",t=>t.c2i18n).attr("data-group",t=>t.group).attr("value",t=>t.value).property("selected",function(t){switch(d0.id){case"tooltipMag":return function(){var e=cfg.tooltip;if(e&&!e.isShow&&"x"===t.value)return"selected";if(e&&e.isUserTip&&"false"===t.value)return"selected";if(e&&e.infoLevel.toString()===t.value)return"selected";return null}();case"changeTheme":return cfg.theme===t.value?"selected":null}}).html(function(t){if(!t.separator)return t.c2i18n&&d3.select(this).attr("data-c2i18n",t.c2i18n),t.label;for(var e="",a=0;a<t.length;a++)e+=c2i.meta.separator[t.idx];return e}),"object"==typeof d0.dynamic&&d0.options.length>0){var btn=trTds.append("td").append(d0.dynamic.type).attr("id",d0.dynamic.id).attr("class",d0.dynamic.cls).attr("data-c2i18n",d0.dynamic.caption).text(___translate2(d0.dynamic.caption,0));method=d0.dynamic.method[0],func=eval(d0.dynamic.method[1]),btn.on(method,func)}}function __renderButton(d0){___bodyTrs_trTds(d0);var btn=trTds.append("td").append(d0.node).attr("id",function(t){return t.id}).attr("class",function(t){return t.cls}).attr("data-c2i18n",function(t){return t.c2i18n}).text(function(){return ___translate(this,0)});method=d0.method[0],func=eval(d0.method[1]),btn.on(method,func)}function __renderDiv(d0){___bodyTrs_trTds(d0);var div=trTds.append("td").append(d0.node).attr("class",function(t){return t.cls});d0.labels.forEach(function(t){div.append("input").attr("id",t.input.id).attr("class",t.input.cls?t.input.cls:null).attr("type",t.input.type).attr("name",t.input.name).attr("value",t.input.value).property("disabled",function(e){switch(t.input.id){case"tipFixed":return!cfg.tooltip}}).property("checked",function(){if("yScale"===t.input.name)return cfg.yDim.scale===t.input.value?"checked":null;switch(t.input.id){case"scaleAuto":return cfg.scaleAuto?"checked":null;case"plotLines":return function(){var t=cfg.yDim.plotLines;if(Array.isArray(t)&&t.length>0){var e=!0;return t.some(function(t){if(!1===t.draw)return e=!1,!0}),e}return null}();case"tipFixed":return cfg.tooltip&&cfg.tooltip.fixedPos?"checked":null}}),div.append("label").style("text-decoration",function(){if("plotLines"===t.input.id){var e=cfg.yDim.plotLines;return!Array.isArray(e)||e.length<1?(d3.select(this).style("color","red"),"line-through"):null}}).attr("for",t.input.id).attr("class",t.cls?t.cls:null).attr("data-c2i18n",t.c2i18n).attr("title",t.title).text(t.label)}),method=d0.method[0],func=eval(d0.method[1]),d3.selectAll(d0.method[2]).on(method,func)}function ___plotLines(){var t=this;cfg.yDim.plotLines.forEach(function(e){e.draw=t.checked}),chart.yDim(cfg.yDim).render()}function _yScaleChange_(){cfg.yDim.scale=this.value,chart.yDim(cfg.yDim).render()}function ___tooltipMagChange(){var t=cfg.tooltip;void 0!==t?("0"===this.value||"1"===this.value?(t.isShow=!0,t.infoLevel=+this.value,t.isUserTip=!1):"false"===this.value?(t.isShow=!0,t.isUserTip=!0):(t.isShow=!1,_tip.classed("c2iHidden",!0)),chart.tooltip(t)):alert(c2i.lang.cm.tipNo)}function ___tipFixed(){chart.tipFixed(this.checked)}function ___changeTheme(){chart.theme(this.value)}function ___exportImage(){_u.exportImage(c2iCon)}cfg.isDev&&!0===cfg.isDev?(data=_meta.data,_u.makeJson(data)):data=_meta.data.filter(function(t){return void 0===t.dev||!0!==t.dev}),data.forEach(function(t,e){if(t.seq=e,-1===nodes.indexOf(t.type+"_"+e)){nodes.push(t.type+"_"+e);var a=t;a.node=t.type,a.seq=e,realNodes.push(a)}}),realNodes.filter(function(t){return!isPlaceEmpty||"c2iSelectedChart"!==t.id}).forEach(function(t){switch(t.node){case"select":__renderSelect(t);break;case"button":__renderButton(t);break;default:__renderDiv(t)}t.dynamic||trTds.append("td")})}var _gPlots,_gBars,_outBars;chart.render=function(){if(!_rawData||0===_rawData.length)return void _u.alert("*.피라미드 차트에 사용할 데이터 없습니다.");const t=cfg.optWin;if(!_svg){if(_width=parseInt(_c2iCon.style("width"),10),cfg.nonComponent&&(cfg.xDim.cmdRect.width>_contentH()/_rawData.length?(cfg.heightSave=cfg.height,cfg.height=22.5*_rawData.length,console.log("*.시각화이기에 임의로 높이 조정합니다.")):cfg.heightSave&&(cfg.height=cfg.heightSave,delete cfg.heightSave,console.log("*.원래 높이로 재 조정합니다."))),_svg=_c2iCon.append("svg").attr("width",_width).attr("height",cfg.height).style("background",cfg.theme?cfg.theme:null),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),!c2i.lang)return;t&&(_option=_u.renderOptionWindow(cfg,_svg,_oID,_option,_makeOptionView))}return t&&!t.optBtnHide&&_u.optionBtnView(cfg,_width,_option),setUpScaleY(),renderAxes(),defineBodyClip(),setTimeout(renderBody,timeSec),timeSec=0,chart};var _isSortRight="",_isSortLeft="",_isSortCalc="",_isSortLabel="",_isSortRightB="",_isSortLeftB="",_isSortCalcB="",lrCalc=[0,0],lrBeforeCalc=[0,0];const _filteredData=function(t){return t=!(void 0!==t&&!t),cfg.data.filter(function(e){return e.__show===t})},_getCalcAvg=function(){lrCalc=[0,0],lrBeforeCalc=[0,0],cfg.data.forEach(function(t){t.__show&&(lrCalc[0]+=t[cfg.yDim.leftCol[0]],lrCalc[1]+=t[cfg.yDim.rightCol[0]],cfg.yDim.leftCol.length>1&&(lrBeforeCalc[0]+=t[cfg.yDim.leftCol[1]],lrBeforeCalc[1]+=t[cfg.yDim.rightCol[1]]))});const t=cfg.data.length;"avg"===cfg.summary.calcFn&&(t?(lrCalc[0]=lrCalc[0]/t,lrCalc[1]=lrCalc[1]/t,lrBeforeCalc[0]=lrBeforeCalc[0]/t,lrBeforeCalc[1]=lrBeforeCalc[1]/t):(lrCalc=[0,0],lrBeforeCalc=[0,0]))},_highlight=function(t){return function(){d3.select(this).attr("class",t)}};function renderBody(){_bodyG||(_bodyG=_svg.append("g").attr("class","body").attr("transform","translate("+[_xStart(),_yEnd()]+")"),_gPlots=_svg.append("g").attr("class","plot").attr("transform","translate("+[_xStart(),_yEnd()]+")")),_outBars||(_outBars=_bodyG.append("g").attr("class","outBar")),enter(),update(!1)}function enter(){var t=function(t,e){var a=c2i.lang.gen;return""===t?(t="desc",_svg.select(".subtitle").style("fill","orange").text(e+a.by+" "+a.desc)):"desc"===t?(t="asc",_svg.select(".subtitle").style("fill","orange").text(e+a.by+" "+a.asc)):(t="",cfg.title&&cfg.title.subCaption?_svg.select(".subtitle").style("fill",cfg.title.subFonts[2]).text(cfg.title.subCaption):_svg.select(".subtitle").text()),t},e=function(t,e){cfg.data.sort(function(a,o){return"desc"===t?d3.descending(a[e],o[e]):"asc"===t?d3.ascending(a[e],o[e]):a.__id-o.__id})};!_gPlots.selectAll(".label").empty()||cfg.summary.calcFn&&"sum"!==cfg.summary.calcFn||(_gPlots.append("text").attr("class","label leftTitleLabel").attr("y",cfg.margin.top-3).attr("text-anchor","end"),_gPlots.append("text").attr("class","label rightTitleLabel").attr("y",cfg.margin.top-3));var a,o=_filteredData();function n(t,e,a){!function(e,a){const o=cfg.tooltip;if(!_tip||!o.isShow)return;_tip.classed("c2iHidden",!1).style("opacity",o.opacity),o.isUserTip||function(t,e){var a=-1===e.indexOf("Before")?0:1,o=_getMeasure(cfg.yDim.leftCol[a]),n=_getMeasure(cfg.yDim.rightCol[a]);const r=_u.formatAll(o.format,o.format);var l=r(t[o.colNm]+t[n.colNm]);_tip.select("#name").text(t[_xColNm]),_tip.select("#measure").html(l+(a?_yUnitNm2:_yUnitNm)),cfg.tooltip.infoLevel>0?function(t){_tip.select("tbody").classed("c2iHidden",!1);const e=c2i.lang.gen,a=d3.format(".1%"),l=cfg.summary.calcFn?cfg.summary.calcFn:"sum";let i,s=cfg.summary.totAvgCalc||l,c=o.caption,d=n.caption;"sum"===s?(i=t[o.colNm]+t[n.colNm],s=e[s]):"avg"===s?(i=(t[o.colNm]+t[n.colNm])/2,s=e[s]):(s=l+s,cfg.summary.isReverse?(s="("+n.captionAlias+" - "+o.captionAlias+") "+e[s],i=t[n.colNm]-t[o.colNm],c+=" ("+o.captionAlias+")",d+=" ("+n.captionAlias+")"):i=t[o.colNm]-t[n.colNm]);const u=[{name:"tipContent",cls:"tipName"},{name:c,cls:"tipAll"},{name:d,cls:"tipAll"},{name:s,cls:"tipAll"}],m=[[e.value,r(t[o.colNm]),r(t[n.colNm]),r(i)]];if(!cfg.summary.hideAggRatio){const r=t[o.colNm]/i,s=t[n.colNm]/i,c=[e.ratio2,a(r),a(s),"sum"===l?"100%":a(r/s)];m.push(c)}const p=["tipHeader","number","number","number"];let g,f,h,y=_tip.select("table").select("tbody");if(y.empty()){const t=(y=_tip.select("table").append("tbody")).append("tr");(h=t.selectAll("th").data(u)).enter().append("th").attr("class",t=>t.cls).attr("data-c2i18n",(t,e)=>0===e?"gen."+t.name:null).text((t,a)=>0===a?e[t.name]:t.name),g=(g=y.selectAll(".level1").data(m)).enter().append("tr").attr("class","level1").merge(g),(f=g.selectAll("td").data(t=>t)).enter().append("td").attr("class",(t,e)=>p[e]).text(t=>t)}else(h=y.selectAll("th").data(u)).text((t,a)=>0===a?e[t.name]:t.name),g=y.selectAll(".level1").data(m),(f=g.selectAll("td").data(t=>t)).text(t=>t);cfg.tooltip.infoLevel;cfg.tooltip.infoLevel}(t):_tip.select("tbody").classed("c2iHidden",!0)}(e,a);o.fixedPos&&void 0===_tipFirst&&function(){const e=cfg.tooltip;c2i.utilEx.resetTooltip(_tip,e.width?e.width:_tip.select("table").style("width"),null);var a,o,n=parseInt(_tip.select("table").style("width")),r=parseInt(_tip.select("table").style("height"));_tip.select(".c2iCloseBtn").classed("c2iHidden",!1).on("touchstart",()=>_tip.classed("c2iHidden",!0)).on("click",()=>_tip.classed("c2iHidden",!0)),a=t.pageX+5,o=t.pageY+5,a>_width-n&&(a-=n+5);o>cfg.height-r&&(o-=1.2*r);a<0&&(a=0);o<0&&(o=0);_tip.style("left",a+"px").style("top",o+"px"),_tipFirst=!1}();cfg.method.mousemove&&o.isUserTip&&cfg.method.mousemove({container:c2iCon,selector:"tooltip"},e)}(e,a),cfg.method.mouseenter&&cfg.method.mouseenter(t,{container:c2iCon,selector:a},e)}function r(t,e,a){if(_tip&&cfg.tooltip.isShow){cfg.tooltip.isUserTip&&cfg.method.mousemove&&cfg.method.mousemove({container:c2iCon,selector:a},e);var o=cfg.tooltip.fixedPos;if(!o){var n,r,l=parseInt(_tip.select("table").style("width")),i=parseInt(_tip.select("table").style("height"));o?(n="middle"===o.xPos?(_width-l)/2:"start"===o.xPos?_xStart():_width-l,r="middle"===o.yPos?(cfg.height-i)/2:"top"===o.yPos?_yEnd():cfg.height-i):(n=t.pageX+5,r=t.pageY+5,n>_width-l&&(n-=l+5),r>cfg.height-i&&(r-=1.2*i)),n<0&&(n=0),r<0&&(r=0),_tip.style("left",n+"px").style("top",r+"px")}}}function l(t,e,a){_tip&&cfg.tooltip.isShow&&!cfg.tooltip.fixedPos&&_tip.classed("c2iHidden",!0),cfg.method.mouseleave&&cfg.method.mouseleave({container:c2iCon,selector:a},e)}setUpScaleX(o),(_gBars=_bodyG.selectAll("g.bar").data(o,_key).enter().append("g").attr("class","bar").attr("transform",function(t){return"translate(0,"+_xX(t[_xColNm])+")"}).on("mouseover",_highlight("highlight bar")).on("mouseleave",_highlight("bar"))).append("rect").on("dblclick",function(e){e.altKey?function(){if(2!==cfg.yDim.leftCol.length||2!==cfg.yDim.rightCol.length)return void console.log(c2i.lang.pyramid.py_1);const e=_getMeasure(cfg.yDim.leftCol[1]),a=_getMeasure(cfg.yDim.rightCol[1]);_isSortCalcB=t(_isSortCalcB,e.caption+","+a.caption+" "+c2i.lang.gen.all),cfg.data.sort(function(t,o){return"desc"===_isSortCalcB?d3.descending(t[e.colNm]+t[a.colNm],o[e.colNm]+o[a.colNm]):"asc"===_isSortCalcB?d3.ascending(t[e.colNm]+t[a.colNm],o[e.colNm]+o[a.colNm]):t.__id-o.__id})}():function(){const e=_getMeasure(cfg.yDim.leftCol[0]),a=_getMeasure(cfg.yDim.rightCol[0]);_isSortCalc=t(_isSortCalc,e.caption+","+a.caption+" "+c2i.lang.gen.all),cfg.data.sort(function(t,o){return"desc"===_isSortCalc?d3.descending(t[e.colNm]+t[a.colNm],o[e.colNm]+o[a.colNm]):"asc"===_isSortCalc?d3.ascending(t[e.colNm]+t[a.colNm],o[e.colNm]+o[a.colNm]):t.__id-o.__id})}(),update()}).on("click",function(t,e){cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"all"},e)}).attr("class","ghostRect").attr("fill","none").attr("pointer-events","all"),_gBars.append("rect").on("dblclick",function(){_isSortLeft=t(_isSortLeft,mLeft.caption),e(_isSortLeft,mLeft.colNm),update()}).on("click",function(t,e){cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"leftBar"},e)}).on("mouseenter",function(t,e){n(t,e,"leftBar")}).on("mousemove",function(t,e){r(t,e,"leftBar")}).on("mouseleave",function(t,e){l(0,e,"leftBar")}).style("stroke",_colorMeasure(mLeft.colNm)).style("fill",__barFillTexture(mLeft.colNm)).attr("x",_xChartlWidth).attr("width",0).attr("class","leftBar"),cfg.yDim.leftCol.length>1&&(a=_getMeasure(cfg.yDim.leftCol[1]),_gBars.append("line").on("dblclick",function(){_isSortLeftB=t(_isSortLeftB,a.caption),e(_isSortLeftB,a.colNm),update()}).on("click",function(t,e){cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"leftBefore"},e)}).on("mouseenter",function(t,e){n(t,e,"leftBefore")}).on("mousemove",function(t,e){r(t,e,"leftBefore")}).on("mouseleave",function(t,e){l(0,e,"leftBefore")}).style("stroke",_colorMeasure(a.colNm)).attr("class","leftBefore").attr("x1",_xChartlWidth).attr("x2",_xChartlWidth));const i=_u.formatAll(mLeft.formatAvg||mLeft.format,mLeft.formatAvg||mLeft.format);mLeft.showLabel&&_gBars.append("text").attr("class","leftText").style("font-family",mLeft.fonts[0]).style("font-size",mLeft.fonts[1]).style("fill",function(t){return _mLeftBefore?t[mLeft.colNm]-t[_mLeftBefore.colNm]>=0?mLeft.fonts[2]:cfg.yDim.negativeColor:mLeft.fonts[2]}).attr("dx",-5).attr("dy",_xDy).attr("text-anchor","end").attr("pointer-events","none").text(function(t){if(_mLeftBefore){var e=0===t[_mLeftBefore.colNm]?0:(t[mLeft.colNm]-t[_mLeftBefore.colNm])/t[_mLeftBefore.colNm];return"("+d3.format("+.1%")(e)+") "+i(t[mLeft.colNm])}return i(t[mLeft.colNm])}).attr("x",_xChartlWidth+_xAllWidth/2),_gBars.append("rect").on("dblclick",function(){_isSortRight=t(_isSortRight,mRight.caption),e(_isSortRight,mRight.colNm),update()}).on("click",function(t,e){cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"rightBar"},e)}).on("mouseenter",function(t,e){n(t,e,"rightBar")}).on("mousemove",function(t,e){r(t,e,"rightBar")}).on("mouseleave",function(t,e){l(0,e,"rightBar")}).style("stroke",_colorMeasure(mRight.colNm)).style("fill",__barFillTexture(mRight.colNm)).attr("x",_xChartlWidth+_xAllWidth).attr("width",0).attr("class","rightBar"),cfg.yDim.rightCol.length>1&&function(){var a=_getMeasure(cfg.yDim.rightCol[1]);_gBars.append("line").on("dblclick",function(){_isSortRightB=t(_isSortRightB,a.caption),e(_isSortRightB,a.colNm),update()}).on("click",function(t,e){cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"rightBefore"},e)}).on("mouseenter",function(t,e){n(t,e,"rightBefore")}).on("mousemove",function(t,e){r(t,e,"rightBefore")}).on("mouseleave",function(t,e){l(0,e,"rightBefore")}).style("stroke",_colorMeasure(a.colNm)).attr("class","rightBefore").attr("x1",_xChartlWidth+_xAllWidth).attr("x2",_xChartlWidth+_xAllWidth)}();const s=_u.formatAll(mRight.formatAvg||mRight.format,mRight.formatAvg||mRight.format);mRight.showLabel&&_gBars.append("text").attr("class","rightText").style("font-family",mRight.fonts[0]).style("font-size",mRight.fonts[1]).style("fill",function(t){return _mRightBefore?t[mRight.colNm]-t[_mRightBefore.colNm]>=0?mRight.fonts[2]:cfg.yDim.negativeColor:mRight.fonts[2]}).attr("dx",5).attr("dy",_xDy).attr("pointer-events","none").text(function(t){if(_mRightBefore){var e=0===t[_mRightBefore.colNm]?0:(t[mRight.colNm]-t[_mRightBefore.colNm])/t[_mRightBefore.colNm];return s(t[mRight.colNm])+" ("+d3.format("+.1%")(e)+")"}return s(t[mRight.colNm])}).attr("x",_xChartlWidth+_xAllWidth/2),_gBars.append("rect").on("click",function(t,e){e.__show=!1,update(!1),cfg.method.click&&__animateText(t)}).attr("class","xLabelCmd").attr("x",_xChartlWidth+_xTextWidth).attr("width",0).style("fill",cfg.xDim.cmdRect.color).style("cursor","pointer").append("title").text(function(t){return t[cfg.xDim.colNm]+" "+c2i.lang.gen.remove}),_gBars.append("text").attr("class","xLabelCmdLabel").attr("x",_xChartlWidth).style("fill-opacity",0).style("font-family",cfg.xDim.fonts[0]).style("fill",cfg.xDim.fonts[2]).style("font-size",cfg.xDim.fonts[1]).style("pointer-events","none").text("X"),_gBars.append("text").on("dblclick",function(){_isSortLabel=t(_isSortLabel,cfg.xDim.caption),e(_isSortLabel,cfg.xDim.colNm),update()}).attr("class","xLabel").attr("x",_xChartlWidth).style("fill-opacity",0).style("font-family",cfg.xDim.fonts[0]).style("fill",cfg.xDim.fonts[2]).style("font-size",cfg.xDim.fonts[1]).text(t=>{const e=t[cfg.xDim.colNm];return e.length>20?e.substr(0,19)+"...":e}).append("title").text(function(t){const e=t[mLeft.colNm]+t[mRight.colNm];let a=cfg.summary.captions[0]+": "+i(e);if(_mLeftBefore){const o=t[_mLeftBefore.colNm]+t[_mRightBefore.colNm];a+=" "+cfg.summary.captions[1]+": "+s(o),a+=" ("+c2i.lang.gen.variation+": "+s(e-o)+")"}return a})}function update(t){var e=_filteredData();if(0==e.length)return cfg.data.forEach(t=>t.__show=!0),void renderBody();var a,o=_getMeasure(cfg.yDim.leftCol[0]),n=_getMeasure(cfg.yDim.rightCol[0]);if(cfg.sideInfo&&function(){const t=cfg.sideInfo,e=_bodyG.selectAll(".c2iPyramidBinary").data(t.captions);e.enter().append("text").attr("class","c2iPyramidBinary").attr("text-anchor",(t,e)=>e?"end":"start").style("font-family",t.fonts[0]).style("font-size",8).style("fill",(e,a)=>t.fonts[a+2]).style("opacity",t.opacity||.5).style("pointer-events","none").text(t=>t).attr("x",()=>_contentW()/2).merge(e).transition().duration(cfg.duration).style("font-size",t.fonts[1]).attr("x",(t,e)=>e?_contentW()-5:5).attr("y",_contentH()/2+10)}(),cfg.summary.isShow&&(!cfg.summary.calcFn||"sum"===cfg.summary.calcFn)){_getCalcAvg();var r=cfg.summary.fonts;_gPlots.select("text.leftTitleLabel").attr("x",_xChartlWidth).style("font-family",r[0]).style("font-size",r[1]).style("fill",r[2]).text(l(0,o.caption,_mLeftBefore)),_gPlots.select("text.rightTitleLabel").attr("x",_xChartlWidth+_xAllWidth).style("font-family",r[0]).style("font-size",r[1]).style("fill",r[3]).text(l(1,n.caption,_mRightBefore))}function l(t,e,a){const o=d3.format(".2%");let n,r,l;const i="avg"===cfg.summary.calcFn;i?(n=lrCalc[0]+lrCalc[1]/2,r=c2i.lang.gen.avg,l=_y2Format):(n=lrCalc[0]+lrCalc[1],r=c2i.lang.gen.sum,l=_yFormat);let s=0===n?"":lrCalc[t]/n,c=o(s),d=cfg.summary.captions?cfg.summary.captions[0]:e,u=(d+=" ["+r+"]")+": "+_u.formatAll(l,l)(lrCalc[t])+cfg.yDim.unitNm;if(i||(u+=", "+c),a){const a=lrBeforeCalc[0]+lrBeforeCalc[1];c=o(s=0===a?"":lrBeforeCalc[t]/a),d=cfg.summary.captions?cfg.summary.captions[1]:e,u+=" ("+(d+=" ["+r+"]")+": "+_u.formatAll(l,l)(lrBeforeCalc[t])+" "+cfg.yDim.unitNm,u+=i?")":", "+c}return u}function i(t){_gBars.selectAll("rect."+t.yDim+"Bar").transition().duration(cfg.duration).attr("x",function(e){return"left"===t.yDim?_xChartlWidth-_yY(e[t.colNm]):_xChartlWidth+_xAllWidth}).attr("height",_xX.bandwidth()).attr("width",function(e){return _yY(e[t.colNm])})}function s(t){_gBars.selectAll("text."+t.yDim+"Text").transition().duration(cfg.duration).attr("y",_xX.bandwidth()/2).attr("x",function(e){return"left"===t.yDim?_xChartlWidth-_yY(e[t.colNm]):_xChartlWidth+_xAllWidth+_yY(e[t.colNm])})}(_gBars=_bodyG.selectAll("g.bar").data(e,_key)).exit().transition().duration(cfg.duration).style("opacity",0).remove(),setUpScaleX(e),cfg.scaleAuto&&(setUpScaleY(e),renderAxes()),_gBars.transition().duration(cfg.duration).attr("transform",t=>"translate(0,"+_xX(t[_xColNm])+")"),_gBars.selectAll("rect.ghostRect").attr("width",_contentW()).attr("height",_xX.bandwidth()),i(o),cfg.yDim.leftCol.length>1&&(a=_getMeasure(cfg.yDim.leftCol[1]),_gBars.selectAll("line.leftBefore").transition().duration(cfg.duration).style("stroke-width",_xX.bandwidth()/3+"px").attr("y1",_xX.bandwidth()/2).attr("y2",_xX.bandwidth()/2).attr("x2",_xChartlWidth).attr("x1",function(t){return _xChartlWidth-_yY(t[a.colNm])})),s(o),i(n),cfg.yDim.rightCol.length>1&&function(){var t=_getMeasure(cfg.yDim.rightCol[1]);_gBars.selectAll("line.rightBefore").transition().duration(cfg.duration).style("stroke-width",_xX.bandwidth()/3+"px").attr("y1",_xX.bandwidth()/2).attr("y2",_xX.bandwidth()/2).attr("x1",_xChartlWidth+_xAllWidth).attr("x2",function(e){return _xChartlWidth+_xAllWidth+_yY(e[t.colNm])})}(),s(n),_gBars.selectAll("rect.xLabelCmd").transition().duration(cfg.duration).attr("height",_xX.bandwidth()).attr("x",_xChartlWidth+2).attr("width",cfg.xDim.cmdRect.width),_gBars.selectAll("text.xLabelCmdLabel").transition().duration(cfg.duration).style("fill-opacity",1).attr("x",_xChartlWidth+cfg.xDim.cmdRect.width/2+2).attr("y",_xX.bandwidth()/2).attr("dy",_xDy).attr("text-anchor","middle"),_gBars.selectAll("text.xLabel").transition().duration(cfg.duration).style("fill-opacity",1).attr("x",_xChartlWidth+_xAllWidth/2+6).attr("y",_xX.bandwidth()/2).attr("dy",_xDy).attr("text-anchor","middle"),void 0!==t&&!1===t&&updateOutBar(),cfg.yDim.plotLines&&cfg.yDim.plotLines[0].draw?updatePlotLine(e):(_gPlots.selectAll(".avgLine").transition().duration(cfg.duration).attr("y1",_contentH()).remove(),_gPlots.selectAll(".avgLabel").transition().duration(cfg.duration).style("fill-opacity",0).remove())}function updatePlotLine(t){for(var e,a,o=[],n=0;n<cfg.yDim.leftCol.length;n++){var r=_getMeasure(cfg.yDim.leftCol[n]),l=_getMeasure(cfg.yDim.rightCol[n]);_avgLeft=d3.mean(t.map(function(t){return t[cfg.yDim.leftCol[n]]})),_avgRight=d3.mean(t.map(function(t){return t[cfg.yDim.rightCol[n]]})),e={gubun:r.caption+" "+c2i.lang.cm.avg,avg:_avgLeft,xPos:_xChartlWidth-_yY(_avgLeft),cls:n?"leftLine":"left"},a={gubun:l.caption+" "+c2i.lang.cm.avg,avg:_avgRight,xPos:_yY(_avgRight)+_xChartlWidth+_xAllWidth,cls:n?"rightLine":"right"},o.push(e),o.push(a)}var i=_gPlots.selectAll(".avgLine").data(o),s=cfg.yDim.plotLines[0];i.enter().append("line").on("mouseenter",function(t,e){var a=cfg.yDim;switch(e.cls){case"left":_bodyG.selectAll("rect.leftBar").filter(function(t){return t[a.leftCol[0]]<e.avg}).style("opacity",.4);break;case"right":_bodyG.selectAll("rect.rightBar").filter(function(t){return t[a.rightCol[0]]<e.avg}).style("opacity",.4);break;case"leftLine":_bodyG.selectAll("line.leftBefore").style("opacity",function(t){return t[a.leftCol[1]]<e.avg?.4:1});break;case"rightLine":_bodyG.selectAll("line.rightBefore").style("opacity",function(t){return t[a.rightCol[1]]<e.avg?.4:1})}}).on("mouseleave",function(t,e){switch(e.cls){case"left":_bodyG.selectAll("rect.leftBar").style("opacity",1);break;case"right":_bodyG.selectAll("rect.rightBar").style("opacity",1);break;case"leftLine":_bodyG.selectAll("line.leftBefore").style("opacity",1);break;case"rightLine":_bodyG.selectAll("line.rightBefore").style("opacity",1)}}).attr("class",function(t){return"avgLine "+t.cls}).style("stroke",function(t,e){return s.color[e<2?0:1]}).style("stroke-width",s.width).style("stroke-dasharray",function(t,e){return e<2?s.dashLength:s.dashLength+5}).attr("x1",t=>t.xPos).attr("x2",t=>t.xPos).attr("y1",cfg.margin.top).attr("y2",cfg.margin.top).merge(i).transition().duration(cfg.duration).attr("x1",t=>t.xPos).attr("x2",t=>t.xPos).attr("y1",cfg.margin.top).attr("y2",_contentH());const c=_u.formatAll(r.formatAvg||r.format,r.formatAvg||r.format),d=_u.formatAll(l.formatAvg||l.format,l.formatAvg||l.format),u=_gPlots.selectAll(".avgLabel").data(o),m=!(!_mLeftBefore||!_mLeftBefore.draw)&&_u.formatAll(_mLeftBefore.formatAvg||_mLeftBefore.format,_mLeftBefore.formatAvg||_mLeftBefore.format),p=!(!_mRightBefore||!_mRightBefore.draw)&&_u.formatAll(_mRightBefore.formatAvg||_mRightBefore.format,_mRightBefore.formatAvg||_mRightBefore.format),g=d3.mean(_yY.domain());u.enter().append("text").attr("class","avgLabel").style("font-family",s.fonts[0]).style("fill",function(t,e){return s.fonts[e<2?2:3]}).style("font-size",s.fonts[1]).style("text-anchor",t=>0===t.cls.indexOf("left")?"end":"start").attr("transform",t=>"translate("+[t.xPos,0]+")").merge(u).transition().duration(cfg.duration).attr("transform",function(t,e){var a=_yIsShow?30:15;return a+=15*(e>1),"translate("+[t.xPos,_contentH()+a]+")"}).style("text-anchor",function(t){return 0===t.cls.indexOf("left")?g>t.avg?"end":"start":g>t.avg?"start":"end"}).text(function(t,e){var a,n=t.gubun+": ";return 0===e?_mLeftBefore?(a=o[2].avg?(t.avg-o[2].avg)/o[2].avg:0,n+m(t.avg)+" ("+d3.format("+.1%")(a)+")"):n+" ("+c(t.avg)+")":1===e?_mRightBefore?(a=o[3].avg?(t.avg-o[3].avg)/o[3].avg:0,n+p(t.avg)+" ("+d3.format("+.1%")(a)+")"):n+" ("+d(t.avg)+")":n+(_mLeftBefore?m(t.avg):p?p(t.avg):"")})}function __animateText(t){var e=_filteredData(),a=d3.mean(e.map(function(t){return(t[cfg.yDim.leftCol[0]]+t[cfg.yDim.rightCol[0]])/2})),o=d3.sum(e.map(function(t){return t[cfg.yDim.leftCol[0]]+t[cfg.yDim.rightCol[0]]}));let n=cfg.summary.captions[1];cfg.method.click(t,{container:c2iCon.substr(1),selector:"removeCmd",srcTitle:n},a,o)}function __barFillTexture(t){if("left"===_getMeasure(t).yDim){if(cfg.yDim.texture)return _txY(t).url();if(cfg.yDim.color[1])return __gradient(_colorMeasure(t))}else{if(cfg.yDim.textureY2)return _txY2(t).url();if(cfg.yDim.colorY2[1])return __gradient(_colorMeasure(t))}return _colorMeasure(t)}function _setTooltip(){var t=cfg.tooltip;(_tip=cfg.method.mousemove&&t&&void 0!==t.id?d3.select(t.id):void 0)&&!_tip.empty()&&("object"!=typeof t.fixedPos?t.fixedPos=void 0:_tip.style("pointer-events","all").style("cursor","move").call(_dragHandle),t.infoLevel=t.infoLevel?t.infoLevel<0||t.infoLevel>3?0:t.infoLevel:0,t.opacity=t.opacity?t.opacity:.7,t.isShow=void 0!==t.isShow&&t.isShow)}function __gradient(t,e){var a;void 0===e?(e="linearGradient",a=c2iCon+"_c2iGradBar"):(e="radialGradient",a=c2iCon+"_c2iGradCircle"),t.indexOf("rgb")>-1&&(t=d3.rgb(t).toString());var o=a+t.substring(1);if(!_svg.select(a).selectAll(o).empty())return"url("+o+")";var n=_u.shadeColor(t,-50),r=_svg.select(a).selectAll(o).data([o]).enter().append(e).attr("id",o.substr(1));return e.indexOf("linear")>-1?(r.attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","reflect"),r.append("stop").attr("offset","0%").attr("stop-color",t),r.append("stop").attr("offset","50%").attr("stop-color",n),r.append("stop").attr("offset","100%").attr("stop-color",t)):(r.attr("gradientUnits","objectBoundingBox").attr("fx","30%").attr("fy","30%"),r.append("stop").attr("offset","0%").attr("stop-color","#FFFFFF"),r.append("stop").attr("offset","40%").attr("stop-color",t),r.append("stop").attr("offset","100%").attr("stop-color",n)),"url("+o+")"}function _getMeasure(t){for(var e=0;e<cfg.measures.length;e++)if(cfg.measures[e].colNm===t)return cfg.measures[e];alert(c2i.lang.pyramid.py_2,t)}function updateOutBar(){const t=_filteredData(!1);let e=_outBars.selectAll(".outLabel").data(t,_key);if(e.exit().style("font-size","14px").style("fill","orangered").transition().delay((t,e)=>50*e).remove(),0===t.length)return void _outBars.selectAll(".resetRect, .resetRectLabel").style("fill","orangered").style("font-size","14px").transition().duration(cfg.duration).remove();const a=cfg.xDim,o=cfg.yDim;_outBars.select(".resetRect").empty()&&(_outBars.append("rect").on("click",function(t){cfg.data.forEach(t=>{t.__show=!0}),renderBody(),d3.select(this).style("opacity",0).transition().remove(),d3.select(".resetRectLabel").style("opacity",0).transition().remove(),cfg.method.click&&__animateText(t)}).attr("class","resetRect").style("cursor","pointer").style("fill",a.cmdRect.color).attr("width",15).attr("height",15).attr("rx",7.5).attr("ry",7.5).attr("x",0).attr("y",-10).append("title"),_outBars.append("text").attr("class","resetRectLabel").attr("text-anchor","middle").attr("x",7.5).attr("y",2).style("font-family",a.fonts[0]).style("fill",a.fonts[2]).style("font-size",a.fonts[1]).style("pointer-events","none").text("X")),_outBars.attr("transform",()=>{let t=o.leftCol.length>1?15:0;return t+=_yIsShow?12:0,"translate("+[0,_yStart()+t]+")"});const n=_u.formatAll(_yFormat,_yFormat);_outBars.select("rect > title").text(()=>{let t=0;return _filteredData(!1).forEach(e=>{t+=e[o.leftCol[0]]+e[o.rightCol[0]]}),t=n(t),cfg.sideInfo.captions.join(" + ")+" = "+t+" "+c2i.lang.pyramid.py_3});const r=e.enter().append("text").on("click",(t,e)=>{e.__show=!0,renderBody(),0===_filteredData(!1).length&&_bodyG.select("g.outBar rect").style("opacity",0).transition().remove(),cfg.method.click&&__animateText(t)}).attr("class","outLabel").style("cursor","pointer").style("font-family",a.fonts[0]).style("fill",a.fonts[2]).style("font-size",a.fonts[1]).attr("dy",1).text(t=>t[a.colNm]);e=r.merge(e),r.append("title").text(t=>{const e=[];return o.leftCol.forEach((a,r)=>{let l=t[o.leftCol[r]]+t[o.rightCol[r]];l=cfg.summary.captions[r]+": "+n(l),e.push(l)}),t[a.colNm]+" "+c2i.lang.pyramid.py_4+" ("+e.join(", ")+")"}).merge(e.selectAll("title"));let l=0;e.transition().attr("x",(t,e)=>{const o=_u.getTextWidth(t[a.colNm],a.fonts[1],a.fonts[0]);let n=20;return 0===e?l=o+20:(n=l+5,l+=o+5),n})}function _layoutData(){var t,e=[];_setXDim(),_setYDim(),_setMeasures(),cfg.preBuildData?_rawData.forEach(function(t,a){if(t.__id=a,t.__show=!0,"band"!==_xScale)t[cfg.xDim.colNm]=+t[cfg.xDim.colNm];else{var o=_u.getTextWidth(t[cfg.xDim.colNm],cfg.xDim.fonts[1],cfg.xDim.fonts[0]);e.push(o)}cfg.measures.forEach(e=>t[e.colNm]=t[e.colNm]?+t[e.colNm]:0)}):(t=d3.nest().key(function(t){return t[cfg.xDim.colNm]}).entries(_rawData),_rawData=t.map(function(t,a){var o={},n=cfg.rawStructure;if(o.__id=a,"band"!==_xScale)o[cfg.yDim.colNm]=+t.key;else{var r=_u.getTextWidth(t.key,cfg.xDim.fonts[1],cfg.xDim.fonts[0]);e.push(r)}return t.values.forEach(function(t){o[t[n.colNm]]=+t[n.valNm]}),o.__show=!0,o})),_xTextWidth=d3.max(e)+20,_xAllWidth=_xTextWidth+12,_xChartlWidth=(_contentW()-_xAllWidth)/2,_setTooltip(),_u.setTheme(cfg,c2iCon,!1),_u.setTitle(cfg),cfg.data=_u.deepClone(_rawData),cfg.isDev&&_u.devMode(cfg)}function setUpScaleX(t){switch(t=t||cfg.data,_xScale.toLowerCase()){case"band":_xValues=t.map(t=>({id:t.__id,xName:t[_xColNm]})),_xX.domain(_xValues.map(t=>t.xName)).range([_yEnd(),_contentH()]).paddingOuter(_xPad[0]).paddingInner(_xPad[1]);break;default:_xValues=d3.extent(t,t=>t[_xColNm]),_xX.domain(_xValues).rangeRound([_yEnd(),_contentH()])}}function setUpScaleY(t){let e,a,o,n=Number.MAX_VALUE,r=Number.MIN_VALUE,l=t||_filteredData();for(o=0;o<cfg.measures.length;o++)(!1===cfg.scaleAuto||cfg.measures[o].draw)&&(a=cfg.measures[o].colNm,e=d3.extent(l,t=>t[a]),n=d3.min([n,e[0]]),r=d3.max([r,e[1]]));n=n===Number.MAX_VALUE?0:n,r=r===Number.MIN_VALUE?1:r,"log"===_yScale||"sqrt"===_yScale?n=n>0?.8*n:1.2*n:cfg.beginZero?n=0:n*=n>=0?_yMinGap:_yMinGap+1,r*=_yMaxGap,_yFormat=cfg.yDim.format?cfg.yDim.format:",d",_y2Format=cfg.summary.formatAvg?cfg.summary.formatAvg:_yFormat,_yBaseValue=cfg.yDim.yBaseValue?cfg.yDim.yBaseValue:n,_yY.domain([_yBaseValue,r]).range([0,_xChartlWidth]).nice()}function setUpScaleY2(t){let e,a,o,n=Number.MAX_VALUE,r=Number.MIN_VALUE,l=t||_filteredData();for(o=0;o<cfg.measures.length;o++)(!1===cfg.scaleAuto||cfg.measures[o].draw)&&(a=cfg.measures[o].colNm,e=d3.extent(l,t=>t[a]),n=d3.min([n,e[0]]),r=d3.max([r,e[1]]));n=n===Number.MAX_VALUE?0:n,r=r===Number.MIN_VALUE?1:r,"log"===_yScale||"sqrt"===_yScale?n=n>0?.8*n:1.2*n:cfg.beginZero?n=0:n*=n>=0?_yMinGap:_yMinGap+1,r*=_yMaxGap,_yFormat=cfg.yDim.format?cfg.yDim.format:",d",_yBaseValue=cfg.yDim.yBaseValue?cfg.yDim.yBaseValue:n,_yY.domain([_yBaseValue,r]).range([0,_xChartlWidth]).nice()}function _setXDim(){const t=cfg.xDim;_xCaption=t.caption?t.caption:"",_xUnitNm=t.unitNm?t.unitNm:"",_xColNm=t.colNm,_xScale=t.scale?t.scale.toLowerCase():"band",_xFormat=t.format,_xAxisPos=t.axisPos?t.axisPos.toLowerCase():"center",_xPos=t.xPos?t.xPos:"middle",_xDy=t.dy?t.dy:4,_xTicks=t.ticks?t.ticks:10,_xTickPad=t.tickPad?t.tickPad:0,_xIsShow=void 0===t.isShow||t.isShow,_xShowGrid=void 0===t.showGrid||t.showGrid,_xPad=t.xPad?t.xPad:[.05,.1],t.cmdRect||(t.cmdRect={width:10,color:"#00A8F9"}),_xX=_u.getScale(_xScale),cfg.scaleAuto=void 0===cfg.scaleAuto||cfg.scaleAuto,cfg.beginZero=void 0===cfg.beginZero||cfg.beginZero}function _setYDim(){const t=cfg.yDim;_yCaption=t.caption?t.caption:"",_yUnitNm=t.unitNm?t.unitNm:"",_yUnitNm2=t.unitNm2?t.unitNm2:"",_yScale=t.scale?t.scale.toLowerCase():"linear",_yFormat=t.format?t.format:",d",_yAxisPos=t.axisPos?t.axisPos.toLowerCase():"bottom",_yDx=t.dx?t.dx:0,_yDy=t.dy?t.dy:3,_yTicks=t.ticks?t.ticks:10,_yIsShow=void 0===t.isShow||t.isShow,_yShowGrid=void 0===t.showGrid||t.showGrid,_yMinGap=t.minGap&&t.minGap>0&&t.minGap<=.2?1-t.minGap:1,_yMaxGap=t.maxGap&&t.maxGap>0&&t.maxGap<=.2?t.maxGap+1:1,_yY=_u.getScale(_yScale),void 0===t.color?t.color=["Tab10","solid"]:"string"==typeof t.color&&(t.color=t.color.toLowerCase().split("/"),2!==t.color.length&&(t.color[1]="")),void 0===t.colorY2?t.colorY2=["Cat10","solid"]:"string"==typeof t.colorY2&&(t.colorY2=t.colorY2.toLowerCase().split("/"),2!==t.colorY2.length&&(t.colorY2[1]=""));let e=[],a=[];t.texture&&t.texture.length>0&&(__setTexture("left",e,a,t.texture.toLowerCase()),_txY.domain(e).range(a)),e=[],a=[],t.textureY2&&t.textureY2.length>0&&(__setTexture("right",e,a,t.textureY2.toLowerCase()),_txY2.domain(e).range(a)),t.fonts||(t.fonts=["helvetica","11px","#aaa"])}function _setMeasures(){_selectedMeasures=[];const t=cfg.measures;let e,a;for(a=t.length-1;a>-1;a--)void 0===(e=t[a]).use||!0===e.use?(e.use=!0,(void 0===e.draw||e.draw)&&(e.draw=!0,_selectedMeasures.push(e.colNm)),e.fonts&&"string"==typeof e.fonts&&(e.fonts=e.fonts.split("/")),3===e.fonts.length?e.fonts[3]=e.fonts[1]:4===e.fonts.length?e.fonts[1]=e.fonts[3]:e.fonts=["helvetica","11px","black","dimgray"],e.color&&"string"==typeof e.color?e.color=[e.color,e.color]:2===e.color.length&&(e.color[0]=e.color[1])):t.splice(a,1);let o,n,r=0;if("each"!==cfg.yDim.color[0])for(o=_u.getColorScheme(cfg.yDim.color[0]),a=0,n=t.length;a<n;a++)"left"===(e=t[a]).yDim&&(e.color[0]=o[a%o.length],r++);if("each"!==cfg.yDim.colorY2[0])for(o=_u.getColorScheme(cfg.yDim.colorY2[0]),a=0,n=t.length;a<n;a++)"right"===(e=t[a]).yDim&&e.draw&&(e.color[0]=o[(a+r)%o.length]);for(cfg.yDim.leftCol=[],cfg.yDim.rightCol=[],a=0,n=t.length;a<n;a++)(e=t[a]).draw&&("left"===e.yDim?cfg.yDim.leftCol.push(e.colNm):cfg.yDim.rightCol.push(e.colNm));mLeft=_getMeasure(cfg.yDim.leftCol[0]),mRight=_getMeasure(cfg.yDim.rightCol[0]),cfg.yDim.leftCol.length>1&&(_mLeftBefore=_getMeasure(cfg.yDim.leftCol[1]),_mRightBefore=_getMeasure(cfg.yDim.rightCol[1])),_colorMeasure.domain(t.map(t=>t.colNm)).range(t.map(t=>t.color[0])),_fontsMeasure.domain(t.map(t=>t.colNm)).range(t.map(t=>t.fonts));const l=cfg.summary;l?(l.fonts&&"string"==typeof l.fonts&&(l.fonts=l.fonts.split("/"),4!==l.fonts.length&&(l.fonts=["helvetica","14px","dimgray","dimgray"])),l.fonts&&4===l.fonts.length||(l.fonts=["helvetica","14px","dimgray","dimgray"]),l.isShow||(l.isShow=!0)):cfg.summary={fonts:["helvetica","14px","dimgray","dimgray"],isShow:!1}}function __setTexture(t,e,a,o){const n=[];if(cfg.measures.forEach(function(a){a.yDim===t&&e.push(a.colNm)}),"each"!==o){("all"===o?["line13","circle11","path7"]:[o]).forEach(function(t){for(var e in _u[t])_u[t].hasOwnProperty(e)&&n.push(_u[t][e])});for(let t=0;t<n.length&&t<e.length;t++)a.push(n[t]())}else cfg.measures.forEach(function(e){if(e.yDim===t){let t=_u.textures[e.texture];t="function"==typeof t?t:_u.textures.pathHexagons,a.push(t())}})}function resize(){_svg&&_c2iCon.node().parentNode.clientWidth&&(cfg.nonComponent?_width=_c2iCon.node().parentNode.clientWidth:(_width=parseInt(_c2iCon.style("width"),10),cfg.height=parseInt(_c2iCon.style("height"),10),cfg.height||(cfg.height=parseInt(_width/cfg.aspect))),_svg.attr("width",_width).attr("height",cfg.height),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),_xChartlWidth=(_contentW()-_xAllWidth)/2,_yY.range([0,_xChartlWidth]),cfg.resizing=!0,chart.render(),cfg.resizing=!1)}function _xStart(){return cfg.margin.left}function _xEnd(){return _width-cfg.margin.right}function _yStart(){return cfg.height-cfg.margin.bottom}function _yEnd(){return cfg.margin.top}function _contentW(){return _width-cfg.margin.left-cfg.margin.right}function _contentH(){return cfg.height-cfg.margin.top-cfg.margin.bottom}chart.title=function(t){return arguments.length?(cfg.title=t,_u.setTitle(cfg),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),chart):cfg.title},chart.xDim=function(t){return arguments.length?(cfg.xDim=t,_setXDim(),chart):cfg.xDim},chart.yDim=function(t){return arguments.length?(cfg.yDim=t,_setYDim(),chart):cfg.yDim},chart.measures=function(t){return arguments.length?(cfg.measures=t,_setMeasures(),chart):cfg.measures},chart.tooltip=function(t){return arguments.length?(cfg.tooltip=t,_setTooltip(),chart):cfg.tooltip},chart.tipFixed=function(t){const e=cfg.tooltip;t?(e.fixedPos=e.fixedPos?e.fixedPos:{xPos:"start",yPos:"top"},_setTooltip()):e.fixedPos=void 0},chart.theme=function(t){return arguments.length?(cfg.theme="base"===t?cfg.themeInit:t,_u.setTheme(cfg,c2iCon,!0),chart):cfg.theme},chart.clear=function(){return _svg&&(_svg.remove(),_svg=_bodyG=_outBars=_isSortCalc=_isSortCalcB=void 0,_axesG=_yAxis=_y2Axis=_yAsisG=_y2AxisG=void 0),chart},chart.data=function(t){return arguments.length?(_rawData=t,_layoutData(),chart):cfg.data},chart.exportData=function(t,e){const a=cfg.title&&cfg.title.caption?cfg.title.caption:"",o=[],n=[];let r;e||(o.push(cfg.xDim.colNm+","),(r=cfg.xDim.caption?cfg.xDim.caption:cfg.xDim.colNm).search(/["|,|\n]/g)>=0?n.push('"'+r+'",'):n.push(r+","),cfg.measures.forEach(function(t){t.caption.search(/["|,|\n]/g)>=0?n.push('"'+t.caption+'",'):n.push(t.caption+","),o.push(t.colNm+",")})),_u.exportData(a,o,n,_rawData,t)},chart.lang=function(t){return arguments.length?(cfg.lang=t.toLowerCase(),_u.locale(cfg),_meta=void 0,chart):cfg.lang};let _timer=null;return cfg.isResponsive&&_u.resizeChart(cfg,c2iCon,resize,_timer),cfg.optWin&&_u.optionHide(),_u.createAccessor(chart,cfg)},c2i.ai.speech=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;(e=e||{}).method=e.method||{};const o={},n={lang:"ko-KR",ignoreSpace:!0,ignoreCapital:!0,isDev:!1};let r;a.init(n,e),n.lang=n.lang||"ko-KR",n.lang="ko"===n.lang?"ko-KR":n.lang;const l=[];return o.checkSupport=function(){return o.recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition),o.recognition?(o.recognition.lang=n.lang,o.recognition.interimResults=!0,o.recognition.addEventListener("result",t=>{const e=Array.from(t.results).map(t=>t[0]).map(t=>t.transcript).join("");o.runtimeTranscription=e}),n.method.speechEnd&&o.recognition.addEventListener("end",()=>{o.runtimeTranscription&&""!==o.runtimeTranscription&&(l.push(o.runtimeTranscription),function(t,e){let a="",o=!1,r=n.ignoreSpace?e.replace(/ /g,""):e;r=n.ignoreCapital?r.toLowerCase():r,Object.keys(n.words).some(function(t){var e=n.words[t];if(o=!1,e.some(function(e){if(e=n.ignoreSpace?e.replace(/ /g,""):e,(e=n.ignoreCapital?e.toLowerCase():e).indexOf(r)>-1)return o=!0,a=t,!0}),o)return!0}),n.method.speechEnd(a||"pardonMe",t,e)}(l,o.runtimeTranscription)),n.isDev&&console.log(o.runtimeTranscription),o.runtimeTranscription="",o.recognition&&o.recognition.start()}),o):(r=null,void console.warn(">> 씨투아이: 음성인식 브라우저가 아닙니다. Chrome, Firefox 중 택일하여 사용하세요."))},o.startStop=function(){if(null!==r)return(r=!r)?(o.recognition||o.checkSupport(),o.recognition.start()):o.recognition=void 0,o},a.createAccessor(o,n)},c2i.chart.std=((c2iCon,options)=>{"use strict";const _u=c2i.util;if(!_u.checkLicenseLocale(options))return!1;if(!_u.checkConfig(c2iCon,options))return!1;let chart={},cfg={isResponsive:!0,width:"100%",margin:{top:30,left:30,right:30,bottom:30,isDynamic:!1},aspectRatio:"1:1",ease:"linear",duration:350,delay:20,data:void 0,preBuildData:!1,rawStructure:void 0,isMark:!0,title:void 0,xDim:void 0,yDim:void 0,y2Dim:void 0,measures:void 0,useGhostBar:!0,xyValueGrid:"xy",legend:void 0,tooltip:void 0,isDev:void 0};options.method=options.method||{},_u.init(cfg,options),cfg.customColors&&_u.setCustomColors(cfg.customColors),cfg.themeInit=cfg.themeInit?cfg.themeInit:cfg.theme;const _c2iCon=d3.select(c2iCon),_oID="#c2iOption",_clipName=c2iCon.substr(1)+"-body-clip",BARS=["stackbar","stackbar100","groupbar"],AREAS=["stackarea","stackarea100","stackstream"];let _width=_u.computeDim(_c2iCon,cfg),_lang=c2i.lang,_meta,_cluster,_rawData,_orgData,_clearing,_svg,_bodyG,_axesG,_xAxis,_x2Axis,_xAxisG,_x2AxisG,_yAxis,_y2Axis,_yAxisG,_y2AxisG,_yParetoAxis,_yParetoAsisG,_bars,_stackLabels,_layerCnt,_xWidthHalf,_brushing,_xValues,_sortedMeasure,_tip,_tipFirst,_option,_xDragPos,_yDragPos,_whichY="y",_format=d3.format(",.0f"),_selectedMeasures=[],_xPlotLables=[],_brushData=[],_sorted="",_xWidth=0,_dr=cfg.duration,_xCaption,_xUnitNm,_xColNm,_xScale,_xFormat,_xAxisPos,_xTicks,_xTickWidth,_xPos,_xDy,_xTickPad,_xIsShow,_xShowGrid,_xImage,_xPad,_xWrapLabel,_yCaption,_yUnitNm,_yScale,_yFormat,_yCluster,_yStackValue,_yAxisPos,_yDx,_yDy,_yTicks,_yTickWidth,_yIsShow,_yShowGrid,_yMinGap,_yMaxGap,_yBaseValue,_y2Scale,_y2Caption,_y2UnitNm,_y2Cluster,_y2StackValue,_y2Format,_y2AxisPos,_y2Dx,_y2Dy,_y2Ticks,_y2TickWidth,_y2IsShow,_y2ShowGrid,_y2MinGap,_y2MaxGap,_y2BaseValue,_xX,_xX2,_yY,_y2Y,_yPareto,_yRatio,_ySplit,_displayTips,_isNegative,_isNegativeEach,_yPlotTexture,_xPlotTexture,_yPlotTextureValue,_xBrush,_xBrushG,_summaryTypes,_paretoIndex,_trendIndex;const _key=t=>c2i.util.getClassPure(t.key),_getFormat=(t,e)=>{const a=_getMeasure(t);return(_format=_u.formatAll(a.format))(e)},_colorMeasure=d3.scaleOrdinal(),_fontsMeasure=d3.scaleOrdinal(),_txY=d3.scaleOrdinal(),_txY2=d3.scaleOrdinal(),_txYPlot=d3.scaleOrdinal(),_txXPlot=d3.scaleOrdinal(),_txXPlotNeg=d3.scaleOrdinal(),_fix={left:0},_dragHandle=d3.drag().on("start",__dragStart).on("drag",__dragMove).on("end",__dragEnd),_dragParetoHandle=d3.drag().on("start",__dragStartPareto).on("drag",__dragMovePareto).on("end",__dragEndPareto),_dragPlotHandle=d3.drag().on("start",__dragStartPlot).on("drag",__dragMovePlot).on("end",__dragEndPareto);let _dragSplitHandle=d3.drag().on("drag",__dragMoveSplitY).on("end",__dragMoveSplitYRender);function __dragStart(t){const e=t.sourceEvent;e.stopPropagation(),_xDragPos=parseFloat(d3.select(this).style("left"))-e.pageX,_yDragPos=parseFloat(d3.select(this).style("top"))-e.pageY,"c2iOption"!==this.id||d3.selectAll("#c2iColorPickerPop").empty()||d3.selectAll("#c2iColorPickerPop").remove()}function __dragMove(t){const e=t.sourceEvent;d3.select(this).style("opacity",.5).style("left",()=>e.pageX+_xDragPos+"px").style("top",()=>e.pageY+_yDragPos+"px")}function __dragEnd(){d3.select(this).style("opacity","c2iOption"===this.id?cfg.optWin.opacity:cfg.tooltip.opacity)}function __dragStartPareto(t){t.sourceEvent.stopPropagation();const e=_u.transform(d3.select(this).attr("transform"));_xDragPos=e.translate,d3.select(this).style("opacity",.5)}function __dragMovePareto(t){const e=t.sourceEvent,a=e.offsetX?e.offsetX:t.x;a>_xStart()&&a<_xEnd()&&(_xDragPos[0]=a,d3.select(this).attr("transform","translate("+_xDragPos+")"))}function __dragEndPareto(){d3.select(this).style("opacity",1)}function __dragMoveSplitY(t,e){const a=t.sourceEvent;a.stopPropagation(),_ySplit=!0;let o=a.offsetY?a.offsetY:t.y;if(o>=_yEnd()&&o<=_yStart()){d3.select(this).attr("cy",o),o-=_yEnd();const t=cfg.common.ySplit;t.ratio=+(o/_contentH()).toFixed(2),1===t.ratio&&(t.ratio=0),_yRatio=parseInt(100*t.ratio),d3.select("#__ySplitText").text(_yRatio+"%"),d3.select("#ySplit").property("value",_yRatio)}}function __dragMoveSplitYRender(){if(!_ySplit)return;const t=cfg.common.ySplit;cfg.yDim&&(t.ratio?_yY.rangeRound([_contentH()*t.ratio,0]):_yY.rangeRound([_contentH(),0])),cfg.y2Dim&&(t.ratio?_y2Y.rangeRound([_contentH(),_contentH()*t.ratio]):_y2Y.rangeRound([_contentH(),0])),chart.render(),_ySplit=!1}function __dragStartPlot(t){t.sourceEvent.stopPropagation();const e=_u.transform(d3.select(this).attr("transform"));_yDragPos=e.translate}function __dragMovePlot(t,e){const a=t.sourceEvent;let o="touchmove"===a.type?a.touches[0].pageY:a.offsetY;if(o>_yStart()||o<_yEnd())return;o-=cfg.margin.top,_yDragPos[1]=o,d3.select(this).style("opacity",.5).attr("transform","translate("+_yDragPos+")");const n=c2iCon.substr(1)+e.relCol+"_split",r=_contentH(),l=cfg.common,i="y"===e.yDim?_yY:_y2Y;let s=0;l&&l.ySplit&&l.ySplit.ratio?("y"===e.yDim?r*=l.ySplit.ratio:s=r*l.ySplit.ratio,o=Math.round(100*(1-(o-s)/(r-s)))+"%"):o=Math.round(100*(1-o/r))+"%",__plotUpdateStops(n,[{offset:o},{offset:o}],i.domain(),e.yDim);const c=d3.format(",d"),d=d3.format("y"===e.yDim?cfg.yDim.formatAvg:cfg.y2Dim.formatAvg);_bodyG.selectAll("text.plotLine."+e.relCol+e.index).attr("y",function(t){const e=d3.format(t.format),a="y"===t.yDim?_yY.invert(_yDragPos[1]):_y2Y.invert(_yDragPos[1]);let o,n,r,l=0,i=0,s=0,u=0;if(cfg.data[0].values.forEach(e=>{l+=e[t.relCol],e[t.relCol]>a?(u++,i+=e[t.relCol]):s+=e[t.relCol]}),o=cfg.data[0].values.length-u,n=0===u?0:i/u,r=0===o?0:s/o,d3.select(this).text(t=>`${t.caption}: ${e(t.y)} -> ${d(a)} (${_lang.gen.top}: ${e(i)} / ${c(u)} = ${d(n)} , ${_lang.gen.bottom}: ${e(s)} / ${c(o)} = ${d(r)})`),cfg.method.mousemove){const e={caption:t.caption,captionValue:t.y,captionAvg:a,aboveTot:i,aboveCnt:u,aboveAvg:n,belowTot:s,belowCnt:o,belowAvg:r};cfg.method.mousemove({container:c2iCon,selector:"plot"},e)}let m=t.dy?t.dy:-10;return t.pos&&"rightout"===t.pos.toLowerCase()&&(m=parseInt(t.fonts[1])/2),_yDragPos[1]+m})}function renderOthers(){const t=cfg.others;if(!t||!t.captions||0===t.captions.length)return;t.opacity=t.opacity?t.opacity:.9;let e=_svg.selectAll(".gOthers").data(t.captions);e.enter().append("g").attr("class","gOthers").append("text").style("text-anchor",(e,a)=>t.pos[a][0]).attr("class","others").style("font-family",(e,a)=>t.fonts[a][0]).style("font-size",(e,a)=>t.fonts[a][1]).style("fill",(e,a)=>t.fonts[a][2]).text(t=>t).merge(e),_svg.selectAll(".gOthers").style("fill-opacity",1e-6).attr("transform","translate("+[_xStart()+_contentW()/2,0]+")").transition().duration(_dr).attr("transform",(e,a)=>{return"translate("+["middle"===t.pos[a][0]?_xStart()+_contentW()/2:"start"===t.pos[a][0]?_xStart()+t.gap[a]:_xEnd()-t.gap[a],"middle"===t.pos[a][1]?cfg.height/2:"top"===t.pos[a][1]?_yEnd()+t.gap[a]:_yStart()-t.gap[a]]+")"}).style("fill-opacity",t.opacity)}chart.render=function(t){if(!_rawData||0===_rawData.length)return void _u.alert("*.도깨비 차트에 사용할 데이터 없습니다.");const e=cfg.optWin;if(!_svg){if(_svg=_c2iCon.append("svg").attr("width",_width).attr("height",cfg.height).style("background",cfg.theme?cfg.theme:null),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),!_lang)return;cfg.legend&&renderLegend(),e&&(_option=_u.renderOptionWindow(cfg,_svg,_oID,_option,_makeOptionView))}return e&&!e.optBtnHide&&_u.optionBtnView(cfg,_width,_option),setUpScaleX(),_yCluster&&setUpScaleY("y",_yCluster),_y2Cluster&&setUpScaleY("y2",_y2Cluster),_axesG?_renderUpdateAxis():renderAxes(),dynamicMargin(),defineBodyClip(),renderBody(),_clearing=!1,"function"==typeof t&&t(),chart};const __xAxisText=function(t){if(cfg.xDim.histogram)return void _xAxisG.selectAll(".x .tick > text").remove();let e=-1;if("band"!==_xScale&&"point"!==_xScale||!t.ticks||(e=parseInt(_xX.domain().length/t.ticks)),"band"===_xScale||"point"===_xScale)switch(t.ticks){case 0:e=-1;break;case-1:e=Math.ceil(_xX.domain().length/(_width/_xTickWidth));break;default:e=Math.ceil(_xX.domain().length/t.ticks)}_xAxisG.selectAll(".x .tick > text").style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).attr("fill",t.fonts[2]).style("fill-opacity",(t,a)=>a%e==0||-1===e?1:0).attr("class",t=>_u.getClassName(_xValues,t)).on("click",(t,e)=>{cfg.method.click&&_rawData.forEach(a=>{a[cfg.xDim.colNm]===e&&cfg.method.click(t,{container:c2iCon,selector:"xLabel"},{xLabel:e,data:a})})});let a=[];cfg.xDim.xLabelColNm&&(_rawData.forEach(t=>{t[cfg.xDim.xLabelColNm]&&a.push(t[cfg.xDim.colNm])}),a.length>0&&_xAxisG.selectAll(".x .tick > text").style("fill-opacity",t=>a.indexOf(t)>-1?1:0)),cfg.measures.forEach(function(o){o.float&&function(e){e.floatData=[],e.float.forEach((t,a)=>{let o;t.xValue?(o=void 0,_rawData.some(e=>{if(e[_xColNm]===t.xValue)return(o=e).__xValue=t.xValue,!0})):o=_rawData.reduce((a,o)=>void 0===t.maxValue||t.maxValue?a[e.colNm]>o[e.colNm]?a:o:a[e.colNm]<o[e.colNm]?a:o),o.__float_idx=a,o.__xStyle=t.xStyle,e.floatData.push(o)}),_xAxisG.selectAll(".x .tick > text").style("fill",function(o){let n;if(e.float){let t;if(e.floatData.some(a=>{if(a[cfg.xDim.colNm].indexOf(o)>-1)return a.__xStyle?t=e.float[a.__float_idx].color:n=!0,!0}),t)return t}return a.indexOf(o)>-1?n?d3.select(this).style("fill"):t.fonts[2]:null})}(o),o.xGridLine&&_xAxisG.selectAll(".x .tick > line").style("stroke-opacity",(t,a)=>o.xGridLine.indexOf(a)>-1||-1===e?1:0),o.fix&&(_fix={left:0},function(e){let a;const o=e.fonts,n=_xAxisG.selectAll(".fix").data(e.fix),r=n.enter().append("g").attr("class","fix").attr("transform",t=>"translate("+[t.groupX,0]+")");switch(r.append("text").attr("class","fixTick").style("text-anchor","middle").style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).attr("fill",t=>t.color).attr("x",t=>t.tick.x?t.tick.x:0).attr("y",t=>t.tick.y?t.tick.y:12).text(t=>t.label),r.append("text").attr("class","fixValue").style("text-anchor","middle").style("font-family",o[0]).style("font-size",o[1]).attr("fill",t=>t.color).text(t=>t.prefix+" "+t.value+t.suffix),e.graphType){case"line":r.append("circle").attr("r",t=>void 0!==t.radius?t.radius:e.dotRange[0]).style("fill",t=>t.color),n.selectAll("circle").attr("cx",t=>t.tick.x?t.tick.x:0).attr("cy",t=>t.labelDy>0?-1*t.labelDy:-1*(_contentH()+cfg.margin.top+t.labelDy));break;case"bar":!function(){r.append("rect").style("fill",t=>t.color),n.selectAll("rect").attr("width",_xX.bandwidth()).attr("height",t=>(a=t.labelDy>0?t.labelDy:-1*(_contentH()+cfg.margin.top+t.labelDy),Math.abs(a)*t.height+parseInt(o[1])/2)).attr("x",-_xX.bandwidth()/2).attr("y",t=>t.labelDy>0?0:-1*d3.select(this).attr("height"))}();break;default:return void alert("특수 제작 차트입니다. 구매처에 문의하세요.")}n.selectAll(".fixValue").attr("x",t=>(_fix.left+=t.groupX,t.labelDx)).attr("y",t=>(a="bar"===e.graphType?t.labelDy>0?t.labelDy:-1*(_contentH()+cfg.margin.top+t.labelDy):t.labelDy>0?-1*t.labelDy:-1*(_contentH()+cfg.margin.top+t.labelDy))-parseInt(o[1]))}(o))})},__yNY2AxisText=function(t,e,a,o){o.selectAll("."+a+" .tick > text").style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).attr("fill",a=>{if(t.axisLabelColor&&Array.isArray(t.axisLabelColor)&&3===t.axisLabelColor.length){return t.axisLabelColor[2]=e.domain()[1]/2,a>=(3===t.axisLabelColor.length?t.axisLabelColor[2]:0)?t.axisLabelColor[0]:t.axisLabelColor[1]}return t.fonts[2]}).style("fill-opacity",t.showLabel?null:0)},_xBrushed=function(t){const e=t.selection,a=cfg.xDim;null===e?(_rawData=_orgData,a.ticks=a.saveTicks?a.saveTicks:0,a.saveTicks,_x2AxisG.classed("xBrush",null),_x2AxisG.selectAll(".xBrush text").classed("selected",!1)):(_x2AxisG.classed("xBrush",!0),_brushData=[],_x2AxisG.selectAll(".xBrush text").classed("selected",function(t){const a=t,o=e[0]<=(t=_xX2(t))&&t<=e[1];return o&&(d3.select(this).style("fill",cfg.xDim.brush.fonts[2]),-1===_brushData.indexOf(a)&&_brushData.push(a)),o}))},_xBrushedEnd=function(){if((_brushData.length||_rawData.length!==_orgData.length)&&((_rawData=_orgData.filter(t=>{if(_brushData.indexOf(t[_xColNm])>-1)return t})).length||(_rawData=_orgData.map(t=>t)),_xIsShow)){const t=cfg.xDim;void 0===t.saveTicks&&(t.saveTicks=t.ticks),t.ticks=0===_brushData.length?t.saveTicks:0}if(_brushing=!0,cfg.pareto){const t=cfg.pareto.isDraw;cfg.pareto.isDraw=!1,dataInit(!0),chart.render(),cfg.pareto.isDraw=t,cfg.optWin&&d3.select(_oID).select("#paretoLines").property("checked",t)}else dataInit(!0),chart.render();_brushing=!1};function _renderAxisX(){const t=_width<300&&_xTicks>2?2:_xTicks,e=!0===_xShowGrid?-_contentH():0;_xAxis||(_xAxis="top"===_xAxisPos?d3.axisTop():d3.axisBottom()).tickPadding(_xTickPad),_xAxis.scale(_xX).ticks(t,_xFormat).tickSize(e),_xAxisG||(_xAxisG=(_xAxisG=_axesG.selectAll(".x.axis").data(_xIsShow?[null]:[])).enter().append("g").attr("class","x axis").merge(_xAxisG)),_xAxisG.attr("transform","translate("+[_xStart(),"top"===_xAxisPos?_yEnd():_yStart()]+")").transition().duration(_dr).call(_xAxis),__xyTickLine("x");const a=cfg.xDim;if(__xAxisText(a),_displayXLabel(),_xCaption){const t=_xAxisG.selectAll(".xCaption").data([_xCaption]);t.enter().append("text").attr("class","xCaption").style("font-family",a.captionFonts[0]).style("font-size",a.captionFonts[1]).attr("fill",a.captionFonts[2]).style("text-anchor",_xPos||"middle").attr("dy",_xDy).merge(t).text(t=>_xUnitNm?t+_xUnitNm:t).attr("x","start"===_xPos?0:"end"===_xPos?_contentW():_contentW()/2)}}function _renderAxisY(){const t=__getTicks(_yTicks),e=_yShowGrid?-_contentW():0;_yAxis||(_yAxis="left"===_yAxisPos?d3.axisLeft():d3.axisRight()).tickPadding(6),_yAxis.scale(_yY).ticks(_yCluster.indexOf("stream")>-1?0:t,_yFormat).tickFormat(_u.formatAll(_yFormat,_yFormat,!1)).tickSize(e),_yAxisG||(_yAxisG=(_yAxisG=_axesG.selectAll(".y.axis").data(_yIsShow?[null]:[])).enter().append("g").attr("class","y axis").merge(_yAxisG)),_yAxisG.call(_yAxis).attr("transform","translate("+[_xStart(),_yEnd()]+")").transition().duration(_dr),__xyTickLine("y");const a=cfg.yDim;if(__yNY2AxisText(a,_yY,"y",_yAxisG),_yCaption){const t=_yAxisG.selectAll(".yCaption").data([_yCaption]);t.enter().append("text").attr("class","yCaption").style("pointer-events","none").style("font-family",a.captionFonts[0]).style("font-size",a.captionFonts[1]).attr("fill",a.captionFonts[2]).attr("dx",_yDx).attr("dy",_yDy).style("writing-mode",a.captionV?"tb":"").style("text-anchor",a.captionV?"start":"end").style("opacity",a.opacity).merge(t).text(t=>_yUnitNm?t+_yUnitNm:t)}}function _renderAxisY2(){const t=__getTicks(_y2Ticks),e=_y2ShowGrid?-_contentW():0;_y2Axis||(_y2Axis="left"===_y2AxisPos?d3.axisLeft():d3.axisRight()).tickPadding(6),_y2Axis.scale(_y2Y).ticks(_y2Cluster.indexOf("stream")>-1?0:t,_y2Format).tickFormat(_u.formatAll(_y2Format,_y2Format,!1)).tickSize(e),_y2AxisG||(_y2AxisG=(_y2AxisG=_axesG.selectAll(".y2.axis").data(_y2IsShow?[null]:[])).enter().append("g").attr("class","y2 axis").merge(_y2AxisG)),_y2AxisG.attr("transform","translate("+[_xEnd(),_yEnd()]+")").transition().duration(_dr).call(_y2Axis),__xyTickLine("y2");const a=cfg.y2Dim;if(__yNY2AxisText(a,_y2Y,"y2",_y2AxisG),_y2Caption){const t=_y2AxisG.selectAll(".y2Caption").data([_y2Caption]);t.enter().append("text").attr("class","y2Caption").style("pointer-events","none").style("font-family",a.captionFonts[0]).style("font-size",a.captionFonts[1]).attr("fill",a.captionFonts[2]).attr("dx",_y2Dx).attr("dy",_y2Dy).style("writing-mode",a.captionV?"tb":"").style("text-anchor",a.captionV?"start":"end").style("opacity",a.opacity).merge(t).text(t=>_y2UnitNm?t+_y2UnitNm:t)}}function renderAxes(){_axesG=_svg.append("g").attr("class","axes"),_xIsShow&&_renderAxisX(),_yIsShow&&_renderAxisY(),_y2IsShow&&_renderAxisY2();const t=cfg.common.domain;_svg.selectAll(".axes .axis .domain").style("fill","none").style("stroke",t.stroke).style("stroke-width",t.strokeWidth).style("stroke-opacity",t.opacity).style("shape-rendering","crispEdges"),_svg.selectAll(".axes .axis line").style("shape-rendering","crispEdges"),cfg.xDim.brush&&!cfg.xDim.brush.hide&&function(){const t=cfg.xDim.brush;_xX2=_xX.copy(),_orgData||(_orgData=_rawData);_xX2.domain(_orgData.map(t=>t[_xColNm]));let e=-1;"band"===_xScale&&(_xX2.rangeRound([0,_contentW()],_xPad[0]),t.ticks&&(e=parseInt(_xX2.domain().length/t.ticks)),e=0===e?1:e);(_x2Axis="top"===_xAxisPos?d3.axisTop():d3.axisBottom()).scale(_xX2).tickSize(5).tickPadding(_xTickPad),(_x2AxisG=_axesG.append("g").attr("class","axis").attr("transform","translate("+[_xStart(),"top"===_xAxisPos?_yEnd()-t.dy:_yStart()+t.dy]+")").call(_x2Axis)).selectAll(".tick > text").attr("class","xCaption").style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).style("fill",t.fonts[2]).style("fill-opacity",(t,a)=>"band"===_xScale?a%e==0||-1===e?.5:0:1),_x2AxisG.selectAll("path.domain").style("fill","none").style("stroke-width",1).style("stroke",t.stroke).style("stroke-opacity",.5),_xBrush=d3.brushX().extent([[0,0],[_contentW(),25]]).on("start brush",_xBrushed).on("end",_xBrushedEnd),(_xBrushG=_axesG.append("g").attr("class","xBrushG").attr("transform","translate("+[_xStart(),"top"===_xAxisPos?_yEnd()-t.dy:_yStart()+t.dy]+")").call(_xBrush)).selectAll("rect").style("fill","none").style("stroke",t.stroke).style("opacity",.7).attr("height",t.height),_xBrushG.selectAll(".resize > rect").style("fill",t.fonts[2]).style("opacity",.8).style("visibility",null)}(),_yParetoAsisG=void 0}function __xyTickLine(t){const e=cfg.common.grid;_svg.selectAll("."+t+" .tick line").style("stroke",e.stroke).style("stroke-width",e.strokeWidth).style("stroke-dasharray","x"===t?e.dashLength[0]:"y"===t?e.dashLength[1]:e.dashLength[2]).style("stroke-opacity",e.opacity)}function _renderUpdateAxis(){if(_xAxis&&_renderAxisX(),_yAxis&&_renderAxisY(),_y2Axis&&_renderAxisY2(),_yParetoAxis&&(_yPareto.range([_contentH(),15]),_yParetoAxis.scale(_yPareto),_yParetoAsisG.call(_yParetoAxis).attr("transform","translate("+[_xEnd()-50,_yEnd()]+")"),__paretoAxisDraw()),cfg.xDim.brush&&!cfg.xDim.brush.hide){const t=cfg.xDim.brush;let e=!1;if(_orgData||(e=!0,_orgData=_rawData,_xX2.domain(_orgData.map(t=>t[_xColNm]))),"band"===_xScale&&(cfg.xDim.roundType&&"rangepoints"===cfg.xDim.roundType.toLowerCase()?_xX2.rangePoints([0,_contentW()],_xPad[0]):_xX2.rangeRound([0,_contentW()],_xPad[0])),_x2Axis.scale(_xX2),_x2AxisG.call(_x2Axis).attr("transform","translate("+[_xStart(),"top"===_xAxisPos?_yEnd()-t.dy:_yStart()+t.dy]+")"),_xBrush.extent([[0,0],[_contentW(),25]]),_xBrushG.call(_xBrush).attr("transform","translate("+[_xStart(),"top"===_xAxisPos?_yEnd()-t.dy:_yStart()+t.dy]+")"),e){let e=-1;"band"===_xScale&&t.ticks&&(e=parseInt(_xX2.domain().length/t.ticks)),_x2AxisG.selectAll(".tick > text").style("fill",t.fonts[2]).style("fill-opacity",(t,a)=>"band"===_xScale?a%e==0||-1===e?1:0:1)}else if(cfg.resizing&&0!==(_brushData=_x2AxisG.selectAll(".xBrush text.selected").data()).length){const t=_xX2(_brushData[0]),e=_xX2(_brushData[_brushData.length-1]);_xBrushG.select("rect.selection").attr("x",t).attr("width",e-t),_xBrushG.select(".handle--w").attr("x",t-3),_xBrushG.select(".handle--e").attr("x",e-3)}}}function _clampDraw(){_svg.select("#"+_clipName).select("rect").attr("width",_contentW()).attr("height",_contentH())}function defineBodyClip(){let t=_svg.select("g.c2iDefs");t.empty()&&((t=_svg.append("g").attr("class","c2iDefs")).append("defs").attr("id",c2iCon.substr(1)+"_c2iGradBar"),t.append("defs").attr("id",c2iCon.substr(1)+"_c2iGradCircle"),t.append("defs").attr("id",c2iCon.substr(1)+"_c2iArrow"),cfg.clamp&&t.append("defs").attr("id",_clipName+"_def").append("clipPath").attr("id",_clipName).append("rect").attr("x",0).attr("y",0)),cfg.clamp&&_clampDraw(),_svg.select("g.c2iTextures").remove();const e=_svg.append("g").attr("class","c2iTextures"),a=_colorMeasure.range();_txY.range().forEach(function(t,o){t.fill&&t.fill(a[o]),t.stroke(a[o]),e.call(t)});let o=0;if(cfg.measures.forEach(function(t){"y"===t.yDim&&o++}),_txY2.range().forEach(function(t,n){t.fill&&t.fill(a[n+o]),t.stroke(a[n+o]),e.call(t)}),_txYPlot.range().forEach(function(t,o){t.fill&&t.fill(a[o]),t.stroke(a[o]),e.call(t)}),_xPlotTexture){let t=Number.MAX_VALUE;const o=cfg.xDim.startTexture[1];_xPlotLables=[],cfg.data[0].values.forEach((e,a)=>{(e[_xColNm]===o||a>t)&&(t=a,_xPlotLables.push(e[_xColNm]))}),_txXPlot.range().forEach((t,o)=>{t.fill&&t.fill(a[o]),t.stroke(a[o]),e.call(t)}),_txXPlotNeg.range().forEach((t,a)=>{const o=_getMeasure(_txXPlotNeg.domain()[a]);o.negative&&(t.fill&&t.fill(o.negative.color),t.stroke(o.negative.color),e.call(t))})}}function renderLegend(){let t="y",e=[],a=!1;if(_yCluster.indexOf("box")>-1||_y2Cluster&&_y2Cluster.indexOf("box")>-1){let o;_y2Cluster&&_y2Cluster.indexOf("box")>-1&&(t="y2"),cfg.measures.forEach(function(n){n.yDim===t?n.colNm===cfg.boxConfig.max&&(a||((o=_u.deepClone(n)).caption=_lang.cm.boxPlot,e.push(o),a=!0)):e.push(n)})}else cfg.measures.forEach(t=>{e.push(t)});let o=!0;const n=cfg.legend;if(!n)return;d3.select(n.id).selectAll(".c2iLgItem").remove();const r=d3.select(n.id).style("padding",n.padding).style("background",n.backColor&&"none"!==n.backColor?n.backColor:null);function l(t,e){d3.select(t).property("checked")?_selectedMeasures.push(e.colNm):_selectedMeasures.splice(_selectedMeasures.indexOf(e.colNm),1),chart.renderFromLegend()}e.forEach(function(t){r.append("input").attr("id",n.id.substr(1)+t.colNm).attr("class","c2iLgItem").attr("type","checkbox").property("checked",t.draw).attr("value",t.colNm).style("margin-left",()=>"y2"===t.yDim&&o?(o=!1,n.yNy2Gap):n.itemGap).on("touchstart",function(e){e.preventDefault(),e.stopPropagation(),d3.select(this).property("checked",!d3.select(this).property("checked")),l(this,t)}).on("click",function(e){if(e.shiftKey){const t=_getMeasure(d3.select(this).property("value"));d3.select(this).property("checked")?cfg.measures.forEach(e=>{t.yDim!==e.yDim||e.draw||(e.draw=!0,r.select(n.id+e.colNm).property("checked",!0),-1===_selectedMeasures.indexOf(e.colNm)&&_selectedMeasures.push(e.colNm))}):cfg.measures.forEach(e=>{t.yDim===e.yDim&&(e.draw=!1,r.select(n.id+e.colNm).property("checked",!1),_selectedMeasures.indexOf(e.colNm)>-1&&_selectedMeasures.splice(_selectedMeasures.indexOf(e.colNm),1))}),chart.renderFromLegend()}else cfg.measures.some(e=>{if(t.colNm===e.colNm)return e.draw=r.select(n.id+e.colNm).property("checked"),!0}),l(this,t)}),r.append("label").attr("class","c2iLgItem "+t.colNm).text(n.cutLength?t.caption.substr(0,n.cutLength):t.caption).style("font-family",n.fonts[0]).style("font-size",n.fonts[1]).style("margin-left",n.labelGap).style("color",t.color[0]).on("touchstart",()=>chart.chartToggle(t.colNm,!0)).on("touchend",()=>chart.chartToggle(t.colNm,!1)).on("mouseenter",()=>chart.chartToggle(t.colNm,!0)).on("mouseleave",()=>chart.chartToggle(t.colNm,!1))})}function dynamicMargin(){const t=cfg.margin,e=cfg.xyValueGrid;if(t.isDynamic){let a,o;_selectedMeasures.length&&_selectedMeasures.forEach(t=>{if(cfg.measures.some(e=>{if(t===e.colNm){if("y"===e.yDim&&!a)return a=!0,!0;if("y2"===e.yDim&&!o)return o=!0,!0}}),a&&o)return!0}),_yAxis&&(a?(_yAxisG.style("fill-opacity",null),t.left_&&(t.left=t.left_)):(_yAxisG.style("fill-opacity",0),t.left_?t.left=t.left_*(e?.75:.25):(t.left_=t.left,t.left=t.left*(e?.75:.25)))),_y2Axis&&(o?(_y2AxisG.style("fill-opacity",null),t.right_&&(t.right=t.right_)):(_y2AxisG.style("fill-opacity",0),t.right_?t.right=t.right_*(e?.75:.25):(t.right_=t.right,t.right=t.right*(e?.75:.25))))}_bodyG&&_bodyG.attr("transform","translate("+_xStart()+","+_yEnd()+")"),cfg.clamp&&_clampDraw()}function _makeOptionView(){function __selectTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.options&&Array.isArray(t.options)&&t.options.forEach(t=>{t.label?(t.c2i18n=[t.label],t.label=___translate2(t.label,0)):!t.separator&&t.value&&(t.label=t.value)})}function __buttonTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.label&&(t.c2i18n=[t.label],t.label=___translate2(t.label,0))}function __divTrans(t){t.c2i18n=[t.caption],t.caption=___translate2(t.caption,0),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0)),t.labels&&Array.isArray(t.labels)&&t.labels.forEach(t=>{t.label&&(t.c2i18n=[t.label],t.label=___translate2(t.label,0)),t.title&&(t.c2i18n.push(t.title),t.title=___translate2(t.title,0))})}_meta||(_meta=_u.deepClone(c2i.meta.std),_meta.title=___translate2(_meta.title,0),_meta.data.forEach(t=>{switch(t.type){case"select":__selectTrans(t);break;case"button":__buttonTrans(t);break;default:__divTrans(t)}})),_cluster="y"===_whichY?cfg.yDim.cluster:cfg.y2Dim.cluster,d3.select(_oID).remove(),d3.select("body").append("div").attr("id",_oID.substr(1)).attr("class","c2iOption");const table=d3.select(_oID).call(_dragHandle).append("table").style("width",cfg.optWin.width?cfg.optWin.width:"300px"),theadTr=table.append("thead").style("cursor","move").append("tr").append("th").attr("colspan",3).attr("class","tipHeader"),tbody=table.append("tbody");let bodyTrs,trTds,options,method,func,data,tmp;theadTr.append("div").attr("class","c2iCloseBtn").on("click",()=>d3.select(_oID).classed("c2iHidden",!0)).attr("data-c2i18n","gen.closeX,gen.close").attr("title",function(){return ___translate(this,1)}).text(function(){return ___translate(this,0)}),theadTr.append("div").append("p").append("strong").append("span").attr("id","optionName").attr("data-c2i18n","std.title").text(_meta.title);let nodes=[];const realNodes=[],isPlaceEmpty=d3.selectAll(".c2iPlace").empty();function ___translate2(t,e){if(t.indexOf(",")>-1)t=t.split(",");else{if(e>0)return null;t=[t]}return t[e].indexOf(".")>-1?(t=t[e].split("."),_lang[t[0]][t[1]]):_lang.std[t[e]]}function ___translate(t,e){const a=d3.select(t).attr("data-c2i18n");return a?___translate2(a,e):null}function ___bodyTrs_trTds(t){bodyTrs=tbody.selectAll("tr."+t.node+t.seq).data(data.filter(e=>e.type===t.node&&e.seq===t.seq)),(trTds=bodyTrs.enter().append("tr").attr("class",e=>e.dev?t.node+t.seq+" isDev":t.node+t.seq)).append("td").attr("class","caption").attr("data-c2i18n",t=>t.c2i18n).attr("title",function(){return ___translate(this,1)}).text(function(){return ___translate(this,0)})}function __renderSelect(d0){___bodyTrs_trTds(d0);const select=trTds.append("td").append(d0.node).attr("id",t=>t.id).attr("class",t=>t.cls).property("disabled",t=>{switch(t.id){case"tooltipMag":return cfg.tooltip?null:"disabled"}});function ____dynamicChart(){let t,e;return nodes=[],d3.selectAll(".c2iPlace").filter(function(){return this.id!==c2iCon.substr(1)}).attr("data-c2iTitle",function(a,o){if(this.id||(this.id=_oID.substr(1)+"_"+o),tmp=this.attributes["data-c2iLegendId"]?"#"+this.attributes["data-c2iLegendId"].value:"",e=this.attributes["data-c2iTitle"],t=e?e.value:this.title.length>0?this.title:_lang.gen.isTitle+" "+this.id,tmp={value:"#"+this.id,label:t,legendId:tmp},nodes.push(tmp),e)return e.value}),nodes}if(d0.method&&2===d0.method.length&&(method=d0.method[0],func=eval(d0.method[1]),select.on(method,func)),d0.dynamic&&(d0.options=____dynamicChart()),options=select.selectAll("option").data(t=>t.options.filter(t=>void 0===t.group||t.group===cfg.groupType)),options.enter().append("option").property("disabled",t=>t.separator?"disabled":null).attr("data-c2i18n",t=>t.c2i18n).attr("data-group",t=>t.group).attr("value",t=>t.value).property("selected",function(t){switch(d0.id){case"clusterType":return function(){return d3.select(_oID).selectAll(".yScale").property("disabled",()=>0===_cluster.indexOf("stack")),__selectedChartType(this,t.value)}();case"curveType":return("y"===_whichY?cfg.yDim.curve:cfg.y2Dim.curve)===t.value?"selected":null;case"colors":return function(){let e="y"===_whichY?cfg.yDim.color:cfg.y2Dim.color;e=e[1].length>0?e.join("/"):e[0];return e===t.value?"selected":null}();case"texture":return("y"===_whichY?cfg.yDim.texture:cfg.y2Dim.texture)===t.value?"selected":null;case"trendType":return function(){if(cfg.trend&&cfg.trend.method===t.value)return"selected"}();case"summaryType":return function(){let e="false";cfg.summary.isShow&&(e=cfg.summary.type);return e===t.value?"selected":null}();case"tooltipMag":return _u.tooltipMag(cfg,t);case"changeTheme":return cfg.theme===t.value?"selected":null}}).html(function(t){if(!t.separator)return t.c2i18n&&d3.select(this).attr("data-c2i18n",t.c2i18n),t.label;let e="";for(let a=0;a<t.length;a++)e+=c2i.meta.separator[t.idx];return e}),"object"==typeof d0.dynamic&&d0.options.length>0){const btn=trTds.append("td").append(d0.dynamic.type).attr("id",d0.dynamic.id).attr("class",d0.dynamic.cls).attr("data-c2i18n",d0.dynamic.caption).text(___translate2(d0.dynamic.caption,0));method=d0.dynamic.method[0],func=eval(d0.dynamic.method[1]),btn.on(method,func)}}function __renderButton(d0){___bodyTrs_trTds(d0);const btn=trTds.append("td").append(d0.node).attr("id",t=>t.id).attr("class",t=>t.cls).attr("data-c2i18n",t=>t.c2i18n).text(function(){return ___translate(this,0)});method=d0.method[0],func=eval(d0.method[1]),btn.on(method,func)}function __renderDiv(d0){___bodyTrs_trTds(d0);const div=trTds.append("td").append(d0.node).attr("class",t=>t.cls);function _labels(){d0.labels.forEach(function(t){div.append("input").attr("id",t.input.id).attr("class",t.input.cls?t.input.cls:null).attr("type",t.input.type).attr("name",t.input.name).attr("value",t.input.value).property("disabled",()=>{if("yScale"===t.input.cls)return!(!_isNegative||"log"!==t.input.value)||0===_cluster.indexOf("stack");if("plotLines"===t.input.id){const t="y"===_whichY?cfg.yDim.plotLines:cfg.y2Dim.plotLines;return!(Array.isArray(t)&&t.length>0)}return"paretoLines"===t.input.id?!cfg.pareto:"trendLines"===t.input.id?!cfg.trend:"tipFixed"===t.input.id?!cfg.tooltip:"ghostBar"===t.input.id?"each"!==_cluster:void 0}).property("checked",()=>{if("whichY"===t.input.name)return t.input.value===_whichY?"checked":null;if("yScale"===t.input.name)return t.input.value===("y"===_whichY?cfg.yDim.scale:cfg.y2Dim.scale)?"checked":null;if("scaleAuto"===t.input.id)return cfg.scaleAuto?"checked":null;if("tipFixed"===t.input.id)return cfg.tooltip&&cfg.tooltip.fixedPos?"checked":null;if("hideValLable"===t.input.id)return cfg.hideValLable?null:"checked";if("stackValue100"===t.input.name){let e="y"===_whichY?cfg.yDim.stackValue:cfg.y2Dim.stackValue;return e="ratio"===e?"both":e,t.input.value===e?"checked":null}if("plotLines"===t.input.id){const t="y"===_whichY?cfg.yDim.plotLines:cfg.y2Dim.plotLines;if(!t)return null;let e="checked";return t.some(t=>{if(!1===t.draw)return e=null,!0}),e}return"paretoLines"===t.input.id?cfg.pareto&&cfg.pareto.isDraw?"checked":null:"markers"===t.input.id?cfg.isMark?"checked":null:"trendLines"===t.input.id?cfg.trend&&cfg.trend.isDraw?"checked":null:"exceptZero"===t.input.id?cfg.trend&&cfg.trend.exceptZero?"checked":null:"ghostBar"===t.input.id?cfg.useGhostBar?"checked":null:void 0}),div.append("label").style("text-decoration",function(){if("plotLines"===t.input.id){const t="y"===_whichY?cfg.yDim.plotLines:cfg.y2Dim.plotLines;return!Array.isArray(t)||t.length<1?(d3.select(this).style("color","red"),"line-through"):null}if("paretoLines"===t.input.id)return cfg.pareto?null:(d3.select(this).style("color","red"),"line-through")}).attr("for",t.input.id).attr("class",t.cls?t.cls:null).attr("data-c2i18n",t.c2i18n).attr("title",t.title).text(t.label)})}function _range(){div.selectAll("label").data(t=>[t.range]).enter().append("input").attr("id",t=>t.input.id).attr("class",t=>t.input.cls).attr("type",t=>t.input.type).attr("min",t=>t.input.min).attr("max",t=>t.input.max).property("disabled",t=>{if("ySplit"===t.input.id)return!cfg.common||void 0===cfg.common.ySplit}).property("value",t=>{switch(t.input.id){case"ySplit":return d3.select("#ySplit").on("mousedown",t=>{t.stopPropagation()}),_yRatio}})}d0.labels?_labels():d0.range&&_range(),d0.method&&(method=d0.method[0],func=eval(d0.method[1]),d3.selectAll(d0.method[2]).on(method,func))}function __selectedChartType(t,e){let a=_cluster;return"each"===a&&cfg.measures.some(t=>{if(_whichY===t.yDim&&t.graphTypeSave)return a=t.graphType,!0}),a===e?"selected":null}function _whichYChange_(){_whichY=this.value,_cluster="y"===_whichY?cfg.yDim.cluster:cfg.y2Dim.cluster;const t="y"===_whichY?cfg.y2Dim.cluster:cfg.yDim.cluster;d3.select(_oID).select("#clusterType").selectAll("option").property("disabled",e=>"each"!==t&&("group"===e.group&&(e.value.indexOf("stack")>-1||e.value.indexOf("group")>-1))).property("selected",function(t){return __selectedChartType(this,t.value)});const e="y"===_whichY?cfg.yDim.curve:cfg.y2Dim.curve;d3.select(_oID).select("#curveType").selectAll("option").property("selected",t=>t.value===e?"selected":null),d3.select(_oID).selectAll(".yScale").property("checked",function(t,e){return d3.select(this).property("disabled",function(){return!(!_isNegative||"log"!==t.labels[e].input.value)||0===_cluster.indexOf("stack")}),t.labels[e].input.value===("y"===_whichY?cfg.yDim.scale:cfg.y2Dim.scale)||null});let a="y"===_whichY?cfg.yDim.stackValue:cfg.y2Dim.stackValue;d3.select(_oID).selectAll(".stackValue100").property("checked",(t,e)=>(a="ratio"===a?"both":a,t.labels[e].input.value===a?"checked":null)),d3.select(_oID).select("#plotLines").property("checked",()=>{const t="y"===_whichY?cfg.yDim.plotLines:cfg.y2Dim.plotLines;if(Array.isArray(t)&&t.length>0){let e=!0;return t.some(t=>{if(!1===t.draw)return e=!1,!0}),e}return null}),"each"===_cluster?d3.select(_oID).select("#ghostBar").property("checked",function(){return d3.select(this).property("disabled",!1),!!cfg.useGhostBar||null}):d3.select(_oID).select("#ghostBar").property("checked",!1).property("disabled",!0);let o="y"===_whichY?cfg.yDim.color:cfg.y2Dim.color;Array.isArray(o)&&(o=o[1].length>0?o.join("/"):o[0]),d3.select(_oID).select("#colors").selectAll("option").property("selected",t=>t.value===o?"selected":null);const n="y"===_whichY?cfg.yDim.texture:cfg.y2Dim.texture;d3.select(_oID).select("#texture").selectAll("option").property("selected",t=>t.value===n?"selected":null)}function _clusterTypeChange_(){["bar","line","area","linearea"].indexOf(this.value)>-1?(_cluster="each",cfg.measures.forEach(t=>{_whichY===t.yDim&&(t.graphTypeSave||(t.graphTypeSave=t.graphType),t.graphType=this.value)})):("each"===_cluster&&cfg.measures.forEach(t=>{_whichY===t.yDim&&(t.graphTypeSave&&(t.graphType=t.graphTypeSave),t.graphTypeSave=void 0)}),"groupbar"===(_cluster=this.value)||"each"===_cluster?d3.select(_oID).selectAll(".yScale").property("checked",function(t,e){return d3.select(this).property("disabled",()=>!(!_isNegative||"log"!==t.labels[e].input.value)||0===_cluster.indexOf("stack")),t.labels[e].input.value===("y"===_whichY?cfg.yDim.scale:cfg.y2Dim.scale)||null}):(d3.select(_oID).selectAll(".yScale").property("checked",function(t,e){return d3.select(this).property("disabled","linear"!==t.labels[e].input.value?"true":null),"linear"===t.labels[e].input.value||null}),"y"===_whichY?cfg.yDim.scale="linear":cfg.y2Dim.scale="linear"),"each"===_cluster?d3.select(_oID).select("#ghostBar").property("checked",function(){return d3.select(this).property("disabled",!1),!!cfg.useGhostBar||null}):d3.select(_oID).select("#ghostBar").property("checked",!1).property("disabled",!0)),"y"===_whichY&&cfg.yDim.cluster!==_cluster?(cfg.yDim.cluster=_cluster,chart.yDim(cfg.yDim)):"y2"===_whichY&&cfg.y2Dim.cluster!==_cluster&&(cfg.y2Dim.cluster=_cluster,chart.y2Dim(cfg.y2Dim)),chart.render()}function _curveTypeChange_(){"y"===_whichY?(cfg.yDim.curve=this.value,chart.yDim(cfg.yDim)):(cfg.y2Dim.curve=this.value,chart.y2Dim(cfg.y2Dim)),chart.render()}function _ySplitChange_(){const t=parseInt(this.value);_yRatio=100===t?0:t,d3.select("#__ySplitText").text(_yRatio+"%"),cfg.common.ySplit.ratio=_yRatio/100,chart.render()}function _yScaleChange_(){"y"===_whichY?(cfg.yDim.scale=this.value,chart.yDim(cfg.yDim).render()):(cfg.y2Dim.scale=this.value,chart.y2Dim(cfg.y2Dim).render())}function ___scaleAuto(){chart.scaleAuto(this.checked).render()}function ___tipFixed(){chart.tipFixed(this.checked)}function ___hideValLable(){chart.hideValLable(this.checked)}function _colorsChange_(){"y"===_whichY?(cfg.yDim.color=this.value,chart.yDim(cfg.yDim)):(cfg.y2Dim.color=this.value,chart.y2Dim(cfg.y2Dim)),chart.measures(cfg.measures).render(),renderLegend(),"function"==typeof cfg.legendExtern&&cfg.legendExtern(_colorMeasure.range())}function _textureChange_(){"y"===_whichY?(cfg.yDim.texture=this.value,chart.yDim(cfg.yDim)):(cfg.y2Dim.texture=this.value,chart.y2Dim(cfg.y2Dim)),chart.measures(cfg.measures).render()}function ___trendTypeChange(){cfg.trend&&(cfg.trend.method=this.value)}function ___summaryTypeChange(){"false"===this.value?cfg.summary.isShow=!1:(cfg.summary.type=this.value,cfg.summary.isShow=!0),chart.render()}function ___stackValue100(){"y"===_whichY?(cfg.yDim.stackValue=this.value,chart.yDim(cfg.yDim)):(cfg.y2Dim.stackValue=this.value,chart.y2Dim(cfg.y2Dim)),chart.render()}function ___plotLines(){const t=this;"plotLines"===this.id?("y"===_whichY?(cfg.yDim.plotLines.forEach(e=>{e.draw=t.checked}),chart.yDim(cfg.yDim)):(cfg.y2Dim.plotLines.forEach(e=>{e.draw=t.checked}),chart.y2Dim(cfg.y2Dim)),chart.render()):"paretoLines"===this.id?(!this.checked&&_yParetoAsisG&&__removeParetoLine(),cfg.pareto.isDraw=this.checked):"markers"===this.id&&(cfg.isMark=this.checked,cfg.isMark?chart.render():(_bodyG.selectAll("g.symbol, g.stackSymbol").transition().duration(_dr).style("opacity",0).remove(),_bodyG.selectAll("g.lbl>text").transition().duration(_dr).attr("y",function(){return+d3.select(this).attr("y")+8})))}function ___trendLines(){"trendLines"===this.id?(this.checked||(__initTrendLines([]),_trendIndex=void 0),cfg.trend.isDraw=this.checked):cfg.trend.exceptZero=this.checked}function ___ghostBar(){chart.useGhostBar(d3.select(this).property("checked")).render()}function ___createNewChart(t){const e=d3.select("#c2iSelectedChart").property("value"),a=_u.deepClone(cfg);a.customColors=void 0,a.legend?(t.options.some(t=>{if(t.value===e)return a.legend.id=t.legendId,!0}),d3.select(a.legend.id).select("svg").remove()):console.log(_lang.cm.lg_0),d3.select(e).select("svg").remove();const o=c2i.chart.std(e,a).data(_rawData||_orgData).render(),n=window.c2i.dashboard;if(n){const t=n[cfg.c2iCon.substr(1)],a=e.substr(1);if(t.filename)return n[a]={domId:a,vizId:t.vizId,filename:t.filename};let r=!1;n.dataMetas.some(function(t){let a;if(t.container===cfg.c2iCon){n.dataMetas.some(o=>{if(o.container===e)return(o=_u.deepClone(t)).container=e,a=o,r=!0,!0}),r||((a=_u.deepClone(t)).container=e,n.dataMetas.push(a));const o="#c2iFilter"+e.substr(9);return d3.select(o).select("select").remove(),d3.select(o).append("select").on("change",function(t,r){const l=d3.select(this).property("value").split("|");a.meta.method.click({container:e,selector:o},l),n[e.substr(1)].title().subCaption=l[3]}).selectAll("option").data(a.dataFiles).enter().append("option").attr("value",t=>a.graphType+"|"+t.creatorId+"|"+t.filename+"|"+t.caption).text(t=>t.caption).property("selected",t=>t.filename===a.currentFilename),!0}});const l=d3.select(e).node().parentNode.clientWidth,i=d3.select(e).node().parentNode.offsetParent.clientHeight-26;o.resizeStudio(l,i),n[a]=o}}function ___tooltipMagChange(){const t=cfg.tooltip;void 0!==t?("0"===this.value||"1"===this.value?(t.isShow=!0,t.infoLevel=+this.value,t.isUserTip=!1):"false"===this.value?(t.isShow=!0,t.isUserTip=!0):(t.isShow=!1,_tip&&_tip.classed("c2iHidden",!0)),chart.tooltip(t)):alert(_lang.cm.tipNo)}function ___changeTheme(){chart.theme(this.value)}function ___exportImage(){_u.exportImage(c2iCon)}function ___makeJson(){_u.makeJson(cfg)}cfg.isDev&&!0===cfg.isDev?(data=_meta.data,_u.makeJson(data)):data=_meta.data.filter(t=>void 0===t.dev||!0!==t.dev),data.forEach((t,e)=>{if(!(cfg.groupType.indexOf("box")>-1&&"summaryType"===t.id||_u.isIE()&&t.range||(t.seq=e,-1!==nodes.indexOf(t.type+"_"+e)))){nodes.push(t.type+"_"+e);const a=t;a.node=t.type,a.seq=e,0!==e||cfg.y2Dim||a.labels.splice(1,1),realNodes.push(a)}}),realNodes.filter(t=>t.range&&"ySplit"===t.range.input.id?cfg.common&&cfg.common.ySplit:!isPlaceEmpty||"c2iSelectedChart"!==t.id).forEach(t=>{switch(t.node){case"select":__renderSelect(t);break;case"button":__renderButton(t);break;default:__renderDiv(t)}t.dynamic||(t.range&&t.range.div?trTds.append("td").append("div").attr("id",t.range.div.id).attr("class",t.range.div.class).style("text-align","center").text(()=>{switch(t.range.div.id){case"__ySplitText":return _yRatio+"%"}}):trTds.append("td"))})}function renderBody(){if(_bodyG||(_bodyG=_svg.append("g").attr("class","body").attr("transform","translate("+_xStart()+","+_yEnd()+")").attr("clip-path",cfg.clamp?"url(#"+_clipName+")":null)),"each"!==_yCluster&&"each"!==_y2Cluster)return alert(_lang.std.std_1),!1;cfg.data.length>0&&__filteredStatistic(cfg.data[0].values),_brushing&&_bodyG.selectAll("g.stackGrp, g.symbol, g.lbl, .paretoLine").remove(),BARS.indexOf(_yCluster)>-1||BARS.indexOf(_y2Cluster)>-1?(_removeAreaChart(),_yCluster.indexOf("stack")>-1||_y2Cluster.indexOf("stack")>-1?renderStackBars():renderGroupBars()):(_removeStackGroupChart(),AREAS.indexOf(_yCluster)>-1||AREAS.indexOf(_y2Cluster)>-1?renderStackAreas():_removeAreaChart()),renderBoxplot(),renderAreas(),renderBars(),renderLines(),renderLines(!1),renderMarks(),renderLabels(),renderPlotLines(),renderParetoLines(),renderOthers(),renderZeroLine(),renderTrendLines(),renderContentBox()}function renderContentBox(){if(cfg.common&&cfg.common.box){const t=cfg.common,e=cfg.margin,a=t.ySplit,o=t.box;let n,r;const l=[{key:"top",x1:e.left,x2:_xEnd(),y1:_yEnd(),y2:_yEnd(),x10:e.left,x20:e.left,y10:_yEnd(),y20:_yEnd()},{key:"right",x1:_xEnd(),x2:_xEnd(),y1:_yEnd(),y2:_yStart(),x10:_xEnd(),x20:_xEnd(),y10:_yStart(),y20:_yStart()},{key:"bottom",x1:e.left+_fix.left,x2:_xEnd(),y1:_yStart(),y2:_yStart(),x10:e.left,x20:e.left,y10:_yStart(),y20:_yStart()},{key:"left",x1:_xStart()+_fix.left,x2:_xStart()+_fix.left,y1:e.top,y2:_yStart(),x10:_xStart(),x20:_xStart(),y10:_yStart(),y20:_yStart()}];if(o.splitY&&void 0!==a){n=0===a.ratio?1:a.ratio,r=_contentH()*n+e.top;const t={key:"splitY",x1:e.left,x2:_xEnd(),y1:r,y2:r,x10:e.left,x20:e.left,y10:r,y20:r};l.push(t)}let i=_svg.selectAll(".contentBox").data([null]);i=i.enter().append("g").attr("class","contentBox").merge(i);const s=l.filter(t=>{if(o[t.key])return t}),c=i.selectAll("line").data(s,_key);if(c.enter().append("line").attr("class",t=>"_"+t.key).style("shape-rendering","crispedges").attr("x1",t=>t.x10).attr("x2",t=>t.x20).attr("y1",t=>t.y10).attr("y2",t=>t.y20).style("stroke",o.color).style("stroke-width",o.strokeWidth).style("stroke-opacity",o.opacity).attr("stroke-dasharray",t=>"splitY"===t.key?a.dashLength:o.dashLength).merge(c).transition().duration(_dr).attr("x1",t=>t.x1).attr("x2",t=>t.x2).attr("y1",t=>t.y1).attr("y2",t=>t.y2),void 0!==a){n=0===a.ratio?1:a.ratio,r=_contentH()*n+e.top;const t=i.selectAll(".splitCircleY").data([null]);t.exit().remove(),t.enter().append("circle").attr("class","splitCircleY").style("cursor","move").on("click",()=>{0!==a.ratio&&(_ySplit=!0,a.ratio=_yRatio=0,d3.select("#__ySplitText").text(_yRatio+"%"),d3.select("#ySplit").property("value",_yRatio),__dragMoveSplitYRender())}).on("mouseenter",function(){d3.select(this).attr("r",a.radius+3).style("fill-opacity",1)}).on("mouseleave",function(){d3.select(this).attr("r",a.radius).style("fill-opacity",a.opacity)}).call(_dragSplitHandle).attr("r",a.radius).attr("fill",a.fill).attr("opacity",a.opacity).attr("stroke",a.stroke).attr("cy",r).attr("cx",_xEnd()).append("title").text(_lang.std.dT20).merge(t),t.attr("cy",r).transition().duration(_dr).attr("cx",_xEnd())}}}function renderBoxplot(){const t=cfg.boxConfig;if(!(_yCluster.indexOf("box")>-1||_y2Cluster.indexOf("box")>-1))return;if(-1===_selectedMeasures.indexOf(t.max))return void _bodyG.selectAll("g.box").data([]).exit().style("opacity",1).transition().duration(_dr).style("opacity",1e-6).remove();_bodyG.selectAll("g.box").data([]).exit().remove(),_xWidth=0,_xWidthHalf=0,"band"===_xScale?_xWidth=_xX.bandwidth():cfg.data&&cfg.data[0].values.length&&(_xWidth=parseInt(_xX.range()[1]/cfg.data[0].values.length)),_xWidthHalf=_xWidth/2;let e=_bodyG.selectAll("g.box").data(cfg.data[0].values,t=>t[_xColNm]);function a(e,a){const o=-_xImage.width/2;let n=_yY(e[t.q3])-_yY(e[t.median])-_xImage.height/2;n=_xImage.pos&&"center"!==_xImage.pos?n-_xImage.height/2-3:n,a.append("image").style("point-events","none").style("opacity",_xImage.opacity?_xImage.opacity:1).attr("xlink:xlink:href",e[_xImage.colNm]).attr("width",_xImage.width).attr("height",_xImage.height).attr("transform","translate("+[o,n]+")")}(e=e.enter().append("g").on("click",(t,e)=>{cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"boxplot"},e)}).attr("class","box "+t.max).each(function(e,o){const n=d3.select(this);let r=_getMeasure(t.q1);if(r.draw&&(n.append("rect").attr("class",t.qtr).attr("height",0).style("stroke",r.color[0]).style("stroke-width",t.strokeWidth?t.strokeWidth:0).style("fill-opacity","y"===r.yDim?cfg.yDim.opacity:cfg.y2Dim.opacity).style("fill",cfg.measureColors?cfg.measureColors[o%cfg.measureColors.length]:__barFillTexture(t.q1)),_xImage&&e[_xImage.colNm])){const o=_yY(e[t.q1])-_yY(e[t.q3]);_xImage.strict?o>_xImage.height&&a(e,n):a(e,n)}(r=_getMeasure(t.max)).draw&&(n.append("line").on("touchstart",function(e,a){_touchDbClick(e,this)&&(a.key=t.max,_mouseEnterBarMark(e,this,a,"max"))}).on("touchmove",function(t,e){_mouseMove(t,e,"max",this)}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"max")}).on("dblclick",function(t){_dblclick(t,this)}).on("mouseenter",function(e,a){a.key=t.max,_mouseEnterBarMark(e,this,a,"max")}).on("mousemove",(t,e)=>_mouseMove(t,e,"max")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"max")}).style("cursor","pointer").attr("class",t.max).attr("x1",0).attr("x2",0).style("shape-rendering","crispEdges").style("stroke",()=>{return _getMeasure(t.max).color[0]}),r.showLabel&&n.append("text").style("font-family",_fontsMeasure(t.max)[0]).style("font-size",_fontsMeasure(t.max)[1]).attr("fill",_fontsMeasure(t.max)[2]).style("pointer-events","none").style("text-anchor","middle").attr("class","maxText").text(d3.format(r.format)(e[t.max]))),(r=_getMeasure(t.min)).draw&&(n.append("line").attr("class",t.range).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0).style("shape-rendering","crispEdges").style("stroke",()=>{return _getMeasure(t.max).color[0]}),n.append("line").on("touchstart",function(e,a){_touchDbClick(e,this)&&(a.key=t.min,_mouseEnterBarMark(e,this,a,"min"))}).on("touchmove",function(t,e){_mouseMove(t,e,"min",this)}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"min")}).on("dblclick",function(t){_dblclick(t,this)}).on("mouseenter",function(e,a){a.key=t.min,_mouseEnterBarMark(e,this,a,"min")}).on("mousemove",(t,e)=>_mouseMove(t,e,"min")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"min")}).style("cursor","pointer").attr("class",t.min).attr("x1",0).attr("x2",0).style("shape-rendering","crispEdges").style("stroke",()=>{return _getMeasure(t.min).color[0]}),r.showLabel&&n.append("text").style("font-family",_fontsMeasure(t.min)[0]).style("font-size",_fontsMeasure(t.min)[1]).attr("fill",_fontsMeasure(t.min)[2]).style("pointer-events","none").style("text-anchor","middle").attr("class","minText").text(d3.format(r.format)(e[t.min]))),(r=_getMeasure(t.median)).draw&&(n.append("line").on("touchstart",function(e,a){_touchDbClick(e,this)&&(a.key=t.median,_mouseEnterBarMark(e,this,a,"median"))}).on("touchmove",function(t,e){_mouseMove(t,e,"median",this)}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"median")}).on("dblclick",function(t){_dblclick(t,this)}).on("mouseenter",function(e,a){a.key=t.median,_mouseEnterBarMark(e,this,a,"median")}).on("mousemove",(t,e)=>_mouseMove(t,e,"median")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"median")}).style("cursor","pointer").attr("class",t.median).attr("x1",0).attr("x2",0).attr("y1",_yY(e[t.min])-_yY(e[t.median])).attr("y2",_yY(e[t.min])-_yY(e[t.median])).style("shape-rendering","crispEdges").style("stroke",()=>{return _getMeasure(t.median).color[0]}),r.showLabel&&n.append("text").style("font-family",_fontsMeasure(t.median)[0]).style("font-size",_fontsMeasure(t.median)[1]).attr("fill",_fontsMeasure(t.median)[2]).style("pointer-events","none").style("text-anchor","end").attr("class","medianText").attr("x",-5).text(d3.format(r.format)(e[t.median]))),(r=_getMeasure(t.mean)).draw&&(n.append("circle").on("touchstart",function(e,a){_touchDbClick(e,this)&&(a.key=t.mean,_mouseEnterBarMark(e,this,a,"mean"))}).on("touchmove",function(t,e){_mouseMove(t,e,"mean",this)}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"mean")}).on("dblclick",function(t){_dblclick(t,this)}).on("mouseenter",function(e,a){a.key=t.mean,_mouseEnterBarMark(e,this,a,"mean")}).on("mousemove",(t,e)=>_mouseMove(t,e,"mean")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"mean")}).style("cursor","pointer").attr("class",t.mean).attr("r",0).attr("cx",0).attr("cy",0).style("fill",()=>e.meanVal>e.medianVal?t.meanColor[2]:e.meanVal<e.medianVal?t.meanColor[0]:t.meanColor[1]),r.showLabel&&n.append("text").style("font-family",_fontsMeasure(t.mean)[0]).style("font-size",_fontsMeasure(t.mean)[1]).attr("fill",_fontsMeasure(t.mean)[2]).style("pointer-events","none").style("text-anchor","start").attr("class","meanText").attr("x",5).text(d3.format(r.format)(e[t.mean]))),n.selectAll("line").style("stroke-width",t.lineStrokeWidth)}).merge(e)).attr("transform",e=>"translate("+[_xX(e[_xColNm])+_xWidthHalf+","+_yY(e[t.median])]+")"),e.selectAll("."+t.range).transition().duration(_dr).attr("y1",e=>_yY(e[t.max])-_yY(e[t.median])).attr("y2",e=>_yY(e[t.min])-_yY(e[t.median])),e.selectAll("."+t.max).transition().duration(_dr).attr("x1",-_xWidthHalf).attr("x2",_xWidthHalf).attr("y1",e=>_yY(e[t.max])-_yY(e[t.median])).attr("y2",e=>_yY(e[t.max])-_yY(e[t.median])),e.selectAll(".maxText").transition().duration(_dr).attr("y",e=>_yY(e[t.max])-_yY(e[t.median])-3),e.selectAll("."+t.min).transition().duration(_dr).attr("x1",-_xWidthHalf).attr("x2",_xWidthHalf).attr("y1",e=>_yY(e[t.min])-_yY(e[t.median])).attr("y2",e=>_yY(e[t.min])-_yY(e[t.median])),e.selectAll(".minText").transition().duration(_dr).attr("y",e=>_yY(e[t.min])-_yY(e[t.median])+13),e.selectAll("rect").transition().duration(_dr).ease(_u.ease[cfg.easing]).attr("width",_xWidth).attr("x",-_xWidthHalf).attr("y",e=>_yY(e[t.q3])-_yY(e[t.median])).attr("height",e=>_yY(e[t.q1])-_yY(e[t.q3])),e.selectAll("."+t.median).transition().duration(_dr).attr("x1",-_xWidthHalf).attr("x2",_xWidthHalf).attr("y1",0).attr("y2",0),e.selectAll("."+t.mean).transition().duration(_dr).attr("r",4).attr("cy",e=>_yY(e[t.mean])-_yY(e[t.median])),e.selectAll(".meanText").transition().duration(_dr).attr("y",e=>_yY(e[t.mean])-_yY(e[t.median])-3)}function _removeAreaChart(){if(!_bodyG.selectAll(".c2iSummary").empty()){_bodyG.selectAll("g.c2iSummary").data([]).exit().transition().style("opacity",1e-6).remove()}if(_bodyG.selectAll(".c2iPath").empty())return;_bodyG.selectAll(".c2iPath").data([]).exit().transition().duration(_dr).ease(_u.ease[cfg.easing]).attr("d",t=>(t=>d3.area().x(t=>_xX(t.src[_xColNm])+_xWidthHalf).y0(_yStart()).y1(_yStart())(t))(t)).remove(),_bodyG.selectAll(".stackLine").data([]).exit().transition().duration(_dr).each(function(){_u.pathShow({sel:d3.select(this),dr:_dr,isReverse:!0}),d3.select(this).remove()}),_bodyG.selectAll("g.stackSymbol").data([]).exit().transition().style("opacity",1e-6).remove(),_bodyG.selectAll("g.stackLbl").data([]).exit().transition().style("opacity",1e-6).remove()}function renderStackBars(){_stackDataMakeUp("stack");let t=_bodyG.selectAll("g.stackGrp").data(cfg.data2,_key);t.exit().transition().style("opacity",1e-6).remove(),cfg.data2.length<1||(t=t.enter().append("g").attr("class",t=>"stackGrp _"+c2i.util.getClassPure(t.key)).merge(t),(_bars=t.selectAll(".rect").data(t=>t)).enter().append("rect").attr("class",t=>_xNameClass(t)+" rect").on("touchstart",function(t,e){_touchDbClick(t,this)&&(_mouseEnterBarMark(t,this,e,"groupbar"),renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"groupbar",key:e.key},e.src))}).on("touchmove",function(t,e){_mouseMove(t,e,"groupbar",this)}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"groupbar")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",(t,e)=>{renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"groupbar",key:e.key},e.src)}).on("mouseenter",function(t,e){_mouseEnterBarMark(t,this,e,"groupbar")}).on("mousemove",(t,e)=>_mouseMove(t,e,"groupbar")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"groupbar")}).attr("x",t=>_xX(t.src[_xColNm])).attr("y",t=>{return"y"===_getMeasure(t.key).yDim?_yY(t[0]):_y2Y(t[0])}).attr("width",_xWidth).attr("height",0).merge(_bars).style("fill",t=>__barFillTexture(t.key,t.src)).style("stroke",t=>_colorMeasure(t.key)).style("stroke-width",t=>{return _isTexture(_getMeasure(t.key))}).transition().duration(_dr).delay((t,e)=>e*cfg.delay).style("fill-opacity",t=>{return"y"===_getMeasure(t.key).yDim?cfg.yDim.opacity:cfg.y2Dim.opacity}).attr("y",t=>{return"y"===_getMeasure(t.key).yDim?_yY(t[1]):_y2Y(t[1])}).attr("height",t=>{const e="y"===_getMeasure(t.key).yDim?_yY(t[0])-_yY(t[1]):_y2Y(t[0])-_y2Y(t[1]);return e<0?0:e}).transition().attr("x",t=>_xX(t.src[_xColNm])).attr("width",_xWidth),_renderStackBarAreaLabel(t),_renderStackBarAreaSumLabel(t.data()))}function _renderStackBarAreaLabel(t){const e=_yCluster.indexOf("100")>-1||_y2Cluster.indexOf("100")>-1;let a="value";e&&(_yCluster.indexOf("100")>-1?a=_yStackValue:_y2Cluster.indexOf("100")>-1&&(a=_y2StackValue));const o=e?5:BARS.indexOf(_yCluster)>-1||BARS.indexOf(_y2Cluster)>-1?2:0;let n=t.selectAll("text").data(t=>t);(n=n.enter().append("text").attr("class",_xNameClass).style("fill-opacity",1e-6).style("text-anchor","middle").style("pointer-events","none").style("font-family",t=>_fontsMeasure(t.key)[0]).style("font-size",t=>_fontsMeasure(t.key)[1]).attr("fill",t=>_fontsMeasure(t.key)[2]).attr("x",t=>_xX(t.src[_xColNm])+_xWidthHalf).attr("y",t=>{return"y"===_getMeasure(t.key).yDim?_yY(t[0]):_y2Y(t[0])}).merge(n).style("fill-opacity",t=>{const e=_getMeasure(t.key);if(e.showLabel){return("y"===e.yDim?_yY(t[0])-_yY(t[1]):_y2Y(t[0])-_y2Y(t[1]))>14?1:1e-6}return 1e-6})).transition().duration(_dr).delay((t,e)=>e*cfg.delay).attr("x",t=>_xX(t.src[_xColNm])+_xWidthHalf).attr("y",t=>{return"y"===_getMeasure(t.key).yDim?_yY(t[1])+o:_y2Y(t[1])+o});const r=function(t){const a=this.parentNode.__data__;return e?_xX(a.src[_xColNm])+_xWidthHalf:null};let l=[];switch(a){case"value":l=["value"];break;case"ratio":l=["ratio"];break;case"both":l=["value","ratio"];break;default:l=[]}const i=n.selectAll("tspan").data(l,t=>t);i.exit().remove(),i.enter().append("tspan").attr("class",t=>t).attr("x",r).text(function(t){const e=this.parentNode.__data__;return"ratio"===t?d3.format(",.1%")(e.src[e.key+"__p"]):_getFormat(e.key,e.src[e.key])}).merge(i).attr("dy","1.1em").transition().duration(_dr).delay((t,e)=>e*cfg.delay).attr("x",r)}function _renderStackBarAreaSumLabel(t){const e=cfg.summary;if(!e.isShow)return;t=t[t.length-1];const a=_bodyG.append("g").attr("class","c2iSummary").selectAll("text").data(t,t=>t.src[_xColNm]),o=_yCluster.indexOf("100")>-1||_y2Cluster.indexOf("100")>-1,n=cfg.common,r=n&&n.ySplit&&n.ySplit.ratio?_contentH()*n.ySplit.ratio/2:_contentH()/2;a.enter().append("text").attr("class",t=>_xNameClass(t)+" totText").style("text-anchor","middle").style("pointer-events","none").style("fill-opacity",0).style("font-family",e.fonts[0]).style("font-size",e.fonts[1]).attr("fill",e.fonts[2]).text(t=>_getFormat(t.key,t.src[e.type])+__getTypeInit()).merge(a).attr("transform",t=>{const a=_getMeasure(t.key),n=_xX(t.src[_xColNm])+_xWidthHalf,l="y"===a.yDim?_yY(t[1])-5:_y2Y(t[1])-5;return o?"translate("+[n,r]+"), rotate("+e.rotate+")":"translate("+[n,l]+")"}).transition().duration(_dr).style("fill-opacity",t=>{return _getMeasure(t.key).showLabel?1:1e-6})}function __areaFillTexture(t){const e=_getMeasure(t);if("y"===e.yDim){if(cfg.yDim.texture)return _txY(e.colNm).url()}else if(cfg.y2Dim.texture)return _txY2(e.colNm).url();return _colorMeasure(t)}function __barFillTexture(t,e){const a=_getMeasure(t);let o;if("y"===a.yDim){if(cfg.yDim.texture)return _txY(t).url();if(cfg.yDim.color[1])return __gradient(_colorMeasure(t));o=n("y")}else{if(cfg.y2Dim.texture)return _txY2(t).url();if(cfg.y2Dim.color[1])return __gradient(_colorMeasure(t));o=n("y2")}return _yPlotTexture&&_yPlotTextureValue>o?_txYPlot(t).url():_xPlotTexture&&_xPlotLables.indexOf(e[_xColNm])>-1?e[a.colNm]>0?_txXPlot(t).url():_txXPlotNeg(t+"_Neg").url():_colorMeasure(t);function n(t){if(!_yPlotTexture||!e)return;let a=0;return cfg.measures.forEach(function(o){o.yDim===t&&o.draw&&(a+=e[o.colNm])}),a}}function renderGroupBars(){_stackDataMakeUp("group");const t=t=>(o=_getMeasure(t.key),_isNegative?"y"===o.yDim?_yY(Math.max(0,t[1]-t[0])):_y2Y(t[1]-t[0]):"y"===o.yDim?_yY(t[1]-t[0]):_y2Y(t[1]-t[0]));let e=_bodyG.selectAll("g.stackGrp").data(cfg.data2,_key);if(e.exit().transition().style("opacity",1e-6).remove(),cfg.data2.length<1)return;const a=_xWidth/_layerCnt;let o,n=a;_xPad[2]>0&&(n-=a*_xPad[2]),e=e.enter().append("g").attr("class",t=>"stackGrp _"+c2i.util.getClassPure(t.key)).merge(e),(_bars=e.selectAll(".rect").data(t=>t)).enter().append("rect").attr("class",t=>_xNameClass(t)+" rect").on("touchstart",function(t,e){_touchDbClick(t,this)&&(_mouseEnterBarMark(t,this,e,"groupbar"),renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"groupbar",key:e.key},e.src))}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"groupbar")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",(t,e)=>{renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"groupbar",key:e.key},e.src)}).on("mouseenter",function(t,e){_mouseEnterBarMark(t,this,e,"groupbar")}).on("mousemove",(t,e)=>_mouseMove(t,e,"groupbar")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"groupbar")}).attr("x",t=>_xX(t.src[_xColNm])+a*t[2]).attr("y",e=>t(e)).attr("width",n).attr("height",0).merge(_bars).style("fill",t=>__barFillTexture(t.key,t.src)).style("fill-opacity",t=>"y"===(o=_getMeasure(t.key)).yDim?cfg.yDim.opacity:cfg.y2Dim.opacity).style("stroke",t=>_colorMeasure(t.key)).style("stroke-width",t=>_isTexture(o=_getMeasure(t.key))).transition().duration(_dr).delay((t,e)=>e*cfg.delay).attr("x",t=>_xX(t.src[_xColNm])+a*t[2]).attr("width",n).transition().attr("y",e=>t(e)).attr("height",t=>{if(o=_getMeasure(t.key),_isNegative)return"y"===o.yDim?Math.abs(_yY(t[1]-t[0])-_yY(0)):_y2Y(t[1]-t[0]);let e="y"===o.yDim?_yY(t[1]-t[0]):_y2Y(t[1]-t[0]);return(e=_getSplitPosHeight(o)-e)<0?0:e}),cfg.xDim.histogram?function(){const t=cfg.xDim.histogram;t.dy=t.dy?t.dy:0,t.rotate=t.rotate?t.rotate:0;const n=e.selectAll(".hist").data(t=>t);n.enter().append("text").attr("class",function(t){return _xNameClass(t)+" hist _"+t.key}).style("font-family",function(t){return _fontsMeasure(t.key)[0]}).style("font-size",function(t){return _fontsMeasure(t.key)[1]}).attr("fill",function(t){return _fontsMeasure(t.key)[2]}).style("text-anchor",function(){return 0===t.rotate?"middle":"top"===_xAxisPos?t.rotate>0?"end":"start":t.rotate>0?"start":"end"}).style("fill-opacity",function(t){return(o=_getMeasure(t.key)).labelStyle&&o.labelStyle.posColNm?t.src[o.labelStyle.posColNm]?1:0:o.showLabel?1:1e-6}).style("pointer-events","none").attr("transform",function(e,o){const n=_xX(e.src[_xColNm])+a*e[2]+a/2,r=_contentH()+t.dy*(t.rotate?1:o+1);return"translate("+[n,r]+") "}).text(function(t){return t.src[t.key+"Gap"]}).merge(n).transition().duration(_dr).attr("transform",function(e,o){const n=_xX(e.src[_xColNm])+a*e[2]+a/2,r=_contentH()+t.dy*(t.rotate?1:o+1);return"translate("+[n,r]+") rotate("+t.rotate+")"})}():(function(){let t=e.selectAll("text").data(t=>t);const n=t.enter().append("text").attr("class",_xNameClass).style("text-anchor","middle").style("pointer-events","none").style("font-family",t=>_fontsMeasure(t.key)[0]).style("font-size",t=>_fontsMeasure(t.key)[1]).attr("fill",t=>_fontsMeasure(t.key)[2]).attr("x",t=>_xX(t.src[_xColNm])+a*t[2]+a/2).attr("y",t=>"y"===(o=_getMeasure(t.key)).yDim?_yY(t[1]-t[0]):_y2Y(t[1]-t[0]));(t=n.merge(t).style("fill-opacity",t=>(o=_getMeasure(t.key)).labelStyle&&o.labelStyle.posColNm?t.src[o.labelStyle.posColNm]?1:0:o.showLabel?1:1e-6)).transition().duration(_dr).delay((t,e)=>e*cfg.delay).attr("y",t=>"y"===(o=_getMeasure(t.key)).yDim?_yY(t[1]-t[0]):_y2Y(t[1]-t[0]));const r=t.selectAll("tspan").data(["value"],t=>t);r.exit().remove(),r.enter().append("tspan").attr("class","value").attr("x",function(){const t=this.parentNode.__data__;return _xX(t.src[_xColNm])+a*t[2]+a/2}).text(function(){const t=this.parentNode.__data__;return _getFormat(t.key,t.src[t.key])}).merge(r).attr("dy","-0.5em").attr("x",function(){const t=this.parentNode.__data__;return _xX(t.src[_xColNm])+a*t[2]+a/2})}(),function(t){const e=cfg.summary;if(!e.isShow)return;t=t[t.length-1];const a=_bodyG.append("g").attr("class","c2iSummary").selectAll(".totText").data(t,t=>t.src[_xColNm]);a.enter().append("text").attr("class",t=>_xNameClass(t)+" totText").style("text-anchor","middle").style("pointer-events","none").style("font-family",e.fonts[0]).style("font-size",e.fonts[1]).attr("fill",e.fonts[2]).attr("transform",t=>{const a=_xX(t.src[_xColNm])+_xWidthHalf;return"translate("+[a-7,e.dy]+"), rotate("+e.rotate+")"}).append("tspan").merge(a.select(".value")).attr("class","value").attr("dy","1.1em").text(t=>_getFormat(t.key,t.src[e.type])+__getTypeInit())}(e.data()))}function __getTypeInit(){if(void 0!==cfg.summary.suffix)return cfg.summary.suffix;let t="";return _langTypes(),_summaryTypes.some(function(e){if(e.value===cfg.summary.type)return t="["+e.init+"]",!0}),t}function _touchDbClick(t){if(t.preventDefault(),t.stopPropagation(),this.__start){this.__end=new Date;const e=this.__end-this.__start;if(this.__start=void 0,!e||e>500)return;_dblclick(t,this)}else this.__start=new Date}function _langTypes(){const t=_lang.cm;_summaryTypes=[{value:"_sum",label:t.sumI,c2i18n:"cm.sumI",init:"S"},{value:"_avg",label:t.avgI,c2i18n:"cm.avgI",init:"A"},{value:"_min",label:t.minI,c2i18n:"cm.minI",init:"m"},{value:"_max",label:t.maxI,c2i18n:"cm.maxI",init:"M"}]}function _dblclick(t,e){if(cfg.noDblClick)return;if("band"!==_xScale)return void console.log(_lang.std.std_6);let a,o,n,r="value",l=!1;const i=t&&t.altKey?2*_dr:_dr;if("_"===(a="path"===e.nodeName?e.className.baseVal.split(" ")[1]:"boxplot"===cfg.groupType?e.className.baseVal:e.parentNode.className.baseVal.split(" ")[1]).substr(0,1)&&(a=a.substr(1)),cfg.measures.some(function(t){if(t.colNm===a)return("y"===t.yDim&&"each"!==_yCluster||"y2"===t.yDim&&"each"!==_y2Cluster)&&(l=!0),!0}),l&&(_yCluster.indexOf("100")>-1||_y2Cluster.indexOf("100")>-1?_yCluster.indexOf("100")>-1?r=_yStackValue:_y2Cluster.indexOf("100")>-1&&(r=_y2StackValue):("each"!==_yCluster&&(r=_yCluster),"each"!==_y2Cluster&&(r=_y2Cluster))),"value"===r?o=a:"ratio"===r||"both"===r?o=a+"__p":(o=a,(_yCluster.indexOf("each")>-1||_y2Cluster.indexOf("each")>-1)&&t&&t.shiftKey&&cfg.measures.some(function(t){if(t.colNm===a)return("y"===t.yDim&&"each"!==_yCluster||"y2"===t.yDim&&"each"!==_y2Cluster)&&(o=cfg.summary.isShow?cfg.summary.type:"_sum"),!0})),_sortedMeasure!==o?(_sortedMeasure=o,_sorted="desc"):_sorted=""===_sorted?"desc":"desc"===_sorted?"asc":"",cfg.title&&cfg.title.subCaption){let t;n=cfg.title.subCaption,t=""!==_sorted?function(){return n+=": "+function(){let t;if(_langTypes(),_summaryTypes.some(function(e){if(e.value===o)return t=e.label,!0}),t)return t;let e=o,a="";return e.indexOf("__p")>-1&&(e=o.substring(0,o.indexOf("__p")),a="%"),cfg.measures.some(function(t){if(t.colNm===e)return e=t.caption,!0}),e+a}()+" "+_lang.gen.by+" "+_lang.gen[_sorted],cfg.title.subFonts[3]}():cfg.title.subFonts[2],_svg.select(".subtitle").style("fill",t).text(n)}let s,c;for(c=0;c<cfg.data.length;c++)c2i.util.getClassPure(cfg.data[c].key)===a&&(s=c),cfg.data[c].values.sort("desc"===_sorted?function(t,e){return e[o]===t[o]?d3.descending(t.__id,e.__id):e[o]-t[o]}:"asc"===_sorted?function(t,e){return e[o]===t[o]?d3.ascending(t.__id,e.__id):t[o]-e[o]}:function(t,e){return d3.ascending(t.__id,e.__id)});if(cfg.pareto&&cfg.pareto.isDraw){_paretoIndex=cfg.data[s].values;let t,e,a=0;const n="_cum",r="_cumP";for(e=0;e<_paretoIndex.length;e++)a+=(t=_paretoIndex[e])[o],t[n]=t[o]+(e>0?_paretoIndex[e-1][n]:0);for(e=0;e<_paretoIndex.length;e++)(t=_paretoIndex[e])[r]=t[n]/a,t[r]=parseFloat(t[r].toFixed(3));_trendIndex=_paretoIndex=s}else cfg.trend&&cfg.trend.isDraw&&(_trendIndex=s);if(_xX.domain(cfg.data[s].values.map(function(t){return t[_xColNm]})),_xAxis){const t=_svg.transition().duration(i).ease(_u.ease[cfg.easing]),e=cfg.data[s].values.length,a=function(t,a){return a/e*cfg.delay};t.select(".x.axis").call(_xAxis).selectAll("g").delay(a),_svg.selectAll(".x.axis text").classed("xyTextHover",!1),_displayXLabel()}_bodyG.selectAll("text").remove(),t.stopPropagation(),s=_dr,_dr=i,n=cfg.scaleAuto,cfg.scaleAuto=!0,renderBody(),cfg.scaleAuto=n,_dr=s}function _removeStackGroupChart(){if(!_bodyG.selectAll(".c2iSummary").empty()){_bodyG.selectAll("g.c2iSummary").data([]).exit().transition().duration(_dr).style("opacity",1e-6).remove()}if(_bodyG.selectAll(".stackGrp").empty())return;const t=_bodyG.selectAll("g.stackGrp").data([]);t.exit().selectAll("text").transition().style("fill-opacity",1e-6),t.exit().selectAll("rect").transition().duration(_dr).attr("width",0),t.exit().transition().delay(_dr).remove()}function renderStackAreas(){let t,e;_stackDataMakeUp("area");let a="monotone";cfg.data2.length>0&&("y"===(t=_getMeasure(cfg.data2[0][0].key)).yDim?(a=cfg.yDim.curve,e=_yY):(a=cfg.y2Dim.curve,e=_y2Y));const o=(t,o)=>d3.area().curve(_u.curve[a]).x(t=>_xX(t.src[_xColNm])+_xWidthHalf).y0(t=>e(t[0])).y1(t=>o?e(t[1]):_yStart())(t),n=_bodyG.selectAll(".c2iPath").data(cfg.data2,_key);n.exit().transition().duration(_dr).ease(_u.ease[cfg.easing]).delay((t,e)=>e*cfg.delay).attr("d",t=>0===cfg.data2.length?null:o(t)).remove(),n.enter().append("path").attr("class",t=>"c2iPath _"+c2i.util.getClassPure(t.key)).on("touchstart",function(t,e){_touchDbClick(t,this)&&(_mouseEnterStackAreaLine(t,this,e,"stackArea"),renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"stackArea",key:e.key},e))}).on("touchend",function(t,e){_mouseLeaveStackAreaLine(t,this,e,"stackArea")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",(t,e)=>{renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"stackArea",key:e.key},e)}).on("mouseenter",function(t,e){_mouseEnterStackAreaLine(t,this,e,"stackArea")}).on("mousemove",(t,e)=>_mouseMove(t,e,"stackArea")).on("mouseleave",function(t,e){_mouseLeaveStackAreaLine(t,this,e,"stackArea")}).style("fill-opacity",1e-6).attr("d",t=>o(t)).merge(n).style("fill",t=>__areaFillTexture(t.key)).transition().duration(_dr).ease(_u.ease[cfg.easing]).delay((t,e)=>e*cfg.delay).style("fill-opacity",.5).attr("d",t=>o(t,!0)),function(t,e){const a=a=>d3.line().curve(_u.curve[e]).x(t=>_xX(t.src[_xColNm])+_xWidthHalf).y(e=>t(e[1]))(a);let o;const n=_bodyG.selectAll(".stackLine").data(cfg.data2,_key);n.exit().transition().duration(_dr).each(function(){_u.pathShow({sel:d3.select(this),dr:_dr,isReverse:!0}),d3.select(this).remove()}),n.enter().append("path").attr("class",t=>"stackLine _"+c2i.util.getClassPure(t.key)).style("cursor","pointer").on("touchstart",function(t,e){_touchDbClick(t,this)&&(_mouseEnterStackAreaLine(t,this,e,"stackLine"),renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"stackLine",key:e.key},e))}).on("touchend",function(t,e){_mouseLeaveStackAreaLine(t,this,e,"stackLine")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",(t,e)=>{renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"stackLine",key:e.key},e)}).on("mouseenter",function(t,e){_mouseEnterStackAreaLine(t,this,e,"stackLine")}).on("mousemove",(t,e)=>_mouseMove(t,e,"stackLine")).on("mouseleave",function(t,e){_mouseLeaveStackAreaLine(t,this,e,"stackLine")}).attr("d",t=>(o=_getMeasure(t.key),a(t))).style("stroke-width",t=>{const e=(o=_getMeasure(t.key)).strokeWidth>0?o.strokeWidth:1;return e>10?1:e}).style("fill","none").merge(n).attr("d",t=>(o=_getMeasure(t.key),a(t))).style("stroke",t=>_colorMeasure(t.key)).transition().duration(_dr).each(function(){_u.pathShow({sel:d3.select(this),dr:_dr})})}(e,a),function(t){const e=Object.keys(_u.symbols),a=cfg.data2.filter(t=>{for(let a=0,o=cfg.measures.length;a<o;a++)if(cfg.measures[a].colNm===t.key)return e.indexOf(cfg.measures[a].dotSymbol)>-1});if(_bodyG.selectAll("g.stackSymbol").remove(),!cfg.isMark)return;let o=_bodyG.selectAll("g.stackSymbol").data(a,_key);const n=(o=o.enter().append("g").attr("class",t=>"stackSymbol _"+c2i.util.getClassPure(t.key)).style("cursor","pointer").merge(o)).selectAll("path").data(t=>t);n.enter().append("path").attr("class",t=>"mark _"+c2i.util.getClassPure(t.key)).on("touchstart",function(t,e){_touchDbClick(t,this)&&(_mouseEnterBarMark(t,this,e,"stackSymbol"),renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"stackSymbol",key:e.key},e.src))}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"stackSymbol")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",(t,e)=>{renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"stackSymbol",key:e.key},e.src)}).on("mouseenter",function(t,e){_mouseEnterBarMark(t,this,e,"stackSymbol")}).on("mousemove",(t,e)=>_mouseMove(t,e,"stackSymbol")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"stackSymbol")}).style("fill-opacity",1e-6).attr("transform",e=>{const a=_xX(e.src[_xColNm])+_xWidthHalf,o=t(e[1]);return"translate("+[a,o]+")"}).attr("d",t=>{const e=_getMeasure(t.key);return d3.symbol().type(_u.symbols[e.dotSymbol]).size(0)()}).merge(n).style("fill",function(){const t=_getColumnName(this),e=_getMeasure(t);if(cfg.yDim&&cfg.yDim.color[1]&&"y"===e.yDim||cfg.y2Dim&&cfg.y2Dim.color[1]&&"y2"===e.yDim){const a="circle"===e.dotSymbol?"radialGradient":void 0;return __gradient(_colorMeasure(t),a)}return _colorMeasure(t)}).transition().duration(_dr).attr("d",t=>{const e=_getMeasure(t.key);let a=_setUpRadius(e,t.src);return a=isNaN(a)?10:a,d3.symbol().type(_u.symbols[e.dotSymbol]).size(50*a)()}).style("fill-opacity",.7).attr("transform",e=>{const a=_xX(e.src[_xColNm])+_xWidthHalf,o=t(e[1]);return"translate("+[a,o]+")"})}(e),function(){const t=cfg.data2.filter(t=>{for(let e=0,a=cfg.measures.length;e<a;e++)if(cfg.measures[e].colNm===t.key)return cfg.measures[e].showLabel});let e=_bodyG.selectAll("g.stackLbl").data(t,_key);if(e.exit().selectAll("text").transition().duration(_dr).attr("y",_contentH()).attr("fill-opacity",1e-6),e.exit().transition().remove(),t.length<1)return;e=e.enter().append("g").attr("class",t=>"stackLbl _"+c2i.util.getClassPure(t.key)).merge(e),(_stackLabels=e.selectAll("text").data(t=>t)).exit().transition().style("opacity",1e-6).remove(),_renderStackBarAreaLabel(e),_renderStackBarAreaSumLabel(e.data())}()}function renderAreas(){const t=_getFilterData("area"),e=_contentH();let a,o,n=e,r="monotone";const l=cfg.common;_xWidth=_xWidthHalf=0,"band"===_xScale&&(_xWidthHalf=_xX.bandwidth()/2);const i="band"===_xScale?_xWidthHalf:0;t.length>0&&("y"===(a=_getMeasure(t[0].key)).yDim?(r=cfg.yDim.curve,o=_yY):(r=cfg.y2Dim.curve,o=_y2Y),l&&l.ySplit&&l.ySplit.ratio&&(n="y"===a.yDim?e*l.ySplit.ratio:e));const s=(t,e)=>d3.area().defined(t=>!a.noDrawColNm||!t[a.noDrawColNm]).curve(_u.curve[r]).x(t=>_xX(t[_xColNm])+i).y0(n).y1(t=>e?o(t[a.colNm]):n)(t),c=_bodyG.selectAll("path.area").data(t,_key);c.exit().transition().duration(_dr).ease(_u.ease[cfg.easing]).attr("d",t=>(a=_getMeasure(t.key),s(t.values))).remove(),c.enter().append("path").attr("class",t=>"area _"+c2i.util.getClassPure(t.key)).on("touchstart",function(t,e){_touchDbClick(t,this)&&(_mouseEnterAreaLine(t,this,e,"area"),renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"area",key:e.key},e))}).on("touchend",function(t,e){_mouseLeaveAreaLine(t,this,e,"area")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",(t,e)=>{renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"area",key:e.key},e)}).on("mouseenter",function(t,e){_mouseEnterAreaLine(t,this,e,"area")}).on("mousemove",(t,e)=>_mouseMove(t,e,"area")).on("mouseleave",function(t,e){_mouseLeaveAreaLine(t,this,e,"area")}).merge(c).style("fill",t=>__areaFillTexture(t.key)).attr("d",t=>(a=_getMeasure(t.key),s(t.values))).style("fill-opacity",1e-6).transition().duration(_dr).ease(_u.ease[cfg.easing]).attr("d",t=>(a=_getMeasure(t.key),s(t.values,!0))).style("fill-opacity",.5)}function renderBars(){const t=_getFilterData("bar");_xWidth=_xWidthHalf=0,"band"===_xScale?_xWidth=_xX.bandwidth():t.length&&(_xWidth=parseInt(_xX.range()[1]/t[0].values.length));let e=_bodyG.selectAll("g.bar").data(t,_key);if(e.exit().remove(),t.length<1)return;const a=(e=e.enter().append("g").attr("class",t=>"bar _"+c2i.util.getClassPure(t.key)).merge(e)).selectAll(".rect").data(t=>t.values);if(a.exit().remove(),a.enter().append("rect").attr("class",function(t){return"rect "+_getColumnName(this)}).on("touchstart",function(t,e){if(_touchDbClick(t,this)){const a=__getMetaMeasure(this);_mouseEnterBarMark(t,this,{key:a.colNm,src:e},"barSimple"),renderTrendLines(a.colNm),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"barSimple",key:a.colNm},e)}}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,{key:__getMetaMeasure(this).colNm,src:e},"barSimple")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",function(t,e){const a=__getMetaMeasure(this);renderTrendLines(a.colNm),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"barSimple",key:a.colNm},e)}).on("mouseenter",function(t,e){_mouseEnterBarMark(t,this,{key:__getMetaMeasure(this).colNm,src:e},"barSimple")}).on("mousemove",function(t,e){_mouseMove(t,{key:__getMetaMeasure(this).colNm,src:e},"barSimple")}).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,{key:__getMetaMeasure(this).colNm,src:e},"barSimple")}).style("fill-opacity",function(){return"y"===__getMetaMeasure(this).yDim?cfg.yDim.opacity:cfg.y2Dim.opacity}).attr("width",_xWidth).attr("height",0).attr("transform",t=>`translate(${_xX(t[_xColNm])-_xWidthHalf}, ${_yEnd()})`).merge(a).style("stroke",function(t,e){const a=__getMetaMeasure(this);return cfg.measureColors?cfg.measureColors[e%cfg.measureColors.length]:a.negative&&t[a.colNm]<0&&a.negative.color?a.negative.color:_colorMeasure(a.colNm)}).style("stroke-width",function(){return _isTexture(__getMetaMeasure(this))}).style("stroke-dasharray",function(t){const e=__getMetaMeasure(this);if(!(!e.noDrawColNm||!t[e.noDrawColNm])&&e.dashLength&&e.dashLength>0)return e.dashLength}).style("fill",function(t,e){if(cfg.measureColors)return cfg.measureColors[e%cfg.measureColors.length];const a=__getMetaMeasure(this);if(a.float){let e;if(a.float.some(a=>{if(a.xValue&&t[_xColNm]===a.xValue)return e=a.color,!0}),e)return e;if(a.floatData.some(o=>{if(t[a.colNm]===o[a.colNm])return e=a.float[o.__float_idx].color,!0}),e)return e}const o=a.negative;return o&&t[a.colNm]<0&&!(_xPlotTexture&&_xPlotLables.indexOf(t[_xColNm])>-1)?o.color:__barFillTexture(a.colNm,t)}).transition().duration(_dr).attr("width",function(){return __barWidthModify(this,t,!0)}).attr("height",function(t){const e=__getMetaMeasure(this);if(e.labelStyle||_isNegative)return"y"===e.yDim?Math.abs(_yY(t[e.colNm])-_yY(0)):Math.abs(_y2Y(t[e.colNm])-_y2Y(0));const a=_getSplitPosHeight(e)-("y"===e.yDim?_yY(t[e.colNm]):_y2Y(t[e.colNm]));return a<0?0:a}).attr("transform",function(e){const a=__getMetaMeasure(this),o=__barWidthModify(this,t,!1);let n;return n=_isNegative&&e[a.colNm]<0?_yY(0):"y"===a.yDim?_yY(e[a.colNm]):_y2Y(e[a.colNm]),`translate(${_xX(e[_xColNm])-_xWidthHalf+o}, ${n})`}),_xImage&&_xImage.isShow){const t=_xImage.dy?_xImage.dy:0,a=_xImage.dx?_xImage.dx:0,o=e.selectAll("image").data(t=>t.values);o.exit().remove(),o.enter().append("image").style("point-events","none").style("opacity",0).attr("xlink:xlink:href",t=>t[_xImage.colNm]).attr("width",_xImage.width).attr("height",0).attr("transform",function(t){const e=__getMetaMeasure(this),a="y"===e.yDim?_yY(t[e.colNm]):_y2Y(t[e.colNm]),o=_contentH()-a;return"translate("+[parseInt(_xX(t[_xColNm])+_xWidth/2-_xImage.width/2),o]+")"}).merge(o).transition().duration(_dr).attr("transform",function(e){const o=__getMetaMeasure(this),n="y"===o.yDim?_yY(e[o.colNm]):_y2Y(e[o.colNm]),r=parseInt(_xX(e[_xColNm])+_xWidth/2-_xImage.width/2),l=parseInt(n-_xImage.height);return"translate("+[r+a,l+t]+")"}).style("opacity",_xImage.opacity?_xImage.opacity:1).attr("height",_xImage.height)}}function __barWidthModify(t,e,a){let o=_xWidth,n=0;if(e.length){const a=_getColumnName(t),r=e.findIndex(t=>t.key===a);r&&(o-=n=parseInt(_xWidth*(r/(e.length+1))))}return a?o:n/2}function __getMetaMeasure(t){return _getMeasure(_getColumnName(t))}function _getSplitPosHeight(t){let e=_contentH(),a=cfg.common;return a&&a.ySplit&&a.ySplit.ratio&&"y"===t.yDim&&(e*=a.ySplit.ratio),e}function renderLines(t){t=void 0===t;const e=_getFilterData("line"),a=_bodyG.selectAll("path.line"+t).data(e,_key);if(a.exit().transition().duration(_dr).remove(),e.length<1)return;let o,n,r;_xWidth=0,_xWidthHalf=0,"band"===_xScale&&(_xWidthHalf=_xX.bandwidth()/2);const l="band"===_xScale?_xWidthHalf:0;a.enter().append("path").attr("class",e=>"line _"+c2i.util.getClassPure(e.key)+" line"+t).style("cursor","pointer").on("touchstart",function(t,e){_touchDbClick(t,this)&&(_mouseEnterAreaLine(t,this,e,"line"),renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"line",key:e.key},e))}).on("touchend",function(t,e){_mouseLeaveAreaLine(t,this,e,"line")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",(t,e)=>{renderTrendLines(e.key),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"line",key:e.key},e)}).on("mouseenter",function(t,e){_mouseEnterAreaLine(t,this,e,"line")}).on("mousemove",(t,e)=>_mouseMove(t,e,"line")).on("mouseleave",function(t,e){_mouseLeaveAreaLine(t,this,e,"line")}).merge(a).attr("d",e=>(r=_getMeasure(e.key),(e=>{"y"===r.yDim?(o=cfg.yDim.curve,n=_yY):(o=cfg.y2Dim.curve,n=_y2Y);let a=-1;if(!t&&r.dashLength){let t=!0;e.forEach((o,n)=>{""===o[r.noDrawColNm]?a=n:t&&a>-1&&(e[a][r.noDrawColNm]="true",t=!1)})}return d3.line().defined((e,o)=>{const n=!r.noDrawColNm||!e[r.noDrawColNm];return o===a&&(e[r.noDrawColNm]=""),t?n:!n&&r.dashLength&&r.dashLength>0}).curve(_u.curve[o]).x(t=>_xX(t[_xColNm])+l).y(t=>n(t[r.colNm]))(e)})(e.values))).style("fill","none").style("stroke",t=>_colorMeasure(t.key)).style("stroke-width",t=>{const e=(r=_getMeasure(t.key)).strokeWidth>0?r.strokeWidth:1;return e>10?1:e}).each(function(e){r=_getMeasure(e.key);const a=t?0:r.dashLength?r.dashLength:0;_u.pathShow({sel:d3.select(this),dr:_dr,dashLen:a})})}function renderMarks(){if(_bodyG.selectAll("g.symbol").remove(),!cfg.isMark)return;const t=Object.keys(_u.symbols),e=cfg.data.filter(e=>{for(let a=0,o=cfg.measures.length;a<o;a++)if(cfg.measures[a].colNm===e.key&&!("each"!==_yCluster&&"y"===cfg.measures[a].yDim||"each"!==_y2Cluster&&"y2"===cfg.measures[a].yDim)&&cfg.measures[a].graphType&&t.indexOf(cfg.measures[a].dotSymbol)>-1)return _selectedMeasures.length&&_selectedMeasures.indexOf(e.key)>-1});if(e.length<1)return;let a=_bodyG.selectAll("g.symbol").data(e,_key);const o=(a=a.enter().append("g").attr("class",(t,e)=>"symbol _"+c2i.util.getClassPure(t.key)).style("cursor","pointer").merge(a)).selectAll("path").data(t=>t.values);o.enter().append("path").attr("class",function(){return"symbol "+_getColumnName(this)}).on("touchstart",function(t,e){_touchDbClick(t,this)&&(e.key=_getColumnName(this),_mouseEnterBarMark(t,this,e,"dot"),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"dot",key:e.key},e))}).on("touchend",function(t,e){_mouseLeaveBarMark(t,this,e,"dot")}).on("dblclick",function(t){_dblclick(t,this)}).on("click",function(t,e){const a=_getColumnName(this);renderTrendLines(a),cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"dot",key:a},e)}).on("mouseenter",function(t,e){e.key=_getColumnName(this),_mouseEnterBarMark(t,this,e,"dot")}).on("mousemove",(t,e)=>_mouseMove(t,e,"dot")).on("mouseleave",function(t,e){_mouseLeaveBarMark(t,this,e,"dot")}).style("stroke",function(){const t=_getColumnName(this),e=_getMeasure(t);return e.dotStyle&&e.dotStyle.stroke?e.dotStyle.stroke:_colorMeasure(t)}).style("stroke-width",function(){const t=_getMeasure(_getColumnName(this));return t.dotStyle&&t.dotStyle.strokeWidth?t.dotStyle.strokeWidth:1}).style("fill-opacity",1e-6).merge(o).style("fill",function(t){const e=_getColumnName(this),a=_getMeasure(e);if(a.float){let o;if(a.floatData.some(function(n){if(t[e]===n[e])return o=a.float[n.__float_idx].color,!0}),o)return o}const o=a.negative;if(o&&t[e]<0)return o.color;if(cfg.yDim&&cfg.yDim.color[1]&&"y"===a.yDim||cfg.y2Dim&&cfg.y2Dim.color[1]&&"y2"===a.yDim){const t="circle"===a.dotSymbol?"radialGradient":void 0;return __gradient(_colorMeasure(e),t)}return a.dotStyle&&a.dotStyle.color?a.dotStyle.color:_colorMeasure(e)}).attr("transform",function(t){const e=_getMeasure(_getColumnName(this));return"translate("+[_xX(t[_xColNm])+("band"===_xScale?_xX.bandwidth()/2:0),("y2"===e.yDim?_y2Y(t[e.colNm]):_yY(t[e.colNm])).toFixed(2)]+")"}).attr("d",function(t){const e=_getMeasure(_getColumnName(this));return d3.symbol().type(_u.symbols[e.dotSymbol]).size(0)()}).transition().duration(_dr).attr("d",function(t){const e=_getMeasure(_getColumnName(this));let a=_setUpRadius(e,t);return a=isNaN(a)?10:a,d3.symbol().type(_u.symbols[e.dotSymbol]).size(25*a)()}).style("fill-opacity",function(t){const e=_getMeasure(_getColumnName(this));return e.noDrawColNm&&t[e.noDrawColNm]&&"true"===t[e.noDrawColNm].toLowerCase()?0:(e.dotStyle&&e.dotStyle.strokeWidth&&d3.select(this).style("stroke",e.dotStyle.stroke).style("stroke-width",e.dotStyle.strokeWidth),e.dotStyle?1:.7)})}function renderLabels(){const t=cfg.data.filter(function(t){for(let e=0,a=cfg.measures.length;e<a;e++)if(c2i.util.getClassPure(cfg.measures[e].colNm)===c2i.util.getClassPure(t.key)&&!("each"!==_yCluster&&"y"===cfg.measures[e].yDim||"each"!==_y2Cluster&&"y2"===cfg.measures[e].yDim))return!!cfg.measures[e].showLabel&&(_selectedMeasures.length&&_selectedMeasures.indexOf(t.key)>-1)});if(_bodyG.selectAll("g.lbl").remove(),t.length<1)return;let e=_bodyG.selectAll("g.lbl").data(t,_key);e=e.enter().append("g").attr("class",t=>"lbl _"+c2i.util.getClassPure(t.key)).merge(e);const a="band"===_xScale?_xX.bandwidth()/2:0,o=e.selectAll("text").data(t=>t.values);function n(t,e){const a=_getColumnName(t);return _fontsMeasure(a)[e]}function r(t,e){const o=_getMeasure(_getColumnName(e));let n=0;if(o.labelStyle){const e=o.labelStyle;t[e.posColNm]&&("right"===t[e.posColNm].toLowerCase()?n=e.dx?e.dx:5:"left"===t[e.posColNm].toLowerCase()&&(n=e.dx?e.dx:5,n*=-1))}return _xX(t[_xColNm])+a+n}o.enter().append("text").style("font-family",function(){return n(this,0)}).style("font-size",function(){return n(this,1)}).attr("fill",function(t){const e=_getColumnName(this);if(t[e]<0){const t=_getMeasure(e);if(t.negative)return t.negative.color}return n(this,2)}).style("pointer-events","none").style("text-anchor",function(t){const e=_getMeasure(_getColumnName(this));if(e.labelStyle){const a=e.labelStyle;if(t[a.posColNm]&&"right"===t[a.posColNm].toLowerCase())return null;if(t[a.posColNm]&&"left"===t[a.posColNm].toLowerCase())return"end"}return"middle"}).attr("class",_xNameClass).attr("x",function(t){return r(t,this)}).text(function(t){let e=_getColumnName(this);const a=_getMeasure(e);e=a.colNm;let o="";if(a.float){let n;if(a.floatData.some(r=>{if(t[e]===r[e]){const l=a.float[r.__float_idx];return n=l.color,o=l.prefix+" "+d3.format(a.format)(t[e])+l.suffix,!0}}),o&&n){const t=a.labelStyle&&a.labelStyle.float&&a.labelStyle.float.fontSize>0?a.labelStyle.float.fontSize:1.3;return d3.select(this).style("fill",n).style("fill-opacity",1).style("font-size",parseInt(a.fonts[1])*t+"px"),o}if(a.labelStyle&&a.labelStyle.onlyFloat){let e=0;a.labelStyle.float&&(a.labelStyle.float.firstValue&&_xX.domain()[0]===t[_xColNm]?e=1:a.labelStyle.float.lastValue&&_xX.domain()[_xX.domain().length-1]===t[_xColNm]&&(e=1)),d3.select(this).style("opacity",e)}}const n=a.sub;return n&&n.colNm&&(o=d3.format(n.format)(t[n.colNm]),n.prefix&&(o=n.prefix+o),n.suffix&&(o+=n.suffix),n.isOnly)?o:d3.format(a.format)(t[e])+o}).merge(o).style("fill-opacity",1e-6).transition().duration(_dr).attr("x",function(t){return r(t,this)}).attr("y",function(t){return function(t,e){let a=_getColumnName(e);const o=_getMeasure(a);let n;if(a=o.colNm,o.labelStyle){const e=o.labelStyle;if(n=void 0!==e.dy?e.dy:5,o.labelStyle.zeroLine){if(_isNegativeEach)return t[a]>0?n+=parseInt(o.fonts[1])/1.5:n*=-1,"y"===o.yDim?parseInt(_yY(0))+n:parseInt(_y2Y(0))+n;n*=-1}if("bar"===o.graphType&&o.negative&&_isNegativeEach){let r;return t[a]>=0?(r="y"===o.yDim?Math.abs(_yY(t[a])-_yY(0)):Math.abs(_y2Y(t[a])-_y2Y(0)),e.posColNm?t[e.posColNm]&&"down"===t[e.posColNm].toLowerCase()?n=-r+parseInt(o.fonts[1])+n/2:(r*=-1,n*=-1):n*=2):(r="y"===o.yDim?_yY(0)-_yY(t[a]):_y2Y(0)-_y2Y(t[a]),e.posColNm?t[e.posColNm]&&"top"===t[e.posColNm].toLowerCase()?n=-r-parseInt(o.fonts[1])/2-n/2:(r*=-1,n=n+parseInt(o.fonts[1])/2+n/2):n*=-1),"y"===o.yDim?parseInt(_yY(t[a]))+r+n:parseInt(_y2Y(0))+r+n}switch(e.posColNm&&t[e.posColNm]){case"top":n*=-1;break;case"down":n+=parseInt(o.fonts[1]);break;case"left":case"right":n=parseInt(o.fonts[1])/3}}else{n="bar"===o.graphType?o.dy?o.dy:-10:o.dy?o.dy:5;const e="y"===o.yDim?parseInt(_yY(t[a]))+n:parseInt(_y2Y(t[a]));n=_contentH()-e>10?n:-2}return"y"===o.yDim?parseInt(_yY(t[a]))+n:parseInt(_y2Y(t[a]))+n}(t,this)+(cfg.isMark?0:8)}).style("fill-opacity",function(t){return function(t,e){let a=_getColumnName(e);const o=_getMeasure(a);if(a=o.colNm,o.noDrawColNm&&t[o.noDrawColNm]&&"true"===t[o.noDrawColNm].toLowerCase())return 0;if(o.labelStyle&&o.labelStyle.posColNm)return t[o.labelStyle.posColNm]?1:0;if("bar"===o.graphType)return 1;const n="y2"===o.yDim?parseInt(_y2Y(t[a]))+5:parseInt(_yY(t[a]));return _contentH()-n>10?1:1e-6}(t,this)})}function renderPlotLines(){const t=function(){let t=[],e=[];return cfg.measures.forEach(e=>{e.draw&&-1===t.indexOf(e.yDim)&&t.push(e.yDim)}),t.forEach(function(t){const a="y"===t?cfg.yDim:cfg.y2Dim;if(!a.plotLines)return;if(a.cluster.indexOf("100")>-1||a.cluster.indexOf("stream")>-1)return;const o=a.plotLines.filter(t=>t.draw);if(0!==o.length)if(a.cluster.indexOf("stack")>-1||a.cluster.indexOf("box")>-1){if(a.cluster.indexOf("box")>-1&&-1===_selectedMeasures.indexOf(cfg.boxConfig.max))return;o.forEach(a=>{"all"===a.relCol&&(a.yDim=t,a.y=a.value,e.push(a))})}else(a.cluster.indexOf("group")>-1||a.cluster.indexOf("each")>-1)&&o.forEach(a=>{if("all"!==a.relCol){let t;if(cfg.measures.some(e=>{if(e.colNm===a.relCol)return t=e.draw,!0}),!t)return}if(a.yDim=t,"value"===a.index)a.y=a.value?a.value:0,e.push(a);else if("all"!==a.relCol){let t=0;cfg.data[0].values.forEach(e=>t+=e[a.relCol]),a.y=t/cfg.data[0].values.length,e.push(a)}else a.y=isNaN(a.value)?0:a.value,e.push(a)})}),e.forEach(t=>{cfg.measures.some(e=>{if("all"===t.relCol||e.colNm===t.relCol)return"y"===t.yDim?t.format=cfg.yDim.formatAvg||cfg.yDim.format:t.format=cfg.y2Dim.formatAvg||cfg.y2Dim.format,!0})}),e}(),e=_bodyG.selectAll("path.plotLine").data(t,function(t,e){return"_"+e+"_"+(t.caption?t.caption.replace(/[\s|.|\/]/g,""):"")});if(e.exit().transition().duration(_dr).each(function(){d3.select(this).remove(),_bodyG.selectAll("text.plotLine."+this.__data__.relCol+this.__data__.index).remove()}),function(){const e=_svg.select(c2iCon+"_c2iArrow").selectAll("marker").data(t.filter(t=>t.isArrow),function(t,e){return"_"+e+"_"+(t.caption?t.caption.replace(/[\s|.|\/]/g,""):"")});e.exit().remove(),e.enter().append("svg:marker").attr("id",t=>n(t.color)).attr("refX",6).attr("refY",3).attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("path").attr("d","M 0 0 6 3 0 6 1.5 3").style("fill",t=>t.color).merge(e)}(),t.length<1)return;const a=d3.line().x(t=>t.x).y(t=>t.y);function o(t){const e=_contentH(),a=cfg.common;let o,n,r=c2iCon.substr(1)+t.relCol+"_split",l=0;"y"===t.yDim?(o=(n=_yY)(t.y),a&&a.ySplit&&a.ySplit.ratio&&(e*=a.ySplit.ratio),o=Math.round(100*(1-o/e))+"%"):(o=(n=_y2Y)(t.y),a&&a.ySplit&&a.ySplit.ratio?(l=e*a.ySplit.ratio,o=Math.round(100*(1-(o-l)/(e-l)))+"%"):o=Math.round(100*(1-o/e))+"%"),__plotUpdateStops(r,[{offset:o,color:t.splitColors[0]},{offset:o,color:t.splitColors[1]}],n.domain(),t.yDim),r="url(#"+r+")","all"!==t.relCol&&(_bodyG.select(".line._"+t.relCol).style("stroke",r),_bodyG.select(".area._"+t.relCol).style("fill",r),_bodyG.select(".bar._"+t.relCol).selectAll("rect").style("stroke",r).style("fill",r),_bodyG.select(".stackGrp._"+t.relCol).selectAll("rect").style("stroke",r).style("fill",r))}function n(t){return t.indexOf("rgb")>-1?t=d3.rgb(t).formatHex().slice(1,7):t.indexOf("#")>-1&&(t=t.substr(1)),c2iCon.substr(1)+"_c2iArrow_"+t}e.enter().append("path").attr("class",t=>"plotLine "+t.relCol+t.index).style("stroke",t=>t.color).style("stroke-width",t=>t.width).style("shape-rendering","crispedges").attr("marker-end",t=>t.isArrow?"url(#"+n(t.color)+")":null).attr("transform",function(t){if("all"!==t.relCol&&Array.isArray(t.splitColors)&&2===t.splitColors.length)d3.select(this).call(_dragPlotHandle),o(t),d3.select(this).style("cursor","move");else if("all"===t.relCol&&t.splitColors&&Array.isArray(t.splitColors))_u.textures[t.splitColors[0]];return"translate(0,"+("y"===t.yDim?_yY(t.y):_y2Y(t.y))+")"}).merge(e).attr("d",function(t){let e,o,n;"y"===t.yDim?(e=_contentW(),o=_fix.left,n=0):(e=_fix.left,o=_contentW(),n=0);return a([{x:e,y:n},{x:o,y:n}])}).attr("transform",function(t){return"all"!==t.relCol&&Array.isArray(t.splitColors)&&2===t.splitColors.length&&o(t),"translate(0,"+("y"===t.yDim?_yY(t.y):_y2Y(t.y))+")"}).each(function(t){_u.pathShow({sel:d3.select(this),dr:_dr,dashLen:t.dashLength})}),function(){const e=_bodyG.selectAll("text.plotLine").data(t);function a(t){let e=_contentW()/2;const a=t.dx?t.dx:12;switch(t.pos&&t.pos.toLowerCase()){case"right":e=_contentW()-a;break;case"rightout":e=_contentW()+a;break;case"left":e=a;break;default:e=_contentW()/2}return e}e.exit().transition().style("opacity",1e-6).remove(),e.enter().append("text").attr("class",t=>"plotLine "+t.relCol+t.index).style("font-family",t=>t.fonts[0]).style("font-size",t=>t.fonts[1]).attr("fill",t=>t.fonts[2]).style("pointer-events","none").text(t=>{let e=t.caption&&t.caption.length>0?t.caption:"";t.withValue&&(e+=": "+d3.format(t.format)(t.y));return e}).style("text-anchor",t=>{let e="middle";switch(t.pos&&t.pos.toLowerCase()){case"right":e="end";break;case"left":case"rightout":e="start";break;default:e="middle"}return e}).attr("x",a).merge(e).transition().duration(_dr).attr("x",a).attr("y",function(t){let e=t.dy?t.dy:-10;t.pos&&"rightout"===t.pos.toLowerCase()&&(e=parseInt(t.fonts[1])/2);return"y"===t.yDim?_yY(t.y)+e:_y2Y(t.y)+e})}()}function __plotUpdateStops(t,e,a,o){_svg.select("#"+t).empty()&&_svg.select("#"+c2iCon.substr(1)+"_c2iArrow").append("linearGradient").attr("id",t).attr("gradientUnits","userSpaceOnUse"),_svg.select("#"+t).attr("x1",0).attr("y1","y"===o?_yY(a[0]):_y2Y(a[0])).attr("x2",0).attr("y2","y"===o?_yY(a[1]):_y2Y(a[1]));const n=_svg.select("#"+t).selectAll("stop").data(e);n.enter().append("stop").attr("stop-color",t=>t.color).merge(n).attr("offset",t=>t.offset),n.exit().remove()}function __removeParetoLine(){__initParetoLines([]),_svg.selectAll(".axes .yPareto").remove(),_bodyG.selectAll("g.paretoMark").remove(),_yParetoAxis=_yParetoAsisG=_paretoIndex=void 0}function __initParetoLines(t){let e=_bodyG.selectAll("path.paretoLine").data(t,_key);return e.exit().transition().duration(_dr).each(function(){_u.pathShow({sel:d3.select(this),dr:_dr,isReverse:!0}),d3.select(this).remove()}),e}function renderParetoLines(){const t=cfg.pareto;if(isNaN(_paretoIndex)||!t||!t.isDraw)return void __removeParetoLine();let e=__initParetoLines([cfg.data[_paretoIndex]]);_xWidthHalf=0,"band"===_xScale&&(_xWidthHalf=_xX.bandwidth()/2);const a="band"===_xScale?_xWidthHalf:0;_yPareto=d3.scaleLinear().range([_contentH(),15]);const o=d3.line().curve(_u.curve[t.curve]).x(t=>_xX(t[_xColNm])+a).y(t=>_yPareto(t._cumP));e.enter().append("path").attr("class",t=>"paretoLine _"+c2i.util.getClassPure(t.key)).style("fill","none").style("stroke-width",t.strokeWidth).attr("d",t=>o(t.values)).merge(e).attr("d",t=>o(t.values)).style("stroke",t=>_colorMeasure(t.key)).each(function(){_u.pathShow({sel:d3.select(this),dr:_dr})}),function(){if(_yParetoAsisG)return void __paretoAxisDraw();const e=__getTicks(t.ticks);(_yParetoAxis="left"===t.axisPos?d3.axisLeft():d3.axisRight()).scale(_yPareto).ticks(e,"%").tickSize(_yShowGrid?5:0).tickPadding(6),_yParetoAsisG=_axesG.append("g").attr("class","yPareto axis").style("cursor","move").attr("transform","translate("+[_xEnd()-_xWidthHalf,_yEnd()]+")").call(_yParetoAxis).call(_dragParetoHandle),__paretoAxisDraw()}(),__renderParetoMarkLabel()}function __renderParetoMarkLabel(){_bodyG.selectAll("g.paretoMark").remove();const t=cfg.data[_paretoIndex];let e=_bodyG.selectAll("g.paretoMark").data([t],_key);const a=(e=e.enter().append("g").attr("class",t=>"paretoMark _"+c2i.util.getClassPure(t.key)).style("cursor","pointer").merge(e)).selectAll("path").data(t.values),o=a.enter().append("circle").attr("class",function(){return"pMark "+_getColumnName(this)}).on("touchstart",(t,e)=>{cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"pMark"},e)}).on("click",(t,e)=>{cfg.method.click&&cfg.method.click(t,{container:c2iCon,selector:"pMark"},e)}).style("fill",function(){const t=_getColumnName(this);return _colorMeasure(t)}).merge(a);function n(t,e){const a=_getColumnName(t);return _fontsMeasure(a)[e]}o.append("title").merge(a.select("title")).text(function(t){const e=this.parentNode.parentNode.__data__.key,a=_getMeasure(e);let o=`${a.caption}: ${_getFormat(e,t[a.colNm])} (${d3.format(".1%")(t[a.colNm]/t._cum)} vs ${_lang.cm.cum})`;return o=`${_lang.cm.cum}: ${_format(t._cum)} (${d3.format(".1%")(t._cumP)})\n${o}`}),o.attr("r",0).style("stroke",cfg.pareto.circleStroke).style("fill-opacity",1e-6).attr("cx",t=>_xX(t[_xColNm])+_xWidthHalf).attr("cy",t=>_yPareto(t._cumP)).transition().duration(_dr).attr("r",cfg.pareto.radius).style("fill-opacity",1),cfg.pareto.showLabel&&a.enter().append("text").style("pointer-events","none").style("font-family",function(){return n(this,0)}).style("font-size",function(){return n(this,1)}).attr("fill",function(){if(cfg.pareto.invertColor){const t=_getColumnName(this);return _u.invertColor(_colorMeasure(t))}return n(this,2)}).style("text-anchor","middle").style("fill-opacity",1e-6).attr("class",_xNameClass).attr("x",function(t){return _xX(t[_xColNm])+_xWidthHalf}).attr("y",function(t){return parseInt(_yPareto(t._cumP)+parseInt(n(this,1))/2)}).text(t=>d3.format(".0%")(t._cumP)).merge(a).transition().duration(_dr).style("fill-opacity",1)}function __paretoAxisDraw(){const t=cfg.pareto;let e=cfg.measures[_paretoIndex].color;e=Array.isArray(e)?e[0]:e,_yParetoAsisG.selectAll(".yPareto .tick > text").style("font-family",t.fonts[0]).style("font-size",t.fonts[1]).style("fill",e),_svg.selectAll(".axes .yPareto .domain").style("fill","none").style("stroke",e).style("stroke-width","1px"),_svg.selectAll(".axes .yPareto .tick line").style("stroke",e).style("stroke-width","1px").style("stroke-opacity",".7")}function __initTrendLines(t){return _bodyG.selectAll(".trendLine").remove(),_bodyG.selectAll(".trendLine").data(t)}function renderTrendLines(t){const e=cfg.trend;if(t&&cfg.measures.some(function(e,a){if(e.colNm===t)return _trendIndex=a,!0}),isNaN(_trendIndex)||!e||!e.isDraw)return void __initTrendLines([]);const a=e.method.indexOf("expo")>-1,o=d3.format("0.2f"),n=cfg.measures[_trendIndex],r=function(t){let o=d3.range(1,_xValues.length+1),n=cfg.data[_trendIndex].values.map(function(t){return parseFloat(t[cfg.measures[_trendIndex].colNm])});if(e.exceptZero){let t=[],e=0,a=[];n.forEach(function(o){0!==o&&(t.push(++e),a.push(o))}),o=t,n=a}const r=_u.trendLine(e.method,o,n);if(a)return{key:t.colNm,value:r};const l=_xX.domain(),i=l[0],s=l[l.length-1],c=r.slope+r.intercept,d=r.slope*o.length+r.intercept;return[{key:t.colNm,x1:i,y1:c,x2:s,y2:d,value:r}]}(n);let l=__initTrendLines(a?[r]:r);_xWidthHalf=0,"band"===_xScale&&(_xWidthHalf=_xX.bandwidth()/2);const i="band"===_xScale?_xWidthHalf:0,s="y"===n.yDim?_yY:_y2Y;if(l=l.enter().append("g").attr("class","trendLine"),e.method.indexOf("expo")>-1){const t=_xX.copy(),a=d3.range(0,r.value.length);t.domain(a);const o=d3.line().x((e,a)=>t(a)+i).y(t=>s(t));l.append("path").datum(r.value).attr("class","tLine").attr("d",o).style("fill","none").attr("stroke",_colorMeasure(r.key)).attr("stroke-width",e.strokeWidth).each(function(){_u.pathShow({sel:d3.select(this),dr:_dr,dashLen:e.dashLength})})}else l.append("line").attr("class","tLine").attr("x1",t=>_xX(t.x1)+i).attr("y1",t=>s(t.y1)).attr("x2",t=>_xX(t.x1)+i).attr("y2",t=>s(t.y1)).attr("stroke",t=>_colorMeasure(t.key)).attr("stroke-width",e.strokeWidth).attr("stroke-dasharray",e.dashLength).transition().duration(_dr).ease(_u.ease[cfg.easing]).attr("x2",t=>_xX(t.x2)+i).attr("y2",t=>s(t.y2)),l.append("text").text(t=>{return _getMeasure(t.key).caption+" "+_lang.gen.rSq+": "+o(t.value.rSquare)}).attr("text-anchor","end").style("font-family",e.fonts[0]).style("font-size",e.fonts[1]).style("fill",e.fonts[2]).attr("x",t=>_xX(t.x2)).attr("y",t=>s(t.y2)-e.dy).append("title").text(t=>`${_lang.gen.equation}: ${_getFormat(n.colNm,t.value.slope)}x + ${_getFormat(n.colNm,t.value.intercept)}`)}function _getFilterData(t){let e=[];const a=cfg.measures;return cfg.data.forEach(o=>{for(let n=0,r=a.length;n<r;n++)a[n].colNm===o.key&&("each"!==_yCluster&&"y"===a[n].yDim||"each"!==_y2Cluster&&"y2"===a[n].yDim||a[n].graphType&&a[n].graphType.toLowerCase().indexOf(t)>-1&&_selectedMeasures.length&&_selectedMeasures.indexOf(o.key)>-1&&e.push(o))}),__haveNegativeVal(e,_selectedMeasures),e}function __haveNegativeVal(t,e){t.length&&(_isNegative=!1,_rawData.some(t=>{if(e.some(e=>{if(_isNegative=t[e]<0)return!0}),_isNegative)return!0}))}function _xNameClass(t){const e=t.src?t.src[_xColNm]:t[_xColNm];return _u.getClassName(_xValues,e)}function __legendStyle(t,e,a){d3.select(cfg.legend.id).select("."+t).style("text-decoration",a).style("color",e)}chart.renderFromLegend=(()=>{"object"==typeof cfg.xyValueGrid&&0===_selectedMeasures.length&&(_svg.select("g.c2iCursorX").style("opacity",0),_svg.select("g.c2iCursorY").style("opacity",0)),function(){const t=cfg.measures;for(let e=0,a=t.length;e<a;e++)t[e].draw=_selectedMeasures.indexOf(t[e].colNm)>-1,t[e].draw||(_paretoIndex===e&&__removeParetoLine(),_trendIndex===e&&(_trendIndex=void 0))}(),dynamicMargin(),setUpScaleX(),_yCluster&&setUpScaleY("y",_yCluster),_y2Cluster&&setUpScaleY("y2",_y2Cluster),_renderUpdateAxis(),renderBody()}),chart.selectedMeasures=function(t){if(!arguments.length)return _selectedMeasures;_selectedMeasures=t},chart.chartToggle=function(t,e){if(!_getMeasure(t).draw)return;let a="",o=_colorMeasure(t);const n="_"+t;e&&(a="3px",o=_u.colorHover(o)),_bodyG.selectAll(".stackGrp."+n).selectAll(".rect").style("stroke-dasharray",a).attr("fill-save",function(){return e?d3.select(this).style("fill"):d3.select(this).attr("fill-save")}).style("fill",function(){return e?o:(o=d3.select(this).attr("fill-save"),d3.select(this).attr("fill-save",null),o)}),_bodyG.selectAll("path.stackLine."+n).style("stroke-dasharray",a).style("stroke",o),_bodyG.selectAll("path.c2iPath."+n).style("fill",o),_bodyG.selectAll(".bar."+n).selectAll(".rect").style("stroke-dasharray",a).attr("stroke-save",function(){return e?d3.select(this).style("stroke"):d3.select(this).attr("stroke-save")}).style("stroke",function(){return e?o:(o=d3.select(this).attr("stroke-save"),d3.select(this).attr("stroke-save",null),o)}).attr("fill-save",function(){return e?d3.select(this).style("fill"):d3.select(this).attr("fill-save")}).style("fill",function(){return e?o:(o=d3.select(this).attr("fill-save"),d3.select(this).attr("fill-save",null),o)}),_bodyG.selectAll("path.line."+n).style("stroke-dasharray",a).attr("stroke-save",function(){return e?d3.select(this).style("stroke"):d3.select(this).attr("stroke-save")}).style("stroke",function(){return e?o:(o=d3.select(this).attr("stroke-save"),d3.select(this).attr("stroke-save",null),o)}),_bodyG.selectAll("path.area."+n).attr("fill-save",function(){return e?d3.select(this).style("fill"):d3.select(this).attr("fill-save")}).style("fill",function(){return e?o:(o=d3.select(this).attr("fill-save"),d3.select(this).attr("fill-save",null),o)})};const __enterLeaveOpacity=(t,e,a)=>{const o=e.toLowerCase().indexOf("line")>-1?"stroke-opacity":"fill-opacity";a?(t.style(o,t.attr("c2iOpacity")),t.attr("c2iOpacity",null)):(t.attr("c2iOpacity",t.style(o)),t.style(o,.7*t.style(o)))},__xLabelToggle=(t,e)=>{const a=_xNameClass(t);_svg.selectAll([".tick ."+a,".hist"+c2i.util.getClassPure(t.key)+"."+a]).classed("xyTextHover",e)},__legendTipEnter=(t,e,a,o,n)=>{__tooltipInfo(a,n,t),cfg.legend&&__legendStyle(o,d3.rgb(_colorMeasure(o)).darker(),"underline"),cfg.method.mouseenter&&cfg.method.mouseenter(t,{container:c2iCon,selector:e},a.src?a.src:a)},__legendTipLeave=(t,e,a,o)=>{cfg.legend&&__legendStyle(o,_colorMeasure(o)),_tip&&cfg.tooltip.isShow&&!cfg.tooltip.fixedPos&&_tip.classed("c2iHidden",!0),cfg.method.mouseleave&&cfg.method.mouseleave(t,{container:c2iCon,selector:e},a.src?a.src:a)};function _mouseEnterStackAreaLine(t,e,a,o){__enterLeaveOpacity(d3.select(e),o),__legendTipEnter(t,o,a[0],a[0].key,a)}function _mouseEnterAreaLine(t,e,a,o){__enterLeaveOpacity(d3.select(e),o),__legendTipEnter(t,o,a,a.key,a.values)}function _mouseEnterBarMark(t,e,a,o){const n="bar"===o?d3.select(e).select(".rect"):d3.select(e);__enterLeaveOpacity(n,o),__legendTipEnter(t,o,a,a.key),__xLabelToggle(a,!0)}function _mouseLeaveStackAreaLine(t,e,a,o){__enterLeaveOpacity(d3.select(e),o,!0),__legendTipLeave(t,o,a[0],a[0].key)}function _mouseLeaveAreaLine(t,e,a,o){__enterLeaveOpacity(d3.select(e),o,!0),__legendTipLeave(t,o,a,a.key)}function _mouseLeaveBarMark(t,e,a,o){const n="bar"===o?d3.select(e).select(".rect"):d3.select(e);__enterLeaveOpacity(n,o,!0),__legendTipLeave(t,o,a,a.key),__xLabelToggle(a,!1)}function _mouseMove(t,e,a,o){const n=cfg.tooltip;if(!_tip||!n.isShow)return;if(n.isUserTip&&cfg.method.mousemove&&cfg.method.mousemove({container:c2iCon,selector:a},e.src?e.src:e),n.fixedPos)return;const r=parseInt(_tip.select("table").style("width")),l=parseInt(_tip.select("table").style("height"));let i,s;if(t.type.indexOf("touch")>-1){const t=d3.touches(o);i=t[0][0]-r/3,s=t[0][1]+30}else i=parseInt(t.pageX-r/2),s=t.pageY-l-15;i>_width-r&&(i-=r/2),s>cfg.height-l&&(s-=l+35),i<0&&(i=0),s<0&&(s=0),_tip.style("left",i+"px").style("top",s+"px")}function _displayXLabel(){if(!cfg.xDim.xLabel||!_xAxis)return;const t=cfg.xDim.xLabel;t.isVertical?_xAxisG.selectAll(".x .tick > text").style("writing-mode","tb").attr("dy",0).style("text-anchor",()=>"top"===_xAxisPos?"end":"start"):void 0!==t.rotate&&0!==t.rotate?_xAxisG.selectAll(".x .tick > text").style("text-anchor",()=>"top"===_xAxisPos?t.rotate>0?"end":"start":t.rotate>0?"start":"end").attr("dx",t.dx).attr("dy",t.dy).attr("transform",()=>"rotate("+t.rotate+")"):_xAxisG.selectAll(".x .tick > text").attr("dx",t.dx).attr("dy",t.dy)}function renderZeroLine(){const t=(cfg.zeroLine||_isNegative)&&"stackstream"!==_yCluster?["zero"]:[],e=cfg.common.grid,a=_bodyG.selectAll(".yZeroLine").data(t);a.exit().transition().duration(_dr).remove(),a.enter().append("line").attr("class","yZeroLine").style("shape-rendering","crispEdges").attr("x1",0).merge(a).attr("stroke",e.zeroStroke?e.zeroStroke:"dimgray").attr("stroke-width",e.strokeWidth).attr("stroke-dasharray",e.dashLength[3]).style("stroke-opacity",e.opacity).attr("x2",_contentW()).attr("y1",_yY(0)).attr("y2",_yY(0))}function _stackDataMakeUp(t){let e="none",a="none",o="y";if("group"===t)_y2Cluster.indexOf("groupbar")>-1&&(o="y2");else{-1===("area"===t?AREAS.indexOf(_yCluster):BARS.indexOf(_yCluster))&&(o="y2")}const n=[];if(_layerCnt=_xWidth=_xWidthHalf=0,cfg.data2=cfg.data.filter(t=>{for(let e=0,a=cfg.measures.length;e<a;e++)if(cfg.measures[e].yDim.toLowerCase()===o&&cfg.measures[e].colNm===t.key&&cfg.measures[e].draw)return n.push(t.key),_layerCnt++,t}),0===_layerCnt)return void console.log(_lang.std.std_2);switch(__haveNegativeVal(cfg.data2,n),"y"===o?_yCluster:_y2Cluster){case"stackbar":a=_u.ORDERS.none,e=_isNegative?_u.OFFSETS.diverge:_u.OFFSETS.none;break;case"groupbar":a=_u.ORDERS.none,e=_u.OFFSETS.none;break;case"stackbar100":case"stackarea100":a=_u.ORDERS.none,e=_u.OFFSETS.expand,console.log(_lang.std.std_10);break;case"stackarea":a=_u.ORDERS.none,e=_u.OFFSETS.none;break;case"stackstream":a=_u.ORDERS.inOut,e=_u.OFFSETS.wiggle}const r=d3.stack().keys(n).order(a).offset(e);"band"===_xScale&&(_xWidth=_xX.bandwidth()),_xWidthHalf=_xWidth/2,cfg.data2=cfg.data2.map(t=>t.values.map(t=>{let e=0,a=Number.MIN_VALUE,o=Number.MAX_VALUE;return n.forEach(n=>{e+=t[n],t[n]>a&&(a=t[n]),t[n]<o&&(o=t[n])}),n.forEach(r=>{t[r+"__p"]=+(t[r]/e).toFixed(3),t._sum=e,t._avg=e/n.length,t._max=a,t._min=o}),t})),cfg.data2=r(cfg.data2[0]).map((t,e)=>{const a=t.map(a=>{let o=[a[0],a[1],e];return o.src=a.data,o.key=t.key,o});return a.key=t.key,a})}function __filteredStatistic(t){let e,a,o,n,r,l,i,s;e=n=0,a=Number.MIN_VALUE,o=Number.MAX_VALUE,r=s=0,l=Number.MIN_VALUE,i=Number.MAX_VALUE;const c=cfg.measures.filter(function(t){return t.draw});t.forEach(t=>{let d=0,u=Number.MIN_VALUE,m=Number.MAX_VALUE,p=0,g=Number.MIN_VALUE,f=Number.MAX_VALUE;c.forEach(e=>{"y"===e.yDim?(d+=t[e.colNm],t[e.colNm]>u&&(u=t[e.colNm]),t[e.colNm]<m&&(m=t[e.colNm]),n++):(p+=t[e.colNm],t[e.colNm]>g&&(g=t[e.colNm]),t[e.colNm]<f&&(f=t[e.colNm]),s++)}),e+=d,a<u&&(a=u),o>m&&(o=m),r+=p,l<g&&(l=g),i>f&&(i=f)}),cfg.__staticsY=n>0?{_sum:e,_avg:e/n,_max:a,_min:o,_cnt:n}:void 0,cfg.__staticsY2=s>0?{_sum:r,_avg:r/s,_max:l,_min:i,_cnt:s}:void 0}function __tooltipInfo(t,e,a){const o=cfg.tooltip;_tip&&o.isShow&&(_tip.classed("c2iHidden",!1).style("opacity",o.opacity),o.isUserTip?_tip.select("tbody").classed("c2iHidden",!0):function(){const a=_getMeasure(t.key),n="y2"===a.yDim?_y2UnitNm:_yUnitNm;let r,l,i,s,c=d3.format(_xFormat),d="",u=0;_tip.select("#name").text("name?"),"time"===_xScale&&(c=d3.timeFormat(_xFormat));if(cfg.measures.some(e=>{if(c2i.util.getClassPure(e.colNm)===c2i.util.getClassPure(t.key))return _tip.select("#name").text([e.caption,n].join(" ")),l=e.tipFormat?e.tipFormat:e.format,!0}),_getFormat(t.key,1),l=l?d3.format(l):_format,_xColNm=c2i.util.getClassPure(_xColNm),e)r=0,e.forEach(e=>{s=e.src?e.src:e,i=_xFormat?c(s[_xColNm]):s[_xColNm],d+=i+" : "+l(s[t.key]),d+=++u%_displayTips?" | ":" <br> ",r+=s[t.key]}),d.length>0&&(d=d.substr(0,d.length-3));else if(s=t.src?t.src:t,d=cfg.xDim&&cfg.xDim.histogram?s[t.key+"Gap"]:s[_xColNm],d=_xFormat?c(d):d,d+=" : "+l(s[t.key]),a.dotSymbol&&a.dotSymbol.length>0&&a.dotColNm.length>0){const t=_getMeasure(a.dotColNm,!0);let e;if(t){const o=t.tipFormat?t.tipFormat:t.format;e=`( ${t.caption} : ${d3.format(o)(s[a.dotColNm])} )`}else e=`( ${d3.format(",.2f")(s[a.dotColNm])} )`;d+='<br><span style="font-size:12px">'+e+"</span>"}_tip.select("#measure").html(d);const m=_lang.gen;let p="<span data-c2i18n='gen.all'>"+m.all+"</span>",g=p+": "+d3.format(",.1%")(s[t.key]/("y"===a.yDim?cfg.__staticsY._sum:cfg.__staticsY2?cfg.__staticsY2._sum:void 0));s[t.key+"__p"]&&(p="<span data-c2i18n='gen.group'>"+m.group+"</span>",g+=", "+p+": "+d3.format(",.1%")(s[t.key+"__p"]));_tip.select("#ratio").empty()?_tip.insert("p","hr").attr("id","ratio").classed("tipRatio",!0).html(g):_tip.select("#ratio").classed("tipRatio",!0).html(g);o.infoLevel>0?function(t){_tip.select("tbody").classed("c2iHidden",!1);const e=t.src?t.src:t,n=[{name:"tipContent",cls:"tipName"},{name:"all",cls:"tipAll"},{name:"series",cls:"tipSeries"},{name:"group",cls:"tipGroup"}],r=["tipHeader","number","number","number"];let i=[];cfg.data.some(e=>{if(t.key===e.key)return i=e.values,!0});const s=i.reduce((e,a,o,n)=>e+=a[t.key],0),c=d3.format(".2%");let d="",u="",p="",g="",f="";void 0!==e[t.key+"__p"]&&(d="y"===a.yDim?cfg.__staticsY._sum:cfg.__staticsY2._sum,u=c(e[t.key]/d),d=l(d),g=l(e._sum),f=c(e[t.key+"__p"]));const h=l(s);void 0!==e[t.key]&&(p=c(e[t.key]/s));const y=[["value",d,h,g],["ratio",u,p,f]];let _,x,v=_tip.select("table").select("tbody");if(v.empty()){const t=(v=_tip.select("table").append("tbody")).append("tr").selectAll("th").data(n);t.enter().append("th").attr("class",t=>t.cls).attr("data-c2i18n",t=>"gen."+t.name).text(t=>m[t.name]),_=(_=v.selectAll(".level1").data(y)).enter().append("tr").attr("class","level1").merge(_),(x=_.selectAll("td").data(t=>t)).enter().append("td").attr("data-c2i18n",(t,e)=>0===e?"gen."+t:null).attr("class",(t,e)=>r[e]).html((t,e)=>0===e?m[t]:t)}else _=v.selectAll(".level1").data(y),(x=_.selectAll("td").data(t=>t)).html((t,e)=>0===e?m[t]:t);o.infoLevel;o.infoLevel}(t):_tip.select("tbody").classed("c2iHidden",!0)}(),o.fixedPos&&void 0===_tipFirst&&function(){const t=parseInt(_tip.select("table").style("width")),e=parseInt(_tip.select("table").style("height"));let n,r;_tip.select(".c2iCloseBtn").classed("c2iHidden",!1).on("touchstart",()=>{d3.select(o.id).classed("c2iHidden",!0)}).on("click",()=>{d3.select(o.id).classed("c2iHidden",!0)}),n=a.pageX+5,r=a.pageY+5,n>_width-t&&(n-=t+5);r>cfg.height-e&&(r-=1.2*e);n<0&&(n=0);r<0&&(r=0);_tip.style("left",n+"px").style("top",r+"px"),_tipFirst=!1}())}function _setUpRadius(t,e){let a=t.dotScale?t.dotScale:"linear";a=_u.getScale(a);const o=t.dotColNm?t.dotColNm:t.colNm,n=d3.extent(_rawData,t=>+t[o]);return 1===t.dotRange.length&&t.dotRange.push(t.dotRange[0]),a.domain(n).rangeRound(t.dotRange).nice(),a(e[o])}function _layoutData(){_setCommon(),_setPareto(),_setTrend(),_setXDim(),_setYDim(),_setY2Dim(),_setMeasures(),_setLegend(),_setTooltip(),_u.setTheme(cfg,c2iCon,!1),_u.setTitle(cfg),dataInit(cfg.preBuildData),cfg.isDev&&_u.devMode(cfg)}function dataInit(t){const e=[],a=[];_isNegative=void 0,cfg.measures.forEach(function(t){"each"!==_yCluster&&"y"===t.yDim&&e.push(t.colNm),"each"!==_y2Cluster&&"y2"===t.yDim&&a.push(t.colNm)}),cfg.xDim.histogram?function(){const t=cfg.xDim.histogram,e=t.intervals;let a,o=[],n={};_orgData=_rawData,_rawData.forEach(function(t){cfg.measures.forEach(function(e){t[e.colNm]=+t[e.colNm]})}),cfg.measures.forEach(function(t){const a=d3.extent(_rawData,e=>e[t.colNm]);let o=d3.scaleQuantile().domain(a).range(d3.range(e));(o=o.quantiles().map(e=>+d3.format(t.format)(e).replace(",",""))).push(a[1]);let r=a[0],l=[];o.forEach(function(e,a){const o=[r,e],n=[];_rawData.forEach(function(o){0===a?r<=o[t.colNm]&&o[t.colNm]<=e&&n.push(o.name):r<o[t.colNm]&&o[t.colNm]<=e&&n.push(o.name)}),o.keys=n,r=e,l.push(o)}),n[t.colNm]=l});for(let r=0;r<e;r++){const e={name:"Gap_"+(r+1),__id:r};cfg.measures.forEach(function(o){a=d3.format(o.format),e[o.colNm]=n[o.colNm][r].keys.length,e[o.colNm+"Gap"]=a(n[o.colNm][r][0])+(0===r?" <= ":" < ")+(t.fullName?o.caption:"X")+" <= "+a(n[o.colNm][r][1]),e[o.colNm+"Keys"]=n[o.colNm][r].keys}),o.push(e)}_rawData=o}():t?_rawData.forEach(function(t,o){t.__id=o,"band"!==_xScale&&(t[cfg.xDim.colNm]=+t[cfg.xDim.colNm]),cfg.measures.forEach(function(o){t[o.colNm]=isNaN(+t[o.colNm])?0:+t[o.colNm],t[o.colNm]<0&&(_isNegative||(e.indexOf(o.colNm)>-1||a.indexOf(o.colNm)>-1)&&(_isNegative=t),_isNegativeEach=!0)}),"boxplot"===cfg.groupType&&(t.range=t[cfg.boxConfig.max]-t[cfg.boxConfig.min],t.qtr=t[cfg.boxConfig.q3]-t[cfg.boxConfig.q1],t.sum=t.sum?t.sum:0,t.variance=t.variance?t.variance:0,t.deviation=t.deviation?t.deviation:0)}):cfg.groupType.indexOf("box")>-1?function(){let t,e,a;const o=cfg.boxConfig,n=cfg.rawStructure;"time"===_xScale&&(t=d3.timeFormat(cfg.xDim.format));_rawData.forEach(function(r,l){r.__id=l,"band"!==_xScale&&(r[cfg.xDim.colNm]="time"===_xScale?t.parse(r[cfg.xDim.colNm]):+r[cfg.xDim.colNm]),a=r[n.valNm].sort(),e=d3.extent(a),r[o.min]=e[0],r[o.max]=e[1],r[o.mean]=d3.mean(a),r[o.median]=d3.median(a),r[o.q1]=d3.quantile(a,.25),r[o.q3]=d3.quantile(a,.75),r.range=e[1]-e[0],r.qtr=r[o.q3]-r[o.q1],r.sum=d3.sum(a),r.variance=d3.variance(a),r.deviation=d3.deviation(a)})}():function(){let t,o=cfg.rawStructure;"time"===_xScale&&(t=d3.timeFormat(cfg.xDim.format));if(o.colNm&&o.groupByAggType)return void function(){const t=[];d3.nest().key(t=>t[o.colNm]).rollup(e=>{const a={};cfg.measures.forEach(({colNm:t})=>(function(t,e,a){switch(o.groupByAggType){case"mean":case"avg":e[a]=d3.mean(t,t=>t[a]);break;case"median":e[a]=d3.median(t,t=>t[a]);break;case"min":e[a]=d3.min(t,t=>t[a]);break;case"max":e[a]=d3.max(t,t=>t[a]);break;default:e[a]=d3.sum(t,t=>t[a])}})(e,a,t)),a[o.colNm]=e[0][o.colNm],t.push(a)}).entries(_rawData),_rawData=t}();const n=d3.groups(_rawData,t=>t[cfg.xDim.colNm]);_rawData=n.map((n,r)=>{const l={};return l.__id=r,l[cfg.xDim.colNm]="band"===_xScale?n[0]:"time"===_xScale?t.parse(n[0]):+n[0],n[1].forEach(t=>{l[t[o.colNm]]=+t[o.valNm],l[t[o.colNm]]<0&&(l[t[o.colNm]]<0&&!_isNegative&&(e.indexOf(t[o.colNm])>-1||a.indexOf(t[o.colNm])>-1)&&(_isNegative=l),_isNegativeEach=!0),cfg.measures.forEach(e=>{e.noDrawColNm&&(l[e.noDrawColNm]="-1"===t[e.noDrawColNm]?"-1":""),!l[e.colNm]&&t[e.colNm]&&(l[e.colNm]=+t[e.colNm])})}),cfg.measures.forEach(t=>{Number(l[t.colNm])||(l[t.colNm]=0)}),l})}(),cfg.data2=cfg.data=[],cfg.measures.forEach(function(t){const e=d3.group(_rawData,e=>t.colNm);cfg.data.push({key:t.colNm,values:e.get(t.colNm)})}),"boxplot"===cfg.groupType&&(cfg.boxConfig.range="range",cfg.boxConfig.qtr="qtr")}function setUpScaleX(){const t=cfg.data[0].values;switch(_xScale&&_xScale.toLowerCase()){case"band":!function(){const e=(_xValues=t.map(t=>({id:t.__id,xName:t[_xColNm]}))).map(t=>t.xName);cfg.xDim.roundType&&"rangepoints"===cfg.xDim.roundType.toLowerCase()?_xX.domain(e).rangePoints([0,_contentW()],_xPad[0]):_xX.domain(e).rangeRound([0,_contentW()]).paddingOuter(_xPad[0]).paddingInner(_xPad[1])}();break;case"point":!function(){const e=(_xValues=t.map(t=>({id:t.__id,xName:t[_xColNm]}))).map(t=>t.xName);_xX.domain(e).rangeRound([0,_contentW()]).padding(_xPad[0])}();break;case"time":_xValues=t.map(t=>({id:t.__id,xName:t[_xColNm]})),_xWidthHalf=parseInt(_contentW()/_xValues.length/2),_xX.domain(d3.extent(_xValues,t=>t.xName)).rangeRound([0,_contentW()]);break;default:_xValues=d3.extent(t,t=>t[_xColNm]),_xX.domain(_xValues).rangeRound([0,_contentW()]).nice()}}function setUpScaleY(t,e){let a,o,n,r,l=[];const i=t=>t[r];if(o=Number.MAX_VALUE,a=Number.MIN_VALUE,cfg.measures.forEach(e=>{e.yDim===t&&(!1===cfg.scaleAuto||e.draw)&&(r=e.colNm,n=d3.extent(_rawData,i),o=d3.min([o,n[0]]),l.push(e.colNm))}),e.indexOf("stack")>-1&&"stackstream"!==e?a=d3.max(_rawData,t=>{let e=0;return l.forEach(a=>e+=t[a]),e}):"each"!==e&&"groupbar"!==e&&"stackstream"!==e&&"boxplot"!==e||(a=d3.max(_rawData,t=>(l.forEach(e=>a=d3.max([a,t[e]])),a))),o=o===Number.MAX_VALUE?0:o,a=a===Number.MIN_VALUE?0:a,cfg.beginZero[0]&&s(),"y"===t){if(!cfg.yDim)return;_yCluster.indexOf("100")>-1?("linear"!==_yScale&&(alert(_lang.std.std_4),_yScale=cfg.yDim.scale="linear",_yY=_u.getScale(_yScale)),_yBaseValue=0,a=1):(_yCluster.indexOf("stack")>-1?"linear"!==_yScale&&(alert(_lang.std.std_5),_yScale=cfg.yDim.scale="linear",_yY=_u.getScale(_yScale)):s(_yScale,_yMinGap),a=0!==a?a*_yMaxGap:_yMaxGap,_yFormat=cfg.yDim.format?cfg.yDim.format:",.0f",_yBaseValue=cfg.yDim.yBaseValue?cfg.yDim.yBaseValue:o),_yY.domain([_yBaseValue,a]).rangeRound([_contentH()*(_yRatio?_yRatio/100:1),0]).nice()}else{if(!cfg.y2Dim)return;_y2Cluster.indexOf("100")>-1?("linear"!==_y2Scale&&(alert(_lang.std.std_4),_y2Scale=cfg.y2Dim.scale="linear",_y2Y=_u.getScale(_y2Scale)),_y2Format="%",_y2BaseValue=0,a=1):(_y2Cluster.indexOf("stack")>-1?"linear"!==_y2Scale&&(alert(_lang.std.std_5),_y2Scale=cfg.y2Dim.scale="linear",_y2Y=_u.getScale(_y2Scale)):s(_y2Scale,_y2MinGap),a=0!==a?a*_y2MaxGap:_y2MaxGap,_y2Format=cfg.y2Dim.format?cfg.y2Dim.format:",.0f",_y2BaseValue=cfg.y2Dim.yBaseValue?cfg.y2Dim.yBaseValue:o),_y2Y.domain([_y2BaseValue,a]).rangeRound([_contentH(),_yRatio?_contentH()*_yRatio/100:0]).nice()}function s(e,a){if("log"===e||"sqrt"===e)o=o>0?.8*o:1.2*o;else{("y"===t?cfg.beginZero[0]:cfg.beginZero[1])?o=0:o*=o>=0?a:2-a}}}function _setXDim(){const t=cfg.xDim;_xCaption=t.caption?t.caption:"",_xUnitNm=t.unitNm?t.unitNm:"",_xColNm=t.colNm,_xScale=t.scale?t.scale.toLowerCase():"band",_xFormat=t.format?t.format:"",_xAxisPos=t.axisPos?t.axisPos.toLowerCase():"bottom",_xPos=t.xPos?t.xPos:"middle",_xDy=void 0!==t.dy?t.dy:35,_xTicks=void 0!==t.ticks?t.ticks:10,_xTickWidth=t.tickWidth?t.tickWidth:70,_xTickPad=t.tickPad?t.tickPad:0,_xIsShow=void 0===t.isShow||t.isShow,_xShowGrid=void 0===t.showGrid||t.showGrid,_xImage=t.image,t.xPad=t.xPad&&Array.isArray(t.xPad)?t.xPad:[.1,.15,0],3!==t.xPad.length&&(2===t.xPad.length?t.xPad.push(.05):t.xPad=[.1,.15,.05]),void 0===t.xLabel?t.xLabel={rotate:0,dx:0,dy:0}:(void 0===t.xLabel.rotate&&(t.xLabel.rotate=0),void 0===t.xLabel.dx&&(t.xLabel.dx=0),void 0===t.xLabel.dy&&(t.xLabel.dy=12)),_xPad=t.xPad,_xWrapLabel=t.xWrapLabel,_xX=_u.getScale(_xScale),cfg.scaleAuto=void 0===cfg.scaleAuto||cfg.scaleAuto,cfg.beginZero=void 0!==cfg.beginZero?cfg.beginZero:[!0,!0],Array.isArray(cfg.beginZero)||(cfg.beginZero=[cfg.beginZero,cfg.beginZero]),cfg.groupType=void 0!==cfg.groupType?cfg.groupType:"each",_dr=cfg.duration=cfg.duration>0&&cfg.duration<=1500?cfg.duration:0,cfg.clamp=void 0===cfg.clamp||cfg.clamp,t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","14px","dimgray"]),function(){if(!t.startTexture||!Array.isArray(t.startTexture))return;const e=[],a=[],o=[],n=[];_xPlotTexture="function"==typeof(_xPlotTexture=_u.textures[t.startTexture[2]])?_xPlotTexture:_u.textures.pathHexagons,cfg.measures.forEach(function(r){r.yDim===t.startTexture[0]&&(e.push(r.colNm),a.push(r.colNm+"_Neg"),o.push(_xPlotTexture()),n.push(_xPlotTexture()))}),_txXPlot.domain(e).range(o),_txXPlotNeg.domain(e).range(n)}()}function _setYDim(){const t=cfg.yDim;if(t){if(_yCaption=t.caption?t.caption:"",_yUnitNm=t.unitNm?t.unitNm:"",_yScale=t.scale?t.scale.toLowerCase():"linear",_yCluster=t.cluster=t.cluster?t.cluster.toLowerCase():"each",_yFormat=_yCluster.indexOf("100")>0?".2%":t.format?t.format:",.0f",t.formatAvg=t.formatAvg?t.formatAvg:_yFormat,_yStackValue=t.stackValue?t.stackValue.toLowerCase():"value",_yAxisPos=t.axisPos?t.axisPos.toLowerCase():"left",_yDx=void 0!==t.dx?t.dx:8,_yDy=void 0!==t.dy?t.dy:3,_yTicks=void 0!==t.ticks?t.ticks:10,_yTickWidth=t.tickWidth?t.tickWidth:70,_yIsShow=void 0===t.isShow||t.isShow,_yShowGrid=void 0===t.showGrid||t.showGrid,cfg.yDim.showLabel=void 0===cfg.yDim.showLabel||cfg.yDim.showLabel,_yMinGap=t.minGap&&t.minGap>0&&t.minGap<=.5?1-t.minGap:1,_yMaxGap=t.maxGap&&t.maxGap>0&&t.maxGap<=.5?t.maxGap+1:1,t.opacity=void 0!==t.opacity?t.opacity:.7,t.strokeWidth=void 0!==t.strokeWidth?t.strokeWidth:1,t.curve=void 0!==t.curve?t.curve:"monotone",_yY=_u.getScale(_yScale),void 0===t.color?t.color=["10","solid"]:"string"==typeof t.color&&(t.color=t.color.split("/"),2!==t.color.length&&(t.color[1]="")),t.texture&&t.texture.length>0){const e=[],a=[];__setTexture("y",e,a,t.texture.toLowerCase()),_txY.domain(e).range(a)}t.plotLines&&(_yPlotTexture=_yPlotTextureValue=void 0,t.plotLines.forEach(function(t){void 0===t.isArrow&&(t.isArrow=!0),"all"===t.relCol&&t.splitColors&&Array.isArray(t.splitColors)&&1===t.splitColors.length&&__setPlotTextureY("y",t)})),t.captionV=void 0===t.captionV||t.captionV,t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","11px","dimgray"])}else _yCluster="each"}function __setPlotTextureY(t,e){const a=[],o=[];_yPlotTexture="function"==typeof(_yPlotTexture=_u.textures[e.splitColors[0]])?_yPlotTexture:_u.textures.pathHexagons,cfg.measures.forEach(function(n){n.yDim===t&&(a.push(n.colNm),o.push(_yPlotTexture()),_yPlotTextureValue=e.value)}),_txYPlot.domain(a).range(o)}function __setTexture(t,e,a,o){const n=[];if(cfg.measures.forEach(function(a){a.yDim===t&&e.push(a.colNm)}),"each"!==o){("all"===o?["line13","circle11","path7"]:[o]).forEach(function(t){for(let e in _u[t])_u[t].hasOwnProperty(e)&&n.push(_u[t][e])});for(let t=0,o=e.length,r=n.length;t<o;t++)a.push(n[t%r]())}else cfg.measures.forEach(function(e){if(e.yDim===t){let t=_u.textures[e.texture];t="function"==typeof t?t:_u.textures.pathHexagons,a.push(t())}})}function _setY2Dim(){const t=cfg.y2Dim;if(t){if(_y2Caption=t.caption?t.caption:"",_y2UnitNm=t.unitNm?t.unitNm:"",_y2Scale=t.scale?t.scale.toLowerCase():"linear",_y2Cluster=t.cluster=t.cluster?t.cluster.toLowerCase():"each",_y2Format=_yCluster.indexOf("100")>0?".2%":t.format?t.format:",.0f",t.formatAvg=t.formatAvg?t.formatAvg:_y2Format,_y2StackValue=t.stackValue?t.stackValue.toLowerCase():"value",_y2AxisPos=t.axisPos?t.axisPos.toLowerCase():"right",_y2Dx=t.dx?t.dx:-8,_y2Dy=t.dy?t.dy:3,_y2Ticks=void 0!==t.ticks?t.ticks:10,_y2TickWidth=t.tickWidth?t.tickWidth:70,_y2IsShow=void 0===t.isShow||t.isShow,_y2ShowGrid=void 0===t.showGrid||t.showGrid,cfg.y2Dim.showLabel=void 0===cfg.y2Dim.showLabel||cfg.y2Dim.showLabel,_y2MinGap=t.minGap&&t.minGap>0&&t.minGap<=.5?1-t.minGap:1,_y2MaxGap=t.maxGap&&t.maxGap>0&&t.maxGap<=.5?t.maxGap+1:1,t.opacity=void 0!==t.opacity?t.opacity:.7,t.strokeWidth=void 0!==t.strokeWidth?t.strokeWidth:1,t.curve=void 0!==t.curve?t.curve:"monotone",_y2Y=_u.getScale(_y2Scale),void 0===t.color&&(t.color=["10","solid"]),"string"==typeof t.color&&(t.color=t.color.split("/"),2!==t.color.length&&(t.color[1]="")),t.texture&&t.texture.length>0){const e=[],a=[];__setTexture("y2",e,a,t.texture.toLowerCase()),_txY2.domain(e).range(a)}t.plotLines&&(_yPlotTexture||(_yPlotTextureValue=void 0),t.plotLines.forEach(function(t){void 0===t.isArrow&&(t.isArrow=!0),"all"===t.relCol&&t.splitColors&&Array.isArray(t.splitColors)&&1===t.splitColors.length&&__setPlotTexture("y2",t)})),t.captionV=void 0===t.captionV||t.captionV,(!t.fonts||t.fonts.length<4)&&(t.fonts=["helvetica","11px","gray"]),t.captionFonts&&3===t.captionFonts.length||(t.captionFonts=["helvetica","11px","dimgray"])}else _y2Cluster="each"}function _setPareto(){const t=cfg.pareto;t&&(t.radius=void 0!==t.radius&&t.radius>0&&t.radius<20?t.radius:6,t.curve=void 0!==t.curve?t.curve:"monotone",t.fonts&&2===t.fonts.length||(t.fonts=["helvetica","11px"]),t.axisPos=t.axisPos&&"left"===t.axisPos.toLowerCase()?"left":"right",t.ticks=void 0!==t.ticks&&t.ticks>0&&t.ticks<11?t.ticks:5,t.circleStroke=t.circleStroke?t.circleStroke:"white",t.strokeWidth=t.strokeWidth?t.strokeWidth:3,t.showLabel=void 0===t.showLabel||t.showLabel,t.isDraw=void 0!==t.isDraw&&t.isDraw)}function _setTrend(){const t=cfg.trend;t&&(t.method=t.method&&t.method.toLowerCase(),t.fonts&&3===t.fonts.length||(t.fonts=["helvetica","11px","gray"]),t.dy=t.dy?t.dy:10,t.strokeWidth=t.strokeWidth?t.strokeWidth:3,t.dashLength=t.dashLength?t.dashLength:0,t.showLabel=void 0===t.showLabel||t.showLabel,t.isDraw=void 0!==t.isDraw&&t.isDraw)}function _setCommon(){const t=cfg.common;t?(void 0!==t.yRatio&&(t.ySplit={ratio:t.yRatio,radius:5,fill:"yellow",stroke:"white",strokeWidth:0,dashLen:0,opacity:.3}),_yRatio=t&&t.ySplit&&t.ySplit.ratio?100*t.ySplit.ratio:0,void 0===t.grid||Array.isArray(t.grid.dashLength)||(t.grid.dashLength&&(t.grid.dashLength=[t.grid.dashLength,t.grid.dashLength,t.grid.dashLength,t.grid.dashLength]),t.grid.dashLength&&4===t.grid.dashLength.length||(t.grid.dashLength=[0,0,0,0]))):(cfg.common={domain:{stroke:"white",strokeWidth:1,opacity:.7},grid:{stroke:"dimgray",strokeWidth:1,opacity:.5,dashLength:[0,0,0],zeroStroke:"yellow"}},_yRatio=0)}function _setMeasures(){let t,e,a;const o=cfg.measures;for(_selectedMeasures=[],a=o.length-1;a>-1;a--)(void 0===o[a].draw||o[a].draw)&&(o[a].draw=!0,_selectedMeasures.push(o[a].colNm)),void 0!==o[a].dotScale&&void 0!==o[a].dotRange&&0!==o[a].dotRange.length||(o[a].dotScale="linear"),o[a].fonts&&"string"==typeof o[a].fonts&&(o[a].fonts=o[a].fonts.split("/")),4===o[a].fonts.length?o[a].fonts[4]=o[a].fonts[2]:5===o[a].fonts.length?o[a].fonts[2]=o[a].fonts[4]:o[a].fonts=["helvetica","11px","black","#f00"],o[a].color&&"string"==typeof o[a].color?o[a].color=[o[a].color,o[a].color]:2===o[a].color.length&&(o[a].color[0]=o[a].color[1]);let n=0;if(cfg.yDim&&"each"!==cfg.yDim.color[0])for(t=_u.getColorScheme(cfg.yDim.color[0]),a=0,e=o.length;a<e;a++)"y"===o[a].yDim&&(o[a].color[0]=t[a%t.length],cfg.isContrastColor&&(o[a].fonts[2]=_u.colorHover(o[a].color)),n++);if(cfg.y2Dim&&"each"!==cfg.y2Dim.color[0])for(t=_u.getColorScheme(cfg.y2Dim.color[0]),a=0,e=o.length;a<e;a++)"y2"===o[a].yDim&&(o[a].color[0]=t[(a+n)%t.length],cfg.isContrastColor&&(o[a].fonts[2]=_u.colorHover(o[a].color)));_colorMeasure.domain(o.map(t=>t.colNm)).range(o.map(t=>t.color[0])),_fontsMeasure.domain(o.map(t=>t.colNm)).range(o.map(t=>t.fonts));const r=cfg.summary;r?(r.fonts&&"string"==typeof r.fonts&&(r.fonts=r.fonts.split("/"),3!==r.fonts.length&&(r.fonts=["helvetica","12px","#ff0"])),r.fonts&&3===r.fonts.length||(r.fonts=["helvetica","12px","#ff0"]),void 0===r.type?r.type="_sum":-1===r.type.indexOf("_")&&(r.type="_"+r.type),void 0===r.format&&(r.format=",.0f"),void 0===r.rotate&&(r.rotate=-45),void 0===r.dy&&(r.dy=20),void 0===r.isShow&&(r.isShow=!0)):cfg.summary={fonts:["helvetica","12px","#ff0"],type:"_sum",format:",.0f",rotate:-45,dy:20,isShow:!1}}function _setTooltip(){const t=cfg.tooltip;(_tip=cfg.method.mousemove&&t&&void 0!==t.id?d3.select(t.id):void 0)&&!_tip.empty()&&(c2i.utilEx.resetTooltip(_tip,t.width?t.width:"360px",null),"object"!=typeof t.fixedPos?t.fixedPos=void 0:_tip.style("pointer-events","all").style("cursor","move").call(_dragHandle),_displayTips=t.displayTips?t.displayTips:2,t.infoLevel=t.infoLevel?t.infoLevel<0||t.infoLevel>3?0:t.infoLevel:0,t.opacity=t.opacity?t.opacity:.7,t.isShow=void 0!==t.isShow&&t.isShow)}function _setLegend(){const t=cfg.legend;if(t){if(!t.id)return alert(_lang.cm.lg_2),!1;t.fonts=t.fonts?t.fonts:["helvetica","12px"],t.padding=t.padding?t.padding:"10px 10px 10px 10px",t.backColor=t.backColor?t.backColor:"",t.labelGap=t.labelGap?t.labelGap:"5px",t.itemGap=t.itemGap?t.itemGap:"10px",t.yNy2Gap=t.yNy2Gap?t.yNy2Gap:"30px",t.cutLength=t.cutLength?t.cutLength:0}else _lang&&console.log(_lang.cm.lg_1)}function __gradient(t,e){let a;void 0===e?(e="linearGradient",a=c2iCon+"_c2iGradBar"):(e="radialGradient",a=c2iCon+"_c2iGradCircle"),t.indexOf("rgb")>-1&&(t=d3.rgb(t).formatHex());const o=a+t.substring(1);if(_svg.select(a).selectAll(o).empty()){let n="linearGradient"===e?-50:-20;cfg.solidLight&&(n*=-1);const r=_u.shadeColor(t,n),l=_svg.select(a).selectAll(o).data([o]).enter().append(e).attr("id",o.substr(1));e.indexOf("linear")>-1?(l.attr("x1","60%").attr("y1","50%").attr("x2","0%").attr("y2","50%").attr("spreadMethod","reflect"),l.append("stop").attr("offset","0%").attr("stop-color",t),l.append("stop").attr("offset","50%").attr("stop-color",r),l.append("stop").attr("offset","100%").attr("stop-color",t)):(l.attr("gradientUnits","objectBoundingBox").attr("fx","30%").attr("fy","30%"),l.append("stop").attr("offset","0%").attr("stop-color","#FFFFFF"),l.append("stop").attr("offset","40%").attr("stop-color",t),l.append("stop").attr("offset","100%").attr("stop-color",r))}return"url("+o+")"}function resize(){_svg&&_c2iCon.node().parentNode.clientWidth&&!_clearing&&(cfg.nonComponent?_width=_c2iCon.node().parentNode.clientWidth:(_width=parseInt(_c2iCon.style("width"),10),cfg.height=parseInt(_width/cfg.aspect),cfg.height||(cfg.height=parseInt(_width/cfg.aspect)),"100%"===cfg.aspectRatio&&(cfg.height=_c2iCon.node().clientHeight)),_svg.attr("width",_width).attr("height",cfg.height),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),cfg.resizing=!0,chart.render(),cfg.resizing=!1)}function __getTicks(t){return cfg.height<200&&t>2?2:t}function _getColumnName(t){let e=t.parentNode.className.baseVal.split(" ")[1];return"_"===e.substr(0,1)&&(e=e.substr(1)),e}function _getMeasure(t,e){for(let e=0;e<cfg.measures.length;e++)if(c2i.util.getClassPure(cfg.measures[e].colNm)===c2i.util.getClassPure(t))return cfg.measures[e];void 0===e?alert(_u.templateFormat(_lang.std.std_7,t)):console.log(_u.templateFormat(_lang.std.std_8,t))}function _isTexture(t){return"y"===t.yDim&&cfg.yDim.texture||_yPlotTexture||_xPlotTexture?1:"y2"===t.yDim&&cfg.y2Dim.texture||_yPlotTexture||_xPlotTexture?1:0}function _xStart(){return cfg.margin.left}function _xEnd(){return _width-cfg.margin.right}function _yStart(){return cfg.height-cfg.margin.bottom}function _yEnd(){return cfg.margin.top}function _contentW(){return _width-cfg.margin.left-cfg.margin.right}function _contentH(){return cfg.height-cfg.margin.top-cfg.margin.bottom}chart.clear=function(){return _clearing=!0,_svg&&(_svg.remove(),_svg=_bodyG=_axesG=_xAxis=_yAxis=_y2Axis=void 0,_xAxisG=_yAxisG=_y2AxisG=void 0),chart},chart.resizeStudio=function(t,e){return _width=t,cfg.height=e,cfg.aspect=t/e,_svg&&(_svg.attr("width",_width).attr("height",cfg.height),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart)),cfg.resizing=!0,chart.render(),cfg.resizing=!1,chart},chart.config=function(t){return arguments.length?(_u.init(cfg,t),_u.locale(cfg),_lang=c2i.lang,chart):cfg},chart.title=function(t){return arguments.length?(cfg.title=t,_u.setTitle(cfg),_u.renderTitle(cfg,_svg,_width,_xStart,_xEnd,_yStart),chart):cfg.title},chart.xDim=function(t){return arguments.length?(cfg.xDim=t,_setXDim(),chart):cfg.xDim},chart.yDim=function(t){return arguments.length?(cfg.yDim=t,_setYDim(),chart):cfg.yDim},chart.y2Dim=function(t){return arguments.length?(cfg.y2Dim=t,_setY2Dim(),chart):cfg.y2Dim},chart.pareto=function(t){return arguments.length?(cfg.pareto=t,_setPareto(),chart):cfg.pareto},chart.trend=function(t){return arguments.length?(cfg.trend=t,_setTrend(),chart):cfg.trend},chart.common=function(t){return arguments.length?(cfg.common=t,_setCommon(),chart):cfg.common},chart.measures=function(t){return arguments.length?(cfg.measures=t,_setMeasures(),chart):cfg.measures},chart.tooltip=function(t){return arguments.length?(cfg.tooltip=t,_setTooltip(),chart):cfg.tooltip},chart.theme=function(t){return arguments.length?(cfg.theme="base"===t?cfg.themeInit:t,_u.setTheme(cfg,c2iCon,!0),chart):cfg.theme},chart.data=function(t){return arguments.length?(_rawData=t,_orgData=void 0,_layoutData(),chart):cfg.data},chart.getConfig=function(){return cfg.measure=void 0,cfg.measures.forEach(function(t,e){t.draw&&!cfg.measure&&(cfg.measure=t),t.__id=e}),cfg.measure||(cfg.measure=cfg.measures[0]),cfg.pieceColors=_colorMeasure.range(),cfg.keyCol="colNm",cfg.lgData=!0,cfg.c2iCon=c2iCon,cfg},chart.setLegend=function(t){cfg.legendExtern=t},chart.tipFixed=function(t){const e=cfg.tooltip;t?(e.fixedPos=e.fixedPos?e.fixedPos:{xPos:"start",yPos:"top"},_setTooltip()):e.fixedPos=void 0},chart.hideValLable=function(t){cfg.hideValLable=t,cfg.measures.forEach(e=>e.showLabel=t),chart.render()},chart.exportData=function(t,e){const a=cfg.title&&cfg.title.caption?cfg.title.caption:"",o=[],n=[];let r;e||(o.push(cfg.xDim.colNm+","),(r=cfg.xDim.caption?cfg.xDim.caption:cfg.xDim.colNm).search(/["|,|\n]/g)>=0?n.push('"'+r+'",'):n.push(r+","),cfg.measures.forEach(function(t){t.caption.search(/["|,|\n]/g)>=0?n.push('"'+t.caption+'",'):n.push(t.caption+","),o.push(t.colNm+",")})),_u.exportData(a,o,n,_rawData,t)},chart.lang=function(t){return arguments.length?(cfg.lang=t.toLowerCase(),_u.locale(cfg),_lang=c2i.lang,_meta=void 0,chart):cfg.lang};let _timer=null;return cfg.isResponsive&&_u.resizeChart(cfg,c2iCon,resize,_timer),cfg.optWin&&_u.optionHide(),_u.createAccessor(chart,cfg)}),c2i.dumbo.wordCloud=function(t,e){"use strict";const a=c2i.util;if(!a.checkLicenseLocale(e))return!1;if(!a.checkConfig(t,e))return!1;let o={},n={isResponsive:void 0!==e.isResponsive&&e.isResponsive,aspectRatio:e.aspectRatio?e.aspectRatio:"100%",margin:e.margin||{top:30,left:30,right:30,bottom:30},easing:e.easing||"linear",duration:e.duration||750,delay:e.delay||0,groupBy:e.groupBy&&e.groupBy,measure:e.measures&&e.measures.find(t=>t.draw),legendId:e.legendId,tooltip:e.tooltip,tipTemplate:e.tipTemplate,isDev:e.isDev};a.init(n,e),n.themeInit=n.themeInit?n.themeInit:n.theme;const r=d3.select(t),l=d3.select(n.tooltip.id);let i,s,c,d,u,m,p=a.computeDim(r,n),g=c2i.lang,f=d3.format(n.measure.listFormat?n.measure.listFormat:n.measure.format),h=d3.format(",.2%"),y=d3.format(",d");const _=t=>t.text;function x(e){const a=s.selectAll("text").data(e),r=(t,e)=>n.groupBy&&n.groupBy.isGroupColor?m(t[n.groupBy.colNm]):m[e%m.length];a.enter().append("text").on("dblclick",function(t,e){e.draw=!1,n.method.click&&C(t);const a=d3.extent(w(),t=>t[n.measure.colNm]);n.word.minMaxValue=a,o.reRender()}).on("click",function(e,a){e.altKey?window.open("https://www.google.com/search?q="+a.text):n.method.click&&n.method.click(e,{container:t,selector:"word"},a)}).on("mouseenter",v).on("mousemove",b).on("mouseleave",k).style("font-family",n.word.font).attr("fill",(t,e)=>t.rank_<=n.word.nTop&&-1!==n.word.nTop?"transparent":r(t,e)).style("font-size",t=>t.size/5+"px").style("text-anchor","middle").attr("stroke",(t,e)=>t.rank_<=n.word.nTop&&-1!==n.word.nTop?r(t,e):null).attr("stroke-width",t=>t.rank_<=n.word.nTop&&-1!==n.word.nTop?1.5:null).attr("class",t=>"cls"+t.seq+" wordText c2iNoSelect").attr("transform",t=>"translate("+[t.x,t.y]+")rotate("+t.rotate+")").text(t=>t.text).merge(a).transition().duration(n.duration).delay((t,e)=>e*n.delay).style("font-size",function(t){return t.size+"px"})}function v(e,a){if(d3.select(this).classed("c2iOverText",!0),r.selectAll(".wordText").style("fill-opacity",.3),d3.select(this).style("fill-opacity",1),n.tooltip&&!n.tooltip.isUserTip){l.select(".c2iCloseBtn").classed("c2iHidden",!0);let t="";n.groupBy&&n.groupBy.colNm&&(t=" ("+a[n.groupBy.colNm]+")");const e=a.ratio_+" (vs "+n.measure.aggI18N+" : "+f(n.data._totAvg)+")",o=n.measures.find(t=>t.colNm===n.measure.colNm),r=`<tr><td class='c2iMiniUi mainTitle'>${"# "+a.rank_.toLocaleString()+" : "+a[n.word.colNm]+t}</td></tr>\n        <tr><td class='c2iMiniUi mainTitle'>${n.measure.caption+"("+n.measure.aggI18N+") : "+f(a[o.colNm])}</td></tr>\n        <tr><td class='c2iMiniUi subTitle'>${e}</td></tr>`;l.select("table").html(r)}n.method.mouseenter&&(n.method.mouseenter(e,{container:t,selector:"word"},a),n.tooltip&&n.tooltip.id&&l.classed("c2iNoSelect",!0))}function b(e,a){if(n.tooltip){l.classed("c2iHidden",!1);const o=e.pageX+5,r=e.pageY+5;n.method.mousemove&&n.tooltip.isUserTip&&n.method.mousemove(e,{container:t,selector:"tooltip"},a),l.style("left",o+"px").style("top",r+"px")}else n.mousemove&&n.mousemove(e,{container:t,selector:"word"},a)}function k(e,a){d3.select(this).classed("c2iOverText",!1),n.tooltip&&l.classed("c2iHidden",!0),r.selectAll(".wordText").style("fill-opacity",1),n.method.mouseleave&&n.method.mouseleave(e,{container:t,selector:"word"},a)}function C(e){const a="Sum"===n.measure.aggSQL?d3.sum(w(),t=>t[n.measure.colNm]):d3.mean(w(),t=>t[n.measure.colNm]),o=n.measure.caption;n.method.click(e,{container:t.substr(1),selector:"removeCmd",srcTitle:o,data:w()},a)}function w(t){return t=!(void 0!==t&&!t),n.data.filter(function(e){return e.draw===t})}function N(){n.data=[],void 0!==n.word.minMaxValue&&Array.isArray(n.word.minMaxValue)?d.filter(t=>!(void 0!==t.draw&&!t.draw)).forEach(function(t){t.size=+t[n.measure.colNm],t.size>=n.word.minMaxValue[0]&&t.size<=n.word.minMaxValue[1]&&(t.text=t[n.word.colNm],n.data.push(t))}):d.filter(t=>!(void 0!==t.draw&&!t.draw)).forEach(function(t){t.text=t[n.word.colNm],t.size=+t[n.measure.colNm],n.data.push(t)}),n.data=n.data.sort(n.word.dataSort.toLowerCase().indexOf("asc")>-1?(t,e)=>d3.ascending(t.size,e.size):(t,e)=>d3.descending(t.size,e.size)).slice(0,n.word.viewWords);const t="Sum"===n.measure.aggSQL?d3.sum(n.data,t=>t.size):d3.mean(n.data,t=>t.size),e=d3.rank(n.data,(t,e)=>d3.descending(t.size,e.size));n.data.forEach((a,o)=>{a.seq=o+1,a.rank_=e[o]+1,a.ratio_=h(a.size/t),a.draw=!0}),n.data._totAvg=t}function A(){n.measure=n.measures.find(t=>!0===t.draw),n.measure||(n.measures[0].draw=!0,n.measure=n.measures[0]),N(),c=c2i.util.getScale(n.word.fontSizeScale),n.groupBy&&n.groupBy.isGroupColor?(m=a.getColorScheme(n.groupBy.color),m=d3.scaleOrdinal().domain(n.data,t=>t[n.groupBy.colNm]).range(m)):m=a.getColorScheme(n.word.color),f=d3.format(n.measure.listFormat?n.measure.listFormat:n.measure.format),L(),n.isDev&&a.devMode(n)}function L(){const t=d3.extent(w(),function(t){return+t[n.measure.colNm]});c.domain(t).rangeRound(n.word.fontSizeRange).nice()}function D(){i&&r.node().parentNode.clientWidth&&(p=a.computeDim(r,n),n.height=Math.min(parseInt(r.style("height"),10),r.node().parentNode.clientHeight),o.clear(),L(),o.render())}function S(){return n.margin.left}function T(){return p-n.margin.right}function M(){return n.height-n.margin.bottom}o.render=function(){if(i||(i=r.append("svg").attr("width",p).attr("height",n.height).style("background",n.theme?n.theme:null),a.renderTitle(n,i,p,S,T,M),function(){const t=n.guideFonts;i.append("text").attr("transform","translate(10, 40)").attr("font-family",t[0]).attr("font-size",t[1]).attr("fill",t[2]).attr("fill-opacity",.7).selectAll("tspan").data([g.wordCloud.searchGuide,g.wordCloud.dblClickGuide]).enter().append("tspan").attr("x",0).attr("y",(t,e)=>20*e).text(t=>t),i.append("text").attr("transform",`translate(${T()}, 40)`).attr("font-family",t[0]).attr("font-size",t[1]).attr("fill",t[2]).attr("text-anchor","end").selectAll("tspan").data([n.command.stopWords.join(",")]).enter().append("tspan").attr("dx",0).text(t=>t).append("title").text("사용자 정의 불용어")}()),c2i.lang)return n.legendId&&d3.select(n.legendId).selectAll("g").remove(),function(){s||(s=i.append("g").attr("class","body").attr("transform","translate("+[p/2,n.height/2+20]+")"));const t=d3.layout.cloud().size([p,M()]).words(w()).padding(n.word.padding).font(n.word.font).fontSize(function(t){return c(+t[n.measure.colNm])}).on("end",x);"random"===n.word.rotate?t.start():t.rotate(function(){return~~(2*Math.random())*parseInt(n.word.rotate)}).start();u||(u=i.append("g").attr("class","outBar"));!function(){const t=w(!1);let e=u.selectAll(".outLabel").data(t,_);if(e.exit().style("font-size","14px").style("fill","orangered").transition().delay((t,e)=>e*n.delay).remove(),0===t.length)return void u.selectAll(".resetRect, .resetRectLabel").style("fill","orangered").style("font-size","14px").transition().duration(n.duration).remove();const r=n.command,l=n.word;u.select(".resetRect").empty()&&(u.append("rect").on("click",function(t){n.data.forEach(t=>t.draw=!0),n.method.click&&C(t),L(),o.clear().render()}).attr("class","resetRect").style("cursor","pointer").style("fill",r.cmdRect.color).attr("width",15).attr("height",15).attr("rx",7.5).attr("ry",7.5).attr("x",0).attr("y",-10).append("title"),u.append("text").attr("class","resetRectLabel").attr("text-anchor","middle").attr("x",7.5).attr("y",2).style("font-family",r.fonts[0]).style("fill",r.fonts[2]).style("font-size",r.fonts[1]).style("pointer-events","none").text("X"));u.attr("transform",()=>`translate(20, ${M()})`),u.select("rect > title").text(()=>{const t=n.measures[0];let e=0;const a=w(!1);a.forEach(a=>{e+=a[t.colNm]}),e=y(e);const o=t.caption+": "+e;return o+" "+c2i.lang.pyramid.py_3});const i=e.enter().append("text").on("click",(t,e)=>{e.draw=!0;const a=w(!1);0===a.length&&s.select("g.outBar rect").style("opacity",0).transition().remove(),n.method.click&&C(t),L(),o.clear().render()}).attr("class","outLabel").style("cursor","pointer").style("font-family",r.fonts[0]).style("fill",r.fonts[2]).style("font-size",r.fonts[1]).attr("dy",1).text(t=>t[l.colNm]);e=i.merge(e),i.append("title").text(t=>t[l.colNm]+" "+c2i.lang.pyramid.py_4+" ("+t[n.measures[0].colNm].toLocaleString()+")").merge(e.selectAll("title"));let c=0;e.transition().attr("x",(t,e)=>{const o=a.getTextWidth(t[l.colNm],r.fonts[1],r.fonts[0]);let n=20;return 0===e?c=o+20:(n=c+5,c+=o+5),n})}()}(),o},o.applyOptionRender=function(){o.clear(),c=c2i.util.getScale(n.word.fontSizeScale),n.groupBy&&n.groupBy.isGroupColor?(m=a.getColorScheme(n.groupBy.color),m=d3.scaleOrdinal().domain(n.data,t=>t[n.groupBy.colNm]).range(m)):m=a.getColorScheme(n.word.color),L(),N(),o.render()},o.setCurrentGroupBy=function(t){return arguments.length?(n.groupBy={caption:t.caption,colNm:t.colNm,isGroupColor:!0},o):n.groupBy},o.setCurrentMeasure=function(t){return arguments.length?(n.measures.forEach(t=>t.draw=!1),n.measure=n.measures.find(e=>{if(e.colNm===t)return e.draw=!0,e}),o):n.measure},o.clear=function(){return r.select("svg").remove(),i&&(i=s=u=void 0),o},o.reRender=function(){D()},o.data=function(t){return arguments.length?(d=t,A(),o):n.data},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.setLang(n),o):n.lang},o.addData=function(t){if(arguments.length)return d.push(t),A(),o},o.addStopWord=function(t){if(arguments.length)return n.command.stopWords,-1===indexOf(t)&&n.command.stopWords.push(t),o},o.exportData=function(t,e){const o=n.title&&n.title.caption?n.title.caption:"";let r=[],l=[],i=o;function s(){i.search(/["|,|\n]/g)>=0?l.push('"'+i+'",'):l.push(i+",")}e||(n.groupBy&&(r.push(n.groupBy.colNm+","),i=n.groupBy.caption?n.groupBy.caption:n.groupBy.colNm),s(),r.push(n.word.colNm+","),i=n.word.caption?n.word.caption:n.word.name,s(),n.measures&&n.measures.forEach(function(t){t.caption.search(/["|,|\n]/g)>=0?l.push('"'+t.caption+'",'):l.push(t.caption+","),r.push(t.colNm+",")})),a.exportData(o,r,l,d,t)},o.lang=function(t){return arguments.length?(n.lang=t.toLowerCase(),a.locale(n),g=c2i.lang,o):n.lang};return n.isResponsive&&a.resizeChart(n,t,D,null),a.createAccessor(o,n)},"object"==typeof module&&module.exports?(this.d3=require("d3"),module.exports=c2i):window.c2i=c2i}();